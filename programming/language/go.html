<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.26" />
    <style>
      :root {
        --vp-c-bg: #fff;
      }

      [data-theme='dark'] {
        --vp-c-bg: #1b1b1f;
      }

      html,
      body {
        background-color: var(--vp-c-bg);
      }
    </style>
    <script>
      const useChoice = localStorage.getItem('vuepress-color-scheme')
      const systemStatus =
        'matchMedia' in window
          ? window.matchMedia('(prefers-color-scheme: dark)').matches
          : false

      if (useChoice === 'light') {
        document.documentElement.dataset.theme = 'light'
      } else if (useChoice === 'dark' || systemStatus) {
        document.documentElement.dataset.theme = 'dark'
      }
    </script>
    <link rel="icon" href="/favicon.png"><title>Go核心语法 | VVFock3r Docs</title><meta name="description" content="VVFock3r Docs">
    <link rel="preload" href="/assets/style-DLxkznZ8.css" as="style"><link rel="stylesheet" href="/assets/style-DLxkznZ8.css">
    <link rel="modulepreload" href="/assets/app-1v6QchTO.js"><link rel="modulepreload" href="/assets/go.html-OifU-vwT.js">
    <link rel="prefetch" href="/assets/index.html-AGZx0vLF.js" as="script"><link rel="prefetch" href="/assets/about.html-BTOEWkHe.js" as="script"><link rel="prefetch" href="/assets/vuepress.html-BLKrC3qW.js" as="script"><link rel="prefetch" href="/assets/Pyenv.html-BnfX46Kp.js" as="script"><link rel="prefetch" href="/assets/python.html-DYW9icSm.js" as="script"><link rel="prefetch" href="/assets/404.html-D9bDT8PP.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><div class="vp-theme-container external-link-icon" vp-container><!--[--><header class="vp-navbar" vp-navbar><div class="vp-toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a class="route-link" href="/"><img class="vp-site-logo" src="/logo.png" alt="VVFock3r Docs"><span class="vp-site-name vp-hide-mobile" aria-hidden="true">VVFock3r Docs</span></a></span><div class="vp-navbar-items-wrapper" style=""><!--[--><!--]--><nav class="vp-navbar-items vp-hide-mobile" aria-label="site navigation"><!--[--><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="💻 编程开发"><span class="title">💻 编程开发</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="💻 编程开发"><span class="title">💻 编程开发</span><span class="right arrow"></span></button><ul class="vp-navbar-dropdown" style="display:none;"><!--[--><li class="vp-navbar-dropdown-item"><!--[--><h4 class="vp-navbar-dropdown-subtitle"><span>🔥 编程语言 · 核心文档</span></h4><ul class="vp-navbar-dropdown-subitem-wrapper"><!--[--><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/programming/language/python.html" aria-label="Python · 语法基础"><!--[--><!--[--><!--]--><!--]-->Python · 语法基础<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/programming/language/python-module.html" aria-label="Python · 常用模块"><!--[--><!--[--><!--]--><!--]-->Python · 常用模块<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-subitem"><a class="route-link route-link-active auto-link" href="/programming/language/go.html" aria-label="Go · 语言语法"><!--[--><!--[--><!--]--><!--]-->Go · 语言语法<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/programming/language/go-module.html" aria-label="Go · 常用模块"><!--[--><!--[--><!--]--><!--]-->Go · 常用模块<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/programming/language/sql.html" aria-label="SQL · 数据库查询"><!--[--><!--[--><!--]--><!--]-->SQL · 数据库查询<!--[--><!--[--><!--]--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/about/about.html" aria-label="ℹ️ 关于"><!--[--><!--[--><!--]--><!--]-->ℹ️ 关于<!--[--><!--[--><!--]--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button type="button" class="vp-toggle-color-mode-button" title="toggle color mode"><svg class="light-icon" viewbox="0 0 32 32" style=""><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg class="dark-icon" viewbox="0 0 32 32" style="display:none;"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!----></div></header><!--]--><div class="vp-sidebar-mask"></div><!--[--><aside class="vp-sidebar" vp-sidebar><nav class="vp-navbar-items" aria-label="site navigation"><!--[--><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="💻 编程开发"><span class="title">💻 编程开发</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="💻 编程开发"><span class="title">💻 编程开发</span><span class="right arrow"></span></button><ul class="vp-navbar-dropdown" style="display:none;"><!--[--><li class="vp-navbar-dropdown-item"><!--[--><h4 class="vp-navbar-dropdown-subtitle"><span>🔥 编程语言 · 核心文档</span></h4><ul class="vp-navbar-dropdown-subitem-wrapper"><!--[--><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/programming/language/python.html" aria-label="Python · 语法基础"><!--[--><!--[--><!--]--><!--]-->Python · 语法基础<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/programming/language/python-module.html" aria-label="Python · 常用模块"><!--[--><!--[--><!--]--><!--]-->Python · 常用模块<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-subitem"><a class="route-link route-link-active auto-link" href="/programming/language/go.html" aria-label="Go · 语言语法"><!--[--><!--[--><!--]--><!--]-->Go · 语言语法<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/programming/language/go-module.html" aria-label="Go · 常用模块"><!--[--><!--[--><!--]--><!--]-->Go · 常用模块<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/programming/language/sql.html" aria-label="SQL · 数据库查询"><!--[--><!--[--><!--]--><!--]-->SQL · 数据库查询<!--[--><!--[--><!--]--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/about/about.html" aria-label="ℹ️ 关于"><!--[--><!--[--><!--]--><!--]-->ℹ️ 关于<!--[--><!--[--><!--]--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="vp-sidebar-items"><!--[--><li><p tabindex="0" class="vp-sidebar-item vp-sidebar-heading">Go核心语法 <!----></p><!----></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="vp-page"><!--[--><!--]--><div vp-content><!--[--><!--]--><div id="content"><h1 id="go核心语法" tabindex="-1"><a class="header-anchor" href="#go核心语法"><span>Go核心语法</span></a></h1><ul><li>官网：<a href="https://go.dev/" target="_blank" rel="noopener noreferrer">https://go.dev/</a></li><li>FAQ：<a href="https://go.dev/doc/faq" target="_blank" rel="noopener noreferrer">https://go.dev/doc/faq</a></li><li>GopherChina：<a href="https://github.com/gopherchina/conference" target="_blank" rel="noopener noreferrer">https://github.com/gopherchina/conference</a></li></ul><br><h2 id="环境设置" tabindex="-1"><a class="header-anchor" href="#环境设置"><span>环境设置</span></a></h2><h3 id="帮助文档" tabindex="-1"><a class="header-anchor" href="#帮助文档"><span>帮助文档</span></a></h3><p>文档：<a href="https://pkg.go.dev/cmd/go" target="_blank" rel="noopener noreferrer">https://pkg.go.dev/cmd/go</a></p><p><code>go</code> 是 <strong>Go 语言的官方命令行工具</strong>，负责 <strong>编译、运行、管理依赖、测试、格式化代码、管理模块</strong> 等所有开发流程</p><table><thead><tr><th>类型</th><th>命令</th><th>注意事项</th></tr></thead><tbody><tr><td>查看Go版本</td><td><code>go version</code></td><td></td></tr><tr><td>查看顶层帮助文档</td><td><code>go</code> 或 <code>go -h</code> 或 <code>go --help</code> 或 <code>go help</code></td><td></td></tr><tr><td>查看子命令帮助文档</td><td><code>go help &lt;command&gt;</code></td><td><code>go &lt;command&gt; -h/--help</code> 看不到详细信息</td></tr></tbody></table><br><h3 id="编译过程" tabindex="-1"><a class="header-anchor" href="#编译过程"><span>编译过程</span></a></h3><p>Go 程序从源码到可执行文件，完整过程可以抽象为三个阶段：</p><blockquote><p><strong>编译 → 汇编 → 链接</strong></p></blockquote><p><code>go build</code> 负责调度整个流水线，而不是亲自&quot;干活&quot;，真正执行工作的是底层的 <code>go tool</code> 工具链</p><div class="language-markdown" data-highlighter="prismjs" data-ext="md"><pre><code class="language-markdown"><span class="line">go build</span>
<span class="line"> ├─ 编译： 调用 go tool compile</span>
<span class="line"> ├─ 汇编:  调用 go tool asm</span>
<span class="line"> └─ 链接:  调用 go tool link</span>
<span class="line"></span></code></pre></div><p><strong>对应参数映射</strong></p><table><thead><tr><th>阶段</th><th>工具</th><th>go build 入口参数</th><th>文档查看</th></tr></thead><tbody><tr><td>编译</td><td>compile</td><td><code>-gcflags</code></td><td><code>go tool compile -h</code></td></tr><tr><td>汇编</td><td>asm</td><td><code>-asmflags</code></td><td><code>go tool asm -h</code></td></tr><tr><td>链接</td><td>link</td><td><code>-ldflags</code></td><td><code>go tool link -h</code></td></tr></tbody></table><blockquote><p>一句话总计：凡是 <code>go build</code> 里以 <code>xxxflags</code> 结尾的参数，真正文档都在 <code>go tool xxx -h</code></p></blockquote><br><h3 id="环境变量" tabindex="-1"><a class="header-anchor" href="#环境变量"><span>环境变量</span></a></h3><p><strong>命令行语法</strong></p><div class="language-bash" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line">go <span class="token builtin class-name">help</span> <span class="token function">env</span>									<span class="token comment"># 查看env命令帮助</span></span>
<span class="line">go <span class="token builtin class-name">help</span> environment							<span class="token comment"># 查看所有环境变量帮助信息</span></span>
<span class="line"></span>
<span class="line">go <span class="token function">env</span> 										<span class="token comment"># 查看所有环境变量</span></span>
<span class="line">go <span class="token function">env</span> <span class="token parameter variable">-json</span>								<span class="token comment"># 查看所有环境变量，json格式</span></span>
<span class="line"></span>
<span class="line">go <span class="token function">env</span> <span class="token punctuation">[</span>VAR1<span class="token punctuation">]</span> <span class="token punctuation">[</span>VAR2<span class="token punctuation">]</span> <span class="token punctuation">[</span>VAR3<span class="token punctuation">]</span>				    <span class="token comment"># 查看某一个或多个具体的环境变量</span></span>
<span class="line">go <span class="token function">env</span> <span class="token parameter variable">-json</span> <span class="token punctuation">[</span>VAR1<span class="token punctuation">]</span> <span class="token punctuation">[</span>VAR2<span class="token punctuation">]</span> <span class="token punctuation">[</span>VAR3<span class="token punctuation">]</span> <span class="token punctuation">..</span>.		<span class="token comment"># 查看某一个或多个具体的环境变量，json格式</span></span>
<span class="line"></span>
<span class="line">go <span class="token function">env</span> <span class="token parameter variable">-w</span> <span class="token assign-left variable">name</span><span class="token operator">=</span>value <span class="token punctuation">[</span>name<span class="token operator">=</span>value <span class="token punctuation">..</span>.<span class="token punctuation">]</span>		<span class="token comment"># 设置环境变量（写入 Go 配置文件，永久生效）</span></span>
<span class="line"></span></code></pre></div><p><strong>推荐设置的环境变量</strong></p><div class="language-bash" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token comment"># 推荐设置的环境变量</span></span>
<span class="line">go <span class="token function">env</span> <span class="token parameter variable">-w</span> <span class="token assign-left variable">GO111MODULE</span><span class="token operator">=</span>on</span>
<span class="line">go <span class="token function">env</span> <span class="token parameter variable">-w</span> <span class="token assign-left variable">GOPROXY</span><span class="token operator">=</span>https://goproxy.cn,direct</span>
<span class="line"></span></code></pre></div><p><strong>常用环境变量</strong></p><details class="hint-container details"><summary>点击查看详情</summary><table><thead><tr><th>分类</th><th>变量</th><th>作用</th></tr></thead><tbody><tr><td><strong>安装路径</strong></td><td><code>GOROOT</code></td><td>Go 安装目录（编译器和标准库所在位置）</td></tr><tr><td></td><td><code>GOPATH</code></td><td>旧工作区目录（模块缓存、工具安装位置）</td></tr><tr><td></td><td><code>GOBIN</code></td><td><code>go install</code> 安装的可执行文件输出目录</td></tr><tr><td></td><td><code>GOCACHE</code></td><td>编译构建缓存目录</td></tr><tr><td></td><td><code>GOMODCACHE</code></td><td>模块下载缓存目录</td></tr><tr><td><strong>模块系统</strong></td><td><code>GOMOD</code></td><td>当前项目的 go.mod 路径</td></tr><tr><td></td><td><code>GOPROXY</code></td><td>模块下载代理地址</td></tr><tr><td></td><td><code>GOPRIVATE</code></td><td>私有模块域名（不走代理和校验）</td></tr><tr><td></td><td><code>GONOSUMDB</code></td><td>指定不使用校验数据库的模块</td></tr><tr><td></td><td><code>GO111MODULE</code></td><td>是否启用 Modules（现代 Go 基本无需设置）</td></tr><tr><td><strong>编译构建</strong></td><td><code>GOOS</code></td><td>目标操作系统</td></tr><tr><td></td><td><code>GOARCH</code></td><td>目标 CPU 架构</td></tr><tr><td></td><td><code>CGO_ENABLED</code></td><td>是否启用 CGO</td></tr><tr><td></td><td><code>GOFLAGS</code></td><td>默认附加到所有 go 命令的 flags</td></tr><tr><td><strong>运行调试</strong></td><td><code>GODEBUG</code></td><td>运行时调试参数</td></tr><tr><td></td><td><code>GOTRACEBACK</code></td><td>panic 堆栈输出级别</td></tr><tr><td><strong>安全下载</strong></td><td><code>GOSUMDB</code></td><td>模块校验数据库</td></tr><tr><td></td><td><code>GOINSECURE</code></td><td>允许不安全下载的模块域</td></tr></tbody></table></details><br><h3 id="gopath" tabindex="-1"><a class="header-anchor" href="#gopath"><span>GOPATH</span></a></h3><div class="hint-container tip"><p class="hint-container-title">GOPATH简介</p><p><strong>GOPATH</strong> 是 Go 的旧工作区，早期用于管理所有项目源码与依赖，在 <strong>Modules</strong> 时代退化为 <strong>模块缓存与工具安装根目录</strong></p><p><strong>默认目录</strong></p><ul><li>Windows：<code>%USERPROFILE%\go</code></li><li>Linux：<code>$HOME/go</code></li></ul><p><strong>GOPATH 时代的核心问题</strong></p><ul><li>依赖无版本</li><li>共享全局目录</li><li>依赖冲突</li><li>构建不可复现</li></ul></div><p><strong>GOPATH目录结构</strong></p><div class="language-markdown" data-highlighter="prismjs" data-ext="md"><pre><code class="language-markdown"><span class="line">$GOPATH/</span>
<span class="line"> ├── pkg/mod/        # 默认模块下载缓存目录（若未设置 GOMODCACHE）</span>
<span class="line"> └── bin/            # go install 安装的可执行文件 (若未设置 GOBIN时)</span>
<span class="line"></span></code></pre></div><br><h3 id="go-modules" tabindex="-1"><a class="header-anchor" href="#go-modules"><span>Go Modules</span></a></h3><div class="hint-container tip"><p class="hint-container-title">Go Modules简介</p><p>Go 1.11 开始引入，Go 1.13 起默认开启，Go 1.16 起 GOPATH 模式默认关闭。<code>GO111MODULE</code> 是用于控制 是否启用 Go Modules 的过渡期开关变量，名字里的 &quot;111&quot; 代表 在 1.11 版本首次引入。</p><hr><p>一个 <strong>Module</strong> 定义为：以 <code>go.mod</code> 文件为根的一组 Go 包集合。</p><ul><li>项目可以位于任意目录，不再依赖 GOPATH/src；</li><li>模块依赖关系写入 <code>go.mod</code></li><li>模块版本校验写入 <code>go.sum</code></li><li>模块下载的依赖缓存于 <code>GOMODCACHE</code>（默认 <code>$GOPATH/pkg/mod</code>）；</li><li>代码编译缓存存放于 <code>GOCACHE</code></li></ul></div><details class="hint-container details"><summary>标准新项目流程</summary><div class="language-bash" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token function">mkdir</span> <span class="token operator">&lt;</span>projectName<span class="token operator">&gt;</span></span>
<span class="line"><span class="token builtin class-name">cd</span> <span class="token operator">&lt;</span>projectName<span class="token operator">&gt;</span></span>
<span class="line">go mod init github.com/<span class="token operator">&lt;</span>username<span class="token operator">&gt;</span>/<span class="token operator">&lt;</span>projectName<span class="token operator">&gt;</span></span>
<span class="line"></span></code></pre></div></details><details class="hint-container details"><summary>常用命令</summary><table><thead><tr><th>命令</th><th>作用</th></tr></thead><tbody><tr><td>go mod init &lt;模块名&gt;</td><td>初始化模块</td></tr><tr><td>go mod tidy</td><td>会根据当前模块的源码 import 情况， <br>自动添加缺失的依赖，并删除未使用的依赖， 同时更新 go.sum，<br>使依赖描述与源码状态完全一致</td></tr><tr><td>go get [模块路径][@版本]</td><td>添加 / 更新依赖</td></tr><tr><td>go list -m all</td><td>查看依赖树</td></tr><tr><td>go mod graph</td><td>依赖图</td></tr><tr><td>go mod vendor</td><td>生成 vendor 目录</td></tr></tbody></table></details><details class="hint-container details"><summary>go mod init 取名问题</summary></details><br><h2 id="基础入门" tabindex="-1"><a class="header-anchor" href="#基础入门"><span>基础入门</span></a></h2><h3 id="变量" tabindex="-1"><a class="header-anchor" href="#变量"><span>变量</span></a></h3><details class="hint-container details"><summary>（1）声明关键字</summary><table><thead><tr><th>关键字</th><th>说明</th></tr></thead><tbody><tr><td><code>var</code></td><td>声明变量</td></tr><tr><td><code>const</code></td><td>声明常量</td></tr><tr><td><code>func</code></td><td>声明函数</td></tr><tr><td><code>type</code></td><td>声明类型</td></tr></tbody></table></details><details class="hint-container details"><summary>（2）声明变量并赋值</summary><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">package</span> main</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token string">&quot;fmt&quot;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token comment">// 声明单个变量</span></span>
<span class="line">	<span class="token comment">//	语法1：var 变量名 变量类型 = 变量值	-- 推荐使用</span></span>
<span class="line">	<span class="token comment">//	语法2：变量名 := 变量值			-- 推荐使用,但仅支持在函数内部使用</span></span>
<span class="line">	<span class="token keyword">var</span> Monday <span class="token builtin">int</span> <span class="token operator">=</span> <span class="token number">1</span></span>
<span class="line">	Tuesday <span class="token operator">:=</span> <span class="token number">2</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 声明多个变量</span></span>
<span class="line">	<span class="token comment">// 语法1:</span></span>
<span class="line">	<span class="token comment">//		var (                                   -- 推荐使用</span></span>
<span class="line">	<span class="token comment">//			变量名1 变量类型 = 变量值</span></span>
<span class="line">	<span class="token comment">//			变量名2 变量类型 = 变量值</span></span>
<span class="line">	<span class="token comment">//		)</span></span>
<span class="line">	<span class="token comment">// 语法2: var 变量名1,变量名2 变量类型 = 变量值1, 变量值2</span></span>
<span class="line">	<span class="token keyword">var</span> <span class="token punctuation">(</span></span>
<span class="line">		Wednesday <span class="token builtin">int</span> <span class="token operator">=</span> <span class="token number">3</span></span>
<span class="line">		Thursday  <span class="token builtin">int</span> <span class="token operator">=</span> <span class="token number">4</span></span>
<span class="line">	<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	<span class="token keyword">var</span> Friday<span class="token punctuation">,</span> Saturday<span class="token punctuation">,</span> Sunday <span class="token builtin">int</span> <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 函数内声明的变量必须要使用，否则编译会报错；函数外的变量可以声明但不使用</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;周一: &quot;</span><span class="token punctuation">,</span> Monday<span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;周二: &quot;</span><span class="token punctuation">,</span> Tuesday<span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;周三: &quot;</span><span class="token punctuation">,</span> Wednesday<span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;周四: &quot;</span><span class="token punctuation">,</span> Thursday<span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;周五: &quot;</span><span class="token punctuation">,</span> Friday<span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;周六: &quot;</span><span class="token punctuation">,</span> Saturday<span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;周日: &quot;</span><span class="token punctuation">,</span> Sunday<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre></div><p>输出结果</p><div class="language-bash" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line">周一:  <span class="token number">1</span></span>
<span class="line">周二:  <span class="token number">2</span></span>
<span class="line">周三:  <span class="token number">3</span></span>
<span class="line">周四:  <span class="token number">4</span></span>
<span class="line">周五:  <span class="token number">5</span></span>
<span class="line">周六:  <span class="token number">6</span></span>
<span class="line">周日:  <span class="token number">7</span></span>
<span class="line"></span></code></pre></div></details><details class="hint-container details"><summary>（3）声明变量不赋值</summary><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">package</span> main</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token string">&quot;fmt&quot;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token comment">// 声明不赋值,默认会使用该类型的零值</span></span>
<span class="line">	<span class="token keyword">var</span> Monday <span class="token builtin">int</span></span>
<span class="line"></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>Monday<span class="token punctuation">)</span> <span class="token comment">// 0</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre></div></details><details class="hint-container details"><summary>（4）声明常量</summary><p>常量使用<code>const</code>关键字声明，与<code>var</code>用法很类似，这里主要演示一下特殊的地方</p><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">package</span> main</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token string">&quot;fmt&quot;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        </span>
<span class="line">	<span class="token comment">// 方式1</span></span>
<span class="line">	<span class="token keyword">const</span> <span class="token punctuation">(</span></span>
<span class="line">		Monday  <span class="token builtin">int</span> <span class="token operator">=</span> <span class="token number">4</span></span>
<span class="line">		Tuesday     <span class="token comment">// 在同一个括号内，若变量值不写，则保持跟距离最近的一个变量 类型和值一样</span></span>
<span class="line">	<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 方式2</span></span>
<span class="line">	<span class="token keyword">const</span> <span class="token punctuation">(</span></span>
<span class="line">		Wednesday <span class="token operator">=</span> <span class="token boolean">iota</span> <span class="token operator">+</span> <span class="token number">3</span> <span class="token comment">// iota初始为0,  0 + 3 = 3</span></span>
<span class="line">		Thursday             <span class="token comment">// 每新增一行iota自增长１, 1 + 3 = 4</span></span>
<span class="line">		Friday               <span class="token comment">//  同理, 2 + 3 =5</span></span>
<span class="line">		Saturday</span>
<span class="line">		Sunday</span>
<span class="line">	<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;周一: &quot;</span><span class="token punctuation">,</span> Monday<span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;周二: &quot;</span><span class="token punctuation">,</span> Tuesday<span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;周三: &quot;</span><span class="token punctuation">,</span> Wednesday<span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;周四: &quot;</span><span class="token punctuation">,</span> Thursday<span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;周五: &quot;</span><span class="token punctuation">,</span> Friday<span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;周六: &quot;</span><span class="token punctuation">,</span> Saturday<span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;周日: &quot;</span><span class="token punctuation">,</span> Sunday<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre></div><p>输出结果</p><div class="language-bash" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line">周一:  <span class="token number">4</span></span>
<span class="line">周二:  <span class="token number">4</span></span>
<span class="line">周三:  <span class="token number">3</span></span>
<span class="line">周四:  <span class="token number">4</span></span>
<span class="line">周五:  <span class="token number">5</span></span>
<span class="line">周六:  <span class="token number">6</span></span>
<span class="line">周日:  <span class="token number">7</span></span>
<span class="line"></span></code></pre></div></details><details class="hint-container details"><summary>（5）指针操作</summary><ul><li><p>指针的值是变量的内存地址</p></li><li><p>使用指针可以在无需知道变量名字的情况下，间接读取或更新变量的值</p></li><li><p>指针类型的零值是nil</p></li><li><p>指针是可以比较的，当两个指针指向同一个变量或两个指针都为nil的时他们才相等</p></li></ul><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">package</span> main</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token string">&quot;fmt&quot;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token comment">// (1) 通过变量获取指针</span></span>
<span class="line">	name <span class="token operator">:=</span> <span class="token string">&quot;Bob&quot;</span>     <span class="token comment">// 声明变量</span></span>
<span class="line">	namePtr <span class="token operator">:=</span> <span class="token operator">&amp;</span>name  <span class="token comment">// 获取这个变量的指针赋值给 namePtr</span></span>
<span class="line">	<span class="token operator">*</span>namePtr <span class="token operator">=</span> <span class="token string">&quot;Jack&quot;</span> <span class="token comment">// 通过指针获取变量，并给这个变量赋值</span></span>
<span class="line"></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span>     <span class="token comment">// Jack</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token operator">*</span>namePtr<span class="token punctuation">)</span> <span class="token comment">// Jack</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// (2) 直接声明指针并赋值</span></span>
<span class="line">	<span class="token keyword">var</span> a <span class="token operator">*</span><span class="token builtin">string</span> <span class="token operator">=</span> namePtr</span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token operator">*</span>a<span class="token punctuation">)</span> <span class="token comment">// Jack</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// (3) 直接声明空指针,后续赋值会引发panic, 原因是并没有进行内存分配,导致无法赋值</span></span>
<span class="line">	<span class="token keyword">var</span> b <span class="token operator">*</span><span class="token builtin">int</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span> <span class="token comment">// &lt;nil&gt;, 指针类型的零值为nil, 这是一个空指针</span></span>
<span class="line">	<span class="token comment">//fmt.Println(*b) // 这会报错, 因为我们自己手动这样创建的指针类型,还没有进行内存分配,解决办法可以使用new和make</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// (4) 对于值类型数据结构,使用new声明和分配内存并返回指针变量</span></span>
<span class="line">	c <span class="token operator">:=</span> <span class="token function">new</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token operator">*</span>c <span class="token operator">=</span> <span class="token number">200</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token operator">*</span>c<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// (5) 对与引用数据结构,使用make声明和分配内存并返回变量(注意返回的不是指针,因为引用类型就没有必要用指针了)</span></span>
<span class="line">	s1 <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span></span>
<span class="line">	s1<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">300</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>s1<span class="token punctuation">)</span>        <span class="token comment">// [300]</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%T\n&quot;</span><span class="token punctuation">,</span> s1<span class="token punctuation">)</span> <span class="token comment">// []int</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre></div></details><br><h3 id="运算符" tabindex="-1"><a class="header-anchor" href="#运算符"><span>运算符</span></a></h3><details class="hint-container details"><summary>（1）算术运算符</summary><p>运算符说明</p><table><thead><tr><th>运算符</th><th>说明</th></tr></thead><tbody><tr><td>+</td><td>加</td></tr><tr><td>-</td><td>减</td></tr><tr><td>*</td><td>乘</td></tr><tr><td>/</td><td>除，<br>整数相除会舍弃小数部分，比如<code>10 /3 = 3</code>, <br>有任意一个是浮点数结果就是浮点数，比如<code>10 / 3.0 = 3.3333333333333335</code></td></tr><tr><td>%</td><td>取余，值的符号和除数符号保持一致<br><code>10 % 3 = 1</code><br><code>10 % -3 = 1</code><br><code>-10 % 3 = -1</code></td></tr><tr><td>++</td><td>支持i++，但不支持++i</td></tr><tr><td>--</td><td>同++</td></tr></tbody></table><p>示例代码</p><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">package</span> main</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token string">&quot;fmt&quot;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>           <span class="token comment">// 2</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>           <span class="token comment">// 0</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span>           <span class="token comment">// 4</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token number">3</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span>           <span class="token comment">// 1, 整数相除会舍弃小数部分</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token number">10</span> <span class="token operator">/</span> <span class="token number">3.0</span><span class="token punctuation">)</span>        <span class="token comment">// 3.3333333333333335</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token number">10</span> <span class="token operator">/</span> <span class="token function">float32</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 3.3333333</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token number">10</span> <span class="token operator">/</span> <span class="token function">float64</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 3.3333333333333335, 默认的浮点数是float64</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token number">10</span> <span class="token operator">%</span> <span class="token number">3</span><span class="token punctuation">)</span>          <span class="token comment">// 1</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">10</span> <span class="token operator">%</span> <span class="token number">3</span><span class="token punctuation">)</span>         <span class="token comment">// -1</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token number">10</span> <span class="token operator">%</span> <span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">)</span>         <span class="token comment">// 1</span></span>
<span class="line"></span>
<span class="line">	i <span class="token operator">:=</span> <span class="token number">1</span></span>
<span class="line">	<span class="token comment">// 下面使用都会报语法错误， i++是一条语句，不是表达式，没有返回值</span></span>
<span class="line">	<span class="token comment">//j := i++</span></span>
<span class="line">	<span class="token comment">//fmt.Println(i++)</span></span>
<span class="line">	i<span class="token operator">++</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token comment">// 2</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre></div></details><br><h3 id="位运算符" tabindex="-1"><a class="header-anchor" href="#位运算符"><span>位运算符</span></a></h3><details class="hint-container details"><summary>（1）原码、反码和补码</summary><ul><li>原码：最高位表示符号位，0表示正，1表示负，所以 -&gt; 0000 0001</li><li>反码 <ul><li>正数的反码等于原码</li><li>负数的反码等于原码按位取反（符号位除外）</li></ul></li><li>补码 <ul><li>正数的补码等于原码</li><li>负数的补码等于反码+1</li></ul></li></ul></details><details class="hint-container details"><summary>（1）^ 按位取反</summary><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">package</span> main</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">(</span></span>
<span class="line">	<span class="token string">&quot;fmt&quot;</span></span>
<span class="line">	<span class="token string">&quot;strconv&quot;</span></span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token comment">// 备注: 这里我们将^作为一元运算符使用，它还可以作为二元运算符使用</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 有符号数字按位取反</span></span>
<span class="line">	<span class="token comment">// 计算公式：^n = (n + 1) * -1 (n是有符号数字，可能是正数也可能是负数)</span></span>
<span class="line">	<span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> v <span class="token operator">:=</span> <span class="token keyword">range</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int32</span><span class="token punctuation">{</span><span class="token operator">-</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">}</span> <span class="token punctuation">{</span></span>
<span class="line">		fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;^int32(%-5s = %d\n&quot;</span><span class="token punctuation">,</span> strconv<span class="token punctuation">.</span><span class="token function">Itoa</span><span class="token punctuation">(</span><span class="token function">int</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;)&quot;</span><span class="token punctuation">,</span> <span class="token operator">^</span>v<span class="token punctuation">)</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 无符号数字按位取反</span></span>
<span class="line">	<span class="token comment">// 计算公式：^n = 该类型最大值 - n （n是无符号数字，&gt;=0）</span></span>
<span class="line">	<span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> v <span class="token operator">:=</span> <span class="token keyword">range</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">uint8</span><span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">}</span> <span class="token punctuation">{</span></span>
<span class="line">		fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;^uint8(%-5s = %d\n&quot;</span><span class="token punctuation">,</span> strconv<span class="token punctuation">.</span><span class="token function">Itoa</span><span class="token punctuation">(</span><span class="token function">int</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;)&quot;</span><span class="token punctuation">,</span> <span class="token operator">^</span>v<span class="token punctuation">)</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre></div><p>输出结果</p><div class="language-bash" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line">^int32<span class="token punctuation">(</span>-200<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">199</span></span>
<span class="line">^int32<span class="token punctuation">(</span>-100<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">99</span></span>
<span class="line">^int32<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>    <span class="token operator">=</span> <span class="token parameter variable">-1</span></span>
<span class="line">^int32<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span>  <span class="token operator">=</span> <span class="token parameter variable">-101</span></span>
<span class="line">^int32<span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span>  <span class="token operator">=</span> <span class="token parameter variable">-201</span></span>
<span class="line"></span>
<span class="line">^uint8<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>    <span class="token operator">=</span> <span class="token number">255</span></span>
<span class="line">^uint8<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>    <span class="token operator">=</span> <span class="token number">254</span></span>
<span class="line">^uint8<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>    <span class="token operator">=</span> <span class="token number">253</span></span>
<span class="line"></span></code></pre></div></details><details class="hint-container details"><summary>（2）左移位 和 右移位</summary><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">package</span> main</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">(</span></span>
<span class="line">	<span class="token string">&quot;fmt&quot;</span></span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token comment">// 左移位</span></span>
<span class="line">	<span class="token comment">// 计算公式：n&lt;&lt;m = n*(2的m次方) （n为10进制数）</span></span>
<span class="line">	<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">3</span><span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span></span>
<span class="line">		<span class="token keyword">for</span> j <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;=</span> <span class="token number">3</span><span class="token punctuation">;</span> j<span class="token operator">++</span> <span class="token punctuation">{</span></span>
<span class="line">			fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%-15s&quot;</span><span class="token punctuation">,</span> fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span><span class="token string">&quot;%d&lt;&lt;%d=%d&quot;</span><span class="token punctuation">,</span> i<span class="token punctuation">,</span> j<span class="token punctuation">,</span> i<span class="token operator">&lt;&lt;</span>j<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">		<span class="token punctuation">}</span></span>
<span class="line">		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 右移位</span></span>
<span class="line">	<span class="token comment">// 计算公式：n&gt;&gt;m = int(n/(2的m次方)) （n为10进制数）</span></span>
<span class="line">	<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">10</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">30</span><span class="token punctuation">;</span> i <span class="token operator">+=</span> <span class="token number">10</span> <span class="token punctuation">{</span></span>
<span class="line">		<span class="token keyword">for</span> j <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;=</span> <span class="token number">3</span><span class="token punctuation">;</span> j<span class="token operator">++</span> <span class="token punctuation">{</span></span>
<span class="line">			fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%-15s&quot;</span><span class="token punctuation">,</span> fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span><span class="token string">&quot;%d&gt;&gt;%d=%d&quot;</span><span class="token punctuation">,</span> i<span class="token punctuation">,</span> j<span class="token punctuation">,</span> i<span class="token operator">&gt;&gt;</span>j<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">		<span class="token punctuation">}</span></span>
<span class="line">		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre></div><p>输出结果</p><div class="language-bash" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token operator"><span class="token file-descriptor important">0</span>&lt;</span><span class="token operator">&lt;</span><span class="token number">0</span><span class="token operator">=</span><span class="token number">0</span>         <span class="token operator"><span class="token file-descriptor important">0</span>&lt;</span><span class="token operator">&lt;</span><span class="token number">1</span><span class="token operator">=</span><span class="token number">0</span>         <span class="token operator"><span class="token file-descriptor important">0</span>&lt;</span><span class="token operator">&lt;</span><span class="token number">2</span><span class="token operator">=</span><span class="token number">0</span>         <span class="token operator"><span class="token file-descriptor important">0</span>&lt;</span><span class="token operator">&lt;</span><span class="token number">3</span><span class="token operator">=</span><span class="token number">0</span>         </span>
<span class="line"><span class="token operator"><span class="token file-descriptor important">1</span>&lt;</span><span class="token operator">&lt;</span><span class="token number">0</span><span class="token operator">=</span><span class="token number">1</span>         <span class="token operator"><span class="token file-descriptor important">1</span>&lt;</span><span class="token operator">&lt;</span><span class="token number">1</span><span class="token operator">=</span><span class="token number">2</span>         <span class="token operator"><span class="token file-descriptor important">1</span>&lt;</span><span class="token operator">&lt;</span><span class="token number">2</span><span class="token operator">=</span><span class="token number">4</span>         <span class="token operator"><span class="token file-descriptor important">1</span>&lt;</span><span class="token operator">&lt;</span><span class="token number">3</span><span class="token operator">=</span><span class="token number">8</span>         </span>
<span class="line"><span class="token operator"><span class="token file-descriptor important">2</span>&lt;</span><span class="token operator">&lt;</span><span class="token number">0</span><span class="token operator">=</span><span class="token number">2</span>         <span class="token operator"><span class="token file-descriptor important">2</span>&lt;</span><span class="token operator">&lt;</span><span class="token number">1</span><span class="token operator">=</span><span class="token number">4</span>         <span class="token operator"><span class="token file-descriptor important">2</span>&lt;</span><span class="token operator">&lt;</span><span class="token number">2</span><span class="token operator">=</span><span class="token number">8</span>         <span class="token operator"><span class="token file-descriptor important">2</span>&lt;</span><span class="token operator">&lt;</span><span class="token number">3</span><span class="token operator">=</span><span class="token number">16</span>        </span>
<span class="line"><span class="token operator"><span class="token file-descriptor important">3</span>&lt;</span><span class="token operator">&lt;</span><span class="token number">0</span><span class="token operator">=</span><span class="token number">3</span>         <span class="token operator"><span class="token file-descriptor important">3</span>&lt;</span><span class="token operator">&lt;</span><span class="token number">1</span><span class="token operator">=</span><span class="token number">6</span>         <span class="token operator"><span class="token file-descriptor important">3</span>&lt;</span><span class="token operator">&lt;</span><span class="token number">2</span><span class="token operator">=</span><span class="token number">12</span>        <span class="token operator"><span class="token file-descriptor important">3</span>&lt;</span><span class="token operator">&lt;</span><span class="token number">3</span><span class="token operator">=</span><span class="token number">24</span>        </span>
<span class="line"></span>
<span class="line"><span class="token number">1</span><span class="token operator"><span class="token file-descriptor important">0</span>&gt;&gt;</span><span class="token number">0</span><span class="token operator">=</span><span class="token number">10</span>       <span class="token number">1</span><span class="token operator"><span class="token file-descriptor important">0</span>&gt;&gt;</span><span class="token number">1</span><span class="token operator">=</span><span class="token number">5</span>        <span class="token number">1</span><span class="token operator"><span class="token file-descriptor important">0</span>&gt;&gt;</span><span class="token number">2</span><span class="token operator">=</span><span class="token number">2</span>        <span class="token number">1</span><span class="token operator"><span class="token file-descriptor important">0</span>&gt;&gt;</span><span class="token number">3</span><span class="token operator">=</span><span class="token number">1</span>        </span>
<span class="line"><span class="token number">2</span><span class="token operator"><span class="token file-descriptor important">0</span>&gt;&gt;</span><span class="token number">0</span><span class="token operator">=</span><span class="token number">20</span>       <span class="token number">2</span><span class="token operator"><span class="token file-descriptor important">0</span>&gt;&gt;</span><span class="token number">1</span><span class="token operator">=</span><span class="token number">10</span>       <span class="token number">2</span><span class="token operator"><span class="token file-descriptor important">0</span>&gt;&gt;</span><span class="token number">2</span><span class="token operator">=</span><span class="token number">5</span>        <span class="token number">2</span><span class="token operator"><span class="token file-descriptor important">0</span>&gt;&gt;</span><span class="token number">3</span><span class="token operator">=</span><span class="token number">2</span>        </span>
<span class="line"><span class="token number">3</span><span class="token operator"><span class="token file-descriptor important">0</span>&gt;&gt;</span><span class="token number">0</span><span class="token operator">=</span><span class="token number">30</span>       <span class="token number">3</span><span class="token operator"><span class="token file-descriptor important">0</span>&gt;&gt;</span><span class="token number">1</span><span class="token operator">=</span><span class="token number">15</span>       <span class="token number">3</span><span class="token operator"><span class="token file-descriptor important">0</span>&gt;&gt;</span><span class="token number">2</span><span class="token operator">=</span><span class="token number">7</span>        <span class="token number">3</span><span class="token operator"><span class="token file-descriptor important">0</span>&gt;&gt;</span><span class="token number">3</span><span class="token operator">=</span><span class="token number">3</span></span>
<span class="line"></span></code></pre></div></details><details class="hint-container details"><summary>（3）左移位示例：KB/MB/GB转换</summary><p><strong>1、不使用位运算</strong></p><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">package</span> main</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token string">&quot;fmt&quot;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">const</span> <span class="token punctuation">(</span></span>
<span class="line">	B  <span class="token operator">=</span> <span class="token number">1</span></span>
<span class="line">	KB <span class="token operator">=</span> <span class="token number">1024</span> <span class="token operator">*</span> B</span>
<span class="line">	MB <span class="token operator">=</span> <span class="token number">1024</span> <span class="token operator">*</span> KB</span>
<span class="line">	GB <span class="token operator">=</span> <span class="token number">1024</span> <span class="token operator">*</span> MB</span>
<span class="line">	TB <span class="token operator">=</span> <span class="token number">1024</span> <span class="token operator">*</span> GB</span>
<span class="line">	PB <span class="token operator">=</span> <span class="token number">1024</span> <span class="token operator">*</span> TB</span>
<span class="line"></span>
<span class="line">	B1000  <span class="token operator">=</span> <span class="token number">1</span></span>
<span class="line">	KB1000 <span class="token operator">=</span> <span class="token number">1000</span> <span class="token operator">*</span> B1000</span>
<span class="line">	MB1000 <span class="token operator">=</span> <span class="token number">1000</span> <span class="token operator">*</span> KB1000</span>
<span class="line">	GB1000 <span class="token operator">=</span> <span class="token number">1000</span> <span class="token operator">*</span> MB1000</span>
<span class="line">	TB1000 <span class="token operator">=</span> <span class="token number">1000</span> <span class="token operator">*</span> GB1000</span>
<span class="line">	PB1000 <span class="token operator">=</span> <span class="token number">1000</span> <span class="token operator">*</span> TB1000</span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>B<span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>KB<span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>MB<span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>GB<span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>TB<span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>PB<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>B1000<span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>KB1000<span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>MB1000<span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>GB1000<span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>TB1000<span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>PB1000<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre></div><p><strong>2、使用位运算</strong></p><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">package</span> main</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token string">&quot;fmt&quot;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">const</span> <span class="token punctuation">(</span></span>
<span class="line">	B <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token punctuation">(</span><span class="token number">10</span> <span class="token operator">*</span> <span class="token boolean">iota</span><span class="token punctuation">)</span></span>
<span class="line">	KB</span>
<span class="line">	MB</span>
<span class="line">	GB</span>
<span class="line">	TB</span>
<span class="line">	PB</span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 对于以1000为单位,并没有想到特别好的办法，哪怕是利用iota只写第一行代码，后面再想一想</span></span>
<span class="line">	B1000  <span class="token operator">=</span> <span class="token number">1</span></span>
<span class="line">	KB1000 <span class="token operator">=</span> <span class="token number">1000</span> <span class="token operator">*</span> B1000</span>
<span class="line">	MB1000 <span class="token operator">=</span> <span class="token number">1000</span> <span class="token operator">*</span> KB1000</span>
<span class="line">	GB1000 <span class="token operator">=</span> <span class="token number">1000</span> <span class="token operator">*</span> MB1000</span>
<span class="line">	TB1000 <span class="token operator">=</span> <span class="token number">1000</span> <span class="token operator">*</span> GB1000</span>
<span class="line">	PB1000 <span class="token operator">=</span> <span class="token number">1000</span> <span class="token operator">*</span> TB1000</span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>B<span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>KB<span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>MB<span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>GB<span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>TB<span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>PB<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>B1000<span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>KB1000<span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>MB1000<span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>GB1000<span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>TB1000<span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>PB1000<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre></div><p>输出结果</p><div class="language-bash" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token number">1</span></span>
<span class="line"><span class="token number">1024</span></span>
<span class="line"><span class="token number">1048576</span></span>
<span class="line"><span class="token number">1073741824</span></span>
<span class="line"><span class="token number">1099511627776</span></span>
<span class="line"><span class="token number">1125899906842624</span></span>
<span class="line"></span>
<span class="line"><span class="token number">1</span></span>
<span class="line"><span class="token number">1000</span></span>
<span class="line"><span class="token number">1000000</span></span>
<span class="line"><span class="token number">1000000000</span></span>
<span class="line"><span class="token number">1000000000000</span></span>
<span class="line"><span class="token number">1000000000000000</span></span>
<span class="line"></span></code></pre></div></details><details class="hint-container details"><summary>（4）左移位示例：构造KB/MB/GB</summary><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">package</span> main</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token string">&quot;fmt&quot;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token comment">// 写法1</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token operator">&lt;&lt;</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token operator">*</span><span class="token number">1024</span><span class="token punctuation">)</span>           <span class="token comment">// 3KB</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token operator">&lt;&lt;</span><span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token operator">*</span><span class="token number">1024</span><span class="token operator">*</span><span class="token number">1024</span><span class="token punctuation">)</span>      <span class="token comment">// 3MB</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token operator">&lt;&lt;</span><span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token operator">*</span><span class="token number">1024</span><span class="token operator">*</span><span class="token number">1024</span><span class="token operator">*</span><span class="token number">1024</span><span class="token punctuation">)</span> <span class="token comment">// 3GB</span></span>
<span class="line"></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 写法2</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token operator">&lt;&lt;</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token operator">*</span><span class="token number">1024</span><span class="token punctuation">)</span>                   <span class="token comment">// 3KB</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token operator">&lt;&lt;</span><span class="token number">10</span><span class="token operator">&lt;&lt;</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token operator">*</span><span class="token number">1024</span><span class="token operator">*</span><span class="token number">1024</span><span class="token punctuation">)</span>          <span class="token comment">// 3MB</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token operator">&lt;&lt;</span><span class="token number">10</span><span class="token operator">&lt;&lt;</span><span class="token number">10</span><span class="token operator">&lt;&lt;</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token operator">*</span><span class="token number">1024</span><span class="token operator">*</span><span class="token number">1024</span><span class="token operator">*</span><span class="token number">1024</span><span class="token punctuation">)</span> <span class="token comment">// 3GB</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre></div><p>输出结果</p><div class="language-bash" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token number">3072</span> <span class="token number">3072</span></span>
<span class="line"><span class="token number">3145728</span> <span class="token number">3145728</span></span>
<span class="line"><span class="token number">3221225472</span> <span class="token number">3221225472</span></span>
<span class="line"></span>
<span class="line"><span class="token number">3072</span> <span class="token number">3072</span></span>
<span class="line"><span class="token number">3145728</span> <span class="token number">3145728</span></span>
<span class="line"><span class="token number">3221225472</span> <span class="token number">3221225472</span></span>
<span class="line"></span></code></pre></div></details><details class="hint-container details"><summary>（5）&amp; 按位与运算</summary><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">package</span> main</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token string">&quot;fmt&quot;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token comment">// 与运算</span></span>
<span class="line">	<span class="token comment">// 对于每一位，只有两个操作数的对应位都为1时，结果才为1，否则为0</span></span>
<span class="line">	x <span class="token operator">:=</span> <span class="token number">15</span></span>
<span class="line">	y <span class="token operator">:=</span> <span class="token number">35</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%10b\n&quot;</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%10b\n&quot;</span><span class="token punctuation">,</span> y<span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%10b\n&quot;</span><span class="token punctuation">,</span> x<span class="token operator">&amp;</span>y<span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%10d\n&quot;</span><span class="token punctuation">,</span> x<span class="token operator">&amp;</span>y<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre></div><p>输出结果</p><div class="language-bash" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line">      <span class="token number">1111</span></span>
<span class="line">    <span class="token number">100011</span></span>
<span class="line">        <span class="token number">11</span></span>
<span class="line">         <span class="token number">3</span></span>
<span class="line"></span></code></pre></div></details><details class="hint-container details"><summary>（6）| 按位或运算</summary><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">package</span> main</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token string">&quot;fmt&quot;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token comment">// 或运算</span></span>
<span class="line">	<span class="token comment">// 1和1 或 = 1</span></span>
<span class="line">	<span class="token comment">// 1和0 或 = 0</span></span>
<span class="line">	<span class="token comment">// 0和0 或 = 0</span></span>
<span class="line">	<span class="token comment">// 0和任何数或都得该数本身</span></span>
<span class="line">	x <span class="token operator">:=</span> <span class="token number">9</span></span>
<span class="line">	y <span class="token operator">:=</span> <span class="token number">5</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%10b\n&quot;</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%10b\n&quot;</span><span class="token punctuation">,</span> y<span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%10b\n&quot;</span><span class="token punctuation">,</span> x<span class="token operator">|</span>y<span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%10d\n&quot;</span><span class="token punctuation">,</span> x<span class="token operator">|</span>y<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre></div><p>输出结果</p><div class="language-bash" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line">      <span class="token number">1001</span></span>
<span class="line">       <span class="token number">101</span></span>
<span class="line">      <span class="token number">1101</span></span>
<span class="line">        <span class="token number">13</span></span>
<span class="line"></span></code></pre></div></details><details class="hint-container details"><summary>（7）| 按位或运算示例：os.OpenFile</summary><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">package</span> main</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">(</span></span>
<span class="line">	<span class="token string">&quot;fmt&quot;</span></span>
<span class="line">	<span class="token string">&quot;log&quot;</span></span>
<span class="line">	<span class="token string">&quot;os&quot;</span></span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token comment">// 一段普通的代码</span></span>
<span class="line">	f<span class="token punctuation">,</span> err <span class="token operator">:=</span> os<span class="token punctuation">.</span><span class="token function">OpenFile</span><span class="token punctuation">(</span><span class="token string">&quot;test.log&quot;</span><span class="token punctuation">,</span> os<span class="token punctuation">.</span>O_RDWR<span class="token operator">|</span>os<span class="token punctuation">.</span>O_CREATE<span class="token operator">|</span>os<span class="token punctuation">.</span>O_TRUNC<span class="token punctuation">,</span> <span class="token number">0777</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span></span>
<span class="line">		log<span class="token punctuation">.</span><span class="token function">Fatalf</span><span class="token punctuation">(</span><span class="token string">&quot;Open file error: %s\n&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line">	<span class="token keyword">defer</span> f<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 分析</span></span>
<span class="line">	<span class="token comment">// 1、os.O_RDWR|os.O_CREATE|os.O_TRUNC 就是一个典型的或运算</span></span>
<span class="line">	<span class="token comment">// 2、O_RDWR    = 0x2    = 2  (转为10进制)</span></span>
<span class="line">	<span class="token comment">// 3、O_CREATE	= 0x40  = 64  (转为10进制)</span></span>
<span class="line">	<span class="token comment">// 4、O_TRUNC   = 0x200 = 512 (转为10进制)</span></span>
<span class="line">	<span class="token comment">// 5、经过或运算之后，由3个数字得到一个数字 578</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%10b %[1]d\n&quot;</span><span class="token punctuation">,</span> os<span class="token punctuation">.</span>O_RDWR<span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%10b %[1]d\n&quot;</span><span class="token punctuation">,</span> os<span class="token punctuation">.</span>O_CREATE<span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%10b %[1]d\n&quot;</span><span class="token punctuation">,</span> os<span class="token punctuation">.</span>O_TRUNC<span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%10b %[1]d\n&quot;</span><span class="token punctuation">,</span> os<span class="token punctuation">.</span>O_RDWR<span class="token operator">|</span>os<span class="token punctuation">.</span>O_CREATE<span class="token operator">|</span>os<span class="token punctuation">.</span>O_TRUNC<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 6、在os.OpenFile函数内部如何判断是否传递了某个参数呢？比如os.O_RDWR</span></span>
<span class="line">	<span class="token comment">//    只需要将【或运算的结果】和某个选项进行【与运算】，如果结果不等于0则代表传递了该参数</span></span>
<span class="line">	flag <span class="token operator">:=</span> os<span class="token punctuation">.</span>O_RDWR <span class="token operator">|</span> os<span class="token punctuation">.</span>O_CREATE <span class="token operator">|</span> os<span class="token punctuation">.</span>O_TRUNC</span>
<span class="line">	<span class="token keyword">if</span> flag<span class="token operator">&amp;</span>os<span class="token punctuation">.</span>O_RDWR <span class="token operator">!=</span> <span class="token number">0</span> <span class="token punctuation">{</span></span>
<span class="line">		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;File is opened in read-write mode&quot;</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre></div><p>输出结果</p><div class="language-bash" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line">        <span class="token number">10</span> <span class="token number">2</span></span>
<span class="line">   <span class="token number">1000000</span> <span class="token number">64</span></span>
<span class="line"><span class="token number">1000000000</span> <span class="token number">512</span></span>
<span class="line"><span class="token number">1001000010</span> <span class="token number">578</span></span>
<span class="line">File is opened <span class="token keyword">in</span> read-write mode</span>
<span class="line"></span></code></pre></div></details><br><h3 id="常用语句" tabindex="-1"><a class="header-anchor" href="#常用语句"><span>常用语句</span></a></h3><details class="hint-container details"><summary>（1）循环语句</summary><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">package</span> main</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">(</span></span>
<span class="line">	<span class="token string">&quot;fmt&quot;</span></span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token comment">// ------------------------- 基础语法 --------------------------------</span></span>
<span class="line">	<span class="token comment">// C语言风格循环</span></span>
<span class="line">	<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span></span>
<span class="line">		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// range循环</span></span>
<span class="line">	list <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">{</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">}</span></span>
<span class="line">	<span class="token keyword">for</span> k<span class="token punctuation">,</span> v <span class="token operator">:=</span> <span class="token keyword">range</span> list <span class="token punctuation">{</span></span>
<span class="line">		fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%#v[%d]=%d\n&quot;</span><span class="token punctuation">,</span> list<span class="token punctuation">,</span> k<span class="token punctuation">,</span> v<span class="token punctuation">)</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 类似while</span></span>
<span class="line">	n <span class="token operator">:=</span> <span class="token number">6</span></span>
<span class="line">	<span class="token keyword">for</span> n <span class="token operator">&lt;=</span> <span class="token number">8</span> <span class="token punctuation">{</span></span>
<span class="line">		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span></span>
<span class="line">		n<span class="token operator">++</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 死循环</span></span>
<span class="line">	<span class="token comment">//for {</span></span>
<span class="line">	<span class="token comment">//	fmt.Println(time.Now())</span></span>
<span class="line">	<span class="token comment">//}</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// ------------------------- 陷阱 --------------------------------</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;\n陷阱代码：&quot;</span><span class="token punctuation">)</span></span>
<span class="line">	data1 <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">{</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">,</span> <span class="token number">300</span><span class="token punctuation">}</span></span>
<span class="line">	data2 <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">*</span><span class="token builtin">int</span><span class="token punctuation">{</span><span class="token punctuation">}</span></span>
<span class="line">	<span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> v <span class="token operator">:=</span> <span class="token keyword">range</span> data1 <span class="token punctuation">{</span></span>
<span class="line">		data2 <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>data2<span class="token punctuation">,</span> <span class="token operator">&amp;</span>v<span class="token punctuation">)</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">	<span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> v <span class="token operator">:=</span> <span class="token keyword">range</span> data2 <span class="token punctuation">{</span></span>
<span class="line">		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token operator">*</span>v<span class="token punctuation">)</span> <span class="token comment">// 输出3个300</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line">	<span class="token comment">// 原因</span></span>
<span class="line">	<span class="token comment">// v是一个临时变量，每次循环并不重新分配内存地址，而是仅改值而已，</span></span>
<span class="line">	<span class="token comment">// 这就导致当最后一次循环完成后，v的值被重置为300</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// ------------------------- 解决 --------------------------------</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;\n修正代码-方式1：&quot;</span><span class="token punctuation">)</span></span>
<span class="line">	data3 <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">*</span><span class="token builtin">int</span><span class="token punctuation">{</span><span class="token punctuation">}</span></span>
<span class="line">	<span class="token keyword">for</span> k<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">:=</span> <span class="token keyword">range</span> data1 <span class="token punctuation">{</span></span>
<span class="line">		data3 <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>data3<span class="token punctuation">,</span> <span class="token operator">&amp;</span>data1<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">// 通过key来获取原始数据data1中的地址</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">	<span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> v <span class="token operator">:=</span> <span class="token keyword">range</span> data3 <span class="token punctuation">{</span></span>
<span class="line">		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token operator">*</span>v<span class="token punctuation">)</span> <span class="token comment">// 输出100 200 300</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;\n修正代码-方式2：&quot;</span><span class="token punctuation">)</span></span>
<span class="line">	data4 <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">*</span><span class="token builtin">int</span><span class="token punctuation">{</span><span class="token punctuation">}</span></span>
<span class="line">	<span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> v <span class="token operator">:=</span> <span class="token keyword">range</span> data1 <span class="token punctuation">{</span></span>
<span class="line">		temp <span class="token operator">:=</span> v <span class="token comment">//使用新变量，每次循环都会重新开辟内存空间</span></span>
<span class="line">		data4 <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>data4<span class="token punctuation">,</span> <span class="token operator">&amp;</span>temp<span class="token punctuation">)</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">	<span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> v <span class="token operator">:=</span> <span class="token keyword">range</span> data4 <span class="token punctuation">{</span></span>
<span class="line">		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token operator">*</span>v<span class="token punctuation">)</span> <span class="token comment">// 输出100 200 300</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre></div><p>输出结果</p><div class="language-bash" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token number">0</span></span>
<span class="line"><span class="token number">1</span>                  </span>
<span class="line"><span class="token number">2</span>                  </span>
<span class="line"><span class="token punctuation">[</span><span class="token punctuation">]</span>int<span class="token punctuation">{</span><span class="token number">3</span>, <span class="token number">4</span>, <span class="token number">5</span><span class="token punctuation">}</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">3</span></span>
<span class="line"><span class="token punctuation">[</span><span class="token punctuation">]</span>int<span class="token punctuation">{</span><span class="token number">3</span>, <span class="token number">4</span>, <span class="token number">5</span><span class="token punctuation">}</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">4</span></span>
<span class="line"><span class="token punctuation">[</span><span class="token punctuation">]</span>int<span class="token punctuation">{</span><span class="token number">3</span>, <span class="token number">4</span>, <span class="token number">5</span><span class="token punctuation">}</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">5</span></span>
<span class="line"><span class="token number">6</span>                  </span>
<span class="line"><span class="token number">7</span>                  </span>
<span class="line"><span class="token number">8</span>                  </span>
<span class="line">                   </span>
<span class="line">陷阱代码：         </span>
<span class="line"><span class="token number">300</span>                </span>
<span class="line"><span class="token number">300</span>                </span>
<span class="line"><span class="token number">300</span>                </span>
<span class="line">                   </span>
<span class="line">修正代码-方式1：   </span>
<span class="line"><span class="token number">100</span>                </span>
<span class="line"><span class="token number">200</span>                </span>
<span class="line"><span class="token number">300</span>                </span>
<span class="line">                   </span>
<span class="line">修正代码-方式2：   </span>
<span class="line"><span class="token number">100</span>                </span>
<span class="line"><span class="token number">200</span>                </span>
<span class="line"><span class="token number">300</span>      </span>
<span class="line"></span></code></pre></div></details><details class="hint-container details"><summary>（2）判断语句</summary><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">package</span> main</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token string">&quot;fmt&quot;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token comment">// if判断</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;if判断&quot;</span><span class="token punctuation">)</span></span>
<span class="line">	a <span class="token operator">:=</span> <span class="token number">100</span></span>
<span class="line">	b <span class="token operator">:=</span> <span class="token number">200</span></span>
<span class="line">	<span class="token keyword">if</span> x<span class="token punctuation">,</span> y <span class="token operator">:=</span> a<span class="token punctuation">,</span> b<span class="token punctuation">;</span> x <span class="token operator">&lt;</span> y <span class="token punctuation">{</span></span>
<span class="line">		fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%d &lt; %d\n&quot;</span><span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">)</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// switch</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;\nswitch判断&quot;</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">5</span><span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span></span>
<span class="line">		<span class="token keyword">switch</span> i <span class="token punctuation">{</span></span>
<span class="line">		<span class="token keyword">case</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">:</span></span>
<span class="line">			fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token string">&quot;0-2&quot;</span><span class="token punctuation">)</span></span>
<span class="line">		<span class="token keyword">case</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">:</span></span>
<span class="line">			fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token string">&quot;1-3&quot;</span><span class="token punctuation">)</span></span>
<span class="line">		<span class="token keyword">default</span><span class="token punctuation">:</span></span>
<span class="line">			fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token string">&quot;Default&quot;</span><span class="token punctuation">)</span></span>
<span class="line">		<span class="token punctuation">}</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;\nswitch-fallthrough判断&quot;</span><span class="token punctuation">)</span></span>
<span class="line">	c <span class="token operator">:=</span> <span class="token number">100</span></span>
<span class="line">	<span class="token keyword">switch</span> c <span class="token punctuation">{</span></span>
<span class="line">	<span class="token keyword">case</span> <span class="token number">50</span><span class="token punctuation">:</span></span>
<span class="line">		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;50&quot;</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token keyword">case</span> <span class="token number">100</span><span class="token punctuation">:</span></span>
<span class="line">		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;100&quot;</span><span class="token punctuation">)</span></span>
<span class="line">		<span class="token keyword">fallthrough</span> <span class="token comment">// 遇到fallthrough，会继续执行代码后面的case， default不执行</span></span>
<span class="line">	<span class="token keyword">case</span> <span class="token number">200</span><span class="token punctuation">:</span></span>
<span class="line">		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;200&quot;</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token keyword">case</span> <span class="token number">300</span><span class="token punctuation">:</span></span>
<span class="line">		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;300&quot;</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token keyword">default</span><span class="token punctuation">:</span></span>
<span class="line">		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;Default&quot;</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre></div><p>输出结果</p><div class="language-bash" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line">if判断</span>
<span class="line"><span class="token number">100</span> <span class="token operator">&lt;</span> <span class="token number">200</span>             </span>
<span class="line">                      </span>
<span class="line">switch判断            </span>
<span class="line"><span class="token number">0</span> <span class="token number">0</span>-2                 </span>
<span class="line"><span class="token number">1</span> <span class="token number">1</span>-3                 </span>
<span class="line"><span class="token number">2</span> <span class="token number">0</span>-2                 </span>
<span class="line"><span class="token number">3</span> <span class="token number">1</span>-3                 </span>
<span class="line"><span class="token number">4</span> Default             </span>
<span class="line">                      </span>
<span class="line">switch-fallthrough判断</span>
<span class="line"><span class="token number">100</span>                   </span>
<span class="line"><span class="token number">200</span></span>
<span class="line"></span></code></pre></div></details><h2 id="" tabindex="-1"><a class="header-anchor" href="#"><span></span></a></h2><h2 id="基本数据类型" tabindex="-1"><a class="header-anchor" href="#基本数据类型"><span>基本数据类型</span></a></h2><h3 id="数字" tabindex="-1"><a class="header-anchor" href="#数字"><span>数字</span></a></h3><details class="hint-container details"><summary>（1）数字类型</summary><p>有符号整数：<code>int8</code>、<code>int16</code>、<code>int32</code>、<code>int64</code></p><p>无符号整数：<code>uint8</code>、<code>uint16</code>、<code>uint32</code>、<code>uint64</code></p><p>浮点数：<code>float32</code>、<code>float64</code></p></details><details class="hint-container details"><summary>（2）各类型取值范围</summary><p>取值范围计算：</p><p>（1）有符号整数： -2的(n-1)次方 ~ (2的(n-1)次方 -1)</p><p>​ 因为第一位表示符号位，实际位数为n-1，同时正数中0代表一个数字，所以正数取值范围要-1</p><p>（2）无符号整数：0 ~ (2的n次方-1)</p><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">package</span> main</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">(</span></span>
<span class="line">	<span class="token string">&quot;fmt&quot;</span></span>
<span class="line">	<span class="token string">&quot;math&quot;</span></span>
<span class="line">	<span class="token string">&quot;strconv&quot;</span></span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token comment">// 计算系统位数(32 or 64)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;当前操作系统位数: %d\n&quot;</span><span class="token punctuation">,</span> strconv<span class="token punctuation">.</span>IntSize<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 有符号整数</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;\n有符号整数&quot;</span><span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;int8 取值范围: %20d ~ %-d\n&quot;</span><span class="token punctuation">,</span> math<span class="token punctuation">.</span>MinInt8<span class="token punctuation">,</span> math<span class="token punctuation">.</span>MaxInt8<span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;int16取值范围: %20d ~ %-d\n&quot;</span><span class="token punctuation">,</span> math<span class="token punctuation">.</span>MinInt16<span class="token punctuation">,</span> math<span class="token punctuation">.</span>MaxInt16<span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;int32取值范围: %20d ~ %-d\n&quot;</span><span class="token punctuation">,</span> math<span class="token punctuation">.</span>MinInt32<span class="token punctuation">,</span> math<span class="token punctuation">.</span>MaxInt32<span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;int64取值范围: %20d ~ %-d\n&quot;</span><span class="token punctuation">,</span> math<span class="token punctuation">.</span>MinInt64<span class="token punctuation">,</span> math<span class="token punctuation">.</span>MaxInt64<span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;int  取值范围: %20d ~ %-d\n&quot;</span><span class="token punctuation">,</span> math<span class="token punctuation">.</span>MinInt<span class="token punctuation">,</span> math<span class="token punctuation">.</span>MaxInt<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 无符号整数</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;\n无符号整数&quot;</span><span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;uint8  取值范围: %d ~ %-d\n&quot;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> math<span class="token punctuation">.</span>MaxUint8<span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;uint16 取值范围: %d ~ %-d\n&quot;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> math<span class="token punctuation">.</span>MaxUint16<span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;uint32 取值范围: %d ~ %-d\n&quot;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> math<span class="token punctuation">.</span>MaxUint32<span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;uint64 取值范围: %d ~ %-d\n&quot;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token function">uint64</span><span class="token punctuation">(</span>math<span class="token punctuation">.</span>MaxUint64<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 这里需要转为uint64</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;uint   取值范围: %d ~ %-d\n&quot;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token function">uint64</span><span class="token punctuation">(</span>math<span class="token punctuation">.</span>MaxUint<span class="token punctuation">)</span><span class="token punctuation">)</span>   <span class="token comment">// 这里需要转为uint64</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 浮点数</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;\n浮点数&quot;</span><span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;float32 取值范围: %10.1e ~ %-10.1e\n&quot;</span><span class="token punctuation">,</span> math<span class="token punctuation">.</span>SmallestNonzeroFloat32<span class="token punctuation">,</span> math<span class="token punctuation">.</span>MaxFloat32<span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;float64 取值范围: %10.1e ~ %-10.1e\n&quot;</span><span class="token punctuation">,</span> math<span class="token punctuation">.</span>SmallestNonzeroFloat64<span class="token punctuation">,</span> math<span class="token punctuation">.</span>MaxFloat64<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre></div><p>输出结果</p><div class="language-bash" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line">当前操作系统位数: <span class="token number">64</span></span>
<span class="line"></span>
<span class="line">有符号整数                                               </span>
<span class="line">int8 取值范围:                 <span class="token parameter variable">-128</span> ~ <span class="token number">127</span>                </span>
<span class="line">int16取值范围:               <span class="token parameter variable">-32768</span> ~ <span class="token number">32767</span>              </span>
<span class="line">int32取值范围:          <span class="token parameter variable">-2147483648</span> ~ <span class="token number">2147483647</span>         </span>
<span class="line">int64取值范围: <span class="token parameter variable">-9223372036854775808</span> ~ <span class="token number">9223372036854775807</span></span>
<span class="line">int  取值范围: <span class="token parameter variable">-9223372036854775808</span> ~ <span class="token number">9223372036854775807</span></span>
<span class="line">                                                         </span>
<span class="line">无符号整数                                               </span>
<span class="line">uint8  取值范围: <span class="token number">0</span> ~ <span class="token number">255</span>                                 </span>
<span class="line">uint16 取值范围: <span class="token number">0</span> ~ <span class="token number">65535</span>                               </span>
<span class="line">uint32 取值范围: <span class="token number">0</span> ~ <span class="token number">4294967295</span>                          </span>
<span class="line">uint64 取值范围: <span class="token number">0</span> ~ <span class="token number">18446744073709551615</span>                </span>
<span class="line">uint   取值范围: <span class="token number">0</span> ~ <span class="token number">18446744073709551615</span>                </span>
<span class="line">                                                         </span>
<span class="line">浮点数                                                   </span>
<span class="line">float32 取值范围:    <span class="token number">1</span>.4e-45 ~ <span class="token number">3</span>.4e+38                   </span>
<span class="line">float64 取值范围:   <span class="token number">4</span>.9e-324 ~ <span class="token number">1</span>.8e+308</span>
<span class="line"></span></code></pre></div></details><details class="hint-container details"><summary>（3）各类型转换注意事项</summary><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">package</span> main</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token string">&quot;fmt&quot;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token comment">// 执行正常,这个容易理解,小范围转大范围</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token function">int16</span><span class="token punctuation">(</span><span class="token function">int8</span><span class="token punctuation">(</span><span class="token number">123</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 123</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 执行报错,这个也容易理解,大范围转小范围,直接报错</span></span>
<span class="line">	<span class="token comment">//fmt.Println(int8(int16(0x1234))) // cannot convert int16(0x1234) (constant 4660 of type int16) to type int8</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 执行正常, 但是结果不对</span></span>
<span class="line">	i <span class="token operator">:=</span> <span class="token number">0x1234</span></span>
<span class="line">	x <span class="token operator">:=</span> <span class="token function">int16</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span></span>
<span class="line">	y <span class="token operator">:=</span> <span class="token function">int8</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%#x&quot;</span><span class="token punctuation">,</span> y<span class="token punctuation">)</span> <span class="token comment">// 0x34,结果明显有错误,丢失了一个字节的数据</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre></div></details><details class="hint-container details"><summary>（4）进制、位数和存储空间</summary><p><strong>1.各个进制的表示方法</strong></p><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">package</span> main</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">(</span></span>
<span class="line">	<span class="token string">&quot;fmt&quot;</span></span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token comment">// 各个进制前缀</span></span>
<span class="line">	<span class="token comment">// 十进制前缀:   无</span></span>
<span class="line">	<span class="token comment">// 二进制前缀:   0b或0B</span></span>
<span class="line">	<span class="token comment">// 八进制前缀:   0o或0O</span></span>
<span class="line">	<span class="token comment">// 十六进制前缀: 0x或0X</span></span>
<span class="line"></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>   <span class="token comment">// 十进制10    =&gt; 十进制10</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token number">0b10</span><span class="token punctuation">)</span> <span class="token comment">// 二进制10    =&gt; 十进制2</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token number">0o10</span><span class="token punctuation">)</span>  <span class="token comment">// 八进制10    =&gt; 十进制8</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token number">0x10</span><span class="token punctuation">)</span> <span class="token comment">// 十六进制10  =&gt; 十进制16</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre></div><p><strong>2、字节和二进制位的关系</strong></p><ul><li><p>一个字节等于8个二进制位所占据的存储空间</p></li><li><p>简单地说就是，一个字节 = 8位，1byte = 8bit</p></li></ul><p><strong>3、一个十六进制数字需要多少位二进制数字才能表示</strong></p><ul><li>1位二进制，能表示2个数字，2的1次方 = 2，即0和1</li><li>2位二进制，能表示4个数字，2的2次方 = 4</li><li>3位二进制，能表示8个数字，2的3次方 = 8</li><li>4位二进制，能表示16个数字，2的4次方 = 16</li><li>所以说，一位16进制数字需要4位二进制数字才能表示，同理8进制需要3位二进制数</li></ul><p><strong>4、int8、int16、int32、int64这里的数字代表啥？</strong></p><p>int8代表占据8个二进制的存储空间，，同理int64代表会占据64个二进制的存储空间，</p><p>即int8类型会占据1个字节存储空间，int64会占据8个字节存储空间</p><p>5、<code>0x1234</code>占据几个字节</p><ul><li><p>首先他是一个数字，没有说明具体的Go类型的话就是<code>int</code>类型，根据所处的平台位数可能是<code>int32</code>和<code>int64</code>。</p><p>大多数系统都是64位，所以可以理解为它占据8个字节</p></li><li><p>其次，我们从二进制位来分析一下：</p><ul><li><code>0x</code>代表是十六进制数字，总共有4位，一位十六进制数字等于四位二进制数，所以换算成二进制位数就是 4 * 4 = 16位二进制数</li><li>那么它就可以被转换为<code>int16</code>类型，即<code>int16(0x1234)</code>，转换完成后它只会占据16位二进制，所以此时它占据2个字节的存储空间</li></ul></li><li><p>总结：根据<code>0x1234</code>类型的不同，可能会占据2、4、8个字节</p></li></ul><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">package</span> main</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">(</span></span>
<span class="line">	<span class="token string">&quot;fmt&quot;</span></span>
<span class="line">	<span class="token string">&quot;unsafe&quot;</span></span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>unsafe<span class="token punctuation">.</span><span class="token function">Sizeof</span><span class="token punctuation">(</span><span class="token number">0x1234</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token comment">// 8</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>unsafe<span class="token punctuation">.</span><span class="token function">Sizeof</span><span class="token punctuation">(</span><span class="token function">int16</span><span class="token punctuation">(</span><span class="token number">0x1234</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 2</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>unsafe<span class="token punctuation">.</span><span class="token function">Sizeof</span><span class="token punctuation">(</span><span class="token function">int32</span><span class="token punctuation">(</span><span class="token number">0x1234</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 4</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>unsafe<span class="token punctuation">.</span><span class="token function">Sizeof</span><span class="token punctuation">(</span><span class="token function">int64</span><span class="token punctuation">(</span><span class="token number">0x1234</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 8</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre></div></details><details class="hint-container details"><summary>（5）科学计数法</summary><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">package</span> main</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token string">&quot;fmt&quot;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token comment">// 科学计数法是一种用于表示非常大或非常小的数的方法，它使用指数形式来表示数字</span></span>
<span class="line">	<span class="token comment">// 计数格式: &lt;m&gt;e&lt;n&gt;</span></span>
<span class="line">	<span class="token comment">// 计算方法： m * n的10次方法</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%f\n&quot;</span><span class="token punctuation">,</span> <span class="token number">1e9</span><span class="token punctuation">)</span>   <span class="token comment">// 1 * 10的9次方   = 1 * 10^9     = 10亿</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%f\n&quot;</span><span class="token punctuation">,</span> <span class="token number">2e3</span><span class="token punctuation">)</span>   <span class="token comment">// 2 * 10的3次方   = 2 * 10^3     = 2000</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%f\n&quot;</span><span class="token punctuation">,</span> <span class="token number">1e-5</span><span class="token punctuation">)</span>  <span class="token comment">// 1 * 10的-5次方  = 1 * 10(^-5)  = 0.00001</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%f\n&quot;</span><span class="token punctuation">,</span> <span class="token number">75e-2</span><span class="token punctuation">)</span> <span class="token comment">// 75 * 10的-2次方 = 75 * 10(^-2) = 0.75</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre></div><p>输出结果</p><div class="language-bash" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line">D:<span class="token punctuation">\</span>application<span class="token punctuation">\</span>GoLand<span class="token punctuation">\</span>example<span class="token operator">&gt;</span>go run main.go</span>
<span class="line"><span class="token number">1000000000.000000</span></span>
<span class="line"><span class="token number">2000.000000</span></span>
<span class="line"><span class="token number">0.000010</span></span>
<span class="line"><span class="token number">0.750000</span></span>
<span class="line"></span></code></pre></div></details><br><h3 id="字符串" tabindex="-1"><a class="header-anchor" href="#字符串"><span>字符串</span></a></h3><details class="hint-container details"><summary>（1）三种类型声明</summary><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">package</span> main</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token string">&quot;fmt&quot;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token comment">// 字符串声明</span></span>
<span class="line">	<span class="token keyword">var</span> s1 <span class="token builtin">string</span> <span class="token operator">=</span> <span class="token string">&quot;\&quot;hello\&quot; world!&quot;</span> <span class="token comment">// (1) 方法1：使用双引号，如果字符串也包含双引号则需要转义</span></span>
<span class="line">	<span class="token keyword">var</span> s2 <span class="token builtin">string</span> <span class="token operator">=</span> `<span class="token string">&quot;hello&quot;</span> world<span class="token operator">!</span>`   <span class="token comment">// (2) 方法2：使用反引号，不需要转义，支持多行字符串</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%s\n&quot;</span><span class="token punctuation">,</span> s1<span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%s\n&quot;</span><span class="token punctuation">,</span> s2<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 字节声明</span></span>
<span class="line">	<span class="token keyword">var</span> b1 <span class="token builtin">byte</span> <span class="token operator">=</span> <span class="token char">&#39;a&#39;</span>      <span class="token comment">// 使用单引号声明</span></span>
<span class="line">	<span class="token keyword">var</span> b2 <span class="token builtin">uint8</span> <span class="token operator">=</span> <span class="token char">&#39;b&#39;</span>     <span class="token comment">// byte的本质就是uint8, 代表一个ASCII字符，无法表示中文</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%c\n&quot;</span><span class="token punctuation">,</span> b1<span class="token punctuation">)</span> <span class="token comment">// 可以使用%c或%q，不能使用%s</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%q\n&quot;</span><span class="token punctuation">,</span> b2<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 字符声明</span></span>
<span class="line">	<span class="token keyword">var</span> r1 <span class="token builtin">rune</span> <span class="token operator">=</span> <span class="token char">&#39;中&#39;</span>  <span class="token comment">// 使用单引号声明</span></span>
<span class="line">	<span class="token keyword">var</span> r2 <span class="token builtin">int32</span> <span class="token operator">=</span> <span class="token char">&#39;国&#39;</span> <span class="token comment">// rune的本质就是int32, 代表一个Unicode字符，除了能表示ASCII还能表示中文</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%c\n&quot;</span><span class="token punctuation">,</span> r1<span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%q\n&quot;</span><span class="token punctuation">,</span> r2<span class="token punctuation">)</span> <span class="token comment">// 可以使用%c或%q，不能使用%s</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre></div><p>输出结果</p><div class="language-bash" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token string">&quot;hello&quot;</span> world<span class="token operator">!</span></span>
<span class="line"><span class="token string">&quot;hello&quot;</span> world<span class="token operator">!</span></span>
<span class="line">a             </span>
<span class="line"><span class="token string">&#39;b&#39;</span>           </span>
<span class="line">中            </span>
<span class="line"><span class="token string">&#39;国&#39;</span></span>
<span class="line"></span></code></pre></div></details><details class="hint-container details"><summary>（2）字符串的本质就是字节数组</summary><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">package</span> main</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">(</span></span>
<span class="line">	<span class="token string">&quot;fmt&quot;</span></span>
<span class="line">	<span class="token string">&quot;unicode/utf8&quot;</span></span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token comment">// 字符串定义</span></span>
<span class="line">	s1 <span class="token operator">:=</span> <span class="token string">&quot;北京欢迎你&quot;</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;        字符串: %-s\n&quot;</span><span class="token punctuation">,</span> s1<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// ------------------------------------------------------------------</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 计算字符串长度</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;计算字符串长度: %d\n&quot;</span><span class="token punctuation">,</span> <span class="token function">len</span><span class="token punctuation">(</span>s1<span class="token punctuation">)</span><span class="token punctuation">)</span>            <span class="token comment">// 15</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;  计算字节长度: %d\n&quot;</span><span class="token punctuation">,</span> <span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span>s1<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>   <span class="token comment">// 15</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;  计算rune长度: %d\n&quot;</span><span class="token punctuation">,</span> <span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">rune</span><span class="token punctuation">(</span>s1<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 5</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;  计算rune长度: %d\n&quot;</span><span class="token punctuation">,</span> utf8<span class="token punctuation">.</span><span class="token function">RuneCountInString</span><span class="token punctuation">(</span>s1<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 5</span></span>
<span class="line">    </span>
<span class="line">	<span class="token comment">// ------------------------------------------------------------------</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 按照字节遍历 - 遍历出来是乱码</span></span>
<span class="line">	<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token function">len</span><span class="token punctuation">(</span>s1<span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span></span>
<span class="line">		fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;string[%d]=%c\n&quot;</span><span class="token punctuation">,</span> i<span class="token punctuation">,</span> s1<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 按照字节数组遍历 - 遍历出来是乱码，和上面的结果是一样的</span></span>
<span class="line">	s2 <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span>s1<span class="token punctuation">)</span></span>
<span class="line">	<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token function">len</span><span class="token punctuation">(</span>s2<span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span></span>
<span class="line">		fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;string[%d]=%c\n&quot;</span><span class="token punctuation">,</span> i<span class="token punctuation">,</span> s2<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line">	<span class="token comment">// 使用range遍历 - 下标具有不确定性</span></span>
<span class="line">	<span class="token keyword">for</span> index<span class="token punctuation">,</span> value <span class="token operator">:=</span> <span class="token keyword">range</span> s1 <span class="token punctuation">{</span></span>
<span class="line">		fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;string[%d]=%c\n&quot;</span><span class="token punctuation">,</span> index<span class="token punctuation">,</span> value<span class="token punctuation">)</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 使用rune遍历 - 完美</span></span>
<span class="line">	s3 <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">rune</span><span class="token punctuation">(</span>s1<span class="token punctuation">)</span></span>
<span class="line">	<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token function">len</span><span class="token punctuation">(</span>s3<span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span></span>
<span class="line">		fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;string[%d]=%c\n&quot;</span><span class="token punctuation">,</span> i<span class="token punctuation">,</span> s3<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre></div><p>输出结果</p><div class="language-bash" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line">        字符串: 北京欢迎你</span>
<span class="line">计算字符串长度: <span class="token number">15</span></span>
<span class="line">  计算字节长度: <span class="token number">15</span></span>
<span class="line">  计算rune长度: <span class="token number">5</span> </span>
<span class="line">  计算rune长度: <span class="token number">5</span> </span>
<span class="line"></span>
<span class="line">中间乱码省略<span class="token punctuation">..</span>.</span>
<span class="line"></span>
<span class="line">string<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">=</span>北</span>
<span class="line">string<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token operator">=</span>京</span>
<span class="line">string<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token operator">=</span>欢</span>
<span class="line">string<span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token operator">=</span>迎</span>
<span class="line">string<span class="token punctuation">[</span><span class="token number">12</span><span class="token punctuation">]</span><span class="token operator">=</span>你</span>
<span class="line">string<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">=</span>北</span>
<span class="line">string<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">=</span>京</span>
<span class="line">string<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token operator">=</span>欢</span>
<span class="line">string<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token operator">=</span>迎</span>
<span class="line">string<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token operator">=</span>你</span>
<span class="line"></span></code></pre></div></details><details class="hint-container details"><summary>（3）strings包介绍</summary><p>官方文档：<a href="https://pkg.go.dev/strings" target="_blank" rel="noopener noreferrer">https://pkg.go.dev/strings</a></p><p>中文文档：<a href="https://studygolang.com/static/pkgdoc/pkg/strings.htm" target="_blank" rel="noopener noreferrer">https://studygolang.com/static/pkgdoc/pkg/strings.htm</a></p><p>常用函数</p><table><thead><tr><th>分类</th><th>函数</th><th>说明</th></tr></thead><tbody><tr><td>字符串相等</td><td><code>func EqualFold(s, t string) bool</code></td><td>判断两个<code>UTF-8</code>字符串是否相等，不区分大小写</td></tr><tr><td>前后缀判断</td><td><code>func HasPrefix(s, prefix string) bool</code></td><td>判断<code>s</code>是否有前缀字符串<code>prefix</code></td></tr><tr><td></td><td><code>func HasSuffix(s, suffix string) bool</code></td><td>判断<code>s</code>是否有后缀字符串<code>suffix </code></td></tr><tr><td>字符串包含</td><td><code>func Contains(s, substr string) bool</code></td><td>判断字符串<code>s</code>是否包含子串<code>substr</code></td></tr><tr><td></td><td><code>func ContainsRune(s string, r rune) bool</code></td><td>判断字符串s是否包含<code>utf-8</code>码值<code>r</code></td></tr><tr><td></td><td><code>func ContainsAny(s, chars string) bool</code></td><td>判断字符串s是否包含字符串<code>chars</code>中的任一字符</td></tr><tr><td>大小写</td><td><code>func ToLower(s string) string</code></td><td>返回将所有字母都转为对应的小写版本的拷贝</td></tr><tr><td></td><td><code>func ToUpper(s string) string</code></td><td>返回将所有字母都转为对应的大写版本的拷贝</td></tr><tr><td>清除</td><td><code>func Trim(s string, cutset string) string</code></td><td>返回将s前后端所有<code>cutset</code>包含的<code>utf-8</code>码值都去掉的字符串</td></tr><tr><td></td><td><code>func TrimSpace(s string) string</code></td><td>返回将s前后端所有空白都去掉的字符串</td></tr><tr><td></td><td><code>func TrimFunc(s string, f func(rune) bool) string</code></td><td>返回将s前后端所有满足<code>f</code>的<code>unicode</code>码值都去掉的字符串</td></tr><tr><td>分割</td><td><code>func Split(s, sep string) []string</code></td><td>以<code>sep</code>作为分割符分割字符串直接末尾，<br>如果<code>sep</code>为空则返回每个<code>Unicode</code>码点</td></tr><tr><td></td><td><code>func SplitN(s, sep string, n int) []string</code></td><td>同<code>Split</code>，参数<code>n</code>决定返回的切片的数目<br><code>n</code> == 0，返回<code>nil</code>（空切片零值）<br><code>n</code> &gt; 0 返回的切片最多n个子字符串；最后一个子字符串包含未进行切割的部分<br><code>n</code> &lt; 0 : 返回所有的子字符串组成的切片</td></tr><tr><td></td><td><code>func SplitAfter(s, sep string) []string</code></td><td>同<code>Split</code>，只是会保留分隔符</td></tr><tr><td></td><td></td><td></td></tr><tr><td>连接</td><td><code>func Join(a []string, sep string) string</code></td><td>将一系列字符串连接为一个字符串，之间用sep来分隔</td></tr></tbody></table><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">package</span> main</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">(</span></span>
<span class="line">	<span class="token string">&quot;fmt&quot;</span></span>
<span class="line">	<span class="token string">&quot;strings&quot;</span></span>
<span class="line">	<span class="token string">&quot;unicode&quot;</span></span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token comment">// 字符串相等判断</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;字符串相等判断&quot;</span><span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>strings<span class="token punctuation">.</span><span class="token function">EqualFold</span><span class="token punctuation">(</span><span class="token string">&quot;go&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;GO&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// true, 不区分大小写</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;go&quot;</span> <span class="token operator">==</span> <span class="token string">&quot;GO&quot;</span><span class="token punctuation">)</span>                  <span class="token comment">// false, 区分大小写</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 字符串前后缀匹配</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;\n字符串前后缀匹配&quot;</span><span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>strings<span class="token punctuation">.</span><span class="token function">HasPrefix</span><span class="token punctuation">(</span><span class="token string">&quot;hello&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;he&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>strings<span class="token punctuation">.</span><span class="token function">HasPrefix</span><span class="token punctuation">(</span><span class="token string">&quot;hello&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot; he&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 字符串包含匹配</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;\n字符串包含匹配&quot;</span><span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>strings<span class="token punctuation">.</span><span class="token function">Contains</span><span class="token punctuation">(</span><span class="token string">&quot;hello&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;ell&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>strings<span class="token punctuation">.</span><span class="token function">ContainsRune</span><span class="token punctuation">(</span><span class="token string">&quot;中华人民共和国&quot;</span><span class="token punctuation">,</span> <span class="token char">&#39;人&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>strings<span class="token punctuation">.</span><span class="token function">ContainsAny</span><span class="token punctuation">(</span><span class="token string">&quot;中华人民共和国&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;你是哪里的人啊？&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 大小写转换</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;\n大小写转换&quot;</span><span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>strings<span class="token punctuation">.</span><span class="token function">ToLower</span><span class="token punctuation">(</span><span class="token string">&quot;Hello&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// hello</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 清除</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;\n清除&quot;</span><span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>strings<span class="token punctuation">.</span><span class="token function">Trim</span><span class="token punctuation">(</span><span class="token string">&quot;hello world!&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;l!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                       <span class="token comment">// hello world, !被清除了，说明并没有将l!作为一个整体</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>strings<span class="token punctuation">.</span><span class="token function">Trim</span><span class="token punctuation">(</span><span class="token string">&quot;@!hello world!&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;!@&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                     <span class="token comment">// hello world, 再次测试一下，验证成功</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>strings<span class="token punctuation">.</span><span class="token function">TrimSpace</span><span class="token punctuation">(</span><span class="token string">&quot; 	hello world &quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                      <span class="token comment">// 清除两侧的空白</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>strings<span class="token punctuation">.</span><span class="token function">TrimFunc</span><span class="token punctuation">(</span><span class="token string">&quot; hello world HAHA&quot;</span><span class="token punctuation">,</span> <span class="token keyword">func</span><span class="token punctuation">(</span>r <span class="token builtin">rune</span><span class="token punctuation">)</span> <span class="token builtin">bool</span> <span class="token punctuation">{</span> <span class="token comment">// 清除两侧的空白和大写字母</span></span>
<span class="line">		<span class="token keyword">return</span> unicode<span class="token punctuation">.</span><span class="token function">IsSpace</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span> <span class="token operator">||</span> unicode<span class="token punctuation">.</span><span class="token function">IsUpper</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span></span>
<span class="line">	<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 分割</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;\n分割&quot;</span><span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%q\n&quot;</span><span class="token punctuation">,</span> strings<span class="token punctuation">.</span><span class="token function">Split</span><span class="token punctuation">(</span><span class="token string">&quot;a,b,c&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;,&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>     <span class="token comment">// [&quot;a&quot; &quot;b&quot; &quot;c&quot;]</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%q\n&quot;</span><span class="token punctuation">,</span> strings<span class="token punctuation">.</span><span class="token function">Split</span><span class="token punctuation">(</span><span class="token string">&quot;aab&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;a&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>       <span class="token comment">// [&quot;&quot; &quot;&quot; &quot;b&quot;]</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%q\n&quot;</span><span class="token punctuation">,</span> strings<span class="token punctuation">.</span><span class="token function">Split</span><span class="token punctuation">(</span><span class="token string">&quot;a b c&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>      <span class="token comment">// [&quot;a&quot; &quot; &quot; &quot;b&quot; &quot; &quot; &quot;c&quot;]</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%q\n&quot;</span><span class="token punctuation">,</span> strings<span class="token punctuation">.</span><span class="token function">SplitN</span><span class="token punctuation">(</span><span class="token string">&quot;a b c&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 参数n决定返回的切片的数目</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 连接</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;\n连接&quot;</span><span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>strings<span class="token punctuation">.</span><span class="token function">Join</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span><span class="token string">&quot;hello&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;world&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;!&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot; &quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre></div><p>输出结果</p><div class="language-bash" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line">字符串相等判断</span>
<span class="line"><span class="token boolean">true</span>            </span>
<span class="line"><span class="token boolean">false</span>           </span>
<span class="line">                </span>
<span class="line">字符串前后缀匹配</span>
<span class="line"><span class="token boolean">true</span>            </span>
<span class="line"><span class="token boolean">false</span>           </span>
<span class="line">                </span>
<span class="line">字符串包含匹配  </span>
<span class="line"><span class="token boolean">true</span>            </span>
<span class="line"><span class="token boolean">true</span>            </span>
<span class="line"><span class="token boolean">true</span>            </span>
<span class="line">                </span>
<span class="line">大小写转换      </span>
<span class="line">hello           </span>
<span class="line">                </span>
<span class="line">清除            </span>
<span class="line">hello world     </span>
<span class="line">hello world     </span>
<span class="line">hello world     </span>
<span class="line">hello world     </span>
<span class="line">                </span>
<span class="line">分割            </span>
<span class="line"><span class="token punctuation">[</span><span class="token string">&quot;a&quot;</span> <span class="token string">&quot;b&quot;</span> <span class="token string">&quot;c&quot;</span><span class="token punctuation">]</span>   </span>
<span class="line"><span class="token punctuation">[</span><span class="token string">&quot;&quot;</span> <span class="token string">&quot;&quot;</span> <span class="token string">&quot;b&quot;</span><span class="token punctuation">]</span>     </span>
<span class="line"><span class="token punctuation">[</span><span class="token string">&quot;a&quot;</span> <span class="token string">&quot; &quot;</span> <span class="token string">&quot;b&quot;</span> <span class="token string">&quot; &quot;</span> <span class="token string">&quot;c&quot;</span><span class="token punctuation">]</span></span>
<span class="line"><span class="token punctuation">[</span><span class="token string">&quot;a b c&quot;</span><span class="token punctuation">]</span></span>
<span class="line"></span>
<span class="line">连接</span>
<span class="line">hello world <span class="token operator">!</span></span>
<span class="line"></span></code></pre></div></details><details class="hint-container details"><summary>（4）bytes包介绍</summary><p>官方文档：<a href="https://pkg.go.dev/bytes" target="_blank" rel="noopener noreferrer">https://pkg.go.dev/bytes</a></p><p>中文文档：<a href="https://studygolang.com/static/pkgdoc/pkg/bytes.htm" target="_blank" rel="noopener noreferrer">https://studygolang.com/static/pkgdoc/pkg/bytes.htm</a></p><p>bytes包实现了操作<code>[]byte</code>的常用函数，与<code>string</code>包函数类似，简单介绍几个方法</p><table><thead><tr><th>分类</th><th>函数</th><th>说明</th></tr></thead><tbody><tr><td>相等判断</td><td><code>func Equal(a, b []byte) bool</code></td><td>判断两个切片的内容是否完全相同</td></tr><tr><td></td><td><code>func EqualFold(s, t []byte) bool</code></td><td>判断两个<code>utf-8</code>编码切片（将unicode大写、小写、标题三种格式字符视为相同）是否相同</td></tr><tr><td>转换</td><td><code>func Runes(s []byte) []rune</code></td><td>返回和s等价的[]rune切片</td></tr></tbody></table><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">package</span> main</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">(</span></span>
<span class="line">	<span class="token string">&quot;bytes&quot;</span></span>
<span class="line">	<span class="token string">&quot;fmt&quot;</span></span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token comment">// 字节切片相等判断</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;字节切片相等判断&quot;</span><span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>bytes<span class="token punctuation">.</span><span class="token function">Equal</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span><span class="token string">&quot;ABC&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span><span class="token string">&quot;ABC&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>     <span class="token comment">// 完全相等</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>bytes<span class="token punctuation">.</span><span class="token function">EqualFold</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span><span class="token string">&quot;ABC&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span><span class="token string">&quot;abc&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 不区分大小写</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 转换</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;\n转换&quot;</span><span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%q\n&quot;</span><span class="token punctuation">,</span> bytes<span class="token punctuation">.</span><span class="token function">Runes</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span><span class="token string">&quot;你好&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 输出结果</span></span>
<span class="line"><span class="token comment">// true</span></span>
<span class="line"><span class="token comment">// true       </span></span>
<span class="line"><span class="token comment">// [&#39;你&#39; &#39;好&#39;]</span></span>
<span class="line"></span></code></pre></div></details><details class="hint-container details"><summary>（5）unicode系列包介绍</summary><p><strong>介绍</strong></p><p><code>unicode</code>包包含基本的字符判断函数。</p><p><code>utf8</code>包主要负责<code>rune</code>和<code>byte</code>之间的转换。</p><p><code>utf16</code>包负责<code>rune</code>和<code>uint16</code>数组之间的转换</p><br><p><strong>官方文档</strong></p><p><code>unicode</code>：<a href="https://pkg.go.dev/unicode" target="_blank" rel="noopener noreferrer">https://pkg.go.dev/unicode</a></p><p><code>unicode/utf8</code>：<a href="https://pkg.go.dev/unicode/utf8" target="_blank" rel="noopener noreferrer">https://pkg.go.dev/unicode/utf8</a></p><p><code>unicode/utf16</code>：<a href="https://pkg.go.dev/unicode/utf16" target="_blank" rel="noopener noreferrer">https://pkg.go.dev/unicode/utf16</a></p><br><p><strong>函数</strong></p><table><thead><tr><th>包名</th><th>分类</th><th>函数</th><th>说明</th></tr></thead><tbody><tr><td><code>unicode</code></td><td>字符判断</td><td><code>func Is(rangeTab *RangeTable, r rune) bool</code></td><td>判断<code>r</code>是否在<code>RangeTable</code>内</td></tr><tr><td></td><td></td><td><code>func IsSpace(r rune) bool</code></td><td>是否是空白字符（空字符串会报错）</td></tr><tr><td></td><td></td><td><code>func IsDigit(r rune) bool</code></td><td>是否是十进制数字</td></tr><tr><td></td><td></td><td><code>func IsNumber(r rune) bool</code></td><td>是否是数字</td></tr><tr><td></td><td></td><td><code>func IsLetter(r rune) bool</code></td><td>是否是字母</td></tr><tr><td></td><td></td><td><code>func IsLower(r rune) bool</code></td><td>是否是小写字母</td></tr><tr><td></td><td></td><td><code>func IsUpper(r rune) bool</code></td><td>是否是大写字母</td></tr><tr><td></td><td>转换</td><td><code>func ToLower(r rune) rune</code></td><td>返回对应的小写字符</td></tr><tr><td></td><td></td><td><code>func ToUpper(r rune) rune</code></td><td>返回对应的小写字符</td></tr><tr><td><code>unicode/utf8</code></td><td>bytes转rune</td><td><code>func DecodeRune(p []byte) (r rune, size int)</code></td><td>解码 []byte中<strong>第一个</strong><code>UTF-8</code> 编码序列，返回该码值和长度</td></tr><tr><td></td><td></td><td><code>func DecodeLastRune(p []byte) (r rune, size int)</code></td><td>同<code>DecodeRune</code>，是最后一个<code>UTF-8</code> 编码序列</td></tr><tr><td></td><td></td><td><code>func DecodeRuneInString(s string) (r rune, size int)</code></td><td>同<code>DecodeRune</code>，传入的是字符串</td></tr><tr><td></td><td></td><td><code>func DecodeLastRuneInString(s string) (r rune, size int)</code></td><td>同<code>DecodeRune</code>，传入的是字符串，是最后一个<code>UTF-8</code> 编码序列</td></tr><tr><td></td><td>rune转bytes</td><td><code>func EncodeRune(p []byte, r rune) int</code></td><td>将 rune的<code>UTF-8 </code>编码序列写入<code>[]byte</code>，并返回写入的字节数。p需要满足足够的长度</td></tr><tr><td></td><td>检测</td><td><code>func FullRune(p []byte) bool</code></td><td>检测<code>[]byte</code>是否包含一个完整 <code>UTF-8</code>编码（只要包含一个就返回true）</td></tr><tr><td></td><td></td><td><code>func FullRuneInString(s string) bool</code></td><td>同上，输入是一个字符串</td></tr><tr><td></td><td></td><td><code>func RuneStart(b byte) bool</code></td><td>检测字节 byte b 是否可以作为某个 rune 编码的第一个字节</td></tr><tr><td></td><td></td><td><code>func Valid(p []byte) bool</code></td><td>检测切片<code>[]byte</code>是否包含完整且合法的<code>UTF-8</code>编码序列（不能有乱码）</td></tr><tr><td></td><td></td><td><code>func ValidRune(r rune) bool</code></td><td>检测字符<code>rune</code>是否包含完整且合法的<code>UTF-8</code>编码序列</td></tr><tr><td></td><td></td><td><code>func ValidString(s string) bool</code></td><td>检测字符串<code>string</code>是否包含完整且合法的<code>UTF-8</code>编码序列</td></tr><tr><td></td><td>统计</td><td><code>func RuneCount(p []byte) int</code></td><td>统计<code>[]byte</code>中<code>rune</code>的个数</td></tr><tr><td></td><td></td><td><code>func RuneCountInString(s string) (n int)</code></td><td>同上，输入是字符串</td></tr><tr><td></td><td></td><td><code>func RuneLen(r rune) int</code></td><td>统计<code>rune</code>编码后的字节数</td></tr><tr><td><code>unicode/utf16</code></td><td>转换</td><td><code>func Encode(s []rune) []uint16</code></td><td>编码<code>rune</code>数组为<code>uint16</code>数组</td></tr><tr><td></td><td></td><td><code>func Decode(s []uint16) []rune</code></td><td>解码<code>uint16</code>数组为<code>rune</code>数组</td></tr></tbody></table><blockquote><p>编码：字符串 -&gt; bytes， rune -&gt; bytes</p><p>解码：bytes -&gt; rune， bytes -&gt; 字符串</p></blockquote><br><p><strong>示例</strong></p><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">package</span> main</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">(</span></span>
<span class="line">	<span class="token string">&quot;fmt&quot;</span></span>
<span class="line">	<span class="token string">&quot;unicode&quot;</span></span>
<span class="line">	<span class="token string">&quot;unicode/utf16&quot;</span></span>
<span class="line">	<span class="token string">&quot;unicode/utf8&quot;</span></span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token comment">// unicode包 - 判断</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;unicode包 - 判断&quot;</span><span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>unicode<span class="token punctuation">.</span><span class="token function">Is</span><span class="token punctuation">(</span>unicode<span class="token punctuation">.</span>Scripts<span class="token punctuation">[</span><span class="token string">&quot;Han&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token char">&#39;a&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 判断是否是汉字</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>unicode<span class="token punctuation">.</span><span class="token function">Is</span><span class="token punctuation">(</span>unicode<span class="token punctuation">.</span>Scripts<span class="token punctuation">[</span><span class="token string">&quot;Han&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token char">&#39;中&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>unicode<span class="token punctuation">.</span><span class="token function">IsSpace</span><span class="token punctuation">(</span><span class="token char">&#39; &#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// true</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// unicode包 - 转换</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;\nunicode包 - 转换&quot;</span><span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%c\n&quot;</span><span class="token punctuation">,</span> unicode<span class="token punctuation">.</span><span class="token function">ToLower</span><span class="token punctuation">(</span><span class="token char">&#39;A&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%c\n&quot;</span><span class="token punctuation">,</span> unicode<span class="token punctuation">.</span><span class="token function">ToLower</span><span class="token punctuation">(</span><span class="token char">&#39;中&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// unicode/utf8 - bytes转rune</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;\nunicode/utf8 -bytes转rune&quot;</span><span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>utf8<span class="token punctuation">.</span><span class="token function">DecodeRune</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span><span class="token string">&quot;你好&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>     <span class="token comment">// 解码第一个，20320 3</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%c\n&quot;</span><span class="token punctuation">,</span> <span class="token number">20320</span><span class="token punctuation">)</span>                      <span class="token comment">// 你</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>utf8<span class="token punctuation">.</span><span class="token function">DecodeLastRune</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span><span class="token string">&quot;你好&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 解码最后一个，22909 3</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%c\n&quot;</span><span class="token punctuation">,</span> <span class="token number">22909</span><span class="token punctuation">)</span>                      <span class="token comment">// 好</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>utf8<span class="token punctuation">.</span><span class="token function">DecodeRuneInString</span><span class="token punctuation">(</span><span class="token string">&quot;你好&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>utf8<span class="token punctuation">.</span><span class="token function">DecodeLastRuneInString</span><span class="token punctuation">(</span><span class="token string">&quot;你好&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// unicode/utf8 - rune转bytes</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;\nunicode/utf8 - rune转bytes&quot;</span><span class="token punctuation">)</span></span>
<span class="line">	buf <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>utf8<span class="token punctuation">.</span><span class="token function">EncodeRune</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span> <span class="token char">&#39;世&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%#v\n&quot;</span><span class="token punctuation">,</span> buf<span class="token punctuation">)</span> <span class="token comment">// []byte{0xe4, 0xb8, 0x96}</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// unicode/utf8 - 检测</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;\nunicode/utf8 - 检测&quot;</span><span class="token punctuation">)</span></span>
<span class="line">	buf2 <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span><span class="token punctuation">{</span><span class="token number">228</span><span class="token punctuation">,</span> <span class="token number">184</span><span class="token punctuation">,</span> <span class="token number">150</span><span class="token punctuation">}</span>           <span class="token comment">// 世</span></span>
<span class="line">	buf3 <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span><span class="token punctuation">{</span><span class="token number">228</span><span class="token punctuation">,</span> <span class="token number">184</span><span class="token punctuation">,</span> <span class="token number">150</span><span class="token punctuation">,</span> <span class="token number">228</span><span class="token punctuation">,</span> <span class="token number">184</span><span class="token punctuation">}</span> <span class="token comment">// 在buf2的基础上再加上两个字节, 世\xe4\xb8</span></span>
<span class="line"></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>utf8<span class="token punctuation">.</span><span class="token function">FullRune</span><span class="token punctuation">(</span>buf2<span class="token punctuation">)</span><span class="token punctuation">)</span>     <span class="token comment">// true</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>utf8<span class="token punctuation">.</span><span class="token function">FullRune</span><span class="token punctuation">(</span>buf3<span class="token punctuation">)</span><span class="token punctuation">)</span>     <span class="token comment">// true</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>utf8<span class="token punctuation">.</span><span class="token function">FullRune</span><span class="token punctuation">(</span>buf2<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// false</span></span>
<span class="line"></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>utf8<span class="token punctuation">.</span><span class="token function">Valid</span><span class="token punctuation">(</span>buf2<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// true</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>utf8<span class="token punctuation">.</span><span class="token function">Valid</span><span class="token punctuation">(</span>buf3<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// false</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%q\n&quot;</span><span class="token punctuation">,</span> buf3<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// unicode/utf16 - rune与uint16转换</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%#v\n&quot;</span><span class="token punctuation">,</span> utf16<span class="token punctuation">.</span><span class="token function">Encode</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">rune</span><span class="token punctuation">(</span><span class="token string">&quot;你好&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>            <span class="token comment">// []uint16{0x4f60, 0x597d}</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%q\n&quot;</span><span class="token punctuation">,</span> utf16<span class="token punctuation">.</span><span class="token function">Decode</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">uint16</span><span class="token punctuation">{</span><span class="token number">0x4f60</span><span class="token punctuation">,</span> <span class="token number">0x597d</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// [&#39;你&#39; &#39;好&#39;]</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre></div><blockquote><p>utf8编码下，英文占1个字节，汉字占3个字节；</p><p>utf16编码下，英文占1个字节，汉字占1个字节</p></blockquote></details><br><h3 id="布尔值" tabindex="-1"><a class="header-anchor" href="#布尔值"><span>布尔值</span></a></h3><p>布尔值的零值是<code>false</code>，布尔值无法隐式转换为数值(1或0)</p><br><h3 id="数组" tabindex="-1"><a class="header-anchor" href="#数组"><span>数组</span></a></h3><p>数组的特点</p><ul><li>数组一旦定义，元素个数不可改变，即不能增加或删除元素；可以改元素的值</li><li>元素数据类型必须一致</li><li>相同数据类型、长度固定的序列才是一样的，即<code>[2]int</code>和<code>[3]int</code>是不同</li><li>数组的零值是元素数据类型的零值</li><li>没有&quot;空数组&quot;的说法</li><li>数组是值类型</li></ul><details class="hint-container details"><summary>（1）声明</summary><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">package</span> main</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token string">&quot;fmt&quot;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token keyword">var</span> a1 <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token builtin">int</span>                   <span class="token comment">// 声明数组；3代表数组元素个数（必须指定）；未赋值则默认使用零值，这里是0</span></span>
<span class="line">	<span class="token keyword">var</span> a2 <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token builtin">int</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">{</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">}</span> <span class="token comment">// 声明并赋值</span></span>
<span class="line">	a3 <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">{</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">}</span>           <span class="token comment">// 短变量声明</span></span>
<span class="line">	a4 <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token operator">...</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">{</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">}</span>      <span class="token comment">// 使用...后数组长度会自动判断；...只能用在值的位置上不可以用在类型的位置上</span></span>
<span class="line">	a5 <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token operator">...</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">:</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">}</span>           <span class="token comment">// 索引1的位置数据是-1，其他位置是零值</span></span>
<span class="line"></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%#v\n&quot;</span><span class="token punctuation">,</span> a1<span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%#v\n&quot;</span><span class="token punctuation">,</span> a2<span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%#v\n&quot;</span><span class="token punctuation">,</span> a3<span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%#v\n&quot;</span><span class="token punctuation">,</span> a4<span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%#v\n&quot;</span><span class="token punctuation">,</span> a5<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre></div><p>输出结果</p><div class="language-bash" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span>int<span class="token punctuation">{</span><span class="token number">0</span>, <span class="token number">0</span>, <span class="token number">0</span><span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span>int<span class="token punctuation">{</span><span class="token number">4</span>, <span class="token number">5</span>, <span class="token number">6</span><span class="token punctuation">}</span>   </span>
<span class="line"><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span>int<span class="token punctuation">{</span><span class="token number">7</span>, <span class="token number">8</span>, <span class="token number">9</span><span class="token punctuation">}</span>   </span>
<span class="line"><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span>int<span class="token punctuation">{</span><span class="token number">10</span>, <span class="token number">11</span>, <span class="token number">12</span><span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>int<span class="token punctuation">{</span><span class="token number">0</span>, -1<span class="token punctuation">}</span>   </span>
<span class="line"></span></code></pre></div></details><details class="hint-container details"><summary>（2）基本操作</summary><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">package</span> main</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token string">&quot;fmt&quot;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	a <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token operator">...</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">{</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 遍历</span></span>
<span class="line">	<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token function">len</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span></span>
<span class="line">		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>a<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line">	<span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> v <span class="token operator">:=</span> <span class="token keyword">range</span> a <span class="token punctuation">{</span></span>
<span class="line">		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 截取</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>a<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">// 索引0-2，注意不支持[:-2]这种负数表示方法</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre></div><p>输出结果</p><div class="language-bash" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token number">10</span></span>
<span class="line"><span class="token number">11</span>        </span>
<span class="line"><span class="token number">12</span>        </span>
<span class="line"><span class="token number">13</span>        </span>
<span class="line"><span class="token number">14</span>        </span>
<span class="line"><span class="token number">15</span>        </span>
<span class="line"><span class="token number">10</span>        </span>
<span class="line"><span class="token number">11</span>        </span>
<span class="line"><span class="token number">12</span>        </span>
<span class="line"><span class="token number">13</span>        </span>
<span class="line"><span class="token number">14</span>        </span>
<span class="line"><span class="token number">15</span>        </span>
<span class="line"><span class="token punctuation">[</span><span class="token number">10</span> <span class="token number">11</span> <span class="token number">12</span><span class="token punctuation">]</span></span>
<span class="line"></span></code></pre></div></details><details class="hint-container details"><summary>（3）多维数组</summary><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">package</span> main</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token string">&quot;fmt&quot;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token comment">// 二维数组</span></span>
<span class="line">	a2 <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">{</span><span class="token punctuation">}</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>a2<span class="token punctuation">)</span> <span class="token comment">// [[0 0 0] [0 0 0]]</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 三维数组</span></span>
<span class="line">	a3 <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">{</span><span class="token punctuation">}</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>a3<span class="token punctuation">)</span></span>
<span class="line">	<span class="token comment">/*</span>
<span class="line">	   [                            第一个数组为长度为1的数组</span>
<span class="line">	      [                         第一个数组的第1个元素为另一个长度为2的数组</span>
<span class="line">	         [0 0 0] [0 0 0]        每个数组有两个元素，每个元素是一个长度为3的数组</span>
<span class="line">	      ]</span>
<span class="line">	   ]</span>
<span class="line"></span>
<span class="line">	*/</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre></div></details><br><h3 id="切片" tabindex="-1"><a class="header-anchor" href="#切片"><span>切片</span></a></h3><p>切片是长度可变的数组，切片的特点</p><ul><li><p>可以动态添加删除元素</p></li><li><p>所有元素数据类型也必须是一样</p></li><li><p>切片的零值是<code>nil</code></p></li><li><p>切片是引用类型</p></li></ul><p>切片由三部分组成</p><ul><li>指针：存放底层数组的内存地址</li><li>长度：指的是切片的元素个数，使用<code>len(切片)</code>输出长度</li><li>容量：底层数组的长度，使用<code>cap(切片)</code>输出容量大小</li></ul><details class="hint-container details"><summary>（1）声明</summary><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">package</span> main</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token string">&quot;fmt&quot;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token comment">// 声明方式1：与数组类似，不同的是不需要指定元素个数</span></span>
<span class="line">	<span class="token keyword">var</span> s1 <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span>  <span class="token comment">// 只声明，默认为零值，即nil</span></span>
<span class="line">	s2 <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token comment">// 空切片</span></span>
<span class="line"></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%#v\n&quot;</span><span class="token punctuation">,</span> s1<span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%#v\n&quot;</span><span class="token punctuation">,</span> s2<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 声明方式2：使用make</span></span>
<span class="line">	s3 <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token comment">//声明一个int类型的切片,长度为1，容量为2；如果容量不指定，那么容量等同于长度</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%#v\n&quot;</span><span class="token punctuation">,</span> s3<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 查看长度和容量</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token function">len</span><span class="token punctuation">(</span>s1<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">len</span><span class="token punctuation">(</span>s2<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">len</span><span class="token punctuation">(</span>s3<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token function">cap</span><span class="token punctuation">(</span>s1<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">cap</span><span class="token punctuation">(</span>s2<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">cap</span><span class="token punctuation">(</span>s3<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre></div><p>输出结果</p><div class="language-bash" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token punctuation">[</span><span class="token punctuation">]</span>int<span class="token punctuation">(</span>nil<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">[</span><span class="token punctuation">]</span>int<span class="token punctuation">{</span><span class="token punctuation">}</span> </span>
<span class="line"><span class="token punctuation">[</span><span class="token punctuation">]</span>int<span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">}</span></span>
<span class="line"><span class="token number">0</span> <span class="token number">0</span> <span class="token number">1</span>   </span>
<span class="line"><span class="token number">0</span> <span class="token number">0</span> <span class="token number">2</span>   </span>
<span class="line"></span></code></pre></div></details><details class="hint-container details"><summary>（2）基本操作</summary><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">package</span> main</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">(</span></span>
<span class="line">	<span class="token string">&quot;bytes&quot;</span></span>
<span class="line">	<span class="token string">&quot;fmt&quot;</span></span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">EqualStringSlice</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token builtin">bool</span> <span class="token punctuation">{</span></span>
<span class="line">	length <span class="token operator">:=</span> <span class="token function">len</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span></span>
<span class="line">	<span class="token keyword">if</span> length <span class="token operator">!=</span> <span class="token function">len</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">		<span class="token keyword">return</span> <span class="token boolean">false</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">	<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> length<span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span></span>
<span class="line">		<span class="token keyword">if</span> a<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">!=</span> b<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token punctuation">{</span></span>
<span class="line">			<span class="token keyword">return</span> <span class="token boolean">false</span></span>
<span class="line">		<span class="token punctuation">}</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line">	<span class="token keyword">return</span> <span class="token boolean">true</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	s1 <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">}</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;原始数据：%#v\n&quot;</span><span class="token punctuation">,</span> s1<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 添加元素</span></span>
<span class="line">	s1 <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>s1<span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token char">&#39;8&#39;</span><span class="token punctuation">,</span> <span class="token char">&#39;中&#39;</span><span class="token punctuation">)</span> <span class="token comment">// 可以一次添加多个， &#39;8&#39;和&#39;中&#39;虽然为rune，本质上还是int类型</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;添加元素：%#v\n&quot;</span><span class="token punctuation">,</span> s1<span class="token punctuation">)</span>    <span class="token comment">// []int{1, 2, 3, 4, 5, 6, 7, 56, 20013}</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 删除元素</span></span>
<span class="line">	s1 <span class="token operator">=</span> s1<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token function">len</span><span class="token punctuation">(</span>s1<span class="token punctuation">)</span><span class="token punctuation">]</span>                 <span class="token comment">// 删除第一个元素</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;删除元素(第一个)：%#v\n&quot;</span><span class="token punctuation">,</span> s1<span class="token punctuation">)</span>  <span class="token comment">//</span></span>
<span class="line">	s1 <span class="token operator">=</span> s1<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token function">len</span><span class="token punctuation">(</span>s1<span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>                <span class="token comment">// 删除最后一个元素</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;删除元素(最后一个)：%#v\n&quot;</span><span class="token punctuation">,</span> s1<span class="token punctuation">)</span> <span class="token comment">//</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 切片浅拷贝</span></span>
<span class="line">	s2 <span class="token operator">:=</span> s1<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">]</span>   <span class="token comment">// 浅拷贝</span></span>
<span class="line">	s3 <span class="token operator">:=</span> s1<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token comment">// 浅拷贝</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;使用[:]浅拷贝：%p &lt;---&gt; %p\n&quot;</span><span class="token punctuation">,</span> s1<span class="token punctuation">,</span> s2<span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;使用[:]浅拷贝：%p &lt;---&gt; %p\n&quot;</span><span class="token punctuation">,</span> s1<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> s3<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 切片深拷贝</span></span>
<span class="line">	s4 <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">,</span> <span class="token function">len</span><span class="token punctuation">(</span>s1<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">cap</span><span class="token punctuation">(</span>s1<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token function">copy</span><span class="token punctuation">(</span>s4<span class="token punctuation">,</span> s1<span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;使用copy深拷贝：%p &lt;---&gt; %p\n&quot;</span><span class="token punctuation">,</span> s1<span class="token punctuation">,</span> s4<span class="token punctuation">)</span> <span class="token comment">// 深拷贝方式1</span></span>
<span class="line">	s5 <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">,</span> <span class="token function">len</span><span class="token punctuation">(</span>s1<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">cap</span><span class="token punctuation">(</span>s1<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> v <span class="token operator">:=</span> <span class="token keyword">range</span> s1 <span class="token punctuation">{</span></span>
<span class="line">		s5 <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>s5<span class="token punctuation">,</span> v<span class="token punctuation">)</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;遍历方式：%p &lt;---&gt; %p\n&quot;</span><span class="token punctuation">,</span> s1<span class="token punctuation">,</span> s5<span class="token punctuation">)</span> <span class="token comment">// 深拷贝方式2</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 解包：切片...</span></span>
<span class="line">	s6 <span class="token operator">:=</span> <span class="token function">append</span><span class="token punctuation">(</span>s1<span class="token punctuation">,</span> s1<span class="token operator">...</span><span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;解包用法示例：%#v\n&quot;</span><span class="token punctuation">,</span> s6<span class="token punctuation">)</span> <span class="token comment">//</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 切片比较 - byte切片使用提供的函数比较</span></span>
<span class="line">	a1 <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">uint8</span><span class="token punctuation">{</span><span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">,</span> <span class="token number">78</span><span class="token punctuation">,</span> <span class="token number">115</span><span class="token punctuation">,</span> <span class="token number">253</span><span class="token punctuation">}</span></span>
<span class="line">	a2 <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">uint8</span><span class="token punctuation">{</span><span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">,</span> <span class="token number">78</span><span class="token punctuation">,</span> <span class="token number">115</span><span class="token punctuation">,</span> <span class="token number">253</span><span class="token punctuation">}</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;[]byte切片比较: %t\n&quot;</span><span class="token punctuation">,</span> bytes<span class="token punctuation">.</span><span class="token function">Equal</span><span class="token punctuation">(</span>a1<span class="token punctuation">,</span> a2<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 切片比较 - 非byte类型</span></span>
<span class="line">	a3 <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span><span class="token string">&quot;hello&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;world&quot;</span><span class="token punctuation">}</span></span>
<span class="line">	a4 <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span><span class="token string">&quot;hello&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;world&quot;</span><span class="token punctuation">}</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;[]string切片比较: %t\n&quot;</span><span class="token punctuation">,</span> <span class="token function">EqualStringSlice</span><span class="token punctuation">(</span>a3<span class="token punctuation">,</span> a4<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre></div><p>输出结果</p><div class="language-bash" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line">原始数据：<span class="token punctuation">[</span><span class="token punctuation">]</span>int<span class="token punctuation">{</span><span class="token number">1</span>, <span class="token number">2</span>, <span class="token number">3</span>, <span class="token number">4</span>, <span class="token number">5</span><span class="token punctuation">}</span></span>
<span class="line">添加元素：<span class="token punctuation">[</span><span class="token punctuation">]</span>int<span class="token punctuation">{</span><span class="token number">1</span>, <span class="token number">2</span>, <span class="token number">3</span>, <span class="token number">4</span>, <span class="token number">5</span>, <span class="token number">6</span>, <span class="token number">7</span>, <span class="token number">56</span>, <span class="token number">20013</span><span class="token punctuation">}</span>        </span>
<span class="line">删除元素<span class="token punctuation">(</span>第一个<span class="token punctuation">)</span>：<span class="token punctuation">[</span><span class="token punctuation">]</span>int<span class="token punctuation">{</span><span class="token number">2</span>, <span class="token number">3</span>, <span class="token number">4</span>, <span class="token number">5</span>, <span class="token number">6</span>, <span class="token number">7</span>, <span class="token number">56</span>, <span class="token number">20013</span><span class="token punctuation">}</span>   </span>
<span class="line">删除元素<span class="token punctuation">(</span>最后一个<span class="token punctuation">)</span>：<span class="token punctuation">[</span><span class="token punctuation">]</span>int<span class="token punctuation">{</span><span class="token number">2</span>, <span class="token number">3</span>, <span class="token number">4</span>, <span class="token number">5</span>, <span class="token number">6</span>, <span class="token number">7</span>, <span class="token number">56</span><span class="token punctuation">}</span>        </span>
<span class="line">使用<span class="token punctuation">[</span>:<span class="token punctuation">]</span>浅拷贝：0xc00012e0f8 <span class="token operator">&lt;</span>---<span class="token operator">&gt;</span> 0xc00012e0f8         </span>
<span class="line">使用<span class="token punctuation">[</span>:<span class="token punctuation">]</span>浅拷贝：0xc00012e100 <span class="token operator">&lt;</span>---<span class="token operator">&gt;</span> 0xc00012e100         </span>
<span class="line">使用copy深拷贝：0xc00012e0f8 <span class="token operator">&lt;</span>---<span class="token operator">&gt;</span> 0xc00012e190        </span>
<span class="line">遍历方式：0xc00012e0f8 <span class="token operator">&lt;</span>---<span class="token operator">&gt;</span> 0xc000156000              </span>
<span class="line">解包用法示例：<span class="token punctuation">[</span><span class="token punctuation">]</span>int<span class="token punctuation">{</span><span class="token number">2</span>, <span class="token number">3</span>, <span class="token number">4</span>, <span class="token number">5</span>, <span class="token number">6</span>, <span class="token number">7</span>, <span class="token number">56</span>, <span class="token number">2</span>, <span class="token number">3</span>, <span class="token number">4</span>, <span class="token number">5</span>, <span class="token number">6</span>, <span class="token number">7</span>, <span class="token number">56</span><span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">[</span><span class="token punctuation">]</span>byte切片比较: <span class="token boolean">true</span>                                   </span>
<span class="line"><span class="token punctuation">[</span><span class="token punctuation">]</span>string切片比较: <span class="token boolean">true</span></span>
<span class="line"></span></code></pre></div></details><details class="hint-container details"><summary>（3）容量扩容机制</summary><p>当<strong>长度==容量</strong>时，再<code>append()</code>插入元素，go会重新申请一个底层数组，将原数据数据拷贝过去，修改切片指针，再用来存放我们插入的数据</p><p>两个并不准确的结论：</p><ul><li>当原切片长度小于1024时，新切片的容量会直接翻倍</li><li>当原切片的容量大于等于1024时，会反复地增加25%，直到新容量超过所需要的容量</li></ul><p><strong>测试1：可以看到是翻倍的</strong></p><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">package</span> main</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token string">&quot;fmt&quot;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token comment">// 定义切片</span></span>
<span class="line">	s <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;当前长度: %2d | 当前容量: %2d\n&quot;</span><span class="token punctuation">,</span> <span class="token function">len</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">cap</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 循环添加元素</span></span>
<span class="line">	<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">18</span><span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span></span>
<span class="line">		s <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span></span>
<span class="line">		fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;当前长度: %2d | 当前容量: %2d\n&quot;</span><span class="token punctuation">,</span> <span class="token function">len</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">cap</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 输出结果</span></span>
<span class="line">	<span class="token comment">//当前长度:  0 | 当前容量:  0</span></span>
<span class="line">	<span class="token comment">//当前长度:  1 | 当前容量:  1</span></span>
<span class="line">	<span class="token comment">//当前长度:  2 | 当前容量:  2</span></span>
<span class="line">	<span class="token comment">//当前长度:  3 | 当前容量:  4</span></span>
<span class="line">	<span class="token comment">//当前长度:  4 | 当前容量:  4</span></span>
<span class="line">	<span class="token comment">//当前长度:  5 | 当前容量:  8</span></span>
<span class="line">	<span class="token comment">//当前长度:  6 | 当前容量:  8</span></span>
<span class="line">	<span class="token comment">//当前长度:  7 | 当前容量:  8</span></span>
<span class="line">	<span class="token comment">//当前长度:  8 | 当前容量:  8</span></span>
<span class="line">	<span class="token comment">//当前长度:  9 | 当前容量: 16</span></span>
<span class="line">	<span class="token comment">//当前长度: 10 | 当前容量: 16</span></span>
<span class="line">	<span class="token comment">//当前长度: 11 | 当前容量: 16</span></span>
<span class="line">	<span class="token comment">//当前长度: 12 | 当前容量: 16</span></span>
<span class="line">	<span class="token comment">//当前长度: 13 | 当前容量: 16</span></span>
<span class="line">	<span class="token comment">//当前长度: 14 | 当前容量: 16</span></span>
<span class="line">	<span class="token comment">//当前长度: 15 | 当前容量: 16</span></span>
<span class="line">	<span class="token comment">//当前长度: 16 | 当前容量: 16</span></span>
<span class="line">	<span class="token comment">//当前长度: 17 | 当前容量: 32</span></span>
<span class="line">	<span class="token comment">//当前长度: 18 | 当前容量: 32</span></span>
<span class="line">	<span class="token comment">//当前长度: 19 | 当前容量: 32</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre></div><p><strong>测试2：可以看到并不是25%</strong></p><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">package</span> main</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token string">&quot;fmt&quot;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token comment">// 定义切片</span></span>
<span class="line">	s <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;当前长度: %2d | 当前容量: %2d\n&quot;</span><span class="token punctuation">,</span> <span class="token function">len</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">cap</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 循环添加元素</span></span>
<span class="line">	<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span></span>
<span class="line">		s <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span></span>
<span class="line">		fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;当前长度: %2d | 当前容量: %2d\n&quot;</span><span class="token punctuation">,</span> <span class="token function">len</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">cap</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 输出结果</span></span>
<span class="line">	<span class="token comment">//当前长度: 2000 | 当前容量: 2000</span></span>
<span class="line">	<span class="token comment">//当前长度: 2001 | 当前容量: 2720</span></span>
<span class="line">	<span class="token comment">//当前长度: 2002 | 当前容量: 2720</span></span>
<span class="line">	<span class="token comment">//当前长度: 2003 | 当前容量: 2720</span></span>
<span class="line">	<span class="token comment">//当前长度: 2004 | 当前容量: 2720</span></span>
<span class="line">	<span class="token comment">//当前长度: 2005 | 当前容量: 2720</span></span>
<span class="line">	<span class="token comment">//当前长度: 2006 | 当前容量: 2720</span></span>
<span class="line">	<span class="token comment">//当前长度: 2007 | 当前容量: 2720</span></span>
<span class="line">	<span class="token comment">//当前长度: 2008 | 当前容量: 2720</span></span>
<span class="line">	<span class="token comment">//当前长度: 2009 | 当前容量: 2720</span></span>
<span class="line">	<span class="token comment">//当前长度: 2010 | 当前容量: 2720</span></span>
<span class="line">	<span class="token comment">//当前长度: 2011 | 当前容量: 2720</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre></div><p>不同版本的<code>go</code>扩容机制也并不一样，具体还需要去看源代码<code>src/runtime/slice.go</code>中的<code>growslice</code>函数</p></details><details class="hint-container details"><summary>（4）容量扩容面试题</summary><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">package</span> main</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token string">&quot;fmt&quot;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	s1 <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">{</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">}</span></span>
<span class="line">	s2 <span class="token operator">:=</span> s1</span>
<span class="line"></span>
<span class="line">	s1 <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>s1<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span></span>
<span class="line">	s1<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">11</span></span>
<span class="line"></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>s1<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>s2<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre></div><details class="hint-container details"><summary>点击查看输出结果和解释</summary><div class="language-bash" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token number">11</span></span>
<span class="line"><span class="token number">10</span></span>
<span class="line"></span>
<span class="line">第一个为11</span>
<span class="line">第二个为10，是因为s1添加元素后会有容量扩容操作，将s1的数据赋值给新的内存空间，s1指向新的地址，</span>
<span class="line">s1的修改自然影响不到s2，s2的数据还是旧的，就是10</span>
<span class="line"></span></code></pre></div></details></details><br><h3 id="映射" tabindex="-1"><a class="header-anchor" href="#映射"><span>映射</span></a></h3><p>映射是存储一系列无序的key/value键值对</p><p>key只能为可使用==运算的值类型（字符串、数字、布尔、数组），value可以为任意类型</p><p>零值为nil</p><details class="hint-container details"><summary>（1）声明</summary><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">package</span> main</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token string">&quot;fmt&quot;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token comment">// 直接声明</span></span>
<span class="line">	<span class="token keyword">var</span> names1 <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token builtin">string</span>     <span class="token comment">//使用var声明但是不初始化(没有分配内存空间)后面赋值会报错；不带大括号的是类型</span></span>
<span class="line">	<span class="token keyword">var</span> names2 <span class="token operator">=</span> <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token comment">// 声明并初始化；带大括号的是值</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 使用make声明</span></span>
<span class="line">	<span class="token keyword">var</span> names3 <span class="token operator">=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">)</span>      <span class="token comment">// 使用make声明并初始化</span></span>
<span class="line">	<span class="token keyword">var</span> names4 <span class="token operator">=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span> <span class="token comment">// 使用make声明并初始化，并指定容量（注意：map的容量不可以使用cap函数获取，会报错）</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 尝试赋值</span></span>
<span class="line">	<span class="token comment">//names1[&quot;a&quot;] = &quot;b&quot; // 这个会报错，panic: assignment to entry in nil map</span></span>
<span class="line">	names2<span class="token punctuation">[</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;b&quot;</span></span>
<span class="line">	names3<span class="token punctuation">[</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;b&quot;</span></span>
<span class="line">	names4<span class="token punctuation">[</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;b&quot;</span></span>
<span class="line"></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;类型: %T | 值: %#v | 元素个数: %d\n&quot;</span><span class="token punctuation">,</span> names1<span class="token punctuation">,</span> names1<span class="token punctuation">,</span> <span class="token function">len</span><span class="token punctuation">(</span>names1<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;类型: %T | 值: %#v | 元素个数: %d\n&quot;</span><span class="token punctuation">,</span> names2<span class="token punctuation">,</span> names2<span class="token punctuation">,</span> <span class="token function">len</span><span class="token punctuation">(</span>names2<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;类型: %T | 值: %#v | 元素个数: %d\n&quot;</span><span class="token punctuation">,</span> names3<span class="token punctuation">,</span> names3<span class="token punctuation">,</span> <span class="token function">len</span><span class="token punctuation">(</span>names3<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;类型: %T | 值: %#v | 元素个数: %d\n&quot;</span><span class="token punctuation">,</span> names4<span class="token punctuation">,</span> names4<span class="token punctuation">,</span> <span class="token function">len</span><span class="token punctuation">(</span>names4<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">//类型: map[string]string | 值: map[string]string(nil) | 元素个数: 0</span></span>
<span class="line">	<span class="token comment">//类型: map[string]string | 值: map[string]string{&quot;a&quot;:&quot;b&quot;} | 元素个数: 1</span></span>
<span class="line">	<span class="token comment">//类型: map[string]string | 值: map[string]string{&quot;a&quot;:&quot;b&quot;} | 元素个数: 1</span></span>
<span class="line">	<span class="token comment">//类型: map[string]string | 值: map[string]string{&quot;a&quot;:&quot;b&quot;} | 元素个数: 1</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre></div></details><details class="hint-container details"><summary>（2）基本操作</summary><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">package</span> main</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token string">&quot;fmt&quot;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token comment">// 声明数组</span></span>
<span class="line">	names <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 添加元素，若已存在会覆盖</span></span>
<span class="line">	names<span class="token punctuation">[</span><span class="token string">&quot;Top1&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;Go&quot;</span></span>
<span class="line">	names<span class="token punctuation">[</span><span class="token string">&quot;Top2&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;Python&quot;</span></span>
<span class="line">	names<span class="token punctuation">[</span><span class="token string">&quot;Top3&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;JavaScript&quot;</span></span>
<span class="line">	names<span class="token punctuation">[</span><span class="token string">&quot;Top4&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;&quot;</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 删除元素, delete函数只用于map，函数无返回值</span></span>
<span class="line">	<span class="token function">delete</span><span class="token punctuation">(</span>names<span class="token punctuation">,</span> <span class="token string">&quot;Top3&quot;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 遍历map，遍历出来是无序的</span></span>
<span class="line">	<span class="token keyword">for</span> k<span class="token punctuation">,</span> v <span class="token operator">:=</span> <span class="token keyword">range</span> names <span class="token punctuation">{</span></span>
<span class="line">		fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;names[%s]=%s\n&quot;</span><span class="token punctuation">,</span> k<span class="token punctuation">,</span> v<span class="token punctuation">)</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line">	<span class="token comment">//names[Top2]=Python</span></span>
<span class="line">	<span class="token comment">//names[Top4]=</span></span>
<span class="line">	<span class="token comment">//names[Top1]=Go</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 判断元素是否存在,若不存在默认会返回对应基本数据类型的零值,所以我们一定要通过返回的布尔值来判断元素是否存在</span></span>
<span class="line">	key <span class="token operator">:=</span> <span class="token string">&quot;Top4&quot;</span></span>
<span class="line">	<span class="token keyword">if</span> v<span class="token punctuation">,</span> ok <span class="token operator">:=</span> names<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span> ok <span class="token punctuation">{</span></span>
<span class="line">		fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;Key %s exists and value is %q\n&quot;</span><span class="token punctuation">,</span> key<span class="token punctuation">,</span> v<span class="token punctuation">)</span></span>
<span class="line">	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">		fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;Key %s does not exist\n&quot;</span><span class="token punctuation">,</span> key<span class="token punctuation">)</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line">	<span class="token comment">// Key Top4 exists and value is &quot;&quot;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre></div></details><details class="hint-container details"><summary>（3）value可以是一个方法</summary><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">package</span> main</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token string">&quot;fmt&quot;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	m1 <span class="token operator">:=</span> <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">]</span><span class="token keyword">func</span><span class="token punctuation">(</span>op <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token builtin">int</span><span class="token punctuation">{</span><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">	m1<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">func</span><span class="token punctuation">(</span>op <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token builtin">int</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> op <span class="token punctuation">}</span></span>
<span class="line">	m1<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">func</span><span class="token punctuation">(</span>op <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token builtin">int</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> op <span class="token operator">*</span> op <span class="token punctuation">}</span></span>
<span class="line">	m1<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">func</span><span class="token punctuation">(</span>op <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token builtin">int</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> op <span class="token operator">*</span> op <span class="token operator">*</span> op <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>m1<span class="token punctuation">)</span> <span class="token comment">// map[1:0x47b920 2:0x47b940 3:0x47b960]</span></span>
<span class="line"></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>m1<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> m1<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> m1<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 2 4 8</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre></div></details><details class="hint-container details"><summary>（4）实现set类型</summary><p>go语言中没有<code>set</code>类型，可以使用map来自定义<code>set</code></p><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">package</span> main</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token string">&quot;fmt&quot;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token comment">// 初始化set</span></span>
<span class="line">	intSet <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">]</span><span class="token builtin">bool</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 添加元素</span></span>
<span class="line">	intSet<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">true</span></span>
<span class="line">	intSet<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">false</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 删除元素</span></span>
<span class="line">	<span class="token function">delete</span><span class="token punctuation">(</span>intSet<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 检查元素是否存在</span></span>
<span class="line">	n <span class="token operator">:=</span> <span class="token number">1</span></span>
<span class="line">	<span class="token keyword">if</span> intSet<span class="token punctuation">[</span>n<span class="token punctuation">]</span> <span class="token punctuation">{</span></span>
<span class="line">		fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%d is in set&quot;</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span></span>
<span class="line">	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">		fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%d is not in set&quot;</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line">	<span class="token comment">// 1 is in set</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre></div><blockquote><p>更好的实现set的方法是使用结构体，参考《空结构体》章节</p></blockquote></details><br><h3 id="类型转换" tabindex="-1"><a class="header-anchor" href="#类型转换"><span>类型转换</span></a></h3><details class="hint-container details"><summary>点击查看完整代码</summary><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">package</span> main</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">(</span></span>
<span class="line">	<span class="token string">&quot;fmt&quot;</span></span>
<span class="line">	<span class="token string">&quot;math&quot;</span></span>
<span class="line">	<span class="token string">&quot;strconv&quot;</span></span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">Int2Float</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;Int转Float:\n&quot;</span><span class="token punctuation">)</span></span>
<span class="line">	x <span class="token operator">:=</span> <span class="token number">99</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%T\n&quot;</span><span class="token punctuation">,</span> <span class="token function">float32</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">Float2Int</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;\nFloat转Int:\n&quot;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 小数部分会被截断</span></span>
<span class="line">	x <span class="token operator">:=</span> <span class="token number">100.7</span></span>
<span class="line">	y <span class="token operator">:=</span> <span class="token operator">-</span><span class="token number">3.9</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%T %d\n&quot;</span><span class="token punctuation">,</span> <span class="token function">int64</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">int64</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 100</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%T %d\n&quot;</span><span class="token punctuation">,</span> <span class="token function">int64</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">int64</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// -3</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 注意：</span></span>
<span class="line">	<span class="token comment">//fmt.Printf(&quot;%T\n&quot;, int64(3.0)) // 不会报错</span></span>
<span class="line">	<span class="token comment">//fmt.Printf(&quot;%T\n&quot;, int64(3.1)) // 会报错,小数部分不为0直接转就会报错</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">CeilAndFloorAndRound</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;\n向上取整/向下取整/四舍五入:\n&quot;</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token comment">// 向上取整，函数签名：Ceil(x float64) float64</span></span>
<span class="line">	x <span class="token operator">:=</span> <span class="token number">1.11</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%T %f\n&quot;</span><span class="token punctuation">,</span> math<span class="token punctuation">.</span><span class="token function">Ceil</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span> math<span class="token punctuation">.</span><span class="token function">Ceil</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// float64 2.000000</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 向下取整，函数签名：Floor(x float64) float64</span></span>
<span class="line">	y <span class="token operator">:=</span> <span class="token number">1.99</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%T %f\n&quot;</span><span class="token punctuation">,</span> math<span class="token punctuation">.</span><span class="token function">Floor</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span><span class="token punctuation">,</span> math<span class="token punctuation">.</span><span class="token function">Floor</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// float64 1.000000</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 四舍五入，函数签名：</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%T %f\n&quot;</span><span class="token punctuation">,</span> math<span class="token punctuation">.</span><span class="token function">Round</span><span class="token punctuation">(</span><span class="token number">1.49</span><span class="token punctuation">)</span><span class="token punctuation">,</span> math<span class="token punctuation">.</span><span class="token function">Round</span><span class="token punctuation">(</span><span class="token number">1.49</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// float64 1.000000</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">AddQuote</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;\n输出添加双引号/单引号:\n&quot;</span><span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>strconv<span class="token punctuation">.</span><span class="token function">Quote</span><span class="token punctuation">(</span><span class="token string">&quot;字符串&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>strconv<span class="token punctuation">.</span><span class="token function">QuoteRune</span><span class="token punctuation">(</span><span class="token char">&#39;字&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">String2Int</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;\n字符串转数字:\n&quot;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 函数签名：Atoi(s string) (int, error)，等同于 ParseInt(s, 10, 0)</span></span>
<span class="line">	<span class="token keyword">if</span> i<span class="token punctuation">,</span> err <span class="token operator">:=</span> strconv<span class="token punctuation">.</span><span class="token function">Atoi</span><span class="token punctuation">(</span><span class="token string">&quot;10&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span></span>
<span class="line">		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 函数签名：ParseInt(s string, base int, bitSize int) (i int64, err error)</span></span>
<span class="line">	<span class="token comment">// 指定字符串为10进制数字，转换到int8类型 (0:int、8:int8、16:int16、32:int32、64:int64)</span></span>
<span class="line">	<span class="token comment">// 用法一样的还有：ParseUint(s string, base int, bitSize int) (uint64, error)</span></span>
<span class="line">	<span class="token keyword">if</span> i<span class="token punctuation">,</span> err <span class="token operator">:=</span> strconv<span class="token punctuation">.</span><span class="token function">ParseInt</span><span class="token punctuation">(</span><span class="token string">&quot;b&quot;</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span></span>
<span class="line">		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 函数签名：ParseFloat(s string, bitSize int) (float64, error)</span></span>
<span class="line">	<span class="token keyword">if</span> i<span class="token punctuation">,</span> err <span class="token operator">:=</span> strconv<span class="token punctuation">.</span><span class="token function">ParseFloat</span><span class="token punctuation">(</span><span class="token string">&quot;1.20&quot;</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span></span>
<span class="line">		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">String2Bool</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;\n字符串转布尔:\n&quot;</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token comment">// 转换规则代码：</span></span>
<span class="line">	<span class="token comment">//switch str {</span></span>
<span class="line">	<span class="token comment">//case &quot;1&quot;, &quot;t&quot;, &quot;T&quot;, &quot;true&quot;, &quot;TRUE&quot;, &quot;True&quot;:</span></span>
<span class="line">	<span class="token comment">//	return true, nil</span></span>
<span class="line">	<span class="token comment">//case &quot;0&quot;, &quot;f&quot;, &quot;F&quot;, &quot;false&quot;, &quot;FALSE&quot;, &quot;False&quot;:</span></span>
<span class="line">	<span class="token comment">//	return false, nil</span></span>
<span class="line">	<span class="token comment">//}</span></span>
<span class="line">	<span class="token comment">// 如果是TRue，这种字符串就无法转换了，可以先使用strings.ToLower或strings.ToUpper转换后再转为布尔值</span></span>
<span class="line">	<span class="token keyword">if</span> b<span class="token punctuation">,</span> err <span class="token operator">:=</span> strconv<span class="token punctuation">.</span><span class="token function">ParseBool</span><span class="token punctuation">(</span><span class="token string">&quot;true&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span></span>
<span class="line">		fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%T %v\n&quot;</span><span class="token punctuation">,</span> b<span class="token punctuation">,</span> b<span class="token punctuation">)</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">Int2String</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;\n数字转字符串:\n&quot;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// int -&gt; 字符串</span></span>
<span class="line">	x <span class="token operator">:=</span> strconv<span class="token punctuation">.</span><span class="token function">Itoa</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%T %s\n&quot;</span><span class="token punctuation">,</span> x<span class="token punctuation">,</span> x<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 函数签名：FormatInt(i int64, base int) string，base代表是多少进制的数字</span></span>
<span class="line">	<span class="token comment">// 先转成10进制数字，然后转为数字</span></span>
<span class="line">	<span class="token comment">// 用法一样的函数还有strconv.FormatUint</span></span>
<span class="line">	y <span class="token operator">:=</span> strconv<span class="token punctuation">.</span><span class="token function">FormatInt</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%T %s\n&quot;</span><span class="token punctuation">,</span> y<span class="token punctuation">,</span> y<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">Bool2String</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;\n布尔转字符串:\n&quot;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 函数签名：FormatBool(b bool) string</span></span>
<span class="line">	<span class="token comment">// 返回 &quot;true&quot; or &quot;false&quot;</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%s\n&quot;</span><span class="token punctuation">,</span> strconv<span class="token punctuation">.</span><span class="token function">FormatBool</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">Any2String</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;\n任意数据类型转字符串:\n&quot;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 这里以float举例</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// float -&gt; 字符串</span></span>
<span class="line">	y <span class="token operator">:=</span> fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span><span class="token string">&quot;%.2f&quot;</span><span class="token punctuation">,</span> <span class="token number">3.1415926</span><span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%T %s\n&quot;</span><span class="token punctuation">,</span> y<span class="token punctuation">,</span> y<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token comment">// ----------------------- 数字之间转换 ------------------</span></span>
<span class="line">	<span class="token comment">// 数字之间转换</span></span>
<span class="line">	<span class="token function">Int2Float</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token function">Float2Int</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 数字向上取整/向下取整/四舍五入</span></span>
<span class="line">	<span class="token function">CeilAndFloorAndRound</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// ----------------------- 字符串之间转换 ------------------</span></span>
<span class="line">	<span class="token comment">// 字节/Rune/字符串之间的转换参考strings/bytes/unicode包</span></span>
<span class="line">	<span class="token function">AddQuote</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 输出添加双引号/单引号</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// ----------------------- 字符串转到其他类型 Parse系列函数------------------</span></span>
<span class="line">	<span class="token function">String2Int</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token function">String2Bool</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// ----------------------- 其他类型转到字符串 Format系列函数------------------</span></span>
<span class="line">	<span class="token function">Int2String</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token function">Bool2String</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token function">Any2String</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre></div><p>输出结果</p><div class="language-bash" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line">Int转Float:</span>
<span class="line">float32                    </span>
<span class="line">                           </span>
<span class="line">Float转Int:                </span>
<span class="line">int64 <span class="token number">100</span>                  </span>
<span class="line">int64 <span class="token parameter variable">-3</span>                   </span>
<span class="line">                           </span>
<span class="line">向上取整/向下取整/四舍五入:</span>
<span class="line">float64 <span class="token number">2.000000</span>           </span>
<span class="line">float64 <span class="token number">1.000000</span>           </span>
<span class="line">float64 <span class="token number">1.000000</span>           </span>
<span class="line">                           </span>
<span class="line">输出添加双引号/单引号:     </span>
<span class="line"><span class="token string">&quot;字符串&quot;</span>                   </span>
<span class="line"><span class="token string">&#39;字&#39;</span>                       </span>
<span class="line">                           </span>
<span class="line">字符串转数字:              </span>
<span class="line"><span class="token number">10</span>                         </span>
<span class="line"><span class="token number">11</span>                         </span>
<span class="line"><span class="token number">1.2</span>                        </span>
<span class="line">                           </span>
<span class="line">字符串转布尔:              </span>
<span class="line">bool <span class="token boolean">true</span>                  </span>
<span class="line">                           </span>
<span class="line">数字转字符串:              </span>
<span class="line">string <span class="token number">100</span></span>
<span class="line">string <span class="token number">13</span></span>
<span class="line"></span>
<span class="line">布尔转字符串:</span>
<span class="line"><span class="token boolean">false</span></span>
<span class="line"></span>
<span class="line">任意数据类型转字符串:</span>
<span class="line">string <span class="token number">3.14</span></span>
<span class="line"></span></code></pre></div></details><br><h3 id="类型总结" tabindex="-1"><a class="header-anchor" href="#类型总结"><span>类型总结</span></a></h3><table><thead><tr><th>数据类型</th><th>元素是否有序</th><th>值类型/引用类型</th><th>指针类型初始化关键字</th><th>零值</th></tr></thead><tbody><tr><td>数字</td><td>✔</td><td>值类型</td><td><code>new</code></td><td><code>0</code></td></tr><tr><td>字符串</td><td>✔</td><td>值类型</td><td><code>new</code></td><td>空字符串</td></tr><tr><td>布尔值</td><td>✔</td><td>值类型</td><td><code>new</code></td><td><code>false</code></td></tr><tr><td>数组</td><td>✔</td><td>值类型</td><td><code>new</code></td><td>元素数据类型的零值</td></tr><tr><td>切片</td><td>✔</td><td>引用类型</td><td><code>make</code></td><td><code>nil</code></td></tr><tr><td>映射</td><td>❌</td><td>引用类型</td><td><code>make</code></td><td><code>nil</code></td></tr></tbody></table><h2 id="-1" tabindex="-1"><a class="header-anchor" href="#-1"><span></span></a></h2><h2 id="函数" tabindex="-1"><a class="header-anchor" href="#函数"><span>函数</span></a></h2><h3 id="基础示例" tabindex="-1"><a class="header-anchor" href="#基础示例"><span>基础示例</span></a></h3><details class="hint-container details"><summary>（1）第一个函数</summary><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">package</span> main</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token string">&quot;fmt&quot;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 参数x和y都是int类型，函数返回值也是int类型</span></span>
<span class="line"><span class="token comment">// 关于返回值：函数可以没有返回值，也可以有多个返回值</span></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">add</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token builtin">int</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token keyword">return</span> x <span class="token operator">+</span> y</span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre></div></details><details class="hint-container details"><summary>（2）可省略参数</summary><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">package</span> main</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token string">&quot;fmt&quot;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// options ...数据类型，这样定义的参数可以不传值</span></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">Login</span><span class="token punctuation">(</span>host<span class="token punctuation">,</span> port<span class="token punctuation">,</span> username<span class="token punctuation">,</span> password <span class="token builtin">string</span><span class="token punctuation">,</span> options <span class="token operator">...</span><span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>host<span class="token punctuation">,</span> port<span class="token punctuation">,</span> username<span class="token punctuation">,</span> password<span class="token punctuation">,</span> options<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token function">Login</span><span class="token punctuation">(</span><span class="token string">&quot;0.0.0.0&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;3306&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;root&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;123456&quot;</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token function">Login</span><span class="token punctuation">(</span><span class="token string">&quot;0.0.0.0&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;3306&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;root&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;123456&quot;</span><span class="token punctuation">,</span> <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span><span class="token string">&quot;ssl&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;true&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">//0.0.0.0 3306 root 123456 []</span></span>
<span class="line"><span class="token comment">//0.0.0.0 3306 root 123456 [map[ssl:true]]</span></span>
<span class="line"></span></code></pre></div></details><details class="hint-container details"><summary>（3）实参为nil</summary><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">package</span> main</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token string">&quot;fmt&quot;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 定义函数</span></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">MyFunc</span><span class="token punctuation">(</span>s <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span> <span class="token punctuation">{</span></span>
<span class="line">	s <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> <span class="token string">&quot;hello world!&quot;</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token keyword">return</span> s</span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token comment">// 函数要求传入一个字符串切片，而他的零值为nil，所以我们可以传入nil，在函数内部相当于是: s := make([]string, 0)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token function">MyFunc</span><span class="token punctuation">(</span><span class="token boolean">nil</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// [hello world!]</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre></div></details><details class="hint-container details"><summary>（4）接受任意类型参数</summary><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">package</span> main</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token string">&quot;fmt&quot;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 使用可省略参数 + interface，可接受任何类型的参数（包括不传），函数内部使用断言再去判断参数类型</span></span>
<span class="line"><span class="token comment">// 并不推荐这样写函数，仅作学习使用</span></span>
<span class="line"><span class="token comment">// 其中interface{}可以使用any代替，推荐使用any</span></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">test</span><span class="token punctuation">(</span>i <span class="token operator">...</span><span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token keyword">if</span> <span class="token function">len</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token operator">&gt;=</span> <span class="token number">1</span> <span class="token punctuation">{</span></span>
<span class="line">		<span class="token keyword">if</span> m<span class="token punctuation">,</span> ok <span class="token operator">:=</span> i<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">)</span><span class="token punctuation">;</span> ok <span class="token punctuation">{</span></span>
<span class="line">			fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>m<span class="token punctuation">[</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span></span>
<span class="line">		<span class="token punctuation">}</span></span>
<span class="line">	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;anomoy&quot;</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token function">test</span><span class="token punctuation">(</span><span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span></span>
<span class="line">		<span class="token string">&quot;name&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;bob&quot;</span><span class="token punctuation">,</span></span>
<span class="line">	<span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre></div></details><details class="hint-container details"><summary>（5）案例：使用闭包实现斐波那契数列</summary><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">package</span> main</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">(</span></span>
<span class="line">	<span class="token string">&quot;fmt&quot;</span></span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">Fibonacci</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">int64</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token keyword">var</span> a<span class="token punctuation">,</span> b <span class="token builtin">int64</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span></span>
<span class="line">	<span class="token keyword">return</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">int64</span> <span class="token punctuation">{</span></span>
<span class="line">		a<span class="token punctuation">,</span> b <span class="token operator">=</span> b<span class="token punctuation">,</span> a<span class="token operator">+</span>b</span>
<span class="line">		<span class="token keyword">return</span> a</span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line"></span>
<span class="line">	fib <span class="token operator">:=</span> <span class="token function">Fibonacci</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">100</span><span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span></span>
<span class="line">		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token function">fib</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre></div></details><br><h3 id="内置函数" tabindex="-1"><a class="header-anchor" href="#内置函数"><span>内置函数</span></a></h3><details class="hint-container details"><summary>（1）copy</summary><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">package</span> main</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token string">&quot;fmt&quot;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token comment">// 位数相同的情况下，全部覆盖</span></span>
<span class="line">	<span class="token keyword">var</span> s <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">}</span></span>
<span class="line">	<span class="token function">copy</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">{</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token comment">// [3, 2, 1]</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// dst位数少的情况下，只覆盖部分</span></span>
<span class="line">	<span class="token keyword">var</span> s1 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">}</span></span>
<span class="line">	<span class="token function">copy</span><span class="token punctuation">(</span>s1<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">{</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>s1<span class="token punctuation">)</span> <span class="token comment">// [3, 2]</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// dst为空的情况下，copy之后还是空</span></span>
<span class="line">	<span class="token keyword">var</span> s2 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">{</span><span class="token punctuation">}</span></span>
<span class="line">	<span class="token function">copy</span><span class="token punctuation">(</span>s2<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>s2<span class="token punctuation">)</span> <span class="token comment">// []</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// src位数少的情况下，只覆盖部分</span></span>
<span class="line">	<span class="token keyword">var</span> s3 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">{</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">}</span></span>
<span class="line">	<span class="token function">copy</span><span class="token punctuation">(</span>s3<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">{</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>s3<span class="token punctuation">)</span> <span class="token comment">// [3 2 4]</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre></div></details><br><h3 id="延迟调用" tabindex="-1"><a class="header-anchor" href="#延迟调用"><span>延迟调用</span></a></h3><p><strong>说明</strong></p><p>defer是延迟调用，后面跟一个函数调用</p><p>比如有<code>A</code>、<code>B</code>两个函数，在<code>A</code>函数中<code>defer B()</code>，那么就意味着在<code>A</code>函数<code>return</code>或<code>panic</code>之后调用<code>B</code>函数</p><br><p><strong>应用场景</strong></p><ul><li><p>释放资源，比如文件句柄、锁等</p></li><li><p>异常处理</p></li><li><p>修改函数返回值</p></li></ul><br><p><strong>详细解读</strong></p><details class="hint-container details"><summary>（1）defer后面的表达式不能加圆括号</summary><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">package</span> main</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token string">&quot;fmt&quot;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token keyword">defer</span> <span class="token punctuation">(</span>fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>	<span class="token comment">// defer后面的函数调用，不能加括号，会报语法错误</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre></div></details><details class="hint-container details"><summary>（2）若执行多次defer语句，则满足LIFO（后进先出），即先defer的后执行</summary><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">package</span> main</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token string">&quot;fmt&quot;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">test1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;测试1&quot;</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">5</span><span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span></span>
<span class="line">		<span class="token keyword">defer</span> fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%d %p \n&quot;</span><span class="token punctuation">,</span> i<span class="token punctuation">,</span> <span class="token operator">&amp;</span>i<span class="token punctuation">)</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">test2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;\n测试2&quot;</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">5</span><span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span></span>
<span class="line">		<span class="token keyword">defer</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">			fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%d %p \n&quot;</span><span class="token punctuation">,</span> i<span class="token punctuation">,</span> <span class="token operator">&amp;</span>i<span class="token punctuation">)</span></span>
<span class="line">		<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">test3</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;\n测试3&quot;</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">5</span><span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span></span>
<span class="line">		<span class="token keyword">defer</span> <span class="token keyword">func</span><span class="token punctuation">(</span>i <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">			fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%d %p \n&quot;</span><span class="token punctuation">,</span> i<span class="token punctuation">,</span> <span class="token operator">&amp;</span>i<span class="token punctuation">)</span></span>
<span class="line">		<span class="token punctuation">}</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token function">test1</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token function">test2</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token function">test3</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre></div><p>输出结果</p><div class="language-bash" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line">测试1</span>
<span class="line"><span class="token number">5</span> 0xc0000180b8 </span>
<span class="line"><span class="token number">4</span> 0xc0000180b8 </span>
<span class="line"><span class="token number">3</span> 0xc0000180b8 </span>
<span class="line"><span class="token number">2</span> 0xc0000180b8 </span>
<span class="line"><span class="token number">1</span> 0xc0000180b8 </span>
<span class="line"><span class="token number">0</span> 0xc0000180b8 </span>
<span class="line">               </span>
<span class="line">测试2          </span>
<span class="line"><span class="token number">6</span> 0xc0000180f0 </span>
<span class="line"><span class="token number">6</span> 0xc0000180f0 </span>
<span class="line"><span class="token number">6</span> 0xc0000180f0 </span>
<span class="line"><span class="token number">6</span> 0xc0000180f0 </span>
<span class="line"><span class="token number">6</span> 0xc0000180f0 </span>
<span class="line"><span class="token number">6</span> 0xc0000180f0 </span>
<span class="line">               </span>
<span class="line">测试3          </span>
<span class="line"><span class="token number">5</span> 0xc0000180f8 </span>
<span class="line"><span class="token number">4</span> 0xc000018110 </span>
<span class="line"><span class="token number">3</span> 0xc000018118 </span>
<span class="line"><span class="token number">2</span> 0xc000018120 </span>
<span class="line"><span class="token number">1</span> 0xc000018128 </span>
<span class="line"><span class="token number">0</span> 0xc000018130 </span>
<span class="line"></span></code></pre></div></details><details class="hint-container details"><summary>（3）defer和return执行顺序的问题</summary><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">package</span> main</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token string">&quot;fmt&quot;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 在defer中修改返回值成功，前提是必须提前声明返回值</span></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">add1</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>result <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token keyword">defer</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">		result <span class="token operator">+=</span> <span class="token number">10</span></span>
<span class="line">	<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token keyword">return</span> x <span class="token operator">+</span> y</span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 在defer中修改返回值失败，并未提前声明返回值</span></span>
<span class="line"><span class="token comment">// 原因是：</span></span>
<span class="line"><span class="token comment">// 		return并非原子操作，共分为两步，赋值和函数返回</span></span>
<span class="line"><span class="token comment">//		赋值：将结果写入到返回值中，如果未提前声明，就写入到一个临时变量中</span></span>
<span class="line"><span class="token comment">//		函数返回：函数带着当前返回值退出</span></span>
<span class="line"><span class="token comment">// 执行顺序：return赋值 --&gt; defer --&gt; return函数返回</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">add2</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token builtin">int</span> <span class="token punctuation">{</span></span>
<span class="line">	result <span class="token operator">:=</span> x <span class="token operator">+</span> y <span class="token comment">// result必须定义在前面</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%p\n&quot;</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>result<span class="token punctuation">)</span></span>
<span class="line">	<span class="token keyword">defer</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">		result <span class="token operator">+=</span> <span class="token number">10</span></span>
<span class="line">		fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%p\n&quot;</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>result<span class="token punctuation">)</span></span>
<span class="line">	<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token keyword">return</span> result</span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token function">add1</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 13</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token function">add2</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 9</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre></div></details><details class="hint-container details"><summary>（4）defer可以捕捉panic</summary><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">package</span> main</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token string">&quot;fmt&quot;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token comment">// recover函数只能用在defer中</span></span>
<span class="line">	<span class="token keyword">if</span> err <span class="token operator">:=</span> <span class="token function">recover</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span></span>
<span class="line">		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;panic: &quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span></span>
<span class="line">	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;Close success!&quot;</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">WithPanic</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token keyword">defer</span> <span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token function">panic</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">NonPanic</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token keyword">defer</span> <span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token function">WithPanic</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token function">NonPanic</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 输出结果</span></span>
<span class="line"><span class="token comment">// panic:  1</span></span>
<span class="line"><span class="token comment">// Close success!</span></span>
<span class="line"></span></code></pre></div></details><details class="hint-container details"><summary>（5）derfer并不能保证一定会执行：os.Exit</summary><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">package</span> main</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">(</span></span>
<span class="line">	<span class="token string">&quot;fmt&quot;</span></span>
<span class="line">	<span class="token string">&quot;os&quot;</span></span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token keyword">defer</span> fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;defer called&quot;</span><span class="token punctuation">)</span></span>
<span class="line">	os<span class="token punctuation">.</span><span class="token function">Exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 运行之后，发现什么都没有输出，说明defer没有正常执行</span></span>
<span class="line"></span></code></pre></div></details><details class="hint-container details"><summary>（6）derfer并不能保证一定会执行：死锁等严重错误</summary><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">package</span> main</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">(</span></span>
<span class="line">	<span class="token string">&quot;fmt&quot;</span></span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token keyword">defer</span> fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;defer called&quot;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	ch <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token keyword">struct</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">//go func() {</span></span>
<span class="line">	<span class="token comment">//	ch &lt;- struct{}{}</span></span>
<span class="line">	<span class="token comment">//</span></span>
<span class="line">	<span class="token comment">//}()</span></span>
<span class="line"></span>
<span class="line">	<span class="token operator">&lt;-</span>ch</span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 运行之后，直接报错 fatal error: all goroutines are asleep - deadlock!</span></span>
<span class="line"><span class="token comment">// 并且defer没有正常执行</span></span>
<span class="line"></span></code></pre></div></details><br><h3 id="泛型函数" tabindex="-1"><a class="header-anchor" href="#泛型函数"><span>泛型函数</span></a></h3><details class="hint-container details"><summary>（1）基础示例</summary><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">package</span> main</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token string">&quot;fmt&quot;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// Print 第一个泛型函数</span></span>
<span class="line"><span class="token keyword">func</span> Print<span class="token punctuation">[</span>T any<span class="token punctuation">]</span><span class="token punctuation">(</span>arr <span class="token punctuation">[</span><span class="token punctuation">]</span>T<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> v <span class="token operator">:=</span> <span class="token keyword">range</span> arr <span class="token punctuation">{</span></span>
<span class="line">		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token comment">// 正规的泛型函数调用方法,语法: function[参数类型](参数)</span></span>
<span class="line">	Print<span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">	Print<span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;b&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;c&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 使用类型推导可以不用显式传递参数类型</span></span>
<span class="line">	<span class="token function">Print</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">float64</span><span class="token punctuation">{</span><span class="token number">1.1</span><span class="token punctuation">,</span> <span class="token number">1.2</span><span class="token punctuation">,</span> <span class="token number">1.3</span><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 这样也可以,但是我们一般都不会这样用</span></span>
<span class="line">	<span class="token function">Print</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span>any<span class="token punctuation">{</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">10.5</span><span class="token punctuation">,</span> <span class="token string">&quot;abc&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre></div><p>输出结果</p><div class="language-bash" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line">D:<span class="token punctuation">\</span>application<span class="token punctuation">\</span>GoLand<span class="token punctuation">\</span>example<span class="token operator">&gt;</span>go run main.go</span>
<span class="line"><span class="token number">1</span></span>
<span class="line"><span class="token number">2</span></span>
<span class="line"><span class="token number">3</span></span>
<span class="line">a</span>
<span class="line">b</span>
<span class="line">c</span>
<span class="line"><span class="token number">1.1</span></span>
<span class="line"><span class="token number">1.2</span></span>
<span class="line"><span class="token number">1.3</span></span>
<span class="line"><span class="token number">10</span></span>
<span class="line"><span class="token number">10.5</span></span>
<span class="line">abc</span>
<span class="line"></span></code></pre></div></details><details class="hint-container details"><summary>（2）类型约束</summary><p>编译失败的写法</p><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">package</span> main</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token string">&quot;fmt&quot;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// Max 返回最大值</span></span>
<span class="line"><span class="token keyword">func</span> Max<span class="token punctuation">[</span>T any<span class="token punctuation">]</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b T<span class="token punctuation">)</span> T <span class="token punctuation">{</span></span>
<span class="line">	<span class="token keyword">if</span> a <span class="token operator">&gt;</span> b <span class="token punctuation">{</span></span>
<span class="line">		<span class="token keyword">return</span> a</span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line">	<span class="token keyword">return</span> b</span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token function">Max</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 原因是a和b都属于T类型，而T类型属于any类型，两个any类型是不能比较的</span></span>
<span class="line"></span></code></pre></div><p>输出结果</p><div class="language-bash" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line">D:<span class="token punctuation">\</span>application<span class="token punctuation">\</span>GoLand<span class="token punctuation">\</span>example<span class="token operator">&gt;</span>go run main.go</span>
<span class="line"><span class="token comment"># command-line-arguments</span></span>
<span class="line">.<span class="token punctuation">\</span>main.go:7:5: invalid operation: a <span class="token operator">&gt;</span> b <span class="token punctuation">(</span>type parameter T is not comparable with <span class="token operator">&gt;</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre></div><p>修正后的写法</p><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">package</span> main</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token string">&quot;fmt&quot;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// Comparable 定义可比较对象</span></span>
<span class="line"><span class="token keyword">type</span> Comparable <span class="token keyword">interface</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token builtin">int</span> <span class="token operator">|</span> <span class="token builtin">int8</span> <span class="token operator">|</span> <span class="token builtin">int16</span> <span class="token operator">|</span> <span class="token builtin">int32</span> <span class="token operator">|</span> <span class="token builtin">int64</span> <span class="token operator">|</span></span>
<span class="line">		<span class="token builtin">uint</span> <span class="token operator">|</span> <span class="token builtin">uint8</span> <span class="token operator">|</span> <span class="token builtin">uint32</span> <span class="token operator">|</span> <span class="token builtin">uint64</span> <span class="token operator">|</span></span>
<span class="line">		<span class="token builtin">float32</span> <span class="token operator">|</span> <span class="token builtin">float64</span> <span class="token operator">|</span> <span class="token builtin">string</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// Max 返回最大值</span></span>
<span class="line"><span class="token keyword">func</span> Max<span class="token punctuation">[</span>T Comparable<span class="token punctuation">]</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b T<span class="token punctuation">)</span> T <span class="token punctuation">{</span></span>
<span class="line">	<span class="token keyword">if</span> a <span class="token operator">&gt;</span> b <span class="token punctuation">{</span></span>
<span class="line">		<span class="token keyword">return</span> a</span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line">	<span class="token keyword">return</span> b</span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// Max2 如果支持的类型比较少的话可以直接写在函数签名中</span></span>
<span class="line"><span class="token keyword">func</span> Max2<span class="token punctuation">[</span>T <span class="token builtin">int</span> <span class="token operator">|</span> <span class="token builtin">string</span><span class="token punctuation">]</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b T<span class="token punctuation">)</span> T <span class="token punctuation">{</span></span>
<span class="line">	<span class="token keyword">if</span> a <span class="token operator">&gt;</span> b <span class="token punctuation">{</span></span>
<span class="line">		<span class="token keyword">return</span> a</span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line">	<span class="token keyword">return</span> b</span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token function">Max</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token function">Max</span><span class="token punctuation">(</span><span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.2</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token function">Max</span><span class="token punctuation">(</span><span class="token string">&quot;你好&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;世界&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token function">Max2</span><span class="token punctuation">(</span><span class="token string">&quot;你好&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;世界&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre></div><p>输出结果</p><div class="language-bash" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line">D:<span class="token punctuation">\</span>application<span class="token punctuation">\</span>GoLand<span class="token punctuation">\</span>example<span class="token operator">&gt;</span>go run main.go</span>
<span class="line"><span class="token number">2</span></span>
<span class="line"><span class="token number">0.1</span></span>
<span class="line">你好</span>
<span class="line">你好</span>
<span class="line"></span></code></pre></div></details><details class="hint-container details"><summary>（3）支持衍生类型</summary><p>编译失败的写法</p><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">package</span> main</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token string">&quot;fmt&quot;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// Comparable 定义可比较对象</span></span>
<span class="line"><span class="token keyword">type</span> Comparable <span class="token keyword">interface</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token builtin">int</span> <span class="token operator">|</span> <span class="token builtin">int8</span> <span class="token operator">|</span> <span class="token builtin">int16</span> <span class="token operator">|</span> <span class="token builtin">int32</span> <span class="token operator">|</span> <span class="token builtin">int64</span> <span class="token operator">|</span></span>
<span class="line">		<span class="token builtin">uint</span> <span class="token operator">|</span> <span class="token builtin">uint8</span> <span class="token operator">|</span> <span class="token builtin">uint32</span> <span class="token operator">|</span> <span class="token builtin">uint64</span> <span class="token operator">|</span></span>
<span class="line">		<span class="token builtin">float32</span> <span class="token operator">|</span> <span class="token builtin">float64</span> <span class="token operator">|</span> <span class="token builtin">string</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// Max 返回最大值</span></span>
<span class="line"><span class="token keyword">func</span> Max<span class="token punctuation">[</span>T Comparable<span class="token punctuation">]</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b T<span class="token punctuation">)</span> T <span class="token punctuation">{</span></span>
<span class="line">	<span class="token keyword">if</span> a <span class="token operator">&gt;</span> b <span class="token punctuation">{</span></span>
<span class="line">		<span class="token keyword">return</span> a</span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line">	<span class="token keyword">return</span> b</span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 自定义类型</span></span>
<span class="line"><span class="token keyword">type</span> MyInt <span class="token builtin">int</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token function">Max</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token function">Max</span><span class="token punctuation">(</span><span class="token function">MyInt</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">MyInt</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre></div><p>输出结果</p><div class="language-bash" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line">D:<span class="token punctuation">\</span>application<span class="token punctuation">\</span>GoLand<span class="token punctuation">\</span>example<span class="token operator">&gt;</span>go run main.go</span>
<span class="line"><span class="token comment"># command-line-arguments</span></span>
<span class="line">.<span class="token punctuation">\</span>main.go:25:17: MyInt does not implement Comparable <span class="token punctuation">(</span>possibly missing ~ <span class="token keyword">for</span> <span class="token for-or-select variable">int</span> <span class="token keyword">in</span> constraint Comparable<span class="token punctuation">)</span></span>
<span class="line"></span></code></pre></div><p>修正后的写法</p><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token comment">// 只给出关键代码，int前面加一个~，代表支持其衍生类型</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// Comparable 定义可比较对象</span></span>
<span class="line"><span class="token keyword">type</span> Comparable <span class="token keyword">interface</span> <span class="token punctuation">{</span></span>
<span class="line">	~<span class="token builtin">int</span> <span class="token operator">|</span> <span class="token builtin">int8</span> <span class="token operator">|</span> <span class="token builtin">int16</span> <span class="token operator">|</span> <span class="token builtin">int32</span> <span class="token operator">|</span> <span class="token builtin">int64</span> <span class="token operator">|</span></span>
<span class="line">		<span class="token builtin">uint</span> <span class="token operator">|</span> <span class="token builtin">uint8</span> <span class="token operator">|</span> <span class="token builtin">uint32</span> <span class="token operator">|</span> <span class="token builtin">uint64</span> <span class="token operator">|</span></span>
<span class="line">		<span class="token builtin">float32</span> <span class="token operator">|</span> <span class="token builtin">float64</span> <span class="token operator">|</span> <span class="token builtin">string</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre></div><p>输出结果</p><div class="language-bash" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line">D:<span class="token punctuation">\</span>application<span class="token punctuation">\</span>GoLand<span class="token punctuation">\</span>example<span class="token operator">&gt;</span>go run main.go</span>
<span class="line"><span class="token number">2</span></span>
<span class="line"><span class="token number">2</span></span>
<span class="line"></span></code></pre></div></details><details class="hint-container details"><summary>（4）内置的类型</summary><p>安装</p><div class="language-bash" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line">D:<span class="token punctuation">\</span>application<span class="token punctuation">\</span>GoLand<span class="token punctuation">\</span>example<span class="token operator">&gt;</span>go get golang.org/x/exp/constraints</span>
<span class="line">go: downloading golang.org/x/exp v0.0.0-20230131160201-f062dba9d201</span>
<span class="line">go: added golang.org/x/exp v0.0.0-20230131160201-f062dba9d201</span>
<span class="line"></span></code></pre></div><p>使用</p><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">package</span> main</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">(</span></span>
<span class="line">	<span class="token string">&quot;fmt&quot;</span></span>
<span class="line">	<span class="token string">&quot;golang.org/x/exp/constraints&quot;</span></span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// Max 返回最大值</span></span>
<span class="line"><span class="token keyword">func</span> Max<span class="token punctuation">[</span>T constraints<span class="token punctuation">.</span>Ordered<span class="token punctuation">]</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b T<span class="token punctuation">)</span> T <span class="token punctuation">{</span></span>
<span class="line">	<span class="token keyword">if</span> a <span class="token operator">&gt;</span> b <span class="token punctuation">{</span></span>
<span class="line">		<span class="token keyword">return</span> a</span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line">	<span class="token keyword">return</span> b</span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token function">Max</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token function">Max</span><span class="token punctuation">(</span><span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.2</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token function">Max</span><span class="token punctuation">(</span><span class="token string">&quot;你好&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;世界&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre></div><p>输出结果</p><div class="language-bash" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line">D:<span class="token punctuation">\</span>application<span class="token punctuation">\</span>GoLand<span class="token punctuation">\</span>example<span class="token operator">&gt;</span>go run main.go                        </span>
<span class="line"><span class="token number">2</span></span>
<span class="line"><span class="token number">0.1</span></span>
<span class="line">你好</span>
<span class="line"></span></code></pre></div></details><br><h2 id="自定义" tabindex="-1"><a class="header-anchor" href="#自定义"><span>自定义</span></a></h2><h3 id="自定义别名" tabindex="-1"><a class="header-anchor" href="#自定义别名"><span>自定义别名</span></a></h3><details class="hint-container details"><summary>（1）自定义别名</summary><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">package</span> main</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token string">&quot;fmt&quot;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">add</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token builtin">int</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token keyword">return</span> x <span class="token operator">+</span> y</span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token comment">// 定义别名， 使用=， 不能给Counter添加方法，Counter本质上就是int</span></span>
<span class="line">	<span class="token keyword">type</span> Counter <span class="token operator">=</span> <span class="token builtin">int</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 使用别名，可以继续像使用int一样使用，本质上它就是int</span></span>
<span class="line">	<span class="token keyword">var</span> a Counter <span class="token operator">=</span> <span class="token number">20</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> a<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 21</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre></div></details><details class="hint-container details"><summary>（2）内置的别名</summary><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token comment">// byte is an alias for uint8 and is equivalent to uint8 in all ways. It is</span></span>
<span class="line"><span class="token comment">// used, by convention, to distinguish byte values from 8-bit unsigned</span></span>
<span class="line"><span class="token comment">// integer values.</span></span>
<span class="line"><span class="token keyword">type</span> <span class="token builtin">byte</span> <span class="token operator">=</span> <span class="token builtin">uint8</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// rune is an alias for int32 and is equivalent to int32 in all ways. It is</span></span>
<span class="line"><span class="token comment">// used, by convention, to distinguish character values from integer values.</span></span>
<span class="line"><span class="token keyword">type</span> <span class="token builtin">rune</span> <span class="token operator">=</span> <span class="token builtin">int32</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// any is an alias for interface{} and is equivalent to interface{} in all ways.</span></span>
<span class="line"><span class="token keyword">type</span> any <span class="token operator">=</span> <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre></div></details><br><h3 id="自定义类型" tabindex="-1"><a class="header-anchor" href="#自定义类型"><span>自定义类型</span></a></h3><details class="hint-container details"><summary>（1）自定义类型：基础使用</summary><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">package</span> main</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token string">&quot;fmt&quot;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">add</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token builtin">int</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token keyword">return</span> x <span class="token operator">+</span> y</span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token comment">// 自定义类型, 这是一个全新的类型</span></span>
<span class="line">	<span class="token comment">// Number除了和int和相同的数据结构外，其他方面没有任何关系</span></span>
<span class="line">	<span class="token keyword">type</span> Number <span class="token builtin">int</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 赋值</span></span>
<span class="line">	<span class="token keyword">var</span> a Number <span class="token operator">=</span> <span class="token number">100</span></span>
<span class="line">	<span class="token keyword">var</span> b <span class="token builtin">int</span> <span class="token operator">=</span> <span class="token number">200</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 错误使用自定义类型</span></span>
<span class="line">	<span class="token comment">//fmt.Println(add(1, a)) // 这里会报错，因为Number已经是全新的类型了</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 和原类型可以做类型转换</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%T %#v\n&quot;</span><span class="token punctuation">,</span> <span class="token function">int</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">int</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">)</span>       <span class="token comment">// int 100</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%T %#v\n&quot;</span><span class="token punctuation">,</span> <span class="token function">Number</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">Number</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// main.Number 200</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre></div></details><details class="hint-container details"><summary>（2）自定义类型：定义复杂的类型</summary><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">package</span> main</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">(</span></span>
<span class="line">	<span class="token string">&quot;fmt&quot;</span></span>
<span class="line">	<span class="token string">&quot;golang.org/x/crypto/bcrypt&quot;</span></span>
<span class="line">	<span class="token string">&quot;log&quot;</span></span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 自定义类型</span></span>
<span class="line"><span class="token comment">//type intSlice []int</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 定义一个结构体，假设这是一个第三方的结构体</span></span>
<span class="line"><span class="token keyword">type</span> Form <span class="token keyword">struct</span> <span class="token punctuation">{</span></span>
<span class="line">	UserName <span class="token builtin">string</span></span>
<span class="line">	Password <span class="token builtin">string</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">NewForm</span><span class="token punctuation">(</span>username<span class="token punctuation">,</span> password <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token operator">*</span>Form <span class="token punctuation">{</span></span>
<span class="line">	<span class="token keyword">return</span> <span class="token operator">&amp;</span>Form<span class="token punctuation">{</span></span>
<span class="line">		UserName<span class="token punctuation">:</span> username<span class="token punctuation">,</span></span>
<span class="line">		Password<span class="token punctuation">:</span> password<span class="token punctuation">,</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 自定义类型</span></span>
<span class="line"><span class="token keyword">type</span> LoginForm Form</span>
<span class="line"></span>
<span class="line"><span class="token comment">// 给它增加一些方法</span></span>
<span class="line"><span class="token keyword">func</span> <span class="token punctuation">(</span>l <span class="token operator">*</span>LoginForm<span class="token punctuation">)</span> <span class="token function">Encrypt</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	hashed<span class="token punctuation">,</span> err <span class="token operator">:=</span> bcrypt<span class="token punctuation">.</span><span class="token function">GenerateFromPassword</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span>l<span class="token punctuation">.</span>Password<span class="token punctuation">)</span><span class="token punctuation">,</span> bcrypt<span class="token punctuation">.</span>DefaultCost<span class="token punctuation">)</span></span>
<span class="line">	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span></span>
<span class="line">		<span class="token keyword">return</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> err</span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line">	<span class="token keyword">return</span> <span class="token function">string</span><span class="token punctuation">(</span>hashed<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">nil</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">func</span> <span class="token punctuation">(</span>l <span class="token operator">*</span>LoginForm<span class="token punctuation">)</span> <span class="token function">ValidatePasswordHashed</span><span class="token punctuation">(</span>hash <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token builtin">bool</span> <span class="token punctuation">{</span></span>
<span class="line">	err <span class="token operator">:=</span> bcrypt<span class="token punctuation">.</span><span class="token function">CompareHashAndPassword</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span>hash<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span>l<span class="token punctuation">.</span>Password<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span></span>
<span class="line">		<span class="token keyword">return</span> <span class="token boolean">false</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line">	<span class="token keyword">return</span> <span class="token boolean">true</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token comment">// 实例化一个Form对象</span></span>
<span class="line">	form <span class="token operator">:=</span> <span class="token function">NewForm</span><span class="token punctuation">(</span><span class="token string">&quot;jinhui&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;qaz.123&quot;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 类型转换</span></span>
<span class="line">	loginForm <span class="token operator">:=</span> <span class="token function">LoginForm</span><span class="token punctuation">(</span><span class="token operator">*</span>form<span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%#v\n&quot;</span><span class="token punctuation">,</span> loginForm<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 加解密操作</span></span>
<span class="line">	<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">3</span><span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span></span>
<span class="line">		<span class="token comment">// 获取加密字符串</span></span>
<span class="line">		hashed<span class="token punctuation">,</span> err <span class="token operator">:=</span> loginForm<span class="token punctuation">.</span><span class="token function">Encrypt</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">		<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span></span>
<span class="line">			log<span class="token punctuation">.</span><span class="token function">Fatalln</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span></span>
<span class="line">		<span class="token punctuation">}</span></span>
<span class="line">		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;加密字符串: &quot;</span><span class="token punctuation">,</span> hashed<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">		<span class="token comment">// 验证加密字符串是否合法</span></span>
<span class="line">		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;验证加密串: &quot;</span><span class="token punctuation">,</span> loginForm<span class="token punctuation">.</span><span class="token function">ValidatePasswordHashed</span><span class="token punctuation">(</span>hashed<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 将类型转换回去 LoginForm -&gt; Form</span></span>
<span class="line">	form2 <span class="token operator">:=</span> <span class="token function">Form</span><span class="token punctuation">(</span>loginForm<span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%#v\n&quot;</span><span class="token punctuation">,</span> form2<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre></div><p>输出结果</p><div class="language-bash" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line">main.LoginForm<span class="token punctuation">{</span>UserName:<span class="token string">&quot;jinhui&quot;</span>, Password:<span class="token string">&quot;qaz.123&quot;</span><span class="token punctuation">}</span></span>
<span class="line">加密字符串:  <span class="token variable">$2a</span><span class="token variable">$10</span><span class="token variable">$DnrKdw</span>.Gp.yQs9z.mKQOKOJc/jbHc0/sLUusR3YOYpylkT8Lt/uTy</span>
<span class="line">验证加密串:  <span class="token boolean">true</span></span>
<span class="line">加密字符串:  <span class="token variable">$2a</span><span class="token variable">$10</span><span class="token variable">$P6iEQKFy99kdCBefE</span>.MCKO171rd4zIfLmMNbvTediK.mRATx2EVgC</span>
<span class="line">验证加密串:  <span class="token boolean">true</span></span>
<span class="line">加密字符串:  <span class="token variable">$2a</span><span class="token variable">$10</span><span class="token variable">$kmV5jDMJfC4Bzy51IaVq9uCX9w</span>//pig9hABRPr.u9Ob5KsF6u7ouK</span>
<span class="line">验证加密串:  <span class="token boolean">true</span></span>
<span class="line">main.Form<span class="token punctuation">{</span>UserName:<span class="token string">&quot;jinhui&quot;</span>, Password:<span class="token string">&quot;qaz.123&quot;</span><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre></div></details><details class="hint-container details"><summary>（3）自定义类型：仿http handler对象转换</summary><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">package</span> main</span>
<span class="line"> </span>
<span class="line"><span class="token keyword">import</span> <span class="token string">&quot;fmt&quot;</span></span>
<span class="line"> </span>
<span class="line"><span class="token comment">// 自定义类型</span></span>
<span class="line"><span class="token comment">// 可以使用HandFunc(函数名) 将函数转为HandFunc对象，函数需要和HandFunc保持签名一致</span></span>
<span class="line"><span class="token keyword">type</span> HandFunc <span class="token keyword">func</span><span class="token punctuation">(</span>x <span class="token builtin">int</span><span class="token punctuation">,</span> y <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token builtin">int</span></span>
<span class="line"> </span>
<span class="line"><span class="token comment">// 自定义类型-扩展方法</span></span>
<span class="line"><span class="token keyword">func</span> <span class="token punctuation">(</span>f HandFunc<span class="token punctuation">)</span> <span class="token function">ServeHTTP</span><span class="token punctuation">(</span>x <span class="token builtin">int</span><span class="token punctuation">,</span> y <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token builtin">int</span> <span class="token punctuation">{</span></span>
<span class="line">   <span class="token comment">// 这里的f是HandFunc对象，也是上面所说的函数对象</span></span>
<span class="line">   <span class="token comment">// 所以这里调用f(x, y)就相当于调用 函数(x, y)</span></span>
<span class="line">   <span class="token keyword">return</span> <span class="token function">f</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"> </span>
<span class="line"><span class="token comment">// 自定义函数</span></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">add</span><span class="token punctuation">(</span>x <span class="token builtin">int</span><span class="token punctuation">,</span> y <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token builtin">int</span> <span class="token punctuation">{</span></span>
<span class="line">   <span class="token keyword">return</span> x <span class="token operator">+</span> y</span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"> </span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">   <span class="token comment">// 将自定义函数转为自定义类型</span></span>
<span class="line">   add2 <span class="token operator">:=</span> <span class="token function">HandFunc</span><span class="token punctuation">(</span>add<span class="token punctuation">)</span></span>
<span class="line">   fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%T\n&quot;</span><span class="token punctuation">,</span> add<span class="token punctuation">)</span></span>
<span class="line">   fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%T\n&quot;</span><span class="token punctuation">,</span> add2<span class="token punctuation">)</span></span>
<span class="line"> </span>
<span class="line">   <span class="token comment">// 正常调用</span></span>
<span class="line">   fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">   fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token function">add2</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"> </span>
<span class="line">   <span class="token comment">// 自定义类型可以调用更多的方法</span></span>
<span class="line">   fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>add2<span class="token punctuation">.</span><span class="token function">ServeHTTP</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre></div><p>输出结果</p><div class="language-bash" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line">func<span class="token punctuation">(</span>int, int<span class="token punctuation">)</span> int</span>
<span class="line">main.HandFunc</span>
<span class="line"><span class="token number">3</span>            </span>
<span class="line"><span class="token number">3</span>            </span>
<span class="line"><span class="token number">3</span>        </span>
<span class="line"></span></code></pre></div></details><h2 id="-2" tabindex="-1"><a class="header-anchor" href="#-2"><span></span></a></h2><h2 id="结构体" tabindex="-1"><a class="header-anchor" href="#结构体"><span>结构体</span></a></h2><p>Go语言的结构体其实就相当于其他编程语言的类</p><h3 id="基础" tabindex="-1"><a class="header-anchor" href="#基础"><span>基础</span></a></h3><details class="hint-container details"><summary>点击查看完整代码</summary><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">package</span> main</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">(</span></span>
<span class="line">	<span class="token string">&quot;fmt&quot;</span></span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 结构体定义语法</span></span>
<span class="line"><span class="token comment">//     语法1： type 结构体名称 struct {}</span></span>
<span class="line"><span class="token comment">//     语法2： 还可以定义匿名结构体，参考下方代码</span></span>
<span class="line"><span class="token keyword">type</span> User <span class="token keyword">struct</span> <span class="token punctuation">{</span></span>
<span class="line">	id      <span class="token builtin">int</span></span>
<span class="line">	name    <span class="token builtin">string</span></span>
<span class="line">	address <span class="token builtin">string</span></span>
<span class="line">	phone   <span class="token builtin">string</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token comment">// 初始化空结构体</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>User<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// {0   }</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">//使用字面量初始化</span></span>
<span class="line">	user1 <span class="token operator">:=</span> User<span class="token punctuation">{</span></span>
<span class="line">		id<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> name<span class="token punctuation">:</span> <span class="token string">&quot;Serry&quot;</span><span class="token punctuation">,</span> address<span class="token punctuation">:</span> <span class="token string">&quot;广东省&quot;</span><span class="token punctuation">,</span> phone<span class="token punctuation">:</span> <span class="token string">&quot;19111111111&quot;</span><span class="token punctuation">,</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>user1<span class="token punctuation">)</span> <span class="token comment">// {1 Serry 广东省 19111111111}</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 使用属性初始化</span></span>
<span class="line">	<span class="token keyword">var</span> user2 User</span>
<span class="line">	user2<span class="token punctuation">.</span>id <span class="token operator">=</span> <span class="token number">1</span></span>
<span class="line">	user2<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">&quot;Bob&quot;</span></span>
<span class="line">	user2<span class="token punctuation">.</span>address <span class="token operator">=</span> <span class="token string">&quot;河北省保定市&quot;</span></span>
<span class="line">	user2<span class="token punctuation">.</span>phone <span class="token operator">=</span> <span class="token string">&quot;13788888888&quot;</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>user2<span class="token punctuation">)</span> <span class="token comment">// {1 Bob 河北省保定市 13788888888}</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 使用new函数初始化【指针类型结构体】</span></span>
<span class="line">	<span class="token keyword">var</span> user3 <span class="token operator">*</span>User <span class="token operator">=</span> <span class="token function">new</span><span class="token punctuation">(</span>User<span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>user3<span class="token punctuation">)</span> <span class="token comment">// &amp;{0   }</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 定义匿名结构体并初始化</span></span>
<span class="line">	user4 <span class="token operator">:=</span> <span class="token keyword">struct</span> <span class="token punctuation">{</span></span>
<span class="line">		id    <span class="token builtin">int</span></span>
<span class="line">		phone <span class="token builtin">string</span></span>
<span class="line">	<span class="token punctuation">}</span><span class="token punctuation">{</span></span>
<span class="line">		id<span class="token punctuation">:</span>    <span class="token number">1</span><span class="token punctuation">,</span></span>
<span class="line">		phone<span class="token punctuation">:</span> <span class="token string">&quot;12345678910&quot;</span><span class="token punctuation">,</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>user4<span class="token punctuation">)</span> <span class="token comment">// {1 12345678910}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre></div></details><br><h3 id="自定义tag" tabindex="-1"><a class="header-anchor" href="#自定义tag"><span>自定义Tag</span></a></h3><p><code>Tag</code>使用语法</p><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token string">`key1:&quot;value1&quot; key2:&quot;value2&quot; key3:&quot;value3&quot;...`</span> <span class="token comment">// 键值对用空格分隔</span></span>
<span class="line"></span></code></pre></div><p>已知使用了结构体<code>Tag</code>的库：<a href="https://github.com/golang/go/wiki/Well-known-struct-tags" target="_blank" rel="noopener noreferrer">https://github.com/golang/go/wiki/Well-known-struct-tags</a></p><details class="hint-container details"><summary>点击查看完整代码</summary><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">package</span> main</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">(</span></span>
<span class="line">	<span class="token string">&quot;fmt&quot;</span></span>
<span class="line">	<span class="token string">&quot;reflect&quot;</span></span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">type</span> User <span class="token keyword">struct</span> <span class="token punctuation">{</span></span>
<span class="line">	Name     <span class="token builtin">string</span> <span class="token string">`my:&quot;username&quot;`</span></span>
<span class="line">	Age      <span class="token builtin">uint8</span></span>
<span class="line">	Password <span class="token builtin">string</span> <span class="token string">`my:&quot;min=6,max=10&quot;`</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">GetTag</span><span class="token punctuation">(</span>u User<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token comment">// 通过反射获取类型</span></span>
<span class="line">	t <span class="token operator">:=</span> reflect<span class="token punctuation">.</span><span class="token function">TypeOf</span><span class="token punctuation">(</span>u<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 代码						类型							说明</span></span>
<span class="line">	<span class="token comment">// t.NumField()											结构体字段数量</span></span>
<span class="line">	<span class="token comment">// t.Field(0)											第1个字段</span></span>
<span class="line">	<span class="token comment">//	t.Field(1).Name 		字符串						字段名，这里是 Name</span></span>
<span class="line">	<span class="token comment">// 	t.Field(1).Tag  		StructTag(自定义字符串类型)	Tag，这里是 my:&quot;username&quot;</span></span>
<span class="line">	<span class="token comment">//  t.Field(1).Tag.Get()	方法							根据key获取value, key不存在返回空字符串</span></span>
<span class="line"></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%-10s   %-s\n&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Struct Key&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Tag Value&quot;</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> t<span class="token punctuation">.</span><span class="token function">NumField</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span></span>
<span class="line">		field <span class="token operator">:=</span> t<span class="token punctuation">.</span><span class="token function">Field</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span></span>
<span class="line">		key <span class="token operator">:=</span> field<span class="token punctuation">.</span>Name</span>
<span class="line">		value <span class="token operator">:=</span> field<span class="token punctuation">.</span>Tag<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span><span class="token string">&quot;my&quot;</span><span class="token punctuation">)</span></span>
<span class="line">		fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%-10s   %-s\n&quot;</span><span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">)</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	user <span class="token operator">:=</span> User<span class="token punctuation">{</span></span>
<span class="line">		Name<span class="token punctuation">:</span>     <span class="token string">&quot;Jack&quot;</span><span class="token punctuation">,</span></span>
<span class="line">		Age<span class="token punctuation">:</span>      <span class="token number">5</span><span class="token punctuation">,</span></span>
<span class="line">		Password<span class="token punctuation">:</span> <span class="token string">&quot;123456&quot;</span><span class="token punctuation">,</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line">	<span class="token function">GetTag</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre></div><p>输出结果</p><div class="language-bash" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line">Struct Key   Tag Value</span>
<span class="line">Name         username    </span>
<span class="line">Age                      </span>
<span class="line">Password     <span class="token assign-left variable">min</span><span class="token operator">=</span><span class="token number">6</span>,max<span class="token operator">=</span><span class="token number">10</span></span>
<span class="line"></span></code></pre></div></details><br><h3 id="空结构体" tabindex="-1"><a class="header-anchor" href="#空结构体"><span>空结构体</span></a></h3><details class="hint-container details"><summary>（1）空结构体占用内存为0</summary><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">package</span> main</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">(</span></span>
<span class="line">	<span class="token string">&quot;fmt&quot;</span></span>
<span class="line">	<span class="token string">&quot;unsafe&quot;</span></span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">type</span> Empty <span class="token keyword">struct</span><span class="token punctuation">{</span><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token comment">// 使用unsafe.Sizeof可以查看占用内存大小,单位字节</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%d\n&quot;</span><span class="token punctuation">,</span> unsafe<span class="token punctuation">.</span><span class="token function">Sizeof</span><span class="token punctuation">(</span><span class="token function">int8</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment">// 1</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%d\n&quot;</span><span class="token punctuation">,</span> unsafe<span class="token punctuation">.</span><span class="token function">Sizeof</span><span class="token punctuation">(</span><span class="token function">int16</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 2</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%d\n&quot;</span><span class="token punctuation">,</span> unsafe<span class="token punctuation">.</span><span class="token function">Sizeof</span><span class="token punctuation">(</span>Empty<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token comment">// 0</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre></div></details><details class="hint-container details"><summary>（2）空结构体的应用场景：对方法分组，将相同类型的方法组合在一起，便于后续扩展和维护</summary><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">package</span> main</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">(</span></span>
<span class="line">	<span class="token string">&quot;fmt&quot;</span></span>
<span class="line">	<span class="token string">&quot;runtime&quot;</span></span>
<span class="line">	<span class="token string">&quot;strconv&quot;</span></span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">type</span> Platform <span class="token keyword">struct</span><span class="token punctuation">{</span><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token punctuation">(</span>e <span class="token operator">*</span>Platform<span class="token punctuation">)</span> <span class="token function">GetOS</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">string</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token keyword">return</span> runtime<span class="token punctuation">.</span>GOOS</span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token punctuation">(</span>e <span class="token operator">*</span>Platform<span class="token punctuation">)</span> <span class="token function">GetOSBit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">int</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token keyword">return</span> strconv<span class="token punctuation">.</span>IntSize</span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token keyword">var</span> platform Platform</span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%s %dbits\n&quot;</span><span class="token punctuation">,</span> platform<span class="token punctuation">.</span><span class="token function">GetOS</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> platform<span class="token punctuation">.</span><span class="token function">GetOSBit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>	<span class="token comment">// windows 64bits</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre></div></details><details class="hint-container details"><summary>（3）空结构体的应用场景：实现<code>set</code>类型</summary><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">package</span> main</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token string">&quot;fmt&quot;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">type</span> Set <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token keyword">struct</span><span class="token punctuation">{</span><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token punctuation">(</span>s Set<span class="token punctuation">)</span> <span class="token function">Add</span><span class="token punctuation">(</span>item <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	s<span class="token punctuation">[</span>item<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">struct</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">{</span><span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token punctuation">(</span>s Set<span class="token punctuation">)</span> <span class="token function">Remove</span><span class="token punctuation">(</span>item <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token function">delete</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> item<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token punctuation">(</span>s Set<span class="token punctuation">)</span> <span class="token function">Exist</span><span class="token punctuation">(</span>item <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token builtin">bool</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token boolean">_</span><span class="token punctuation">,</span> ok <span class="token operator">:=</span> s<span class="token punctuation">[</span>item<span class="token punctuation">]</span></span>
<span class="line">	<span class="token keyword">return</span> ok</span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	set <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span>Set<span class="token punctuation">)</span></span>
<span class="line">	set<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token string">&quot;123&quot;</span><span class="token punctuation">)</span></span>
<span class="line">	set<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token string">&quot;456&quot;</span><span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>set<span class="token punctuation">.</span><span class="token function">Exist</span><span class="token punctuation">(</span><span class="token string">&quot;123&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// true</span></span>
<span class="line">	set<span class="token punctuation">.</span><span class="token function">Remove</span><span class="token punctuation">(</span><span class="token string">&quot;123&quot;</span><span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>set<span class="token punctuation">.</span><span class="token function">Exist</span><span class="token punctuation">(</span><span class="token string">&quot;123&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// false</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre></div></details><details class="hint-container details"><summary>（4）空结构体的应用场景：空通道，实现通知型<code>channel</code>，其不需要发送任何数据，只是用于协调<code>Goroutine</code>运行</summary><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">package</span> main</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">(</span></span>
<span class="line">	<span class="token string">&quot;fmt&quot;</span></span>
<span class="line">	<span class="token string">&quot;time&quot;</span></span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	ch <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token keyword">struct</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	<span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">		time<span class="token punctuation">.</span><span class="token function">Sleep</span><span class="token punctuation">(</span><span class="token number">3</span> <span class="token operator">*</span> time<span class="token punctuation">.</span>Second<span class="token punctuation">)</span></span>
<span class="line">		<span class="token function">close</span><span class="token punctuation">(</span>ch<span class="token punctuation">)</span></span>
<span class="line">	<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token operator">&lt;-</span>ch</span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;b&quot;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre></div></details><br><h3 id="结构体组合" tabindex="-1"><a class="header-anchor" href="#结构体组合"><span>结构体组合</span></a></h3><p>类似于类的继承</p><details class="hint-container details"><summary>（1）基础用法</summary><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">package</span> main</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token string">&quot;fmt&quot;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">type</span> Addr <span class="token keyword">struct</span> <span class="token punctuation">{</span></span>
<span class="line">	province <span class="token builtin">string</span></span>
<span class="line">	street   <span class="token builtin">string</span></span>
<span class="line">	number   <span class="token builtin">string</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">type</span> User <span class="token keyword">struct</span> <span class="token punctuation">{</span></span>
<span class="line">	id    <span class="token builtin">int</span></span>
<span class="line">	name  <span class="token builtin">string</span></span>
<span class="line">	addr  Addr</span>
<span class="line">	phone <span class="token builtin">string</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token keyword">var</span> addr <span class="token operator">=</span> Addr<span class="token punctuation">{</span></span>
<span class="line">		province<span class="token punctuation">:</span> <span class="token string">&quot;Hebei&quot;</span><span class="token punctuation">,</span></span>
<span class="line">		street<span class="token punctuation">:</span>   <span class="token string">&quot;天威路&quot;</span><span class="token punctuation">,</span></span>
<span class="line">		number<span class="token punctuation">:</span>   <span class="token string">&quot;10&quot;</span><span class="token punctuation">,</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">	<span class="token keyword">var</span> user <span class="token operator">=</span> User<span class="token punctuation">{</span></span>
<span class="line">		id<span class="token punctuation">:</span>    <span class="token number">1</span><span class="token punctuation">,</span></span>
<span class="line">		name<span class="token punctuation">:</span>  <span class="token string">&quot;bob&quot;</span><span class="token punctuation">,</span></span>
<span class="line">		addr<span class="token punctuation">:</span>  addr<span class="token punctuation">,</span></span>
<span class="line">		phone<span class="token punctuation">:</span> <span class="token string">&quot;137111111111&quot;</span><span class="token punctuation">,</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre></div></details><details class="hint-container details"><summary>（2）K-V同名简写</summary><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">package</span> main</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token string">&quot;fmt&quot;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">type</span> User <span class="token keyword">struct</span> <span class="token punctuation">{</span></span>
<span class="line">	Basic <span class="token comment">// Basic Basic的简写形式,但与直接写Basic Basic有区别</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">type</span> Basic <span class="token keyword">struct</span> <span class="token punctuation">{</span></span>
<span class="line">	Name <span class="token builtin">string</span></span>
<span class="line">	Age  <span class="token builtin">int</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token punctuation">(</span>b <span class="token operator">*</span>Basic<span class="token punctuation">)</span> <span class="token function">GetName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">string</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token keyword">return</span> b<span class="token punctuation">.</span>Name</span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	u <span class="token operator">:=</span> User<span class="token punctuation">{</span></span>
<span class="line">		Basic<span class="token punctuation">{</span></span>
<span class="line">			Name<span class="token punctuation">:</span> <span class="token string">&quot;July&quot;</span><span class="token punctuation">,</span></span>
<span class="line">			Age<span class="token punctuation">:</span>  <span class="token number">18</span><span class="token punctuation">,</span></span>
<span class="line">		<span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%#v\n&quot;</span><span class="token punctuation">,</span> u<span class="token punctuation">)</span>   <span class="token comment">// main.User{Basic:main.Basic{Name:&quot;July&quot;, Age:18}}</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>u<span class="token punctuation">.</span><span class="token function">GetName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// July, User结构体实例可以直接使用Basic结构体的方法,如果是非简写形式则不可以直接调用</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre></div></details><br><h3 id="结构体方法" tabindex="-1"><a class="header-anchor" href="#结构体方法"><span>结构体方法</span></a></h3><details class="hint-container details"><summary>（1）基础示例</summary><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token comment">// 定义结构体</span></span>
<span class="line"><span class="token keyword">type</span> Person <span class="token keyword">struct</span> <span class="token punctuation">{</span></span>
<span class="line">	name <span class="token builtin">string</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 一般我们会为结构体定义一个构造方法（这不是必须的）</span></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">NewPerson</span><span class="token punctuation">(</span>name <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token operator">*</span>Person <span class="token punctuation">{</span></span>
<span class="line">	<span class="token keyword">return</span> <span class="token operator">&amp;</span>Person<span class="token punctuation">{</span>name<span class="token punctuation">:</span> name<span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 定义结构体方法</span></span>
<span class="line"><span class="token comment">// 语法：func (接收者变量 接收者类型) 方法名(参数列表) (返回参数)</span></span>
<span class="line"><span class="token comment">//      接收者变量: 建议使用接收者类型名称首字母的小写，而不是self、this之类的命名</span></span>
<span class="line"><span class="token comment">//      接收者类型：值类型和指针类型</span></span>
<span class="line"><span class="token keyword">func</span> <span class="token punctuation">(</span>p <span class="token operator">*</span>Person<span class="token punctuation">)</span> <span class="token function">GetName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">string</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token keyword">return</span> p<span class="token punctuation">.</span>name</span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre></div></details><details class="hint-container details"><summary>测试1：值接收者会将结构体拷贝一份到方法内</summary><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">package</span> main</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token string">&quot;fmt&quot;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">type</span> Person <span class="token keyword">struct</span> <span class="token punctuation">{</span></span>
<span class="line">	name <span class="token builtin">string</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">NewPerson</span><span class="token punctuation">(</span>name <span class="token builtin">string</span><span class="token punctuation">)</span> Person <span class="token punctuation">{</span></span>
<span class="line">	<span class="token keyword">return</span> Person<span class="token punctuation">{</span>name<span class="token punctuation">:</span> name<span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token punctuation">(</span>p Person<span class="token punctuation">)</span> <span class="token function">GetName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">string</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token keyword">return</span> p<span class="token punctuation">.</span>name</span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">func</span> <span class="token punctuation">(</span>p Person<span class="token punctuation">)</span> <span class="token function">SetName</span><span class="token punctuation">(</span>name <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;SetName: %p\n&quot;</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>p<span class="token punctuation">)</span></span>
<span class="line">	p<span class="token punctuation">.</span>name <span class="token operator">=</span> name</span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	bob <span class="token operator">:=</span> <span class="token function">NewPerson</span><span class="token punctuation">(</span><span class="token string">&quot;bob&quot;</span><span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;main: %p\n&quot;</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>bob<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	bob<span class="token punctuation">.</span><span class="token function">SetName</span><span class="token punctuation">(</span><span class="token string">&quot;jack&quot;</span><span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>bob<span class="token punctuation">.</span><span class="token function">GetName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 输出结果</span></span>
<span class="line">	<span class="token comment">// main: 0xc00004a250</span></span>
<span class="line">	<span class="token comment">// SetName: 0xc00004a260</span></span>
<span class="line">	<span class="token comment">// bob</span></span>
<span class="line">    <span class="token comment">// 总结：值接收者会将结构体拷贝一份到方法内，所以导致并没有对结构体修改成功</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre></div></details><details class="hint-container details"><summary>测试2：指针接收者不会拷贝结构体</summary><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">package</span> main</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token string">&quot;fmt&quot;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">type</span> Person <span class="token keyword">struct</span> <span class="token punctuation">{</span></span>
<span class="line">	name <span class="token builtin">string</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">NewPerson</span><span class="token punctuation">(</span>name <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token operator">*</span>Person <span class="token punctuation">{</span></span>
<span class="line">	<span class="token keyword">return</span> <span class="token operator">&amp;</span>Person<span class="token punctuation">{</span>name<span class="token punctuation">:</span> name<span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token punctuation">(</span>p <span class="token operator">*</span>Person<span class="token punctuation">)</span> <span class="token function">GetName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">string</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// 这里是一个语法糖，本质上为 return (*p).name</span></span>
<span class="line">	<span class="token keyword">return</span> p<span class="token punctuation">.</span>name</span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">func</span> <span class="token punctuation">(</span>p <span class="token operator">*</span>Person<span class="token punctuation">)</span> <span class="token function">SetName</span><span class="token punctuation">(</span>name <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;SetName: %p\n&quot;</span><span class="token punctuation">,</span> p<span class="token punctuation">)</span></span>
<span class="line">	p<span class="token punctuation">.</span>name <span class="token operator">=</span> name</span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	bob <span class="token operator">:=</span> <span class="token function">NewPerson</span><span class="token punctuation">(</span><span class="token string">&quot;bob&quot;</span><span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;main: %p\n&quot;</span><span class="token punctuation">,</span> bob<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	bob<span class="token punctuation">.</span><span class="token function">SetName</span><span class="token punctuation">(</span><span class="token string">&quot;jack&quot;</span><span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>bob<span class="token punctuation">.</span><span class="token function">GetName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 输出结果</span></span>
<span class="line">	<span class="token comment">// main: 0xc00010e110</span></span>
<span class="line">	<span class="token comment">// SetName: 0xc00010e110</span></span>
<span class="line">	<span class="token comment">// jack</span></span>
<span class="line">    <span class="token comment">// 总结：指针接收者不会拷贝结构体，所以对结构体修改成功</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre></div></details><details class="hint-container details"><summary>（3）结构体是map-v的怪异行为</summary><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">package</span> main</span>
<span class="line"></span>
<span class="line"><span class="token keyword">type</span> Person <span class="token keyword">struct</span> <span class="token punctuation">{</span></span>
<span class="line">	Name <span class="token builtin">string</span></span>
<span class="line">	Sex  <span class="token builtin">string</span></span>
<span class="line">	Age  <span class="token builtin">int</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	m <span class="token operator">:=</span> <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">uint</span><span class="token punctuation">]</span>Person<span class="token punctuation">{</span></span>
<span class="line">		<span class="token number">0</span><span class="token punctuation">:</span> Person<span class="token punctuation">{</span><span class="token string">&quot;张无忌&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;男&quot;</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">		<span class="token number">1</span><span class="token punctuation">:</span> Person<span class="token punctuation">{</span><span class="token string">&quot;赵敏&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;女&quot;</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 测试1：这会报错 cannot assign to struct field m[0].Age in map</span></span>
<span class="line">	m<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>Age <span class="token operator">+=</span> <span class="token number">1</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 测试2：迂回解决</span></span>
<span class="line">	<span class="token comment">//tmp := m[0]</span></span>
<span class="line">	<span class="token comment">//tmp.Age += 1</span></span>
<span class="line">	<span class="token comment">//m[0] = tmp</span></span>
<span class="line">	<span class="token comment">//fmt.Println(m[0].Age)</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 测试3：定义map为指针类型后解决</span></span>
<span class="line">	<span class="token comment">//m2 := map[uint]*Person{</span></span>
<span class="line">	<span class="token comment">//	0: &amp;Person{&quot;张无忌&quot;, &quot;男&quot;, 20},</span></span>
<span class="line">	<span class="token comment">//	1: &amp;Person{&quot;赵敏&quot;, &quot;女&quot;, 21},</span></span>
<span class="line">	<span class="token comment">//}</span></span>
<span class="line">	<span class="token comment">//</span></span>
<span class="line">	<span class="token comment">//m2[0].Age += 1</span></span>
<span class="line">	<span class="token comment">//fmt.Println(m2[0].Age)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre></div></details><br><h3 id="函数式选项模式" tabindex="-1"><a class="header-anchor" href="#函数式选项模式"><span>函数式选项模式</span></a></h3><p>该模式解决的问题是如何更动态灵活地为对象配置参数</p><details class="hint-container details"><summary>点击查看详情</summary><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">package</span> main</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token string">&quot;fmt&quot;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 定义结构体</span></span>
<span class="line"><span class="token keyword">type</span> User <span class="token keyword">struct</span> <span class="token punctuation">{</span></span>
<span class="line">	Name <span class="token builtin">string</span> <span class="token comment">// 必须字段</span></span>
<span class="line">	Age  <span class="token builtin">uint8</span>  <span class="token comment">// 非必须</span></span>
<span class="line">	Sex  <span class="token builtin">string</span> <span class="token comment">// 非必须</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 定义各种选项</span></span>
<span class="line"><span class="token keyword">type</span> Option <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token operator">*</span>User<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">WithAge</span><span class="token punctuation">(</span>age <span class="token builtin">uint8</span><span class="token punctuation">)</span> Option <span class="token punctuation">{</span></span>
<span class="line">	<span class="token keyword">return</span> <span class="token keyword">func</span><span class="token punctuation">(</span>user <span class="token operator">*</span>User<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">		user<span class="token punctuation">.</span>Age <span class="token operator">=</span> age</span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">WithSex</span><span class="token punctuation">(</span>sex <span class="token builtin">string</span><span class="token punctuation">)</span> Option <span class="token punctuation">{</span></span>
<span class="line">	<span class="token keyword">return</span> <span class="token keyword">func</span><span class="token punctuation">(</span>user <span class="token operator">*</span>User<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">		user<span class="token punctuation">.</span>Sex <span class="token operator">=</span> sex</span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">DefaultOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>Option <span class="token punctuation">{</span></span>
<span class="line">	<span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>Option<span class="token punctuation">{</span><span class="token function">WithAge</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">WithSex</span><span class="token punctuation">(</span><span class="token string">&quot;superman&quot;</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 构造方法</span></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">NewUser</span><span class="token punctuation">(</span>name <span class="token builtin">string</span><span class="token punctuation">,</span> options <span class="token operator">...</span>Option<span class="token punctuation">)</span> <span class="token operator">*</span>User <span class="token punctuation">{</span></span>
<span class="line">	<span class="token comment">// (1) 必须有的字段直接写到函数签名中，这里只有一个name</span></span>
<span class="line">	<span class="token comment">// (2) 可有可无的通过options动态传递</span></span>
<span class="line">	<span class="token comment">// (3) 以后若增加新的选项，也不需要改构造函数</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 实例化结构体</span></span>
<span class="line">	user <span class="token operator">:=</span> <span class="token operator">&amp;</span>User<span class="token punctuation">{</span>Name<span class="token punctuation">:</span> name<span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 设置默认参数</span></span>
<span class="line">	<span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> option <span class="token operator">:=</span> <span class="token keyword">range</span> <span class="token function">DefaultOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">		<span class="token function">option</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 自定义参数</span></span>
<span class="line">	<span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> option <span class="token operator">:=</span> <span class="token keyword">range</span> options <span class="token punctuation">{</span></span>
<span class="line">		<span class="token function">option</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line">	<span class="token keyword">return</span> user</span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	bob <span class="token operator">:=</span> <span class="token function">NewUser</span><span class="token punctuation">(</span><span class="token string">&quot;bob&quot;</span><span class="token punctuation">)</span></span>
<span class="line">	jack <span class="token operator">:=</span> <span class="token function">NewUser</span><span class="token punctuation">(</span><span class="token string">&quot;jack&quot;</span><span class="token punctuation">,</span> <span class="token function">WithAge</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">WithSex</span><span class="token punctuation">(</span><span class="token string">&quot;man&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">	julie <span class="token operator">:=</span> <span class="token function">NewUser</span><span class="token punctuation">(</span><span class="token string">&quot;julie&quot;</span><span class="token punctuation">,</span> <span class="token function">WithSex</span><span class="token punctuation">(</span><span class="token string">&quot;woman&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%#v\n&quot;</span><span class="token punctuation">,</span> bob<span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%#v\n&quot;</span><span class="token punctuation">,</span> jack<span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%#v\n&quot;</span><span class="token punctuation">,</span> julie<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">//&amp;main.User{Name:&quot;bob&quot;, Age:0xa, Sex:&quot;superman&quot;}</span></span>
<span class="line">	<span class="token comment">//&amp;main.User{Name:&quot;jack&quot;, Age:0x14, Sex:&quot;man&quot;}  </span></span>
<span class="line">	<span class="token comment">//&amp;main.User{Name:&quot;julie&quot;, Age:0xa, Sex:&quot;woman&quot;}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre></div></details><br><h3 id="计算内存占用" tabindex="-1"><a class="header-anchor" href="#计算内存占用"><span>计算内存占用</span></a></h3><p><strong>结论</strong></p><p>结构体内存占用大小是<span style="color:red;font-weight:bold;">每个字段内存对齐之后占用之和</span>，并不是每个字段占用之和</p><p><strong>结构体内存对齐规则</strong></p><ul><li>第一个字段在与结构体偏移量为0的地址处</li><li>其他字段要对齐到对齐数的整数倍的地址处</li></ul><details class="hint-container details"><summary>（1）查看每种数据类型占用大小和对齐数</summary><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">package</span> main</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">(</span></span>
<span class="line">	<span class="token string">&quot;fmt&quot;</span></span>
<span class="line">	<span class="token string">&quot;unsafe&quot;</span></span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;bool  : Size %2d, Alignment %d\n&quot;</span><span class="token punctuation">,</span> unsafe<span class="token punctuation">.</span><span class="token function">Sizeof</span><span class="token punctuation">(</span><span class="token function">bool</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> unsafe<span class="token punctuation">.</span><span class="token function">Alignof</span><span class="token punctuation">(</span><span class="token function">bool</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;int8  : Size %2d, Alignment %d\n&quot;</span><span class="token punctuation">,</span> unsafe<span class="token punctuation">.</span><span class="token function">Sizeof</span><span class="token punctuation">(</span><span class="token function">int8</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> unsafe<span class="token punctuation">.</span><span class="token function">Alignof</span><span class="token punctuation">(</span><span class="token function">int8</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;int16 : Size %2d, Alignment %d\n&quot;</span><span class="token punctuation">,</span> unsafe<span class="token punctuation">.</span><span class="token function">Sizeof</span><span class="token punctuation">(</span><span class="token function">int16</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> unsafe<span class="token punctuation">.</span><span class="token function">Alignof</span><span class="token punctuation">(</span><span class="token function">int16</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;int32 : Size %2d, Alignment %d\n&quot;</span><span class="token punctuation">,</span> unsafe<span class="token punctuation">.</span><span class="token function">Sizeof</span><span class="token punctuation">(</span><span class="token function">int32</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> unsafe<span class="token punctuation">.</span><span class="token function">Alignof</span><span class="token punctuation">(</span><span class="token function">int32</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;int64 : Size %2d, Alignment %d\n&quot;</span><span class="token punctuation">,</span> unsafe<span class="token punctuation">.</span><span class="token function">Sizeof</span><span class="token punctuation">(</span><span class="token function">int64</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> unsafe<span class="token punctuation">.</span><span class="token function">Alignof</span><span class="token punctuation">(</span><span class="token function">int64</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;byte  : Size %2d, Alignment %d\n&quot;</span><span class="token punctuation">,</span> unsafe<span class="token punctuation">.</span><span class="token function">Sizeof</span><span class="token punctuation">(</span><span class="token function">byte</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> unsafe<span class="token punctuation">.</span><span class="token function">Alignof</span><span class="token punctuation">(</span><span class="token function">byte</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;rune  : Size %2d, Alignment %d\n&quot;</span><span class="token punctuation">,</span> unsafe<span class="token punctuation">.</span><span class="token function">Sizeof</span><span class="token punctuation">(</span><span class="token function">rune</span><span class="token punctuation">(</span><span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> unsafe<span class="token punctuation">.</span><span class="token function">Alignof</span><span class="token punctuation">(</span><span class="token function">rune</span><span class="token punctuation">(</span><span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;string: Size %2d, Alignment %d\n&quot;</span><span class="token punctuation">,</span> unsafe<span class="token punctuation">.</span><span class="token function">Sizeof</span><span class="token punctuation">(</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> unsafe<span class="token punctuation">.</span><span class="token function">Alignof</span><span class="token punctuation">(</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;struct: Size %2d, Alignment %d\n&quot;</span><span class="token punctuation">,</span> unsafe<span class="token punctuation">.</span><span class="token function">Sizeof</span><span class="token punctuation">(</span><span class="token keyword">struct</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span> unsafe<span class="token punctuation">.</span><span class="token function">Alignof</span><span class="token punctuation">(</span><span class="token keyword">struct</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre></div><p>输出结果</p><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token builtin">bool</span>  <span class="token punctuation">:</span> Size  <span class="token number">1</span><span class="token punctuation">,</span> Alignment <span class="token number">1</span></span>
<span class="line"><span class="token builtin">int8</span>  <span class="token punctuation">:</span> Size  <span class="token number">1</span><span class="token punctuation">,</span> Alignment <span class="token number">1</span></span>
<span class="line"><span class="token builtin">int16</span> <span class="token punctuation">:</span> Size  <span class="token number">2</span><span class="token punctuation">,</span> Alignment <span class="token number">2</span></span>
<span class="line"><span class="token builtin">int32</span> <span class="token punctuation">:</span> Size  <span class="token number">4</span><span class="token punctuation">,</span> Alignment <span class="token number">4</span></span>
<span class="line"><span class="token builtin">int64</span> <span class="token punctuation">:</span> Size  <span class="token number">8</span><span class="token punctuation">,</span> Alignment <span class="token number">8</span></span>
<span class="line"><span class="token builtin">byte</span>  <span class="token punctuation">:</span> Size  <span class="token number">1</span><span class="token punctuation">,</span> Alignment <span class="token number">1</span></span>
<span class="line"><span class="token builtin">rune</span>  <span class="token punctuation">:</span> Size  <span class="token number">4</span><span class="token punctuation">,</span> Alignment <span class="token number">4</span></span>
<span class="line"><span class="token builtin">string</span><span class="token punctuation">:</span> Size <span class="token number">16</span><span class="token punctuation">,</span> Alignment <span class="token number">8</span></span>
<span class="line"><span class="token keyword">struct</span><span class="token punctuation">:</span> Size  <span class="token number">0</span><span class="token punctuation">,</span> Alignment <span class="token number">1</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// Size代表占用内存大小（单位字节）</span></span>
<span class="line"><span class="token comment">// Alignment代表内存对齐数字（单位字节）</span></span>
<span class="line"></span></code></pre></div></details><details class="hint-container details"><summary>（2）对齐规则验证</summary><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">package</span> main</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">(</span></span>
<span class="line">	<span class="token string">&quot;fmt&quot;</span></span>
<span class="line">	<span class="token string">&quot;unsafe&quot;</span></span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">type</span> P1 <span class="token keyword">struct</span> <span class="token punctuation">{</span></span>
<span class="line">	a <span class="token builtin">bool</span>   <span class="token comment">// 偏移量为0, 自身占用1个字节</span></span>
<span class="line">	b <span class="token builtin">int32</span>  <span class="token comment">// 与a做内存对齐,int32类型的对齐倍数为4,导致偏移量为4,自身又占用4个字节,所以本字段结束位置在偏移量为8的位置</span></span>
<span class="line">	c <span class="token builtin">byte</span>   <span class="token comment">// 与b做内存对齐,偏移量为9的位置</span></span>
<span class="line">	d <span class="token builtin">string</span> <span class="token comment">// 与c做内存对齐,偏移量开始位置在16,自身占用16,最终位置在32</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">type</span> P2 <span class="token keyword">struct</span> <span class="token punctuation">{</span></span>
<span class="line">	a <span class="token builtin">bool</span>   <span class="token comment">// 偏移量为0,最终位置1</span></span>
<span class="line">	c <span class="token builtin">byte</span>   <span class="token comment">// 偏移量为1,最终位置2</span></span>
<span class="line">	b <span class="token builtin">int32</span>  <span class="token comment">// 偏移量开始为4,结束为8</span></span>
<span class="line">	d <span class="token builtin">string</span> <span class="token comment">// 偏移量开始为8,结束为 8 + 16 = 24</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>unsafe<span class="token punctuation">.</span><span class="token function">Sizeof</span><span class="token punctuation">(</span>P1<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 32</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>unsafe<span class="token punctuation">.</span><span class="token function">Sizeof</span><span class="token punctuation">(</span>P2<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 24</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre></div></details><h2 id="-3" tabindex="-1"><a class="header-anchor" href="#-3"><span></span></a></h2><h2 id="接口" tabindex="-1"><a class="header-anchor" href="#接口"><span>接口</span></a></h2><h3 id="接口是什么" tabindex="-1"><a class="header-anchor" href="#接口是什么"><span>接口是什么</span></a></h3><p>接口是一个类型，就和<code>int</code>、<code>string</code>、<code>map</code>等一样，是类型，不是值</p><p>接口是一系列方法的集合，比如<code>io.Writer</code>就是一个接口</p><p>某个值实现了某个接口的所有方法，我们称它实现了某个接口，比如<code>os.Stdout</code>实现了<code>io.Writer</code>接口</p><p>下面用代码演示一下</p><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">package</span> main</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">(</span></span>
<span class="line">	<span class="token string">&quot;io&quot;</span></span>
<span class="line">	<span class="token string">&quot;os&quot;</span></span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token comment">// 声明变量w,类型为 io.Writer, 这是一个接口类型的变量</span></span>
<span class="line">	<span class="token keyword">var</span> w io<span class="token punctuation">.</span>Writer</span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 给接口类型变量赋值</span></span>
<span class="line">	w <span class="token operator">=</span> os<span class="token punctuation">.</span>Stdout</span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 调用</span></span>
<span class="line">	<span class="token boolean">_</span><span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">=</span> w<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span><span class="token string">&quot;hello&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>	<span class="token comment">// hello</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre></div><br><h3 id="接口类型都可以用在哪" tabindex="-1"><a class="header-anchor" href="#接口类型都可以用在哪"><span>接口类型都可以用在哪</span></a></h3><p>接口是一种类型，那么都可以用在哪呢？</p><p>（1）声明变量为接口类型</p><p>（2）函数形参指定为接口类型</p><p>（3）结构体字段指定为接口类型</p><details class="hint-container details"><summary>点击查看完整代码</summary><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">package</span> main</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">(</span></span>
<span class="line">	<span class="token string">&quot;io&quot;</span></span>
<span class="line">	<span class="token string">&quot;log&quot;</span></span>
<span class="line">	<span class="token string">&quot;os&quot;</span></span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">WriteString</span><span class="token punctuation">(</span>w io<span class="token punctuation">.</span>Writer<span class="token punctuation">,</span> msg <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>n <span class="token builtin">int</span><span class="token punctuation">,</span> err <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token keyword">return</span> w<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">type</span> User <span class="token keyword">struct</span> <span class="token punctuation">{</span></span>
<span class="line">	io<span class="token punctuation">.</span>Writer</span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token comment">// 应用1: 声明为接口变量</span></span>
<span class="line">	<span class="token keyword">var</span> w io<span class="token punctuation">.</span>Writer</span>
<span class="line">	w <span class="token operator">=</span> os<span class="token punctuation">.</span>Stdout</span>
<span class="line">	<span class="token keyword">if</span> <span class="token boolean">_</span><span class="token punctuation">,</span> err <span class="token operator">:=</span> w<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span><span class="token string">&quot;hello &quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span></span>
<span class="line">		log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 应用2: 函数形参为接口类型</span></span>
<span class="line">	<span class="token keyword">if</span> <span class="token boolean">_</span><span class="token punctuation">,</span> err <span class="token operator">:=</span> <span class="token function">WriteString</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>Stdout<span class="token punctuation">,</span> <span class="token string">&quot;world&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span></span>
<span class="line">		log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 应用3: 结构体字段为接口类型</span></span>
<span class="line">	user <span class="token operator">:=</span> User<span class="token punctuation">{</span>os<span class="token punctuation">.</span>Stdout<span class="token punctuation">}</span></span>
<span class="line">	<span class="token keyword">if</span> <span class="token boolean">_</span><span class="token punctuation">,</span> err <span class="token operator">:=</span> user<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span><span class="token string">&quot;!\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span></span>
<span class="line">		log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 输出结果：</span></span>
<span class="line"><span class="token comment">// hello world!</span></span>
<span class="line"></span></code></pre></div></details><br><h3 id="接口类型值都可以是什么" tabindex="-1"><a class="header-anchor" href="#接口类型值都可以是什么"><span>接口类型值都可以是什么</span></a></h3><p>凡是实现了接口中定义的方法的对象都可以是接口值，都有哪些呢？</p><p>（1）结构体（这个是最常用的）</p><p>（2）自定义类型（一个自定义类型作为接口类型的值，感觉有点奇怪哈~）</p><details class="hint-container details"><summary>点击查看完整代码</summary><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">package</span> main</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">(</span></span>
<span class="line">	<span class="token string">&quot;log&quot;</span></span>
<span class="line">	<span class="token string">&quot;os&quot;</span></span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 定义接口</span></span>
<span class="line"><span class="token keyword">type</span> Writer <span class="token keyword">interface</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token function">Write</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>n <span class="token builtin">int</span><span class="token punctuation">,</span> err <span class="token builtin">error</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 自定义类型</span></span>
<span class="line"><span class="token keyword">type</span> Stdout <span class="token builtin">string</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token punctuation">(</span>m Stdout<span class="token punctuation">)</span> <span class="token function">Write</span><span class="token punctuation">(</span>w <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>n <span class="token builtin">int</span><span class="token punctuation">,</span> err <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token keyword">return</span> os<span class="token punctuation">.</span>Stdout<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span>w<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token keyword">var</span> a Stdout <span class="token comment">// 声明变量a为自定义类型</span></span>
<span class="line">	<span class="token keyword">var</span> b Writer <span class="token comment">// 声明变量b为接口类型</span></span>
<span class="line">	b <span class="token operator">=</span> a        <span class="token comment">// 自定义类型实现了Reader接口,所以可以将a赋值给b</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 调用方法</span></span>
<span class="line">	<span class="token keyword">if</span> <span class="token boolean">_</span><span class="token punctuation">,</span> err <span class="token operator">:=</span> b<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span><span class="token string">&quot;hello&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span></span>
<span class="line">		log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 输出结果</span></span>
<span class="line"><span class="token comment">// hello</span></span>
<span class="line"></span></code></pre></div></details><br><h3 id="值接收者和指针接收者" tabindex="-1"><a class="header-anchor" href="#值接收者和指针接收者"><span>值接收者和指针接收者</span></a></h3><details class="hint-container details"><summary>点击查看完整代码</summary><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">package</span> main</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token string">&quot;fmt&quot;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 定义Sender接口</span></span>
<span class="line"><span class="token keyword">type</span> Sender <span class="token keyword">interface</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token function">Send</span><span class="token punctuation">(</span><span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token builtin">error</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 定义微信媒介</span></span>
<span class="line"><span class="token keyword">type</span> Weixin <span class="token keyword">struct</span> <span class="token punctuation">{</span></span>
<span class="line">	User     <span class="token builtin">string</span></span>
<span class="line">	Password <span class="token builtin">string</span></span>
<span class="line">	Phone    <span class="token builtin">string</span></span>
<span class="line">	To       <span class="token builtin">string</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token punctuation">(</span>s <span class="token operator">*</span>Weixin<span class="token punctuation">)</span> <span class="token function">Send</span><span class="token punctuation">(</span>msg <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span> <span class="token comment">// 指针方法</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;Weixin Send: %s\n&quot;</span><span class="token punctuation">,</span> msg<span class="token punctuation">)</span></span>
<span class="line">	<span class="token keyword">return</span> <span class="token boolean">nil</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 定义邮箱媒介</span></span>
<span class="line"><span class="token keyword">type</span> Email <span class="token keyword">struct</span> <span class="token punctuation">{</span></span>
<span class="line">	Addr     <span class="token builtin">string</span></span>
<span class="line">	Port     <span class="token builtin">string</span></span>
<span class="line">	User     <span class="token builtin">string</span></span>
<span class="line">	Password <span class="token builtin">string</span></span>
<span class="line">	to       <span class="token builtin">string</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token punctuation">(</span>e Email<span class="token punctuation">)</span> <span class="token function">Send</span><span class="token punctuation">(</span>msg <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span> <span class="token comment">// 值方法</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;Email Send: %s\n&quot;</span><span class="token punctuation">,</span> msg<span class="token punctuation">)</span></span>
<span class="line">	<span class="token keyword">return</span> <span class="token boolean">nil</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token comment">// 测试1</span></span>
<span class="line">	<span class="token keyword">var</span> x Sender    <span class="token comment">// 声明x为Sender接口类型</span></span>
<span class="line">	x <span class="token operator">=</span> <span class="token operator">&amp;</span>Weixin<span class="token punctuation">{</span><span class="token punctuation">}</span>   <span class="token comment">// 给x赋值, 接收者是指针类型的,所以这里必须使用指针类型</span></span>
<span class="line">	x<span class="token punctuation">.</span><span class="token function">Send</span><span class="token punctuation">(</span><span class="token string">&quot;hello&quot;</span><span class="token punctuation">)</span> <span class="token comment">// 调用方法</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 测试2</span></span>
<span class="line">	<span class="token keyword">var</span> y<span class="token punctuation">,</span> z Sender <span class="token comment">// 声明Sender接口类型</span></span>
<span class="line">	y <span class="token operator">=</span> Email<span class="token punctuation">{</span><span class="token punctuation">}</span>     <span class="token comment">// 赋值</span></span>
<span class="line">	z <span class="token operator">=</span> <span class="token operator">&amp;</span>Email<span class="token punctuation">{</span><span class="token punctuation">}</span>    <span class="token comment">// 赋值</span></span>
<span class="line">	y<span class="token punctuation">.</span><span class="token function">Send</span><span class="token punctuation">(</span><span class="token string">&quot;hello&quot;</span><span class="token punctuation">)</span> <span class="token comment">// 调用方法</span></span>
<span class="line">	z<span class="token punctuation">.</span><span class="token function">Send</span><span class="token punctuation">(</span><span class="token string">&quot;hello&quot;</span><span class="token punctuation">)</span> <span class="token comment">// 调用方法,指针对象调用的本质还是值对象调用,只是语法糖</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 输出结果</span></span>
<span class="line">	<span class="token comment">// Weixin Send: hello</span></span>
<span class="line">	<span class="token comment">// Email Send: hello</span></span>
<span class="line">	<span class="token comment">// Email Send: hello</span></span>
<span class="line">	<span class="token comment">// 总结:</span></span>
<span class="line">	<span class="token comment">// (1) 指针类型接收者的方法必须使用指针对象来调用</span></span>
<span class="line">	<span class="token comment">// (2) 值类型接收者的方法既可以用值对象调用,也可以用指针对象调用</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre></div></details><br><h3 id="空接口" tabindex="-1"><a class="header-anchor" href="#空接口"><span>空接口</span></a></h3><p>空接口意为着可以接受任意类型的值，也意味着我们不能确定值是什么类型</p><details class="hint-container details"><summary>点击查看完整代码</summary><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">package</span> main</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token string">&quot;fmt&quot;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 定义空接口</span></span>
<span class="line"><span class="token keyword">type</span> Empty <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token keyword">var</span> a Empty</span>
<span class="line">	a <span class="token operator">=</span> <span class="token number">1</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>	<span class="token comment">// 1</span></span>
<span class="line">	a <span class="token operator">=</span> <span class="token string">&quot;Hello&quot;</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>	<span class="token comment">// Hello</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre></div></details><br><h3 id="断言和查询" tabindex="-1"><a class="header-anchor" href="#断言和查询"><span>断言和查询</span></a></h3><details class="hint-container details"><summary>点击查看完整代码</summary><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">package</span> main</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">(</span></span>
<span class="line">	<span class="token string">&quot;fmt&quot;</span></span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">//定义一个结构体</span></span>
<span class="line"><span class="token keyword">type</span> EmailSender <span class="token keyword">struct</span> <span class="token punctuation">{</span></span>
<span class="line">	Addr     <span class="token builtin">string</span></span>
<span class="line">	Port     <span class="token builtin">string</span></span>
<span class="line">	User     <span class="token builtin">string</span></span>
<span class="line">	Password <span class="token builtin">string</span></span>
<span class="line">	to       <span class="token builtin">string</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token punctuation">(</span>s <span class="token operator">*</span>EmailSender<span class="token punctuation">)</span> <span class="token function">Send</span><span class="token punctuation">(</span>msg <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;Hello &quot;</span> <span class="token operator">+</span> msg<span class="token punctuation">)</span></span>
<span class="line">	<span class="token keyword">return</span> <span class="token boolean">nil</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">//定义一个结构体</span></span>
<span class="line"><span class="token keyword">type</span> WeiChartSender <span class="token keyword">struct</span> <span class="token punctuation">{</span></span>
<span class="line">	User     <span class="token builtin">string</span></span>
<span class="line">	Password <span class="token builtin">string</span></span>
<span class="line">	to       <span class="token builtin">string</span></span>
<span class="line">	Phone    <span class="token builtin">string</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token punctuation">(</span>s <span class="token operator">*</span>WeiChartSender<span class="token punctuation">)</span> <span class="token function">Send</span><span class="token punctuation">(</span>msg <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;Hello &quot;</span> <span class="token operator">+</span> msg<span class="token punctuation">)</span></span>
<span class="line">	<span class="token keyword">return</span> <span class="token boolean">nil</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">//定义一个接口</span></span>
<span class="line"><span class="token keyword">type</span> Sender <span class="token keyword">interface</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token function">Send</span><span class="token punctuation">(</span><span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token builtin">error</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token comment">// 初始化</span></span>
<span class="line">	<span class="token keyword">var</span> a Sender <span class="token operator">=</span> <span class="token operator">&amp;</span>WeiChartSender<span class="token punctuation">{</span>User<span class="token punctuation">:</span> <span class="token string">&quot;我是小a&quot;</span><span class="token punctuation">}</span> <span class="token comment">// 定义sender为Sender接口类型; 如果用new初始化,直接赋值就会报错了</span></span>
<span class="line">	b <span class="token operator">:=</span> <span class="token function">new</span><span class="token punctuation">(</span>WeiChartSender<span class="token punctuation">)</span>                     <span class="token comment">// 定义b为WeiChartSender结构体指针类型</span></span>
<span class="line">	b<span class="token punctuation">.</span>User <span class="token operator">=</span> <span class="token string">&quot;我是小b&quot;</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 正常调用方法</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;正常方法调用:&quot;</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token boolean">_</span> <span class="token operator">=</span> a<span class="token punctuation">.</span><span class="token function">Send</span><span class="token punctuation">(</span><span class="token string">&quot;world!&quot;</span><span class="token punctuation">)</span> <span class="token comment">// Hello world!</span></span>
<span class="line">	<span class="token boolean">_</span> <span class="token operator">=</span> b<span class="token punctuation">.</span><span class="token function">Send</span><span class="token punctuation">(</span><span class="token string">&quot;world!&quot;</span><span class="token punctuation">)</span> <span class="token comment">// Hello world!</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 查看各个类型,看起来两个类型都一样</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;\n查看类型:&quot;</span><span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%T\n&quot;</span><span class="token punctuation">,</span> a<span class="token punctuation">)</span> <span class="token comment">// *main.WeiChartSender</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%T\n&quot;</span><span class="token punctuation">,</span> b<span class="token punctuation">)</span> <span class="token comment">// *main.WeiChartSender</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 调用属性, 接口类型的不能调用,因为接口只能要求函数, 定义不了属性,当然也没有实现</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;\n查看属性:&quot;</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token comment">//fmt.Println(a.User) // 这个会报错 a.User undefined (type Sender has no field or method User)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;b.User=%s\n&quot;</span><span class="token punctuation">,</span> b<span class="token punctuation">.</span>User<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 接口类型转换为结构体 -- 断言方式</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;\n断言方式:&quot;</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token keyword">if</span> obj<span class="token punctuation">,</span> ok <span class="token operator">:=</span> a<span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token operator">*</span>WeiChartSender<span class="token punctuation">)</span><span class="token punctuation">;</span> ok <span class="token punctuation">{</span></span>
<span class="line">		fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;断言成功: %#v\n&quot;</span><span class="token punctuation">,</span> obj<span class="token punctuation">)</span></span>
<span class="line">		fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;a.User=%s\n&quot;</span><span class="token punctuation">,</span> obj<span class="token punctuation">.</span>User<span class="token punctuation">)</span></span>
<span class="line">	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">		fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;断言失败&quot;</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 接口类型转换为结构体 -- 查询方式</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;\n查询方式:&quot;</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token keyword">switch</span> obj <span class="token operator">:=</span> a<span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token keyword">type</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token keyword">case</span> <span class="token operator">*</span>WeiChartSender<span class="token punctuation">:</span></span>
<span class="line">		fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;查询成功: %#v\n&quot;</span><span class="token punctuation">,</span> obj<span class="token punctuation">)</span></span>
<span class="line">        fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;a.User=%s\n&quot;</span><span class="token punctuation">,</span> obj<span class="token punctuation">.</span>User<span class="token punctuation">)</span></span>
<span class="line">	<span class="token keyword">default</span><span class="token punctuation">:</span></span>
<span class="line">		fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;查询失败\n&quot;</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre></div><p>输出结果</p><div class="language-bash" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line">正常方法调用:</span>
<span class="line">Hello world<span class="token operator">!</span>                                                                </span>
<span class="line">Hello world<span class="token operator">!</span>                                                                </span>
<span class="line">                                                                            </span>
<span class="line">查看类型:                                                                   </span>
<span class="line">*main.WeiChartSender                                                        </span>
<span class="line">*main.WeiChartSender                                                        </span>
<span class="line">                                                                            </span>
<span class="line">查看属性:                                                                   </span>
<span class="line"><span class="token assign-left variable">b.User</span><span class="token operator">=</span>我是小b                                                              </span>
<span class="line">                                                                            </span>
<span class="line">断言方式:                                                                   </span>
<span class="line">断言成功: <span class="token operator">&amp;</span>main.WeiChartSender<span class="token punctuation">{</span>User:<span class="token string">&quot;我是小a&quot;</span>, Password:<span class="token string">&quot;&quot;</span>, to:<span class="token string">&quot;&quot;</span>, Phone:<span class="token string">&quot;&quot;</span><span class="token punctuation">}</span></span>
<span class="line"><span class="token assign-left variable">a.User</span><span class="token operator">=</span>我是小a                                                              </span>
<span class="line">                                                                            </span>
<span class="line">查询方式:                                                                   </span>
<span class="line">查询成功: <span class="token operator">&amp;</span>main.WeiChartSender<span class="token punctuation">{</span>User:<span class="token string">&quot;我是小a&quot;</span>, Password:<span class="token string">&quot;&quot;</span>, to:<span class="token string">&quot;&quot;</span>, Phone:<span class="token string">&quot;&quot;</span><span class="token punctuation">}</span></span>
<span class="line"><span class="token assign-left variable">a.User</span><span class="token operator">=</span>我是小a</span>
<span class="line"></span></code></pre></div></details><br><h3 id="常用接口" tabindex="-1"><a class="header-anchor" href="#常用接口"><span>常用接口</span></a></h3><details class="hint-container details"><summary>（1）Stringer</summary><p>字符串功能接口</p><p>定义如下</p><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token comment">// fmt.print.go</span></span>
<span class="line"><span class="token keyword">type</span> Stringer <span class="token keyword">interface</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token function">String</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">string</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre></div><p>测试代码</p><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">package</span> main</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token string">&quot;fmt&quot;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">type</span> A <span class="token keyword">struct</span> <span class="token punctuation">{</span></span>
<span class="line">	Name <span class="token builtin">string</span></span>
<span class="line">	Age  <span class="token builtin">uint</span></span>
<span class="line">	Sex  <span class="token builtin">string</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token punctuation">(</span>a A<span class="token punctuation">)</span> <span class="token function">String</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">string</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token keyword">return</span> fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span><span class="token string">&quot;String: 大家好, 我是%s, 性别%s, 年龄%d&quot;</span><span class="token punctuation">,</span> a<span class="token punctuation">.</span>Name<span class="token punctuation">,</span> a<span class="token punctuation">.</span>Sex<span class="token punctuation">,</span> a<span class="token punctuation">.</span>Age<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token punctuation">(</span>a A<span class="token punctuation">)</span> <span class="token function">GoString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">string</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token keyword">return</span> fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span><span class="token string">&quot;GoString: 大家好, 我是%s, 性别%s, 年龄%d&quot;</span><span class="token punctuation">,</span> a<span class="token punctuation">.</span>Name<span class="token punctuation">,</span> a<span class="token punctuation">.</span>Sex<span class="token punctuation">,</span> a<span class="token punctuation">.</span>Age<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	a <span class="token operator">:=</span> <span class="token operator">&amp;</span>A<span class="token punctuation">{</span></span>
<span class="line">		Name<span class="token punctuation">:</span> <span class="token string">&quot;张三&quot;</span><span class="token punctuation">,</span></span>
<span class="line">		Age<span class="token punctuation">:</span>  <span class="token number">18</span><span class="token punctuation">,</span></span>
<span class="line">		Sex<span class="token punctuation">:</span>  <span class="token string">&quot;男&quot;</span><span class="token punctuation">,</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%v\n&quot;</span><span class="token punctuation">,</span> a<span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%+v\n&quot;</span><span class="token punctuation">,</span> a<span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%#v\n&quot;</span><span class="token punctuation">,</span> a<span class="token punctuation">)</span> <span class="token comment">// GoString</span></span>
<span class="line"></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%s\n&quot;</span><span class="token punctuation">,</span> a<span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%q\n&quot;</span><span class="token punctuation">,</span> a<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre></div><p>输出结果</p><div class="language-bash" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line">String: 大家好, 我是张三, 性别男, 年龄18</span>
<span class="line">String: 大家好, 我是张三, 性别男, 年龄18  </span>
<span class="line">String: 大家好, 我是张三, 性别男, 年龄18  </span>
<span class="line">GoString: 大家好, 我是张三, 性别男, 年龄18</span>
<span class="line">String: 大家好, 我是张三, 性别男, 年龄18  </span>
<span class="line"><span class="token string">&quot;String: 大家好, 我是张三, 性别男, 年龄18&quot;</span></span>
<span class="line"></span></code></pre></div></details><h2 id="-4" tabindex="-1"><a class="header-anchor" href="#-4"><span></span></a></h2><h2 id="io" tabindex="-1"><a class="header-anchor" href="#io"><span>IO</span></a></h2><h3 id="fmt-格式化io" tabindex="-1"><a class="header-anchor" href="#fmt-格式化io"><span><code>fmt</code>：格式化IO</span></a></h3><p>文档：<a href="https://pkg.go.dev/fmt" target="_blank" rel="noopener noreferrer">https://pkg.go.dev/fmt</a></p><details class="hint-container details"><summary>（1）常用函数</summary><table><thead><tr><th>分类</th><th>函数</th><th>说明</th></tr></thead><tbody><tr><td>输出到控制台</td><td><code>fmt.Print(string)</code></td><td>不换行</td></tr><tr><td></td><td><code>fmt.Println(string)</code></td><td>自动换行，<code>ln</code>意为<code>line</code></td></tr><tr><td></td><td><code>fmt.Printf(格式化字符, 字符串)</code></td><td>格式化输出</td></tr><tr><td>作为返回值返回</td><td><code>fmt.Sprint()</code></td><td></td></tr><tr><td></td><td><code>fmt.Sprintln()</code></td><td></td></tr><tr><td></td><td><code>fmt.Sprintf(格式化字符, 字符串对象)</code></td><td></td></tr><tr><td>接收用户输入</td><td><code>fmt.Scan(指针对象)</code></td><td>将控制台接收的值 赋值给指针对象</td></tr></tbody></table></details><details class="hint-container details"><summary>（2）fmt.printf格式化字符串</summary><table><thead><tr><th>分类</th><th>修饰符</th><th>说明</th></tr></thead><tbody><tr><td>常用</td><td><code>%T</code></td><td>数据类型</td></tr><tr><td></td><td><code>%v</code></td><td>获取数据的值，如果实现了 <code>error </code>接口，仅表示错误消息</td></tr><tr><td></td><td><code>%+v</code></td><td>获取数据的值，如果是结构体会携带字段名</td></tr><tr><td></td><td><code>%#v</code></td><td>获取数据的值，如果是结构体会携带结构体名和字段名</td></tr><tr><td>指针</td><td><code>%p</code></td><td>指针地址（带 <code>0x</code>）</td></tr><tr><td></td><td><code>%#p</code></td><td>指针地址（不带 <code>0x</code>）</td></tr><tr><td>字符串</td><td><code>%s</code></td><td>字符串或字节切片</td></tr><tr><td></td><td><code>%c</code></td><td>Unicode码点对应的字符</td></tr><tr><td></td><td><code>%q</code></td><td>对于字符串或字节切片，结果会加上双引号；<br>对于<code>byte</code>或<code>rune，</code>结果会加上单引号</td></tr><tr><td>字符串宽度</td><td><code>%5s</code></td><td>最小宽度为5（默认右对齐）</td></tr><tr><td></td><td><code>%-5s</code></td><td>最小宽度为5（左对齐）</td></tr><tr><td></td><td><code>%.5s</code></td><td>最大宽度为5，多出部分会截断</td></tr><tr><td></td><td><code>%5.7s</code></td><td>最小宽度为5，最大宽度为7</td></tr><tr><td></td><td><code>%-5.7s</code></td><td>最小宽度为5，最大宽度为7（左对齐）</td></tr><tr><td></td><td><code>%5.3s</code></td><td>如果宽度大于3，则截断</td></tr><tr><td></td><td><code>%05s</code></td><td>如果宽度小于5，就会在字符串前面补零</td></tr><tr><td>整型</td><td><code>%b</code></td><td>二进制数</td></tr><tr><td></td><td><code>%o</code></td><td>八进制数</td></tr><tr><td></td><td><code>%#o</code></td><td>八进制数</td></tr><tr><td></td><td><code>%d</code></td><td>十进制数</td></tr><tr><td></td><td><code>%x</code></td><td>打印16进制数，a-f</td></tr><tr><td></td><td><code>%X</code></td><td>打印16进制数，A-F</td></tr><tr><td></td><td><code>%#x</code>、<code>%#X</code></td><td>打印16进制数，带<code>0x</code>、<code>0X</code></td></tr><tr><td></td><td><code>% x</code>、<code>% X</code></td><td>打印16进制数，前面带一个空格</td></tr><tr><td>浮点数</td><td><code>%f</code></td><td>浮点数, 默认保留6位小数，即<code>%.6</code></td></tr><tr><td></td><td><code>%e</code></td><td>科学计数法，默认保留6位小数，即<code>%.6e</code></td></tr><tr><td>指针</td><td><code>%p</code></td><td>指针，十六进制表示，带前缀<code>0x</code></td></tr><tr><td></td><td><code>%#p</code></td><td>指针，十六进制表示，不带前缀<code>0x</code></td></tr><tr><td>布尔值</td><td><code>%t</code></td><td>打印<code>true</code>或<code>false</code></td></tr></tbody></table></details><details class="hint-container details"><summary>（3）fmt.Printf：基础示例</summary><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">package</span> main</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token string">&quot;fmt&quot;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">type</span> Person <span class="token keyword">struct</span> <span class="token punctuation">{</span></span>
<span class="line">	Name <span class="token builtin">string</span></span>
<span class="line">	Age  <span class="token builtin">int</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	person <span class="token operator">:=</span> Person<span class="token punctuation">{</span>Name<span class="token punctuation">:</span> <span class="token string">&quot;Bob&quot;</span><span class="token punctuation">,</span> Age<span class="token punctuation">:</span> <span class="token number">20</span><span class="token punctuation">}</span></span>
<span class="line">	numbers <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 常用类型</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%T\n&quot;</span><span class="token punctuation">,</span> person<span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%v\n&quot;</span><span class="token punctuation">,</span> person<span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%+v\n&quot;</span><span class="token punctuation">,</span> person<span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%#v\n&quot;</span><span class="token punctuation">,</span> person<span class="token punctuation">)</span></span>
<span class="line">	<span class="token comment">//main.Person</span></span>
<span class="line">	<span class="token comment">//{Bob 20}</span></span>
<span class="line">	<span class="token comment">//{Name:Bob Age:20}</span></span>
<span class="line">	<span class="token comment">//main.Person{Name:&quot;Bob&quot;, Age:20}</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 指针类型，值类型需要使用&amp;获取指针地址，引用类型加不加&amp;都可以</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%p, %p\n&quot;</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>person<span class="token punctuation">,</span> numbers<span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%#p, %#p\n&quot;</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>person<span class="token punctuation">,</span> <span class="token operator">&amp;</span>numbers<span class="token punctuation">)</span></span>
<span class="line">	<span class="token comment">//0xc000004078, 0xc0000161e0</span></span>
<span class="line">	<span class="token comment">//c000004078, c0000161e0</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 字符串</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%s, %s\n&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;北京&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span><span class="token string">&quot;北京&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%#x\n&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">rune</span><span class="token punctuation">(</span><span class="token string">&quot;北京&quot;</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">// 0x5317, 字符串 -&gt; unicode -&gt; 16进制</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%c\n&quot;</span><span class="token punctuation">,</span> <span class="token number">0x5317</span><span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%q, %q, %q\n&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;北京&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span><span class="token string">&quot;北京&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0x5317</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token comment">//北京, 北京</span></span>
<span class="line">	<span class="token comment">//0x5317</span></span>
<span class="line">	<span class="token comment">//北</span></span>
<span class="line">	<span class="token comment">//&quot;北京&quot;, &quot;北京&quot;, &#39;北&#39;</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 字符串宽度</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%5s\n&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;ABC&quot;</span><span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%-5s\n&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;ABC&quot;</span><span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%.5s\n&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;ABCDEF&quot;</span><span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%5.3s\n&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;ABCDEF&quot;</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token comment">//ABC</span></span>
<span class="line">	<span class="token comment">//ABC</span></span>
<span class="line">	<span class="token comment">//ABCDE</span></span>
<span class="line">	<span class="token comment">//ABC</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 整型</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%b\n&quot;</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%o\n&quot;</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%#o\n&quot;</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%x\n&quot;</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%X\n&quot;</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%X\n&quot;</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%#x\n&quot;</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%#X\n&quot;</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;% X\n&quot;</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token comment">//11</span></span>
<span class="line">	<span class="token comment">//11</span></span>
<span class="line">	<span class="token comment">//011</span></span>
<span class="line">	<span class="token comment">//f</span></span>
<span class="line">	<span class="token comment">//F</span></span>
<span class="line">	<span class="token comment">//F</span></span>
<span class="line">	<span class="token comment">//0xf</span></span>
<span class="line">	<span class="token comment">//0XF</span></span>
<span class="line">	<span class="token comment">// F</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 	浮点数</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%.2f\n&quot;</span><span class="token punctuation">,</span> <span class="token number">2.985</span><span class="token punctuation">)</span>                     <span class="token comment">// 并非四舍五入</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%.2f\n&quot;</span><span class="token punctuation">,</span> <span class="token number">2.986</span><span class="token punctuation">)</span>                     <span class="token comment">// 也不是完全舍去小数</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%f\n&quot;</span><span class="token punctuation">,</span> <span class="token number">3.3333333333333333333333333</span><span class="token punctuation">)</span> <span class="token comment">// 默认保留六位小数</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%f\n&quot;</span><span class="token punctuation">,</span> <span class="token number">3.0</span><span class="token punctuation">)</span>                         <span class="token comment">// 默认保留六位小数，即%.06</span></span>
<span class="line">    </span>
<span class="line">    <span class="token comment">// 科学计数法</span></span>
<span class="line">    <span class="token comment">// 默认为%.6e；计算方法为：123456.789 = 1.23456789 * 10^5 = 1.23456789e5，又因为是保留6位小数，所以1.234568</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%e\n&quot;</span><span class="token punctuation">,</span> <span class="token number">123456.789</span><span class="token punctuation">)</span>                  </span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 指针</span></span>
<span class="line">	a <span class="token operator">:=</span> <span class="token number">1</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%p\n&quot;</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>a<span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%#p\n&quot;</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>a<span class="token punctuation">)</span></span>
<span class="line">	<span class="token comment">//0xc0000181c0</span></span>
<span class="line">	<span class="token comment">//c0000181c0</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 布尔值</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%t\n&quot;</span><span class="token punctuation">,</span> <span class="token number">1</span> <span class="token operator">&gt;</span> <span class="token number">2</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token comment">// false</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre></div></details><details class="hint-container details"><summary>（4）fmt.Printf：多进度条实现原理</summary><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">package</span> main</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">(</span></span>
<span class="line">	<span class="token string">&quot;fmt&quot;</span></span>
<span class="line">	<span class="token string">&quot;time&quot;</span></span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">const</span> <span class="token punctuation">(</span></span>
<span class="line">	PreviousLineClear <span class="token operator">=</span> <span class="token string">&quot;\033[F&quot;</span> <span class="token comment">// 光标回到上一行行首并清空行</span></span>
<span class="line">	CurrentLineClear  <span class="token operator">=</span> <span class="token string">&quot;\033[K&quot;</span> <span class="token comment">// 光标回到当前行行首并清空行</span></span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">11</span><span class="token punctuation">;</span> i <span class="token operator">&gt;=</span> <span class="token number">1</span><span class="token punctuation">;</span> i<span class="token operator">--</span> <span class="token punctuation">{</span></span>
<span class="line">		<span class="token keyword">if</span> i <span class="token operator">!=</span> <span class="token number">11</span> <span class="token punctuation">{</span></span>
<span class="line">			fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span>PreviousLineClear<span class="token punctuation">)</span></span>
<span class="line">			fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span>PreviousLineClear<span class="token punctuation">)</span></span>
<span class="line">		<span class="token punctuation">}</span></span>
<span class="line">		fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%s%d\n&quot;</span><span class="token punctuation">,</span> CurrentLineClear<span class="token punctuation">,</span> i<span class="token punctuation">)</span></span>
<span class="line">		fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%s%d\n&quot;</span><span class="token punctuation">,</span> CurrentLineClear<span class="token punctuation">,</span> i<span class="token punctuation">)</span></span>
<span class="line">		time<span class="token punctuation">.</span><span class="token function">Sleep</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span>Millisecond <span class="token operator">*</span> <span class="token number">500</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre></div></details><details class="hint-container details"><summary>（5）fmt.Printf：动态指定宽度</summary><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">package</span> main</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token string">&quot;fmt&quot;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;|%-10s|\n&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Hello World!&quot;</span><span class="token punctuation">)</span>    <span class="token comment">// 左对齐，并指定宽度为10</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;|%-*s|\n&quot;</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token string">&quot;Hello World!&quot;</span><span class="token punctuation">)</span> <span class="token comment">// 左对齐，并动态指定宽度为20</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre></div><p>输出结果</p><div class="language-bash" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line">D:<span class="token punctuation">\</span>application<span class="token punctuation">\</span>GoLand<span class="token punctuation">\</span>example<span class="token operator">&gt;</span>go run main.go</span>
<span class="line"><span class="token operator">|</span>Hello World<span class="token operator">!</span><span class="token operator">|</span></span>
<span class="line"><span class="token operator">|</span>Hello World<span class="token operator">!</span>        <span class="token operator">|</span></span>
<span class="line"></span></code></pre></div></details><details class="hint-container details"><summary>（6）fmt.Printf：位置引用</summary><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">package</span> main</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token string">&quot;fmt&quot;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%s %s\n&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;2&quot;</span><span class="token punctuation">)</span>             <span class="token comment">// 正常的使用方法</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%[2]s %[1]s\n&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;2&quot;</span><span class="token punctuation">)</span>       <span class="token comment">// [2]引用第二个变量, [1]引用第一个变量</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%[2]s %[2]s %[2]s\n&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;2&quot;</span><span class="token punctuation">)</span> <span class="token comment">// 多次引用没有问题</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre></div><p>输出结果</p><div class="language-bash" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line">D:<span class="token punctuation">\</span>application<span class="token punctuation">\</span>GoLand<span class="token punctuation">\</span>example<span class="token operator">&gt;</span>go run main.go</span>
<span class="line"><span class="token number">1</span> <span class="token number">2</span></span>
<span class="line"><span class="token number">2</span> <span class="token number">1</span></span>
<span class="line"><span class="token number">2</span> <span class="token number">2</span> <span class="token number">2</span></span>
<span class="line"></span></code></pre></div></details><details class="hint-container details"><summary>（7）fmt.Fscanf：接收用户输入</summary><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">package</span> main</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">(</span></span>
<span class="line">	<span class="token string">&quot;fmt&quot;</span></span>
<span class="line">	<span class="token string">&quot;os&quot;</span></span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token keyword">for</span> <span class="token punctuation">{</span></span>
<span class="line">		fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;Enter your name: &quot;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">		<span class="token comment">// 从os.Stdin读取, format指定数据格式, 并赋值给 指针变量</span></span>
<span class="line">		<span class="token keyword">var</span> name <span class="token builtin">string</span></span>
<span class="line">		<span class="token boolean">_</span><span class="token punctuation">,</span> err <span class="token operator">:=</span> fmt<span class="token punctuation">.</span><span class="token function">Fscanf</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>Stdin<span class="token punctuation">,</span> <span class="token string">&quot;%s&quot;</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>name<span class="token punctuation">)</span></span>
<span class="line">		<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span></span>
<span class="line">			<span class="token keyword">continue</span></span>
<span class="line">		<span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span></span>
<span class="line">		<span class="token keyword">break</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre></div><p>输出结果</p><div class="language-bash" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line">Enter your name:		  <span class="token comment"># 直接输入空格, 会报错, 重新循环</span></span>
<span class="line">Enter your name: zhangsan <span class="token comment"># 输入, 并按回车</span></span>
<span class="line">zhangsan                  <span class="token comment"># 输出, 跳出循环</span></span>
<span class="line"></span></code></pre></div></details><br><h3 id="os-基础文件读写" tabindex="-1"><a class="header-anchor" href="#os-基础文件读写"><span><code>os</code>：基础文件读写</span></a></h3><p>官方文档：<a href="https://pkg.go.dev/os" target="_blank" rel="noopener noreferrer">https://pkg.go.dev/os</a></p><br><p><strong>一、基础函数</strong></p><details class="hint-container details"><summary>（1）打开文件的三种方式</summary><p>方式一：<code>OpenFile</code></p><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token comment">// OpenFile(name string, flag int, perm FileMode) (*File, error)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// flag选项</span></span>
<span class="line"><span class="token comment">//	(1)打开模式（必须指定其一）</span></span>
<span class="line"><span class="token comment">//		os.O_RDONLY         以只读方式打开文件       如果文件不存在则报错</span></span>
<span class="line"><span class="token comment">//		os.O_WRONLY         以只写方式打开          如果文件不存在则报错</span></span>
<span class="line"><span class="token comment">//		os.O_RDWR           以读写方式打开文件       如果文件不存在则报错</span></span>
<span class="line"><span class="token comment">//	(2)辅助控制行为</span></span>
<span class="line"><span class="token comment">//		os.O_APPEND         追加方式写入</span></span>
<span class="line"><span class="token comment">//		os.O_CREATE         文件不存在则创建文件；Windows系统该属性会自带写属性                                          </span></span>
<span class="line"><span class="token comment">//		os.O_EXCL           文件必须不存在；使用场景比如：只允许进程打开自己的文件 或 多进程运行时退出，只允许单进程运行</span></span>
<span class="line"><span class="token comment">//		os.O_TRUNC          文件存在则截断（清空内容）</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 常用flag组合选项</span></span>
<span class="line"><span class="token comment">//	读文件</span></span>
<span class="line"><span class="token comment">//		os.O_RDONLY                             读文件，文件不存在则报错</span></span>
<span class="line"><span class="token comment">//	写文件</span></span>
<span class="line"><span class="token comment">//		os.O_RDWR | os.O_CREATE                 写文件，当文件不存在时自动创建文件</span></span>
<span class="line"><span class="token comment">//		os.O_RDWR | os.O_CREATE | os.O_APPEND   写文件，当文件不存在时自动创建文件，当文件存在时追加内容</span></span>
<span class="line"><span class="token comment">//		os.O_RDWR | os.O_CREATE | os.O_TRUNC    写文件，当文件不存在时自动创建文件，当文件存在时清空文件内容</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// perm选项</span></span>
<span class="line"><span class="token comment">// 	文件权限</span></span>
<span class="line"><span class="token comment">//	(1)只有在创建文件时才有用，当不需要创建文件时可以设置为0</span></span>
<span class="line"><span class="token comment">//	(2)内置常量os.ModePerm = 0777</span></span>
<span class="line"></span></code></pre></div><p>方式二：<code>Open</code></p><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">func</span> <span class="token function">Open</span><span class="token punctuation">(</span>name <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>File<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token keyword">return</span> <span class="token function">OpenFile</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> O_RDONLY<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 核心为OpenFile，以只读模式打开文件，当文件不存在时会报错</span></span>
<span class="line"></span></code></pre></div><p>方式三：<code>Create</code></p><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">func</span> <span class="token function">Create</span><span class="token punctuation">(</span>name <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>File<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token keyword">return</span> <span class="token function">OpenFile</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> O_RDWR<span class="token operator">|</span>O_CREATE<span class="token operator">|</span>O_TRUNC<span class="token punctuation">,</span> <span class="token number">0666</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 核心为OpenFile，当文件不存在时会创建，当文件存在时会清空文件内容</span></span>
<span class="line"><span class="token comment">// 使用时多加注意，不要误清空了文件内容!!!</span></span>
<span class="line"></span></code></pre></div></details><details class="hint-container details"><summary>（2）常用的文件操作函数</summary><table><thead><tr><th>分类</th><th>函数</th><th>说明</th></tr></thead><tbody><tr><td>创建临时文件或目录</td><td><code>CreateTemp(dir, pattern string) (*File, error)</code></td><td>创建临时文件，返回临时文件的路径<br>（1）<code>dir</code>指定在哪个目录下创建临时目录，为空会使用用户默认临时目录<br>（2）<code>pattern </code>指定文件名前缀，如果包含<code>*</code>，那么代指整个文件名，<br><code>*</code>被替换为随机字符串</td></tr><tr><td></td><td><code>MkdirTemp(dir, pattern string) (string, error)</code></td><td>同上，只不过创建的是临时目录</td></tr><tr><td>创建目录</td><td><code>Mkdir(name string, perm FileMode) error</code></td><td>创建目录；<br>（1）不支持创建多级目录<br>（2）目录存在时会报错</td></tr><tr><td></td><td><code>MkdirAll(path string, perm FileMode) error</code></td><td>创建目录<br>（1）支持创建多级目录<br>（2）目录存在时会报错</td></tr><tr><td>删除文件或目录</td><td><code>Remove(name string) error</code></td><td>删除文件或空目录，不存在时会报错</td></tr><tr><td></td><td><code>RemoveAll(path string) error</code></td><td>删除文件或目录，支持非空目录，不存在时会报错</td></tr><tr><td>重命名</td><td><code>Rename(oldpath, newpath string) error</code></td><td>文件或目录重命名</td></tr><tr><td>文件详情</td><td><code>Stat(name string) (FileInfo, error)</code></td><td>获取文件详情</td></tr><tr><td></td><td><code>Lstat(name string) (FileInfo, error)</code></td><td>同上，区别是对于链接文件，<code>Stat</code>具有穿透能力而<code>Lstat</code>没有</td></tr><tr><td>判断是哪种错误</td><td><code>IsExist(err error) bool</code></td><td>是否是文件存在错误</td></tr><tr><td></td><td><code>IsNotExist(err error) bool</code></td><td>是否是文件不存在错误</td></tr><tr><td></td><td><code>IsPermission(err error) bool</code></td><td>是否是权限错误</td></tr><tr><td></td><td><code>IsTimeout(err error) bool</code></td><td>是否是超时错误</td></tr></tbody></table></details><details class="hint-container details"><summary>（3）判断文件或目录是否存在</summary><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">package</span> main</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">(</span></span>
<span class="line">	<span class="token string">&quot;fmt&quot;</span></span>
<span class="line">	<span class="token string">&quot;os&quot;</span></span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 判断文件或目录是否存在</span></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">PathExists</span><span class="token punctuation">(</span>path <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token builtin">bool</span><span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token boolean">_</span><span class="token punctuation">,</span> err <span class="token operator">:=</span> os<span class="token punctuation">.</span><span class="token function">Stat</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span></span>
<span class="line">	<span class="token keyword">if</span> err <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span></span>
<span class="line">		<span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">nil</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line">	<span class="token keyword">if</span> os<span class="token punctuation">.</span><span class="token function">IsNotExist</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">		<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">nil</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line">	<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">,</span> err</span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> path <span class="token operator">:=</span> <span class="token keyword">range</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span><span class="token string">&quot;main.go&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;go.mod&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;test.log&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;C:\\Windows&quot;</span><span class="token punctuation">}</span> <span class="token punctuation">{</span></span>
<span class="line">		<span class="token keyword">if</span> exists<span class="token punctuation">,</span> err <span class="token operator">:=</span> <span class="token function">PathExists</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span></span>
<span class="line">			fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%s exist: %t\n&quot;</span><span class="token punctuation">,</span> path<span class="token punctuation">,</span> exists<span class="token punctuation">)</span></span>
<span class="line">		<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">			fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%s exist: %t\n&quot;</span><span class="token punctuation">,</span> path<span class="token punctuation">,</span> <span class="token string">&quot;unknown&quot;</span><span class="token punctuation">)</span></span>
<span class="line">		<span class="token punctuation">}</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre></div><p>输出结果</p><div class="language-bash" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line">main.go exist: <span class="token boolean">true</span></span>
<span class="line">go.mod exist: <span class="token boolean">true</span>    </span>
<span class="line">test.log exist: <span class="token boolean">false</span> </span>
<span class="line">C:<span class="token punctuation">\</span>Windows exist: <span class="token boolean">true</span></span>
<span class="line"></span></code></pre></div></details><br><p><strong>二、写入数据</strong></p><details class="hint-container details"><summary>点击查看完整代码</summary><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">package</span> main</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">(</span></span>
<span class="line">	<span class="token string">&quot;io&quot;</span></span>
<span class="line">	<span class="token string">&quot;log&quot;</span></span>
<span class="line">	<span class="token string">&quot;os&quot;</span></span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token comment">// 打开文件，文件存在则清空内容，不存在则创建</span></span>
<span class="line">	f<span class="token punctuation">,</span> err <span class="token operator">:=</span> os<span class="token punctuation">.</span><span class="token function">OpenFile</span><span class="token punctuation">(</span><span class="token string">&quot;test.log&quot;</span><span class="token punctuation">,</span> os<span class="token punctuation">.</span>O_RDWR<span class="token operator">|</span>os<span class="token punctuation">.</span>O_CREATE<span class="token operator">|</span>os<span class="token punctuation">.</span>O_TRUNC<span class="token punctuation">,</span> <span class="token number">0777</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span></span>
<span class="line">		log<span class="token punctuation">.</span><span class="token function">Fatalf</span><span class="token punctuation">(</span><span class="token string">&quot;Open file error: %s\n&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line">	<span class="token keyword">defer</span> f<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 写入内容 - 字节</span></span>
<span class="line">	byteLine <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span><span class="token string">&quot;人之初，性本善。性相近，习相远。&quot;</span><span class="token punctuation">)</span></span>
<span class="line">	byteLine <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>byteLine<span class="token punctuation">,</span> <span class="token char">&#39;\n&#39;</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token keyword">if</span> <span class="token boolean">_</span><span class="token punctuation">,</span> err <span class="token operator">:=</span> f<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span>byteLine<span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span></span>
<span class="line">		log<span class="token punctuation">.</span><span class="token function">Fatalf</span><span class="token punctuation">(</span><span class="token string">&quot;Write error: %s&quot;</span><span class="token punctuation">,</span> byteLine<span class="token punctuation">)</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 写入内容 - 字符串</span></span>
<span class="line">	stringLine <span class="token operator">:=</span> <span class="token string">&quot;苟不教，性乃迁。教之道，贵以专。&quot;</span></span>
<span class="line">	stringLine <span class="token operator">=</span> stringLine <span class="token operator">+</span> <span class="token string">&quot;\n&quot;</span></span>
<span class="line">	<span class="token keyword">if</span> <span class="token boolean">_</span><span class="token punctuation">,</span> err <span class="token operator">:=</span> f<span class="token punctuation">.</span><span class="token function">WriteString</span><span class="token punctuation">(</span>stringLine<span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span></span>
<span class="line">		log<span class="token punctuation">.</span><span class="token function">Fatalf</span><span class="token punctuation">(</span><span class="token string">&quot;Write error: %s&quot;</span><span class="token punctuation">,</span> stringLine<span class="token punctuation">)</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 获取文件指针位置 (从当前位置开始，偏移为0的位置)</span></span>
<span class="line">	currentSeek<span class="token punctuation">,</span> err <span class="token operator">:=</span> f<span class="token punctuation">.</span><span class="token function">Seek</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> io<span class="token punctuation">.</span>SeekCurrent<span class="token punctuation">)</span></span>
<span class="line">	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span></span>
<span class="line">		log<span class="token punctuation">.</span><span class="token function">Fatalf</span><span class="token punctuation">(</span><span class="token string">&quot;Get file current seek error: %s\n&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 使用指针写入（写入的长度会将指针后面的内容覆盖）</span></span>
<span class="line">	<span class="token comment">// 这里我们使用”新“替换掉”贵以专。“中的”贵“,思路就是文件指针移动到”贵“字上，然后替换即可</span></span>
<span class="line">	<span class="token comment">// 偏移量计算：1(&#39;\n&#39;) + 12(&quot;贵新专。&quot;，一个汉字3个字节，注意这里的句号是中文的，也计算在汉字里面) = 13</span></span>
<span class="line">	seekRune <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span><span class="token string">&quot;新&quot;</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token keyword">if</span> <span class="token boolean">_</span><span class="token punctuation">,</span> err <span class="token operator">:=</span> f<span class="token punctuation">.</span><span class="token function">WriteAt</span><span class="token punctuation">(</span>seekRune<span class="token punctuation">,</span> currentSeek<span class="token operator">-</span><span class="token number">13</span><span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span></span>
<span class="line">		log<span class="token punctuation">.</span><span class="token function">Fatalf</span><span class="token punctuation">(</span><span class="token string">&quot;Write error: %s&quot;</span><span class="token punctuation">,</span> byteLine<span class="token punctuation">)</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre></div></details><br><p><strong>三、读取数据</strong></p><details class="hint-container details"><summary>（1）按字节从文件开始读取数据</summary><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">package</span> main</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">(</span></span>
<span class="line">	<span class="token string">&quot;fmt&quot;</span></span>
<span class="line">	<span class="token string">&quot;io&quot;</span></span>
<span class="line">	<span class="token string">&quot;log&quot;</span></span>
<span class="line">	<span class="token string">&quot;os&quot;</span></span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">Read</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token comment">// 打开文件</span></span>
<span class="line">	fileName <span class="token operator">:=</span> <span class="token string">&quot;test.log&quot;</span></span>
<span class="line">	f<span class="token punctuation">,</span> err <span class="token operator">:=</span> os<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span>fileName<span class="token punctuation">)</span></span>
<span class="line">	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span></span>
<span class="line">		log<span class="token punctuation">.</span><span class="token function">Fatalf</span><span class="token punctuation">(</span><span class="token string">&quot;文件不存在: %s\n&quot;</span><span class="token punctuation">,</span> fileName<span class="token punctuation">)</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line">	<span class="token keyword">defer</span> f<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 循环读取文件</span></span>
<span class="line">	buffer <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span><span class="token punctuation">,</span> <span class="token number">1024</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token keyword">for</span> <span class="token punctuation">{</span></span>
<span class="line">		n<span class="token punctuation">,</span> err <span class="token operator">:=</span> f<span class="token punctuation">.</span><span class="token function">Read</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">		<span class="token comment">// 处理数据</span></span>
<span class="line">		<span class="token keyword">if</span> n <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token punctuation">{</span></span>
<span class="line">            fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%s&quot;</span><span class="token punctuation">,</span> buffer<span class="token punctuation">[</span><span class="token punctuation">:</span>n<span class="token punctuation">]</span><span class="token punctuation">)</span>	<span class="token comment">// 注意这里[:n]</span></span>
<span class="line">		<span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">		<span class="token comment">// 判断是否可以读取下一行</span></span>
<span class="line">		<span class="token keyword">if</span> err <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span></span>
<span class="line">			<span class="token keyword">continue</span></span>
<span class="line">		<span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">		<span class="token comment">// 文件读取完成</span></span>
<span class="line">		<span class="token keyword">if</span> err <span class="token operator">==</span> io<span class="token punctuation">.</span>EOF <span class="token punctuation">{</span></span>
<span class="line">			<span class="token keyword">break</span></span>
<span class="line">		<span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">		<span class="token comment">// 文件读取失败</span></span>
<span class="line">		log<span class="token punctuation">.</span><span class="token function">Fatalf</span><span class="token punctuation">(</span><span class="token string">&quot;文件读取失败: %s:%s\n&quot;</span><span class="token punctuation">,</span> fileName<span class="token punctuation">,</span> err<span class="token punctuation">)</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token function">Read</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre></div></details><details class="hint-container details"><summary>（2）按字节从文件任意位置读取数据</summary><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">package</span> main</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">(</span></span>
<span class="line">	<span class="token string">&quot;fmt&quot;</span></span>
<span class="line">	<span class="token string">&quot;io&quot;</span></span>
<span class="line">	<span class="token string">&quot;log&quot;</span></span>
<span class="line">	<span class="token string">&quot;os&quot;</span></span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">ReadAt</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token comment">// 打开文件</span></span>
<span class="line">	fileName <span class="token operator">:=</span> <span class="token string">&quot;test.log&quot;</span></span>
<span class="line">	f<span class="token punctuation">,</span> err <span class="token operator">:=</span> os<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span>fileName<span class="token punctuation">)</span></span>
<span class="line">	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span></span>
<span class="line">		log<span class="token punctuation">.</span><span class="token function">Fatalf</span><span class="token punctuation">(</span><span class="token string">&quot;文件不存在: %s\n&quot;</span><span class="token punctuation">,</span> fileName<span class="token punctuation">)</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line">	<span class="token keyword">defer</span> f<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 获取文件指针(末尾)</span></span>
<span class="line">	seekEnd<span class="token punctuation">,</span> err <span class="token operator">:=</span> f<span class="token punctuation">.</span><span class="token function">Seek</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> io<span class="token punctuation">.</span>SeekEnd<span class="token punctuation">)</span></span>
<span class="line">	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span></span>
<span class="line">		log<span class="token punctuation">.</span><span class="token function">Fatalf</span><span class="token punctuation">(</span><span class="token string">&quot;File seek error: %s\n&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// ReadAt读取</span></span>
<span class="line">	buf <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span></span>
<span class="line">	n<span class="token punctuation">,</span> err <span class="token operator">:=</span> f<span class="token punctuation">.</span><span class="token function">ReadAt</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span> seekEnd<span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token comment">// 读取文件末尾的4个字节，换行符1个字节，中文1个字节</span></span>
<span class="line">	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span></span>
<span class="line">		log<span class="token punctuation">.</span><span class="token function">Fatalf</span><span class="token punctuation">(</span><span class="token string">&quot;File readat error: %s\n&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token function">string</span><span class="token punctuation">(</span>buf<span class="token punctuation">[</span><span class="token punctuation">:</span>n<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token function">ReadAt</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre></div></details><details class="hint-container details"><summary>（3）读取中文乱码问题</summary><p>一个中文占3个字节，如果只是简单的使用<code>Read</code>按字节读取文件的话，有可能会遇到中文乱码问题</p><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">package</span> main</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">(</span></span>
<span class="line">	<span class="token string">&quot;bufio&quot;</span></span>
<span class="line">	<span class="token string">&quot;fmt&quot;</span></span>
<span class="line">	<span class="token string">&quot;io&quot;</span></span>
<span class="line">	<span class="token string">&quot;log&quot;</span></span>
<span class="line">	<span class="token string">&quot;os&quot;</span></span>
<span class="line">	<span class="token string">&quot;unicode/utf8&quot;</span></span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">WriteFile</span><span class="token punctuation">(</span>fileName <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token comment">// 生成数据</span></span>
<span class="line">	data <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">170</span><span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span></span>
<span class="line">		data <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span><span class="token string">&quot;中&quot;</span><span class="token punctuation">)</span><span class="token operator">...</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line">	data <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span><span class="token string">&quot;国&quot;</span><span class="token punctuation">)</span><span class="token operator">...</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 写入文件</span></span>
<span class="line">	err <span class="token operator">:=</span> os<span class="token punctuation">.</span><span class="token function">WriteFile</span><span class="token punctuation">(</span>fileName<span class="token punctuation">,</span> data<span class="token punctuation">,</span> os<span class="token punctuation">.</span>ModePerm<span class="token punctuation">)</span></span>
<span class="line">	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span></span>
<span class="line">		log<span class="token punctuation">.</span><span class="token function">Fatalf</span><span class="token punctuation">(</span><span class="token string">&quot;写入文件失败: %s\n&quot;</span><span class="token punctuation">,</span> fileName<span class="token punctuation">)</span></span>
<span class="line">	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">		log<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;写入文件成功: %s: %d bytes\n&quot;</span><span class="token punctuation">,</span> fileName<span class="token punctuation">,</span> <span class="token function">len</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">ReadByte</span><span class="token punctuation">(</span>fileName <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token comment">// 打开文件</span></span>
<span class="line">	f<span class="token punctuation">,</span> err <span class="token operator">:=</span> os<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span>fileName<span class="token punctuation">)</span></span>
<span class="line">	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span></span>
<span class="line">		log<span class="token punctuation">.</span><span class="token function">Fatalf</span><span class="token punctuation">(</span><span class="token string">&quot;打开文件失败: %s\n&quot;</span><span class="token punctuation">,</span> fileName<span class="token punctuation">)</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line">	<span class="token keyword">defer</span> f<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 读取数据</span></span>
<span class="line">	buf <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span><span class="token punctuation">,</span> <span class="token number">512</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token keyword">for</span> <span class="token punctuation">{</span></span>
<span class="line">		n<span class="token punctuation">,</span> err <span class="token operator">:=</span> f<span class="token punctuation">.</span><span class="token function">Read</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span></span>
<span class="line">		<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span></span>
<span class="line">			<span class="token keyword">if</span> err <span class="token operator">==</span> io<span class="token punctuation">.</span>EOF <span class="token punctuation">{</span></span>
<span class="line">				<span class="token keyword">break</span></span>
<span class="line">			<span class="token punctuation">}</span></span>
<span class="line">			log<span class="token punctuation">.</span><span class="token function">Fatalf</span><span class="token punctuation">(</span><span class="token string">&quot;读取文件失败: %s: %s \n&quot;</span><span class="token punctuation">,</span> fileName<span class="token punctuation">,</span> err<span class="token punctuation">)</span></span>
<span class="line">		<span class="token punctuation">}</span></span>
<span class="line">		log<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;读取文件成功: %s: %d bytes\n&quot;</span><span class="token punctuation">,</span> fileName<span class="token punctuation">,</span> n<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">		<span class="token comment">// 显示数据,最后一个中文显示乱码</span></span>
<span class="line">		log<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;显示文件内容: %s\n&quot;</span><span class="token punctuation">,</span> <span class="token function">string</span><span class="token punctuation">(</span>buf<span class="token punctuation">[</span><span class="token punctuation">:</span>n<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">		<span class="token comment">// 检测切片[]byte是否包含完整且合法的UTF-8编码序列（不能有乱码）</span></span>
<span class="line">		log<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;检测字节切片是否是完整且合法的UTF-8编码序列: %t\n&quot;</span><span class="token punctuation">,</span> utf8<span class="token punctuation">.</span><span class="token function">Valid</span><span class="token punctuation">(</span>buf<span class="token punctuation">[</span><span class="token punctuation">:</span>n<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">ReadAllByte</span><span class="token punctuation">(</span>fileName <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	data<span class="token punctuation">,</span> err <span class="token operator">:=</span> os<span class="token punctuation">.</span><span class="token function">ReadFile</span><span class="token punctuation">(</span>fileName<span class="token punctuation">)</span></span>
<span class="line">	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span></span>
<span class="line">		log<span class="token punctuation">.</span><span class="token function">Fatalf</span><span class="token punctuation">(</span><span class="token string">&quot;读取文件失败: %s: %s \n&quot;</span><span class="token punctuation">,</span> fileName<span class="token punctuation">,</span> err<span class="token punctuation">)</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line">	log<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;读取文件成功: %s: %d bytes\n&quot;</span><span class="token punctuation">,</span> fileName<span class="token punctuation">,</span> <span class="token function">len</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">	log<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;显示文件内容: %s\n&quot;</span><span class="token punctuation">,</span> <span class="token function">string</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">ReadByRune</span><span class="token punctuation">(</span>fileName <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token comment">// 打开文件</span></span>
<span class="line">	f<span class="token punctuation">,</span> err <span class="token operator">:=</span> os<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span>fileName<span class="token punctuation">)</span></span>
<span class="line">	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span></span>
<span class="line">		log<span class="token punctuation">.</span><span class="token function">Fatalf</span><span class="token punctuation">(</span><span class="token string">&quot;打开文件失败: %s\n&quot;</span><span class="token punctuation">,</span> fileName<span class="token punctuation">)</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line">	<span class="token keyword">defer</span> f<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 读取数据</span></span>
<span class="line">	reader <span class="token operator">:=</span> bufio<span class="token punctuation">.</span><span class="token function">NewReader</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span></span>
<span class="line">	data <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">rune</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token keyword">for</span> <span class="token punctuation">{</span></span>
<span class="line">		r<span class="token punctuation">,</span> <span class="token boolean">_</span><span class="token punctuation">,</span> err <span class="token operator">:=</span> reader<span class="token punctuation">.</span><span class="token function">ReadRune</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">		<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span></span>
<span class="line">			<span class="token keyword">if</span> err <span class="token operator">==</span> io<span class="token punctuation">.</span>EOF <span class="token punctuation">{</span></span>
<span class="line">				<span class="token keyword">break</span></span>
<span class="line">			<span class="token punctuation">}</span></span>
<span class="line">			log<span class="token punctuation">.</span><span class="token function">Fatalf</span><span class="token punctuation">(</span><span class="token string">&quot;读取文件失败: %s: %s \n&quot;</span><span class="token punctuation">,</span> fileName<span class="token punctuation">,</span> err<span class="token punctuation">)</span></span>
<span class="line">		<span class="token punctuation">}</span></span>
<span class="line">		<span class="token comment">//log.Printf(&quot;读取文件成功: %s: %d bytes\n&quot;, fileName, size)</span></span>
<span class="line">		data <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> r<span class="token punctuation">)</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line">	<span class="token comment">// 显示数据</span></span>
<span class="line">	log<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;显示文件内容: %s\n&quot;</span><span class="token punctuation">,</span> <span class="token function">string</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">ReadByteBySeek</span><span class="token punctuation">(</span>fileName <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token comment">// 打开文件</span></span>
<span class="line">	f<span class="token punctuation">,</span> err <span class="token operator">:=</span> os<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span>fileName<span class="token punctuation">)</span></span>
<span class="line">	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span></span>
<span class="line">		log<span class="token punctuation">.</span><span class="token function">Fatalf</span><span class="token punctuation">(</span><span class="token string">&quot;打开文件失败: %s\n&quot;</span><span class="token punctuation">,</span> fileName<span class="token punctuation">)</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line">	<span class="token keyword">defer</span> f<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 读取数据</span></span>
<span class="line">	<span class="token keyword">var</span> bufsize <span class="token builtin">int64</span> <span class="token operator">=</span> <span class="token number">512</span></span>
<span class="line">	oldSize <span class="token operator">:=</span> bufsize</span>
<span class="line">	<span class="token keyword">for</span> <span class="token punctuation">{</span></span>
<span class="line">		<span class="token comment">// 读取数据</span></span>
<span class="line">		buf <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span><span class="token punctuation">,</span> bufsize<span class="token punctuation">)</span></span>
<span class="line">		n<span class="token punctuation">,</span> err <span class="token operator">:=</span> f<span class="token punctuation">.</span><span class="token function">Read</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span></span>
<span class="line">		<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span></span>
<span class="line">			<span class="token keyword">if</span> err <span class="token operator">==</span> io<span class="token punctuation">.</span>EOF <span class="token punctuation">{</span></span>
<span class="line">				<span class="token keyword">break</span></span>
<span class="line">			<span class="token punctuation">}</span></span>
<span class="line">			log<span class="token punctuation">.</span><span class="token function">Fatalf</span><span class="token punctuation">(</span><span class="token string">&quot;读取文件失败: %s: %s \n&quot;</span><span class="token punctuation">,</span> fileName<span class="token punctuation">,</span> err<span class="token punctuation">)</span></span>
<span class="line">		<span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">		<span class="token comment">// 非完整的UTF8序列处理</span></span>
<span class="line">		<span class="token keyword">if</span> <span class="token operator">!</span>utf8<span class="token punctuation">.</span><span class="token function">Valid</span><span class="token punctuation">(</span>buf<span class="token punctuation">[</span><span class="token punctuation">:</span>n<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">			<span class="token comment">// 指针回退</span></span>
<span class="line">			<span class="token keyword">if</span> ret<span class="token punctuation">,</span> err <span class="token operator">:=</span> f<span class="token punctuation">.</span><span class="token function">Seek</span><span class="token punctuation">(</span><span class="token function">int64</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token operator">*</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> io<span class="token punctuation">.</span>SeekCurrent<span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span></span>
<span class="line">				log<span class="token punctuation">.</span><span class="token function">Fatalf</span><span class="token punctuation">(</span><span class="token string">&quot;读取文件失败: %s: %s %s \n&quot;</span><span class="token punctuation">,</span> fileName<span class="token punctuation">,</span> err<span class="token punctuation">,</span> ret<span class="token punctuation">)</span></span>
<span class="line">			<span class="token punctuation">}</span></span>
<span class="line">			<span class="token comment">// buf字节数+1</span></span>
<span class="line">			bufsize<span class="token operator">++</span></span>
<span class="line"></span>
<span class="line">			<span class="token keyword">continue</span></span>
<span class="line">		<span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">		<span class="token comment">// 完整的UTF8序列处理</span></span>
<span class="line">		log<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;读取文件成功: %s: %d bytes\n&quot;</span><span class="token punctuation">,</span> fileName<span class="token punctuation">,</span> n<span class="token punctuation">)</span></span>
<span class="line">		log<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;显示文件内容: %s\n&quot;</span><span class="token punctuation">,</span> buf<span class="token punctuation">[</span><span class="token punctuation">:</span>n<span class="token punctuation">]</span><span class="token punctuation">)</span></span>
<span class="line">		bufsize <span class="token operator">=</span> oldSize</span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">ReadByteNoSeek</span><span class="token punctuation">(</span>fileName <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token comment">// 打开文件</span></span>
<span class="line">	f<span class="token punctuation">,</span> err <span class="token operator">:=</span> os<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span>fileName<span class="token punctuation">)</span></span>
<span class="line">	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span></span>
<span class="line">		log<span class="token punctuation">.</span><span class="token function">Fatalf</span><span class="token punctuation">(</span><span class="token string">&quot;打开文件失败: %s\n&quot;</span><span class="token punctuation">,</span> fileName<span class="token punctuation">)</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line">	<span class="token keyword">defer</span> f<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 读取数据</span></span>
<span class="line">	lastLeft <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token comment">// 上次读取留下来的不完整的字节切片</span></span>
<span class="line">	<span class="token keyword">for</span> <span class="token punctuation">{</span></span>
<span class="line">		<span class="token comment">// 读取数据</span></span>
<span class="line">		buf <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span><span class="token punctuation">,</span> <span class="token number">300</span><span class="token punctuation">)</span></span>
<span class="line">		n<span class="token punctuation">,</span> err <span class="token operator">:=</span> f<span class="token punctuation">.</span><span class="token function">Read</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span></span>
<span class="line">		<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span></span>
<span class="line">			<span class="token keyword">if</span> err <span class="token operator">==</span> io<span class="token punctuation">.</span>EOF <span class="token punctuation">{</span></span>
<span class="line">				<span class="token keyword">break</span></span>
<span class="line">			<span class="token punctuation">}</span></span>
<span class="line">			log<span class="token punctuation">.</span><span class="token function">Fatalf</span><span class="token punctuation">(</span><span class="token string">&quot;读取文件失败: %s: %s \n&quot;</span><span class="token punctuation">,</span> fileName<span class="token punctuation">,</span> err<span class="token punctuation">)</span></span>
<span class="line">		<span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">		<span class="token comment">// 与上次读取遗留字节合并</span></span>
<span class="line">		buf <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>lastLeft<span class="token punctuation">,</span> buf<span class="token operator">...</span><span class="token punctuation">)</span></span>
<span class="line">		n <span class="token operator">+=</span> <span class="token function">len</span><span class="token punctuation">(</span>lastLeft<span class="token punctuation">)</span></span>
<span class="line">		lastLeft <span class="token operator">=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token comment">// 重新初始化</span></span>
<span class="line"></span>
<span class="line">		<span class="token comment">// 检查序列完整性</span></span>
<span class="line">		<span class="token keyword">for</span> <span class="token punctuation">{</span></span>
<span class="line">			<span class="token keyword">if</span> utf8<span class="token punctuation">.</span><span class="token function">Valid</span><span class="token punctuation">(</span>buf<span class="token punctuation">[</span><span class="token punctuation">:</span>n<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">				<span class="token keyword">break</span></span>
<span class="line">			<span class="token punctuation">}</span></span>
<span class="line">			lastByte <span class="token operator">:=</span> buf<span class="token punctuation">[</span>n<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span></span>
<span class="line">			lastLeft <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span><span class="token punctuation">{</span>lastByte<span class="token punctuation">}</span><span class="token punctuation">,</span> lastLeft<span class="token operator">...</span><span class="token punctuation">)</span></span>
<span class="line">			n<span class="token operator">--</span></span>
<span class="line">		<span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">		<span class="token comment">// 完整的UTF8序列处理</span></span>
<span class="line">		log<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;读取文件成功: %s: %d bytes\n&quot;</span><span class="token punctuation">,</span> fileName<span class="token punctuation">,</span> n<span class="token punctuation">)</span></span>
<span class="line">		log<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;显示文件内容: %s\n&quot;</span><span class="token punctuation">,</span> buf<span class="token punctuation">[</span><span class="token punctuation">:</span>n<span class="token punctuation">]</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	fileName <span class="token operator">:=</span> <span class="token string">&quot;test.log&quot;</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 写数据</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;------------------ 写入数据 ---------------------&quot;</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token function">WriteFile</span><span class="token punctuation">(</span>fileName<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 按字节读数据(会读到乱码)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;\n------------------ 按字节读数据(会读到乱码) ---------------------&quot;</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token function">ReadByte</span><span class="token punctuation">(</span>fileName<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 解决方案1：一次性全部读取到内存中</span></span>
<span class="line">	<span class="token comment">// 缺点：内存占用过大，不适用大文件</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;\n------------------ 解决方案1：一次性全部读取到内存中 ---------------------&quot;</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token function">ReadAllByte</span><span class="token punctuation">(</span>fileName<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 解决方案2：按Rune读取文件</span></span>
<span class="line">	<span class="token comment">// 缺点：一个字符一个字符的读，效率太低</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;\n------------------ 解决方案2：按Rune方式读取 ---------------------&quot;</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token function">ReadByRune</span><span class="token punctuation">(</span>fileName<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 解决方案3：按字节读取，如果不是完整UTF8序列则回退文件指针，动态微调buf大小</span></span>
<span class="line">	<span class="token comment">// 缺点：需要通过Seek指针操作</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;\n- 解决方案3：按字节读数据，如果不是完整UTF8序列则回退文件指针，动态微调buf大小 -&quot;</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token function">ReadByteBySeek</span><span class="token punctuation">(</span>fileName<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 解决方案4：按字节读取，如果不是完整UTF8序列，那么将字节切片分割，只是用完整的UTF8序列，乱码部分与下一次读取连接起来</span></span>
<span class="line">	<span class="token comment">// 缺点：代码比较复杂</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;\n------- 解决方案4：字节分割与重组读法（与Read表现一致） ----------&quot;</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token function">ReadByteNoSeek</span><span class="token punctuation">(</span>fileName<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre></div><p>输出结果</p><div class="language-bash" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line">------------------ 写入数据 ---------------------</span>
<span class="line"><span class="token number">2022</span>/04/25 <span class="token number">15</span>:56:39 写入文件成功: test.log: <span class="token number">513</span> bytes</span>
<span class="line"></span>
<span class="line">------------------ 按字节读数据<span class="token punctuation">(</span>会读到乱码<span class="token punctuation">)</span> ---------------------</span>
<span class="line"><span class="token number">2022</span>/04/25 <span class="token number">15</span>:56:39 读取文件成功: test.log: <span class="token number">512</span> bytes</span>
<span class="line"><span class="token number">2022</span>/04/25 <span class="token number">15</span>:56:39 显示文件内容: 中中中中中中中中中中中中中中中中中中中中中中中</span>
<span class="line">中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中</span>
<span class="line">中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中</span>
<span class="line">中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中</span>
<span class="line">中中中中中中中中中中中中中中中中中中中中中中中中中中中��</span>
<span class="line"><span class="token number">2022</span>/04/25 <span class="token number">15</span>:56:39 检测字节切片是否是完整且合法的UTF-8编码序列: <span class="token boolean">false</span></span>
<span class="line"><span class="token number">2022</span>/04/25 <span class="token number">15</span>:56:39 读取文件成功: test.log: <span class="token number">1</span> bytes</span>
<span class="line"><span class="token number">2022</span>/04/25 <span class="token number">15</span>:56:39 显示文件内容: �</span>
<span class="line"><span class="token number">2022</span>/04/25 <span class="token number">15</span>:56:39 检测字节切片是否是完整且合法的UTF-8编码序列: <span class="token boolean">false</span></span>
<span class="line"></span>
<span class="line">------------------ 解决方案1：一次性全部读取到内存中 ---------------------      </span>
<span class="line"><span class="token number">2022</span>/04/25 <span class="token number">15</span>:56:39 读取文件成功: test.log: <span class="token number">513</span> bytes</span>
<span class="line"><span class="token number">2022</span>/04/25 <span class="token number">15</span>:56:39 显示文件内容: 中中中中中中中中中中中中中中中中中中中中中中中</span>
<span class="line">中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中</span>
<span class="line">中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中</span>
<span class="line">中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中</span>
<span class="line">中中中中中中中中中中中中中中中中中中中中中中中中中中中国</span>
<span class="line"></span>
<span class="line">------------------ 解决方案2：按Rune方式读取 ---------------------</span>
<span class="line"><span class="token number">2022</span>/04/25 <span class="token number">15</span>:56:39 显示文件内容: 中中中中中中中中中中中中中中中中中中中中中中中</span>
<span class="line">中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中</span>
<span class="line">中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中</span>
<span class="line">中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中</span>
<span class="line">中中中中中中中中中中中中中中中中中中中中中中中中中中中国</span>
<span class="line"></span>
<span class="line">- 解决方案3：按字节读数据，如果不是完整UTF8序列则回退文件指针，动态微调buf大小 -</span>
<span class="line"><span class="token number">2022</span>/04/25 <span class="token number">15</span>:56:39 读取文件成功: test.log: <span class="token number">513</span> bytes</span>
<span class="line"><span class="token number">2022</span>/04/25 <span class="token number">15</span>:56:39 显示文件内容: 中中中中中中中中中中中中中中中中中中中中中中中</span>
<span class="line">中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中</span>
<span class="line">中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中</span>
<span class="line">中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中</span>
<span class="line">中中中中中中中中中中中中中中中中中中中中中中中中中中中国</span>
<span class="line"></span>
<span class="line">------- 解决方案4：字节分割与重组读法（与Read表现一致） ----------</span>
<span class="line"><span class="token number">2022</span>/04/25 <span class="token number">15</span>:56:39 读取文件成功: test.log: <span class="token number">510</span> bytes</span>
<span class="line"><span class="token number">2022</span>/04/25 <span class="token number">15</span>:56:39 显示文件内容: 中中中中中中中中中中中中中中中中中中中中中中中</span>
<span class="line">中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中</span>
<span class="line">中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中</span>
<span class="line">中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中中</span>
<span class="line">中中中中中中中中中中中中中中中中中中中中中中中中中中中</span>
<span class="line"><span class="token number">2022</span>/04/25 <span class="token number">15</span>:56:39 读取文件成功: test.log: <span class="token number">3</span> bytes</span>
<span class="line"><span class="token number">2022</span>/04/25 <span class="token number">15</span>:56:39 显示文件内容: 国</span>
<span class="line"></span></code></pre></div></details><details class="hint-container details"><summary>（4）按行读取任何文本文件</summary><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">package</span> main</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">(</span></span>
<span class="line">	<span class="token string">&quot;bufio&quot;</span></span>
<span class="line">	<span class="token string">&quot;fmt&quot;</span></span>
<span class="line">	<span class="token string">&quot;os&quot;</span></span>
<span class="line">	<span class="token string">&quot;strings&quot;</span></span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token comment">// 打开文件</span></span>
<span class="line">	file<span class="token punctuation">,</span> err <span class="token operator">:=</span> os<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span><span class="token string">&quot;main.go&quot;</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span></span>
<span class="line">		<span class="token function">panic</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line">	<span class="token keyword">defer</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token boolean">_</span> <span class="token operator">=</span> file<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 创建一个带缓冲的读取器</span></span>
<span class="line">	reader <span class="token operator">:=</span> bufio<span class="token punctuation">.</span><span class="token function">NewReader</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 逐行读取文件内容</span></span>
<span class="line">	<span class="token keyword">for</span> <span class="token punctuation">{</span></span>
<span class="line">		line<span class="token punctuation">,</span> err <span class="token operator">:=</span> reader<span class="token punctuation">.</span><span class="token function">ReadString</span><span class="token punctuation">(</span><span class="token char">&#39;\n&#39;</span><span class="token punctuation">)</span></span>
<span class="line">		<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span></span>
<span class="line">			<span class="token keyword">break</span></span>
<span class="line">		<span class="token punctuation">}</span></span>
<span class="line">		<span class="token comment">// 去除换行符</span></span>
<span class="line">		line <span class="token operator">=</span> strings<span class="token punctuation">.</span><span class="token function">TrimRight</span><span class="token punctuation">(</span>line<span class="token punctuation">,</span> <span class="token string">&quot;\n&quot;</span><span class="token punctuation">)</span></span>
<span class="line">		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>line<span class="token punctuation">)</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre></div></details><details class="hint-container details"><summary>（5）读写快捷函数</summary><p><code>os.WriteFile</code>和<code>os.ReadFile</code>底层调用的是<code>OpenFile</code>，一次性加载数据到内存中，适合读取小文件，大文件有撑爆内存的风险</p><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">package</span> main</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">(</span></span>
<span class="line">	<span class="token string">&quot;log&quot;</span></span>
<span class="line">	<span class="token string">&quot;os&quot;</span></span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token comment">// 写入文件</span></span>
<span class="line">	writeFileName <span class="token operator">:=</span> <span class="token string">&quot;test.log&quot;</span></span>
<span class="line">	err <span class="token operator">:=</span> os<span class="token punctuation">.</span><span class="token function">WriteFile</span><span class="token punctuation">(</span>writeFileName<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span><span class="token string">&quot;Hello, 这里是测试日志&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> os<span class="token punctuation">.</span>ModePerm<span class="token punctuation">)</span></span>
<span class="line">	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span></span>
<span class="line">		log<span class="token punctuation">.</span><span class="token function">Fatalf</span><span class="token punctuation">(</span><span class="token string">&quot;写入文件失败: %s\n&quot;</span><span class="token punctuation">,</span> writeFileName<span class="token punctuation">)</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line">	log<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;写入文件成功: %s\n&quot;</span><span class="token punctuation">,</span> writeFileName<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 函数源码如下：</span></span>
<span class="line">	<span class="token comment">//func WriteFile(name string, data []byte, perm FileMode) error {</span></span>
<span class="line">	<span class="token comment">//	f, err := OpenFile(name, O_WRONLY|O_CREATE|O_TRUNC, perm)</span></span>
<span class="line">	<span class="token comment">//	if err != nil {</span></span>
<span class="line">	<span class="token comment">//	return err</span></span>
<span class="line">	<span class="token comment">//}</span></span>
<span class="line">	<span class="token comment">//	_, err = f.Write(data)</span></span>
<span class="line">	<span class="token comment">//	if err1 := f.Close(); err1 != nil &amp;&amp; err == nil {</span></span>
<span class="line">	<span class="token comment">//	err = err1</span></span>
<span class="line">	<span class="token comment">//}</span></span>
<span class="line">	<span class="token comment">//	return err</span></span>
<span class="line">	<span class="token comment">//}</span></span>
<span class="line">	<span class="token comment">// 可以看到，(1)读写模式打开文件 (2)文件若不存在会自动创建 (3)文件若存在则会截断(清空内容)，所以使用这个函数前需要小心一些</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 读取文件</span></span>
<span class="line">	readFileName <span class="token operator">:=</span> <span class="token string">&quot;D:\\iso\\CentOS-7-x86_64-DVD-1708.iso&quot;</span></span>
<span class="line">	log<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;开始读取文件: %s\n&quot;</span><span class="token punctuation">,</span> readFileName<span class="token punctuation">)</span></span>
<span class="line">	buf<span class="token punctuation">,</span> err <span class="token operator">:=</span> os<span class="token punctuation">.</span><span class="token function">ReadFile</span><span class="token punctuation">(</span>readFileName<span class="token punctuation">)</span></span>
<span class="line">	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span></span>
<span class="line">		log<span class="token punctuation">.</span><span class="token function">Fatalf</span><span class="token punctuation">(</span><span class="token string">&quot;读取文件失败: %s: %s\n&quot;</span><span class="token punctuation">,</span> readFileName<span class="token punctuation">,</span> err<span class="token punctuation">)</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line">	log<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;读取文件成功: %s: %d bytes\n&quot;</span><span class="token punctuation">,</span> readFileName<span class="token punctuation">,</span> <span class="token function">len</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token comment">// 查看源码可以看到，</span></span>
<span class="line">	<span class="token comment">//		(1)使用Open打开文件</span></span>
<span class="line">	<span class="token comment">//		(2)当文件大小(int64类型)能正常转为int类型时，buf就取这个值；否则buf设置为512</span></span>
<span class="line">	<span class="token comment">//		   int最大值转为GB是多少呢？ math.MaxInt / 1024 / 1024 / 1024 = 8589934591</span></span>
<span class="line">	<span class="token comment">//		   当文件小于8589934591GB时，都是一次性读入内存中</span></span>
<span class="line">	<span class="token comment">// 		   所以使用这个函数，就等同于将文件一次性读入内存，请确保内存充足..</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre></div><p>输出结果</p><div class="language-bash" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token number">2022</span>/04/24 <span class="token number">14</span>:30:58 写入文件成功: test.log</span>
<span class="line"><span class="token number">2022</span>/04/24 <span class="token number">14</span>:30:58 开始读取文件: D:<span class="token punctuation">\</span>iso<span class="token punctuation">\</span>CentOS-7-x86_64-DVD-1708.iso</span>
<span class="line"><span class="token number">2022</span>/04/24 <span class="token number">14</span>:31:00 读取文件成功: D:<span class="token punctuation">\</span>iso<span class="token punctuation">\</span>CentOS-7-x86_64-DVD-1708.iso: <span class="token number">4521459712</span> bytes</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 可以看到，4个多G的文件2秒钟读完了</span></span>
<span class="line"></span></code></pre></div></details><br><h3 id="io-io基本接口定义" tabindex="-1"><a class="header-anchor" href="#io-io基本接口定义"><span><code>io</code>：IO基本接口定义</span></a></h3><p>官方文档：<a href="https://pkg.go.dev/io" target="_blank" rel="noopener noreferrer">https://pkg.go.dev/io</a></p><details class="hint-container details"><summary>（1）Reader基本接口</summary><p><strong>1、Reader定义</strong></p><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token comment">// io.Reader</span></span>
<span class="line"><span class="token keyword">type</span> Reader <span class="token keyword">interface</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token function">Read</span><span class="token punctuation">(</span>p <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>n <span class="token builtin">int</span><span class="token punctuation">,</span> err <span class="token builtin">error</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre></div><p>根据接口定义得到的信息：读取数据并填充到<code>p</code>中，最多填充<code>len(p)</code>个字节；返回实际读取到的字节数<code>n</code>和<code>error</code></p><p><strong>2、Reader读取规则</strong></p><p>（1）读取成功，数据全部填充至<code>p</code>，此时有<code> n == len(p)</code>、<code>err == nil</code></p><p>（2）读取失败，此时有<code>err != nil</code>，<code>err</code>代表具体的错误</p><p>（3）读到<code>EOF</code>，此时支持以下两种处理情况：</p><p>​ ① 返回实际读取的字节数n，将<code>err</code>设置为<code>EOF</code>（推荐）</p><p>​ ② 返回实际读取的字节数n，将<code>err</code>设置为<code>nil</code>，对于这种情况，在下一次读取时需要返回<code>n == 0, err == nil</code>（不推荐）</p><p>（4）<span style="color:blue;font-weight:bold;">允许数据没全部准备好时，返回部分数据，此时有<code>p</code>尚未填充满，同时<code>err == nil</code></span>（这种情况要小心，可能写代码会出现一些坑）</p><p><strong>3、Reader接口的几种实现</strong></p><table><thead><tr><th>结构体/接口</th><th>具体实现</th><th>备注</th></tr></thead><tbody><tr><td>从文件中读：<br><code>os.File</code>结构体</td><td><code>os.OpenFile()</code></td><td>文件读取</td></tr><tr><td></td><td><code>os.Stdin</code>/<code>os.Stdout</code>/<code>os.Stderr</code></td><td>主要为标准输入读取<code>Stdin</code></td></tr><tr><td>从字符串中读：<br><code>strings.Reader</code>结构体</td><td><code>strings.NewReader()</code></td><td><code>Reader</code>接口：本质是调用内置函数<code>copy</code>，无法读取中文<br><code>RuneReader</code>接口：本质是按字节遍历，如果字节在ASCII码范围内<br>则使用<code>rune</code>包装一下返回，否则调用<code>utf8.DecodeRuneInString</code>解码出第一个<code>Rune</code>并返回</td></tr><tr><td>从字节中读：<br><code>bytes.Reader</code>结构体</td><td><code>bytes.NewReader()</code></td><td>类似于<code>strings.Reader</code>结构体</td></tr><tr><td>从缓冲中读：<br><code>bytes.Buffer</code>结构体<br><code>bufio.Reader</code>结构体</td><td>详细介绍见后面章节</td><td>详细介绍见后面章节</td></tr><tr><td>从网络连接中读：<br><code>net.Conn</code>接口</td><td>以后补充</td><td>以后补充</td></tr></tbody></table></details><details class="hint-container details"><summary>（2）Reader方法使用</summary><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">package</span> main</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">(</span></span>
<span class="line">	<span class="token string">&quot;fmt&quot;</span></span>
<span class="line">	<span class="token string">&quot;io&quot;</span></span>
<span class="line">	<span class="token string">&quot;log&quot;</span></span>
<span class="line">	<span class="token string">&quot;os&quot;</span></span>
<span class="line">	<span class="token string">&quot;strings&quot;</span></span>
<span class="line">	<span class="token string">&quot;time&quot;</span></span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">ReadFromStdin</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	buf <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span><span class="token punctuation">,</span> <span class="token number">1024</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token keyword">for</span> <span class="token punctuation">{</span></span>
<span class="line">		<span class="token comment">// 读取输入</span></span>
<span class="line">		fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%s 请输入名字：&quot;</span><span class="token punctuation">,</span> time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Format</span><span class="token punctuation">(</span><span class="token string">&quot;2006/01/02 15:04:05&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">		n<span class="token punctuation">,</span> err <span class="token operator">:=</span> os<span class="token punctuation">.</span>Stdin<span class="token punctuation">.</span><span class="token function">Read</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span></span>
<span class="line">		<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span></span>
<span class="line">			log<span class="token punctuation">.</span><span class="token function">Fatalln</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span></span>
<span class="line">		<span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">		<span class="token comment">// 解析输入</span></span>
<span class="line">		name <span class="token operator">:=</span> strings<span class="token punctuation">.</span><span class="token function">TrimSpace</span><span class="token punctuation">(</span><span class="token function">string</span><span class="token punctuation">(</span>buf<span class="token punctuation">[</span><span class="token punctuation">:</span>n<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">		<span class="token comment">// 判断输入是否合法</span></span>
<span class="line">		<span class="token keyword">if</span> <span class="token function">len</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token punctuation">{</span></span>
<span class="line">			log<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;您的名字为: %s&quot;</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span></span>
<span class="line">			<span class="token keyword">break</span></span>
<span class="line">		<span class="token punctuation">}</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">ReadFromStringReader</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	reader <span class="token operator">:=</span> strings<span class="token punctuation">.</span><span class="token function">NewReader</span><span class="token punctuation">(</span><span class="token string">&quot;hello world!&quot;</span><span class="token punctuation">)</span></span>
<span class="line">	buf <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span><span class="token punctuation">,</span> <span class="token number">1024</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token keyword">for</span> <span class="token punctuation">{</span></span>
<span class="line">		n<span class="token punctuation">,</span> err <span class="token operator">:=</span> reader<span class="token punctuation">.</span><span class="token function">Read</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span></span>
<span class="line">		<span class="token keyword">if</span> n <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token punctuation">{</span></span>
<span class="line">			log<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%s\n&quot;</span><span class="token punctuation">,</span> buf<span class="token punctuation">[</span><span class="token punctuation">:</span>n<span class="token punctuation">]</span><span class="token punctuation">)</span></span>
<span class="line">		<span class="token punctuation">}</span></span>
<span class="line">		<span class="token keyword">if</span> err <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span></span>
<span class="line">			<span class="token keyword">continue</span></span>
<span class="line">		<span class="token punctuation">}</span></span>
<span class="line">		<span class="token keyword">if</span> err <span class="token operator">==</span> io<span class="token punctuation">.</span>EOF <span class="token punctuation">{</span></span>
<span class="line">			<span class="token keyword">break</span></span>
<span class="line">		<span class="token punctuation">}</span></span>
<span class="line">		log<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;read error&quot;</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">ReadRuneFromStringReader</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	reader <span class="token operator">:=</span> strings<span class="token punctuation">.</span><span class="token function">NewReader</span><span class="token punctuation">(</span><span class="token string">&quot;a你好&quot;</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token keyword">for</span> <span class="token punctuation">{</span></span>
<span class="line">		r<span class="token punctuation">,</span> <span class="token boolean">_</span><span class="token punctuation">,</span> err <span class="token operator">:=</span> reader<span class="token punctuation">.</span><span class="token function">ReadRune</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">		<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span></span>
<span class="line">			<span class="token keyword">if</span> err <span class="token operator">==</span> io<span class="token punctuation">.</span>EOF <span class="token punctuation">{</span></span>
<span class="line">				<span class="token keyword">break</span></span>
<span class="line">			<span class="token punctuation">}</span></span>
<span class="line">		<span class="token punctuation">}</span></span>
<span class="line">		log<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%s&quot;</span><span class="token punctuation">,</span> <span class="token function">string</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token function">ReadFromStdin</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token function">ReadFromStringReader</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token function">ReadRuneFromStringReader</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre></div><p>输出结果</p><div class="language-bash" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token number">2022</span>/04/24 <span class="token number">16</span>:52:13 请输入名字：愤怒的西瓜</span>
<span class="line"><span class="token number">2022</span>/04/24 <span class="token number">16</span>:52:32 您的名字为: 愤怒的西瓜</span>
<span class="line"><span class="token number">2022</span>/04/24 <span class="token number">16</span>:52:32 hello world<span class="token operator">!</span></span>
<span class="line"><span class="token number">2022</span>/04/24 <span class="token number">16</span>:52:32 a</span>
<span class="line"><span class="token number">2022</span>/04/24 <span class="token number">16</span>:52:32 你</span>
<span class="line"><span class="token number">2022</span>/04/24 <span class="token number">16</span>:52:32 好</span>
<span class="line"></span></code></pre></div></details><details class="hint-container details"><summary>（3）Reader其他接口</summary><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token comment">// 读取一次返回一个字节</span></span>
<span class="line"><span class="token keyword">type</span> ByteReader <span class="token keyword">interface</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token function">ReadByte</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token builtin">byte</span><span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 读取一次返回一个Rune</span></span>
<span class="line"><span class="token keyword">type</span> RuneReader <span class="token keyword">interface</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token function">ReadRune</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>r <span class="token builtin">rune</span><span class="token punctuation">,</span> size <span class="token builtin">int</span><span class="token punctuation">,</span> err <span class="token builtin">error</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 可以从指定位置(字节)处读取</span></span>
<span class="line"><span class="token keyword">type</span> ReaderAt <span class="token keyword">interface</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token function">ReadAt</span><span class="token punctuation">(</span>p <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span><span class="token punctuation">,</span> off <span class="token builtin">int64</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>n <span class="token builtin">int</span><span class="token punctuation">,</span> err <span class="token builtin">error</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre></div></details><details class="hint-container details"><summary>（4）Reader封装函数</summary><table><thead><tr><th>函数</th><th>说明</th></tr></thead><tbody><tr><td><code>func ReadAll(r Reader) ([]byte, error)</code></td><td>从<code>Reader</code>中读完所有数据再返回，当文件过大时有撑爆内存的风险</td></tr><tr><td><code>func ReadFull(r Reader, buf []byte) (n int, err error)</code></td><td>读满缓冲区再返回，未读满缓冲区（即使读到<code>EOF</code>）也会返回错误</td></tr><tr><td><code>func ReadAtLeast(r Reader, buf []byte, min int) (n int, err error)</code></td><td>最少要读<code>min</code>个字节，即使读到<code>EOF</code>也会返回错误</td></tr><tr><td><code>func LimitReader(r Reader, n int64) Reader</code></td><td>返回一个新<code>Reader</code>，该<code>Reader</code>最多只能读取<code>n</code>个字节（偏移为0）</td></tr><tr><td><code>func NewSectionReader(r ReaderAt, off int64, n int64) *SectionReader</code></td><td>返回一个新<code>Reader</code>，该<code>Reader</code>最多只能读取<code>n</code>个字节（偏移为<code>off</code>）</td></tr></tbody></table></details><details class="hint-container details"><summary>（5）Writer和Closer接口</summary><p><strong>接口定义</strong></p><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">type</span> Writer <span class="token keyword">interface</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token function">Write</span><span class="token punctuation">(</span>p <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>n <span class="token builtin">int</span><span class="token punctuation">,</span> err <span class="token builtin">error</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">type</span> Closer <span class="token keyword">interface</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">error</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre></div></details><details class="hint-container details"><summary>（6）Reader和Writer复合函数</summary><p><strong>io.Copy系列</strong></p><p>（1）<code>func Copy(dst Writer, src Reader) (written int64, err error)</code></p><p>主要功能为：从<code>Reader</code>中读取，并写入到<code>Writer</code>中，返回写入的字节数和错误</p><blockquote><p>实现的细节：</p><ol><li>如果<code>src</code>实现了<code>WriteTo</code>接口，那么就调用<code>src.WriteTo(dst)</code>方法</li><li>如果<code>dst</code>实现了<code>ReaderFrom</code>接口，那么就调用<code>dst.ReadFrom(src)</code>方法</li><li>如果以上两个接口都没实现，那么就从<code>src</code>读取数据到缓冲区再写入<code>Writer</code></li><li>如果<code>src</code>是<code>*LimitedReader</code>结构体，那么<code>buffer</code>大小设定为规定的大小，否则设置为<code>32KB</code></li></ol></blockquote><p>（2）<code>func CopyBuffer(dst Writer, src Reader, buf []byte) (written int64, err error)</code></p><p>与<code>io.Copy</code>不同的地方在于可以自定义<code>buffer</code>大小的<code>Copy</code>，但是请注意只有在<code>src.WriteTo</code>和<code>dst.ReadFrom</code>都没有实现的情况下生效</p><p>（3）<code>func CopyN(dst Writer, src Reader, n int64) (written int64, err error)</code></p><p>只拷贝N个字节，本质上是通过<code>LimitReader</code>来限制<code>Reader</code>所能读取的字节数</p><p><strong>io.Pipe</strong></p><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">func</span> <span class="token function">Pipe</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>PipeReader<span class="token punctuation">,</span> <span class="token operator">*</span>PipeWriter<span class="token punctuation">)</span></span>
<span class="line"></span></code></pre></div><ul><li>从w中写入，从r中读出</li><li>线程安全</li><li>本质上是无缓冲的<code>channel</code>，所以不能在同一个协程中读和写</li></ul></details><br><h3 id="bufio-带缓冲的io包" tabindex="-1"><a class="header-anchor" href="#bufio-带缓冲的io包"><span>bufio：带缓冲的IO包</span></a></h3><p>官方文档：<a href="https://pkg.go.dev/bufio" target="_blank" rel="noopener noreferrer">https://pkg.go.dev/bufio</a></p><details class="hint-container details"><summary>（1）缓冲原理</summary><p><img src="https://tuchuang-1257805459.cos.accelerate.myqcloud.com/bufio.png" alt="bufio"></p><p>本质上来讲，就是通过减少系统调用来提高效率，付出的代价就是内存占用变多</p></details><details class="hint-container details"><summary>（2）构造函数</summary><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">func</span> <span class="token function">NewReader</span><span class="token punctuation">(</span>rd io<span class="token punctuation">.</span>Reader<span class="token punctuation">)</span> <span class="token operator">*</span>Reader <span class="token punctuation">{</span></span>
<span class="line">	<span class="token keyword">return</span> <span class="token function">NewReaderSize</span><span class="token punctuation">(</span>rd<span class="token punctuation">,</span> defaultBufSize<span class="token punctuation">)</span>	</span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">NewWriter</span><span class="token punctuation">(</span>w io<span class="token punctuation">.</span>Writer<span class="token punctuation">)</span> <span class="token operator">*</span>Writer <span class="token punctuation">{</span></span>
<span class="line">	<span class="token keyword">return</span> <span class="token function">NewWriterSize</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> defaultBufSize<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 默认的缓冲区大小defaultBufSize = 4096</span></span>
<span class="line"></span></code></pre></div></details><details class="hint-container details"><summary>（3）Reader使用示例</summary><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">package</span> main</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">(</span></span>
<span class="line">	<span class="token string">&quot;bufio&quot;</span></span>
<span class="line">	<span class="token string">&quot;log&quot;</span></span>
<span class="line">	<span class="token string">&quot;strings&quot;</span></span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token comment">// 生成原始Reader</span></span>
<span class="line">	<span class="token keyword">var</span> str <span class="token builtin">string</span></span>
<span class="line">	<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">170</span><span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span></span>
<span class="line">		str <span class="token operator">+=</span> <span class="token string">&quot;中&quot;</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line">	r <span class="token operator">:=</span> strings<span class="token punctuation">.</span><span class="token function">NewReader</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span></span>
<span class="line">	log<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;原始Reader可读取数据大小: %d\n&quot;</span><span class="token punctuation">,</span> <span class="token function">len</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 带缓冲的Reader</span></span>
<span class="line">	<span class="token comment">//reader := bufio.NewReader(f)	// 使用默认缓冲大小</span></span>
<span class="line">	reader <span class="token operator">:=</span> bufio<span class="token punctuation">.</span><span class="token function">NewReaderSize</span><span class="token punctuation">(</span>r<span class="token punctuation">,</span> <span class="token number">1024</span><span class="token punctuation">)</span> <span class="token comment">// 自定义缓冲大小</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 读取数据</span></span>
<span class="line">	buf <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span></span>
<span class="line">	n<span class="token punctuation">,</span> err <span class="token operator">:=</span> reader<span class="token punctuation">.</span><span class="token function">Read</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span></span>
<span class="line">	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span></span>
<span class="line">		log<span class="token punctuation">.</span><span class="token function">Fatalf</span><span class="token punctuation">(</span><span class="token string">&quot;Read error: %s\n&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line">	log<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;Read %d bytes\n&quot;</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 查看缓冲区信息</span></span>
<span class="line">	log<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;缓冲区大小: %d bytes\n&quot;</span><span class="token punctuation">,</span> reader<span class="token punctuation">.</span><span class="token function">Size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">	log<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;当前缓冲区剩余的可读字节数: %d bytes\n&quot;</span><span class="token punctuation">,</span> reader<span class="token punctuation">.</span><span class="token function">Buffered</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre></div><p>输出结果</p><div class="language-bash" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token number">2023</span>/04/20 <span class="token number">11</span>:04:08 原始Reader可读取数据大小: <span class="token number">510</span></span>
<span class="line"><span class="token number">2023</span>/04/20 <span class="token number">11</span>:04:08 Read <span class="token number">100</span> bytes</span>
<span class="line"><span class="token number">2023</span>/04/20 <span class="token number">11</span>:04:08 缓冲区大小: <span class="token number">1024</span> bytes</span>
<span class="line"><span class="token number">2023</span>/04/20 <span class="token number">11</span>:04:08 当前缓冲区剩余的可读字节数: <span class="token number">410</span> bytes</span>
<span class="line"></span></code></pre></div></details><details class="hint-container details"><summary>（4）Writer使用示例</summary><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">package</span> main</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">(</span></span>
<span class="line">	<span class="token string">&quot;bufio&quot;</span></span>
<span class="line">	<span class="token string">&quot;log&quot;</span></span>
<span class="line">	<span class="token string">&quot;os&quot;</span></span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token comment">// 带缓冲的Writer,默认缓冲区4096字节，下面的代码手动设置缓冲区大小15个字节</span></span>
<span class="line">	<span class="token comment">//writer := bufio.NewWriter(os.Stdout)</span></span>
<span class="line">	writer <span class="token operator">:=</span> bufio<span class="token punctuation">.</span><span class="token function">NewWriterSize</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>Stdout<span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 写入数据，本次总共写入13个字节数据</span></span>
<span class="line">	<span class="token comment">// 若缓冲区大于等于13则写入到缓冲区，屏幕上也不会输出任何信息，因为缓冲区还并没有向真正的io.Writer中写入</span></span>
<span class="line">	<span class="token comment">// 若缓冲区小于13则不写缓冲区直接写到原始的io.Writer中去</span></span>
<span class="line">	n<span class="token punctuation">,</span> err <span class="token operator">:=</span> writer<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span><span class="token string">&quot;hello world!\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span></span>
<span class="line">		log<span class="token punctuation">.</span><span class="token function">Fatalf</span><span class="token punctuation">(</span><span class="token string">&quot;写入失败: %s\n&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line">	log<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;写入成功: %d bytes\n&quot;</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 缓冲区信息</span></span>
<span class="line">	log<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;缓冲区大小: %d bytes\n&quot;</span><span class="token punctuation">,</span> writer<span class="token punctuation">.</span><span class="token function">Size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">	log<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;当前缓冲区已写入的字节数: %d bytes\n&quot;</span><span class="token punctuation">,</span> writer<span class="token punctuation">.</span><span class="token function">Buffered</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">	log<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;当前缓冲区未使用的字节数: %d bytes\n&quot;</span><span class="token punctuation">,</span> writer<span class="token punctuation">.</span><span class="token function">Available</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 将缓冲区数据写入到io.Writer中</span></span>
<span class="line">	<span class="token comment">// 必须要判断error，否则可能会导致写入不完整</span></span>
<span class="line">	<span class="token comment">//err := writer.Flush()</span></span>
<span class="line">	<span class="token comment">//if err != nil {</span></span>
<span class="line">	<span class="token comment">//	panic(err)</span></span>
<span class="line">	<span class="token comment">//}</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 清空缓冲区, 未写入的则丢弃</span></span>
<span class="line">	<span class="token comment">//writer.Reset(writer)</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 返回未使用字节组成的切片</span></span>
<span class="line">	<span class="token comment">//b := writer.AvailableBuffer()</span></span>
<span class="line">	<span class="token comment">//等同于b := make([]byte, writer.Available())</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre></div><p>输出结果</p><div class="language-bash" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token number">2023</span>/04/20 <span class="token number">11</span>:10:48 写入成功: <span class="token number">13</span> bytes</span>
<span class="line"><span class="token number">2023</span>/04/20 <span class="token number">11</span>:10:48 缓冲区大小: <span class="token number">15</span> bytes</span>
<span class="line"><span class="token number">2023</span>/04/20 <span class="token number">11</span>:10:48 当前缓冲区已写入的字节数: <span class="token number">13</span> bytes</span>
<span class="line"><span class="token number">2023</span>/04/20 <span class="token number">11</span>:10:48 当前缓冲区未使用的字节数: <span class="token number">2</span> bytes</span>
<span class="line"></span></code></pre></div></details><details class="hint-container details"><summary>（5）写缓冲性能测试</summary><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">package</span> main</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">(</span></span>
<span class="line">	<span class="token string">&quot;bufio&quot;</span></span>
<span class="line">	<span class="token string">&quot;io&quot;</span></span>
<span class="line">	<span class="token string">&quot;log&quot;</span></span>
<span class="line">	<span class="token string">&quot;os&quot;</span></span>
<span class="line">	<span class="token string">&quot;time&quot;</span></span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">MustWrite</span><span class="token punctuation">(</span>src<span class="token punctuation">,</span> dst <span class="token builtin">string</span><span class="token punctuation">,</span> bufSize <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token comment">// 记录写入的字节数</span></span>
<span class="line">	<span class="token keyword">var</span> writeBytes <span class="token builtin">int64</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 统计时间</span></span>
<span class="line">	now <span class="token operator">:=</span> time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token keyword">defer</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">		log<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;It takes %.2f seconds to copy %d bytes for %s\n&quot;</span><span class="token punctuation">,</span> time<span class="token punctuation">.</span><span class="token function">Since</span><span class="token punctuation">(</span>now<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Seconds</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> writeBytes<span class="token punctuation">,</span> dst<span class="token punctuation">)</span></span>
<span class="line">	<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 打开src文件</span></span>
<span class="line">	r<span class="token punctuation">,</span> err <span class="token operator">:=</span> os<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span>src<span class="token punctuation">)</span></span>
<span class="line">	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span></span>
<span class="line">		log<span class="token punctuation">.</span><span class="token function">Fatalln</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line">	<span class="token keyword">defer</span> r<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 打开dst文件</span></span>
<span class="line">	w<span class="token punctuation">,</span> err <span class="token operator">:=</span> os<span class="token punctuation">.</span><span class="token function">OpenFile</span><span class="token punctuation">(</span>dst<span class="token punctuation">,</span> os<span class="token punctuation">.</span>O_RDWR<span class="token operator">|</span>os<span class="token punctuation">.</span>O_CREATE<span class="token operator">|</span>os<span class="token punctuation">.</span>O_TRUNC<span class="token punctuation">,</span> os<span class="token punctuation">.</span>ModePerm<span class="token punctuation">)</span></span>
<span class="line">	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span></span>
<span class="line">		log<span class="token punctuation">.</span><span class="token function">Fatalln</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line">	<span class="token keyword">defer</span> w<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 构建 reader 和 writer</span></span>
<span class="line">	<span class="token keyword">var</span> <span class="token punctuation">(</span></span>
<span class="line">		reader io<span class="token punctuation">.</span>Reader</span>
<span class="line">		writer io<span class="token punctuation">.</span>Writer</span>
<span class="line">	<span class="token punctuation">)</span></span>
<span class="line">	reader <span class="token operator">=</span> r</span>
<span class="line">	<span class="token keyword">if</span> bufSize <span class="token operator">&lt;=</span> <span class="token number">0</span> <span class="token punctuation">{</span></span>
<span class="line">		writer <span class="token operator">=</span> w</span>
<span class="line">	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">		bufWriter <span class="token operator">:=</span> bufio<span class="token punctuation">.</span><span class="token function">NewWriterSize</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> bufSize<span class="token punctuation">)</span></span>
<span class="line">		<span class="token keyword">defer</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">			err <span class="token operator">:=</span> bufWriter<span class="token punctuation">.</span><span class="token function">Flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">			<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span></span>
<span class="line">				log<span class="token punctuation">.</span><span class="token function">Fatalln</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span></span>
<span class="line">			<span class="token punctuation">}</span></span>
<span class="line">		<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">		writer <span class="token operator">=</span> bufWriter</span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 方式1：使用io.Copy 或 io.CopyBuffer 读取和写入</span></span>
<span class="line">	<span class="token comment">//writeBytes, err = io.Copy(writer, reader)</span></span>
<span class="line">	<span class="token comment">//if err != nil {</span></span>
<span class="line">	<span class="token comment">//	log.Fatalln(err)</span></span>
<span class="line">	<span class="token comment">//}</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 方式2：自己读取和写入</span></span>
<span class="line">	buf <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span><span class="token punctuation">,</span> <span class="token number">1024</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token keyword">for</span> <span class="token punctuation">{</span></span>
<span class="line">		<span class="token comment">// 读取数据</span></span>
<span class="line">		n<span class="token punctuation">,</span> err <span class="token operator">:=</span> reader<span class="token punctuation">.</span><span class="token function">Read</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span></span>
<span class="line">		<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span></span>
<span class="line">			<span class="token keyword">if</span> err <span class="token operator">==</span> io<span class="token punctuation">.</span>EOF <span class="token punctuation">{</span></span>
<span class="line">				<span class="token keyword">break</span></span>
<span class="line">			<span class="token punctuation">}</span></span>
<span class="line">			log<span class="token punctuation">.</span><span class="token function">Fatalf</span><span class="token punctuation">(</span><span class="token string">&quot;read error: %s\n&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span></span>
<span class="line">		<span class="token punctuation">}</span></span>
<span class="line">		<span class="token comment">// 写入数据</span></span>
<span class="line">		m<span class="token punctuation">,</span> err <span class="token operator">:=</span> writer<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span>buf<span class="token punctuation">[</span><span class="token punctuation">:</span>n<span class="token punctuation">]</span><span class="token punctuation">)</span></span>
<span class="line">		<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span></span>
<span class="line">			log<span class="token punctuation">.</span><span class="token function">Fatalf</span><span class="token punctuation">(</span><span class="token string">&quot;write error: %s\n&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span></span>
<span class="line">		<span class="token punctuation">}</span></span>
<span class="line">		<span class="token comment">// 统计写入的字节数</span></span>
<span class="line">		writeBytes <span class="token operator">+=</span> <span class="token function">int64</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token comment">// 写缓冲测试</span></span>
<span class="line">	src <span class="token operator">:=</span> <span class="token string">&quot;D:\\iso\\CentOS-7-x86_64-DVD-1708.iso&quot;</span></span>
<span class="line">	dst <span class="token operator">:=</span> <span class="token string">&quot;D:\\iso\\copy.iso&quot;</span></span>
<span class="line">	bufSize <span class="token operator">:=</span> <span class="token number">4</span> <span class="token operator">&lt;&lt;</span> <span class="token number">20</span> <span class="token comment">// 4MiB</span></span>
<span class="line">	<span class="token function">MustWrite</span><span class="token punctuation">(</span>src<span class="token punctuation">,</span> dst<span class="token punctuation">,</span> bufSize<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre></div><p>输出结果</p><div class="language-bash" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token comment"># 调整代码中缓冲区大小，分别执行两次</span></span>
<span class="line"><span class="token comment"># 以下是测试了两块硬盘的结果</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 磁盘1</span></span>
<span class="line"><span class="token number">2023</span>/04/20 <span class="token number">12</span>:59:17 It takes <span class="token number">35.35</span> seconds to copy <span class="token number">4521459712</span> bytes <span class="token keyword">for</span> D:<span class="token punctuation">\</span>iso<span class="token punctuation">\</span>copy.iso  <span class="token comment"># 无缓冲区</span></span>
<span class="line"><span class="token number">2023</span>/04/20 <span class="token number">13</span>:07:17 It takes <span class="token number">29.68</span> seconds to copy <span class="token number">4521459712</span> bytes <span class="token keyword">for</span> D:/iso/copy.iso  <span class="token comment"># 4MB缓冲区</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 磁盘2</span></span>
<span class="line"><span class="token number">2023</span>/04/20 <span class="token number">13</span>:47:17 It takes <span class="token number">94.07</span> seconds to copy <span class="token number">4521459712</span> bytes <span class="token keyword">for</span> F:/.HOMES/admin/系统镜像/copy.iso  <span class="token comment"># 无缓冲区</span></span>
<span class="line"><span class="token number">2023</span>/04/20 <span class="token number">13</span>:45:17 It takes <span class="token number">47.44</span> seconds to copy <span class="token number">4521459712</span> bytes <span class="token keyword">for</span> F:/.HOMES/admin/系统镜像/copy.iso  <span class="token comment"># 4MB缓冲区</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 说明</span></span>
<span class="line"><span class="token comment"># 1、使用Read/Write读写方式性能有一定的提升</span></span>
<span class="line"><span class="token comment"># 2、但如果使用io.Copy方式读写文件，会使用dst.ReadFrom(src)方式读写，对我们这次测试来说并不准，用不用bufio，两者花费的时间几乎一致</span></span>
<span class="line"><span class="token comment"># 3、缓冲区并不是唯一的影响因素，如果不使用缓冲区都能榨干硬件性能，那么使用缓冲区提升也不会大</span></span>
<span class="line"></span></code></pre></div></details><details class="hint-container details"><summary>（7）读缓冲性能测试</summary><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">package</span> main</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">(</span></span>
<span class="line">	<span class="token string">&quot;bufio&quot;</span></span>
<span class="line">	<span class="token string">&quot;io&quot;</span></span>
<span class="line">	<span class="token string">&quot;log&quot;</span></span>
<span class="line">	<span class="token string">&quot;os&quot;</span></span>
<span class="line">	<span class="token string">&quot;time&quot;</span></span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">MustRead</span><span class="token punctuation">(</span>src <span class="token builtin">string</span><span class="token punctuation">,</span> bufSize <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token comment">// 记录读取的字节数</span></span>
<span class="line">	<span class="token keyword">var</span> readBytes <span class="token builtin">int64</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 统计时间</span></span>
<span class="line">	now <span class="token operator">:=</span> time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token keyword">defer</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">		log<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;Read %d bytes in %.2f second: %s\n&quot;</span><span class="token punctuation">,</span> readBytes<span class="token punctuation">,</span> time<span class="token punctuation">.</span><span class="token function">Since</span><span class="token punctuation">(</span>now<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Seconds</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> src<span class="token punctuation">)</span></span>
<span class="line">	<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 打开src文件</span></span>
<span class="line">	r<span class="token punctuation">,</span> err <span class="token operator">:=</span> os<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span>src<span class="token punctuation">)</span></span>
<span class="line">	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span></span>
<span class="line">		log<span class="token punctuation">.</span><span class="token function">Fatalln</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line">	<span class="token keyword">defer</span> r<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 构建 reader</span></span>
<span class="line">	<span class="token keyword">var</span> reader io<span class="token punctuation">.</span>Reader</span>
<span class="line">	<span class="token keyword">if</span> bufSize <span class="token operator">&lt;=</span> <span class="token number">0</span> <span class="token punctuation">{</span></span>
<span class="line">		reader <span class="token operator">=</span> r</span>
<span class="line">	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">		reader <span class="token operator">=</span> bufio<span class="token punctuation">.</span><span class="token function">NewReaderSize</span><span class="token punctuation">(</span>r<span class="token punctuation">,</span> bufSize<span class="token punctuation">)</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 手动读取</span></span>
<span class="line">	buf <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span><span class="token punctuation">,</span> <span class="token number">1024</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token keyword">for</span> <span class="token punctuation">{</span></span>
<span class="line">		<span class="token comment">// 读取数据</span></span>
<span class="line">		n<span class="token punctuation">,</span> err <span class="token operator">:=</span> reader<span class="token punctuation">.</span><span class="token function">Read</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span></span>
<span class="line">		<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span></span>
<span class="line">			<span class="token keyword">if</span> err <span class="token operator">==</span> io<span class="token punctuation">.</span>EOF <span class="token punctuation">{</span></span>
<span class="line">				<span class="token keyword">break</span></span>
<span class="line">			<span class="token punctuation">}</span></span>
<span class="line">			log<span class="token punctuation">.</span><span class="token function">Fatalf</span><span class="token punctuation">(</span><span class="token string">&quot;read error: %s\n&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span></span>
<span class="line">		<span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">		<span class="token comment">// 统计读取的字节数</span></span>
<span class="line">		readBytes <span class="token operator">+=</span> <span class="token function">int64</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token comment">// 读缓冲测试</span></span>
<span class="line">	src <span class="token operator">:=</span> <span class="token string">&quot;F:/.HOMES/admin/系统镜像/CentOS-7-x86_64-DVD-1708.iso&quot;</span></span>
<span class="line">	bufSize <span class="token operator">:=</span> <span class="token number">4</span> <span class="token operator">&lt;&lt;</span> <span class="token number">20</span> <span class="token comment">// 4MiB</span></span>
<span class="line">	<span class="token function">MustRead</span><span class="token punctuation">(</span>src<span class="token punctuation">,</span> bufSize<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre></div><p>输出结果</p><div class="language-bash" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token comment"># 调整代码中缓冲区大小，分别执行两次</span></span>
<span class="line"><span class="token comment"># 以下是测试了两块硬盘的结果</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 磁盘1</span></span>
<span class="line"><span class="token number">2023</span>/04/20 <span class="token number">12</span>:59:17 Read <span class="token number">4521459712</span> bytes <span class="token keyword">in</span> <span class="token number">35.35</span> second: D:<span class="token punctuation">\</span>iso<span class="token punctuation">\</span>CentOS-7-x86_64-DVD-1708.iso <span class="token comment"># 无缓冲区</span></span>
<span class="line"><span class="token number">2023</span>/04/20 <span class="token number">13</span>:07:17 Read <span class="token number">4521459712</span> bytes <span class="token keyword">in</span> <span class="token number">29.68</span> second: D:<span class="token punctuation">\</span>iso<span class="token punctuation">\</span>CentOS-7-x86_64-DVD-1708.iso <span class="token comment"># 4MB缓冲</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 磁盘2</span></span>
<span class="line"><span class="token number">2023</span>/04/20 <span class="token number">13</span>:40:50 Read <span class="token number">4521459712</span> bytes <span class="token keyword">in</span> <span class="token number">14.48</span> second: F:<span class="token punctuation">\</span>.HOMES<span class="token punctuation">\</span>admin<span class="token punctuation">\</span>系统镜像<span class="token punctuation">\</span>CentOS-7-x86_64-DVD-1708.iso <span class="token comment"># 无缓冲区</span></span>
<span class="line"><span class="token number">2023</span>/04/20 <span class="token number">13</span>:43:03 Read <span class="token number">4521459712</span> bytes <span class="token keyword">in</span> <span class="token number">1.06</span> second: F:<span class="token punctuation">\</span>.HOMES<span class="token punctuation">\</span>admin<span class="token punctuation">\</span>系统镜像<span class="token punctuation">\</span>CentOS-7-x86_64-DVD-1708.iso  <span class="token comment"># 4MB缓冲区</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 说明</span></span>
<span class="line"><span class="token comment"># 1、使用读缓冲区有明显的性能提升</span></span>
<span class="line"><span class="token comment"># 2、缓冲区并不是唯一的影响因素，如果不使用缓冲区都能榨干硬件性能，那么使用缓冲区提升也不会大</span></span>
<span class="line"></span></code></pre></div></details><br><h3 id="ioutils-已被os-io代替" tabindex="-1"><a class="header-anchor" href="#ioutils-已被os-io代替"><span>ioutils：已被os/io代替</span></a></h3><p>官方文档：<a href="https://pkg.go.dev/io/ioutil" target="_blank" rel="noopener noreferrer">https://pkg.go.dev/io/ioutil</a></p><p>从Go 1.16开始，同样的功能现在由包<code>io</code>包或<code>os</code>包提供，在代码中应该优先使用这些实现。有关详细信息，请参阅特定功能文档。</p><h2 id="-5" tabindex="-1"><a class="header-anchor" href="#-5"><span></span></a></h2><h2 id="并发基础" tabindex="-1"><a class="header-anchor" href="#并发基础"><span>并发基础</span></a></h2><h3 id="goroutine" tabindex="-1"><a class="header-anchor" href="#goroutine"><span>Goroutine</span></a></h3><details class="hint-container details"><summary>（1）基础示例</summary><ul><li>Go语言中每个并发执行的单元叫<code>Goroutine</code>（协程）</li><li>使用<code>go</code>关键字后接函数调用来创建一个<code>Goroutine</code></li><li>``Goroutine`是并发安全的</li></ul><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">package</span> main</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">(</span></span>
<span class="line">	<span class="token string">&quot;fmt&quot;</span></span>
<span class="line">	<span class="token string">&quot;runtime&quot;</span></span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">taskA</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span></span>
<span class="line">		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">taskB</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token char">&#39;A&#39;</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token char">&#39;Z&#39;</span><span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span></span>
<span class="line">		fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%c\n&quot;</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;start&quot;</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token keyword">go</span> <span class="token function">taskA</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 启动一个协程</span></span>
<span class="line">	<span class="token keyword">go</span> <span class="token function">taskB</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 启动另一个协程</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;end&quot;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 输出结果</span></span>
<span class="line"><span class="token comment">// start</span></span>
<span class="line"><span class="token comment">// end</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 问：协程函数没有执行吗？</span></span>
<span class="line"><span class="token comment">// 答：原因是main()函数并不会等待所有协程执行完后再退出,这里main函数已经执行完了，协程还没执行到for循环，所以造成协程没有执行的假象</span></span>
<span class="line"></span></code></pre></div></details><details class="hint-container details"><summary>（2）等待所有协程执行完再退出：使用WaitGroup-方式1</summary><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">package</span> main</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">(</span></span>
<span class="line">	<span class="token string">&quot;fmt&quot;</span></span>
<span class="line">	<span class="token string">&quot;sync&quot;</span></span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 声明WaitGroup</span></span>
<span class="line"><span class="token keyword">var</span> wg sync<span class="token punctuation">.</span>WaitGroup</span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">taskA</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span></span>
<span class="line">		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line">	wg<span class="token punctuation">.</span><span class="token function">Done</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">taskB</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token char">&#39;A&#39;</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token char">&#39;Z&#39;</span><span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span></span>
<span class="line">		fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%c\n&quot;</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line">	wg<span class="token punctuation">.</span><span class="token function">Done</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;start&quot;</span><span class="token punctuation">)</span></span>
<span class="line">	wg<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token keyword">go</span> <span class="token function">taskA</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 启动一个协程</span></span>
<span class="line">	<span class="token keyword">go</span> <span class="token function">taskB</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 启动另一个协程</span></span>
<span class="line"></span>
<span class="line">	wg<span class="token punctuation">.</span><span class="token function">Wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;end&quot;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 输出结果</span></span>
<span class="line"><span class="token comment">// start</span></span>
<span class="line"><span class="token comment">// A</span></span>
<span class="line"><span class="token comment">// 内容太多省略...	</span></span>
<span class="line"><span class="token comment">// 10</span></span>
<span class="line"><span class="token comment">// end</span></span>
<span class="line"></span></code></pre></div></details><details class="hint-container details"><summary>（3）等待所有协程执行完再退出：使用WaitGroup-方式2</summary><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">package</span> main</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">(</span></span>
<span class="line">	<span class="token string">&quot;fmt&quot;</span></span>
<span class="line">	<span class="token string">&quot;sync&quot;</span></span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">taskA</span><span class="token punctuation">(</span>wg <span class="token operator">*</span>sync<span class="token punctuation">.</span>WaitGroup<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span></span>
<span class="line">		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line">	wg<span class="token punctuation">.</span><span class="token function">Done</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">taskB</span><span class="token punctuation">(</span>wg <span class="token operator">*</span>sync<span class="token punctuation">.</span>WaitGroup<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token char">&#39;A&#39;</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token char">&#39;Z&#39;</span><span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span></span>
<span class="line">		fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%c\n&quot;</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line">	wg<span class="token punctuation">.</span><span class="token function">Done</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;start&quot;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 如果需要作为函数参数传递wg，则wg必须是引用类型</span></span>
<span class="line">	wg <span class="token operator">:=</span> <span class="token function">new</span><span class="token punctuation">(</span>sync<span class="token punctuation">.</span>WaitGroup<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	wg<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token keyword">go</span> <span class="token function">taskA</span><span class="token punctuation">(</span>wg<span class="token punctuation">)</span> <span class="token comment">// 启动一个协程</span></span>
<span class="line">	<span class="token keyword">go</span> <span class="token function">taskB</span><span class="token punctuation">(</span>wg<span class="token punctuation">)</span> <span class="token comment">// 启动另一个协程</span></span>
<span class="line"></span>
<span class="line">	wg<span class="token punctuation">.</span><span class="token function">Wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;end&quot;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 输出结果</span></span>
<span class="line"><span class="token comment">// start</span></span>
<span class="line"><span class="token comment">// A</span></span>
<span class="line"><span class="token comment">// 内容太多省略...	</span></span>
<span class="line"><span class="token comment">// 10</span></span>
<span class="line"><span class="token comment">// end</span></span>
<span class="line"></span></code></pre></div></details><details class="hint-container details"><summary>（4）等待所有协程执行完再退出：使用 Channel</summary><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">package</span> main</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">(</span></span>
<span class="line">	<span class="token string">&quot;fmt&quot;</span></span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">taskA</span><span class="token punctuation">(</span>ch <span class="token keyword">chan</span> <span class="token keyword">struct</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span></span>
<span class="line">		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line">	ch <span class="token operator">&lt;-</span> <span class="token keyword">struct</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">{</span><span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">taskB</span><span class="token punctuation">(</span>ch <span class="token keyword">chan</span> <span class="token keyword">struct</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token char">&#39;A&#39;</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token char">&#39;Z&#39;</span><span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span></span>
<span class="line">		fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%c\n&quot;</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line">	ch <span class="token operator">&lt;-</span> <span class="token keyword">struct</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">{</span><span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;start&quot;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 初始化channel</span></span>
<span class="line">	n <span class="token operator">:=</span> <span class="token number">2</span> <span class="token comment">// 代表启动几个groutine</span></span>
<span class="line">	ch <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token keyword">struct</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	<span class="token keyword">go</span> <span class="token function">taskA</span><span class="token punctuation">(</span>ch<span class="token punctuation">)</span> <span class="token comment">// 启动一个协程</span></span>
<span class="line">	<span class="token keyword">go</span> <span class="token function">taskB</span><span class="token punctuation">(</span>ch<span class="token punctuation">)</span> <span class="token comment">// 启动另一个协程</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 阻塞</span></span>
<span class="line">	<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span></span>
<span class="line">		<span class="token operator">&lt;-</span>ch</span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;end&quot;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 输出结果</span></span>
<span class="line"><span class="token comment">// start</span></span>
<span class="line"><span class="token comment">// A</span></span>
<span class="line"><span class="token comment">// 内容太多省略...	</span></span>
<span class="line"><span class="token comment">// 10</span></span>
<span class="line"><span class="token comment">// end</span></span>
<span class="line"></span></code></pre></div></details><details class="hint-container details"><summary>（5）Goroutine相关函数</summary><table><thead><tr><th>函数</th><th>说明</th></tr></thead><tbody><tr><td><code>runtime.NumGoroutine()</code></td><td>返回当前存在的<code>Goroutine</code>数量</td></tr><tr><td><code>runtime.Gosched()</code></td><td>暂停当前<code>Goroutine</code>，由Go自动调度其他<code>Goroutine</code>执行</td></tr><tr><td><code>runtime.Goexit()</code></td><td>退出当前<code>Goroutine</code></td></tr><tr><td><code>runtime.GOMAXPROCS(n)</code></td><td>设置可以使用的最大CPU数量，默认值为<code>runtime.NumCPU()</code>；返回上一次设置的值</td></tr></tbody></table></details><br><h3 id="channel-基础" tabindex="-1"><a class="header-anchor" href="#channel-基础"><span>Channel 基础</span></a></h3><details class="hint-container details"><summary>（1）说明</summary><p><code>Channel</code>用于<code>Goroutine</code>之间的通信，中文可以称为”管道&quot;或&quot;通道&quot;</p><p><strong>根据状态可以分为</strong></p><ul><li><code>nil</code>，只声明未初始化的<code>Channel</code></li><li>正常，声明并初始化的<code>Channel</code></li><li>关闭，使用<code>close(Channel)</code></li></ul><p><strong>根据缓冲方式可以分为</strong></p><ul><li>无缓冲区<code>Channel</code></li><li>带缓冲区<code>Channel</code></li></ul><p><strong>根据读写方式可以分为</strong></p><ul><li>读写<code>Channel</code></li><li>只读<code>Channel</code></li><li>只写<code>Channel</code></li></ul></details><details class="hint-container details"><summary>（2）定义</summary><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">package</span> main</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token string">&quot;fmt&quot;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token comment">// 声明一个int类型的channel</span></span>
<span class="line">	<span class="token keyword">var</span> channel <span class="token keyword">chan</span> <span class="token builtin">int</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%T %#v\n&quot;</span><span class="token punctuation">,</span> channel<span class="token punctuation">,</span> channel<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 初始化channel</span></span>
<span class="line">	channel <span class="token operator">=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token builtin">int</span><span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%T %#v\n&quot;</span><span class="token punctuation">,</span> channel<span class="token punctuation">,</span> channel<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 以上两句可以简写成如下形式（推荐这种写法）</span></span>
<span class="line">	ch <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token builtin">int</span><span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%T %#v\n&quot;</span><span class="token punctuation">,</span> ch<span class="token punctuation">,</span> ch<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 输出结果</span></span>
<span class="line"><span class="token comment">//chan int (chan int)(nil)</span></span>
<span class="line"><span class="token comment">//chan int (chan int)(0xc00005e060)</span></span>
<span class="line"><span class="token comment">//chan int (chan int)(0xc00005e0c0)</span></span>
<span class="line"></span></code></pre></div></details><details class="hint-container details"><summary>（3）读和写</summary><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token comment">// 写数据：将100写入到channel中</span></span>
<span class="line">ch <span class="token operator">&lt;-</span> <span class="token number">100</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 读数据-方式1， v代表读到的值</span></span>
<span class="line">v <span class="token operator">:=</span> <span class="token operator">&lt;-</span>ch</span>
<span class="line"></span>
<span class="line"><span class="token comment">// 读数据-方式2， v代表读到的值, ok代表channel的状态，true为channel正常，false为channel已经关闭</span></span>
<span class="line">v<span class="token punctuation">,</span> ok <span class="token operator">:=</span> <span class="token operator">&lt;-</span>ch</span>
<span class="line"></span>
<span class="line"><span class="token comment">// 读取管道-方式3, 使用range遍历，这里只有一个返回值，若Channel关闭则for循环也随之结束</span></span>
<span class="line"><span class="token keyword">for</span> v<span class="token operator">:=</span> <span class="token keyword">range</span> ch <span class="token punctuation">{</span></span>
<span class="line">    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 关闭channel</span></span>
<span class="line"><span class="token function">close</span><span class="token punctuation">(</span>ch<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 记忆技巧：箭头代表数据流向</span></span>
<span class="line"></span></code></pre></div></details><br><h3 id="channel-无缓冲区" tabindex="-1"><a class="header-anchor" href="#channel-无缓冲区"><span>Channel 无缓冲区</span></a></h3><p><strong>定义</strong></p><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line">ch <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token builtin">int</span><span class="token punctuation">)</span>	<span class="token comment">// 无缓冲区channel, 等同于make(chan int, 0)，第二个参数代表可缓冲数据个数</span></span>
<span class="line"></span></code></pre></div><p><strong>特性</strong></p><ul><li>读和写不能在同一个协程中</li><li>读写次数不一致会发生死锁：<code>fatal error: all goroutines are asleep - deadlock!</code></li><li>管道关闭后： <ul><li>假如继续读，不会阻塞，而是会读取到零值</li><li>假如继续写，会报错：<code>panic: send on closed channel</code></li></ul></li><li>如果管道一切都正常，未读取之前写入会阻塞，未写入之前读取也会阻塞</li></ul><details class="hint-container details"><summary>测试1: 基础使用</summary><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">package</span> main</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">(</span></span>
<span class="line">	<span class="token string">&quot;log&quot;</span></span>
<span class="line">	<span class="token string">&quot;time&quot;</span></span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token comment">// 声明并初始化channel</span></span>
<span class="line">	ch <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token builtin">int</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 写数据</span></span>
<span class="line">	<span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">		<span class="token keyword">for</span> curTime <span class="token operator">:=</span> <span class="token keyword">range</span> time<span class="token punctuation">.</span><span class="token function">Tick</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span>Second<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">			second <span class="token operator">:=</span> curTime<span class="token punctuation">.</span><span class="token function">Second</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">			ch <span class="token operator">&lt;-</span> second</span>
<span class="line">			log<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;Write to Channel  %d\n&quot;</span><span class="token punctuation">,</span> second<span class="token punctuation">)</span></span>
<span class="line">		<span class="token punctuation">}</span></span>
<span class="line">	<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 读数据</span></span>
<span class="line">	<span class="token keyword">for</span> v <span class="token operator">:=</span> <span class="token keyword">range</span> ch <span class="token punctuation">{</span></span>
<span class="line">		log<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;Read from Channel %d\n\n&quot;</span><span class="token punctuation">,</span> v<span class="token punctuation">)</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre></div><p>输出结果</p><div class="language-bash" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token number">2022</span>/04/17 <span class="token number">11</span>:51:32 Write to Channel  <span class="token number">32</span></span>
<span class="line"><span class="token number">2022</span>/04/17 <span class="token number">11</span>:51:32 Read from Channel <span class="token number">32</span></span>
<span class="line"></span>
<span class="line"><span class="token number">2022</span>/04/17 <span class="token number">11</span>:51:33 Write to Channel  <span class="token number">33</span></span>
<span class="line"><span class="token number">2022</span>/04/17 <span class="token number">11</span>:51:33 Read from Channel <span class="token number">33</span></span>
<span class="line"></span>
<span class="line"><span class="token number">2022</span>/04/17 <span class="token number">11</span>:51:34 Write to Channel  <span class="token number">34</span></span>
<span class="line"><span class="token number">2022</span>/04/17 <span class="token number">11</span>:51:34 Read from Channel <span class="token number">34</span></span>
<span class="line"></span></code></pre></div></details><br><h3 id="channel-带缓冲区" tabindex="-1"><a class="header-anchor" href="#channel-带缓冲区"><span>Channel 带缓冲区</span></a></h3><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line">ch <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token builtin">int</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>	<span class="token comment">// 代表缓冲区长度为3，可以放3个数据</span></span>
<span class="line"></span></code></pre></div><p><strong>特性</strong></p><ul><li><p>读和写可以在同一个协程中</p></li><li><p>读写次数可以不一致，最大差不能超过缓冲区长度，否则同样会引发死锁：<code>fatal error: all goroutines are asleep - deadlock!</code></p><p>举个例子，缓冲区大小为1，则写入1次读取0次没有问题，写入2次读取0次就会引发死锁</p></li><li><p>管道关闭后：</p><ul><li>假如继续读，不会阻塞，而是会先读取缓冲区，若缓冲区读完会读到零值</li><li>假如继续写，会报错：<code>panic: send on closed channel</code></li></ul></li><li><p>如果管道一切都正常，</p><ul><li>只有1个协程情况下（<code>main函数</code>），写满缓冲区再写入会报错，读完缓冲区再读取也会报错</li><li>至少2个协程情况下（<code>go</code>关键字至少启动1个），写满缓冲区再写入会阻塞，读完缓冲区再读取也会阻塞</li></ul></li></ul><details class="hint-container details"><summary>测试1: 读和写可以在同一个协程中</summary><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">package</span> main</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">(</span></span>
<span class="line">	<span class="token string">&quot;fmt&quot;</span></span>
<span class="line">	<span class="token string">&quot;math/rand&quot;</span></span>
<span class="line">	<span class="token string">&quot;time&quot;</span></span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token comment">// 初始化随机数种子</span></span>
<span class="line">	rand<span class="token punctuation">.</span><span class="token function">Seed</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Unix</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 声明并初始化channel</span></span>
<span class="line">	ch <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token builtin">int</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 写入数据（0-99之间的随机数）</span></span>
<span class="line">	ch <span class="token operator">&lt;-</span> rand<span class="token punctuation">.</span><span class="token function">Intn</span><span class="token punctuation">(</span><span class="token number">99</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 读取数据</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;读取数据: &quot;</span><span class="token punctuation">,</span> <span class="token operator">&lt;-</span>ch<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre></div></details><details class="hint-container details"><summary>测试2: 读写次数可以不一致</summary><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">package</span> main</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">(</span></span>
<span class="line">	<span class="token string">&quot;math/rand&quot;</span></span>
<span class="line">	<span class="token string">&quot;time&quot;</span></span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token comment">// 初始化随机数种子</span></span>
<span class="line">	rand<span class="token punctuation">.</span><span class="token function">Seed</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Unix</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 声明并初始化channel，缓冲区大小为10</span></span>
<span class="line">	ch <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token builtin">int</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 写入数据次数, 写入10次读取0次没问题，写入11次读取0次就会发生死锁，因为缓冲区写满了</span></span>
<span class="line">	n <span class="token operator">:=</span> <span class="token number">10</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 写入数据（0-99之间的随机数）</span></span>
<span class="line">	<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span></span>
<span class="line">		ch <span class="token operator">&lt;-</span> rand<span class="token punctuation">.</span><span class="token function">Intn</span><span class="token punctuation">(</span><span class="token number">99</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre></div></details><details class="hint-container details"><summary>测试3: Channel关闭后再读取，会读完缓冲区后读取到零值</summary><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">package</span> main</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token string">&quot;fmt&quot;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token comment">// 声明并初始化channel，缓冲区大小为3</span></span>
<span class="line">	ch <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token builtin">int</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 写缓冲区</span></span>
<span class="line">	ch <span class="token operator">&lt;-</span> <span class="token number">100</span></span>
<span class="line">	ch <span class="token operator">&lt;-</span> <span class="token number">200</span></span>
<span class="line">	ch <span class="token operator">&lt;-</span> <span class="token number">300</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 关闭channel</span></span>
<span class="line">	<span class="token function">close</span><span class="token punctuation">(</span>ch<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 读取数据</span></span>
<span class="line">	<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">5</span><span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span></span>
<span class="line">		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token operator">&lt;-</span>ch<span class="token punctuation">)</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 输出结果</span></span>
<span class="line"><span class="token comment">// 100</span></span>
<span class="line"><span class="token comment">// 200</span></span>
<span class="line"><span class="token comment">// 300</span></span>
<span class="line"><span class="token comment">// 0</span></span>
<span class="line"><span class="token comment">// 0</span></span>
<span class="line"></span></code></pre></div></details><details class="hint-container details"><summary>测试4: Channel关闭后再写入会直接报错，而不是写入到缓冲区</summary><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">package</span> main</span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token comment">// 声明并初始化channel，缓冲区大小为3</span></span>
<span class="line">	ch <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token builtin">int</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 关闭channel</span></span>
<span class="line">	<span class="token function">close</span><span class="token punctuation">(</span>ch<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 写数据，channel已经关闭了，不能写入到缓冲区，会直接报错，这和无缓冲channel表现一致</span></span>
<span class="line">	ch <span class="token operator">&lt;-</span> <span class="token number">100</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre></div></details><details class="hint-container details"><summary>测试5: 1个协程情况下（<code>main函数</code>），写满缓冲区再写入会报错</summary><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">package</span> main</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token string">&quot;fmt&quot;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token comment">// 声明并初始化channel，缓冲区大小为3</span></span>
<span class="line">	ch <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token builtin">int</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 写数据</span></span>
<span class="line">	ch <span class="token operator">&lt;-</span> <span class="token number">100</span></span>
<span class="line">	ch <span class="token operator">&lt;-</span> <span class="token number">100</span></span>
<span class="line">	ch <span class="token operator">&lt;-</span> <span class="token number">100</span></span>
<span class="line">	ch <span class="token operator">&lt;-</span> <span class="token number">100</span> <span class="token comment">// 这里直接报错</span></span>
<span class="line"></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token operator">&lt;-</span>ch<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre></div></details><details class="hint-container details"><summary>测试6: 1个协程情况下（<code>main函数</code>），读完缓冲区再读取也会报错</summary><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">package</span> main</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">(</span></span>
<span class="line">	<span class="token string">&quot;fmt&quot;</span></span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token comment">// 声明并初始化channel，缓冲区大小为3</span></span>
<span class="line">	ch <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token builtin">int</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 写入</span></span>
<span class="line">	ch <span class="token operator">&lt;-</span> <span class="token number">100</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 读取</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token operator">&lt;-</span>ch<span class="token punctuation">)</span> <span class="token comment">// 正常读取</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token operator">&lt;-</span>ch<span class="token punctuation">)</span> <span class="token comment">// 报错</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre></div></details><details class="hint-container details"><summary>测试7: 至少2个协程情况下（go关键字至少启动1个），写满缓冲区再写入会阻塞</summary><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">package</span> main</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">(</span></span>
<span class="line">	<span class="token string">&quot;log&quot;</span></span>
<span class="line">	<span class="token string">&quot;runtime&quot;</span></span>
<span class="line">	<span class="token string">&quot;time&quot;</span></span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token comment">// 声明并初始化channel，缓冲区大小为3</span></span>
<span class="line">	ch <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token builtin">int</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 开启一个协程</span></span>
<span class="line">	<span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">		time<span class="token punctuation">.</span><span class="token function">Sleep</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span>Second <span class="token operator">*</span> <span class="token number">60</span><span class="token punctuation">)</span></span>
<span class="line">		log<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;协程运行结束&quot;</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 写入</span></span>
<span class="line">	<span class="token comment">// 		循环次数：缓冲区+1次</span></span>
<span class="line">	<span class="token comment">//		协程未运行完之前，第4次写入会卡住，等协程运行完，第4次写入就会报错</span></span>
<span class="line">	<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token function">cap</span><span class="token punctuation">(</span>ch<span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span></span>
<span class="line">		log<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;【开始】第%d次写入数据 | 当前协程数量: %d\n&quot;</span><span class="token punctuation">,</span> i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span> runtime<span class="token punctuation">.</span><span class="token function">NumGoroutine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">		ch <span class="token operator">&lt;-</span> <span class="token number">100</span></span>
<span class="line">		log<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;【结束】第%d次写入数据 | 当前协程数量: %d\n\n&quot;</span><span class="token punctuation">,</span> i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span> runtime<span class="token punctuation">.</span><span class="token function">NumGoroutine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre></div><p>输出结果</p><div class="language-bash" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token number">2022</span>/04/17 <span class="token number">13</span>:28:40 【开始】第1次写入数据 <span class="token operator">|</span> 当前协程数量: <span class="token number">2</span></span>
<span class="line"><span class="token number">2022</span>/04/17 <span class="token number">13</span>:28:40 【结束】第1次写入数据 <span class="token operator">|</span> 当前协程数量: <span class="token number">2</span></span>
<span class="line"></span>
<span class="line"><span class="token number">2022</span>/04/17 <span class="token number">13</span>:28:40 【开始】第2次写入数据 <span class="token operator">|</span> 当前协程数量: <span class="token number">2</span></span>
<span class="line"><span class="token number">2022</span>/04/17 <span class="token number">13</span>:28:40 【结束】第2次写入数据 <span class="token operator">|</span> 当前协程数量: <span class="token number">2</span></span>
<span class="line"></span>
<span class="line"><span class="token number">2022</span>/04/17 <span class="token number">13</span>:28:40 【开始】第3次写入数据 <span class="token operator">|</span> 当前协程数量: <span class="token number">2</span></span>
<span class="line"><span class="token number">2022</span>/04/17 <span class="token number">13</span>:28:40 【结束】第3次写入数据 <span class="token operator">|</span> 当前协程数量: <span class="token number">2</span></span>
<span class="line"></span>
<span class="line"><span class="token number">2022</span>/04/17 <span class="token number">13</span>:28:40 【开始】第4次写入数据 <span class="token operator">|</span> 当前协程数量: <span class="token number">2</span></span>
<span class="line"><span class="token number">2022</span>/04/17 <span class="token number">13</span>:29:40 协程运行结束</span>
<span class="line">fatal error: all goroutines are asleep - deadlock<span class="token operator">!</span></span>
<span class="line"></span>
<span class="line">goroutine <span class="token number">1</span> <span class="token punctuation">[</span>chan send<span class="token punctuation">]</span>:</span>
<span class="line">main.main<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">        C:/Users/Administrator/GolandProjects/learn/main.go:24 +0x18d</span>
<span class="line"></span>
<span class="line">Process finished with the <span class="token builtin class-name">exit</span> code <span class="token number">2</span></span>
<span class="line"></span></code></pre></div></details><details class="hint-container details"><summary>测试8: 至少2个协程情况下（go关键字至少启动1个），读完缓冲区再读取也会阻塞</summary><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">package</span> main</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">(</span></span>
<span class="line">	<span class="token string">&quot;log&quot;</span></span>
<span class="line">	<span class="token string">&quot;time&quot;</span></span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token comment">// 声明并初始化channel，缓冲区大小为3</span></span>
<span class="line">	ch <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token builtin">int</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 开启一个协程</span></span>
<span class="line">	<span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">		time<span class="token punctuation">.</span><span class="token function">Sleep</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span>Second <span class="token operator">*</span> <span class="token number">60</span><span class="token punctuation">)</span></span>
<span class="line">		log<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;协程运行结束&quot;</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 读取</span></span>
<span class="line">	log<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;开始读取&quot;</span><span class="token punctuation">)</span></span>
<span class="line">	v<span class="token punctuation">,</span> ok <span class="token operator">:=</span> <span class="token operator">&lt;-</span>ch</span>
<span class="line">	log<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;读取结束&quot;</span><span class="token punctuation">,</span> v<span class="token punctuation">,</span> ok<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre></div><p>输出结果</p><div class="language-bash" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token number">2022</span>/04/17 <span class="token number">13</span>:36:51 开始读取</span>
<span class="line"><span class="token number">2022</span>/04/17 <span class="token number">13</span>:37:51 协程运行结束</span>
<span class="line">fatal error: all goroutines are asleep - deadlock<span class="token operator">!</span></span>
<span class="line"></span>
<span class="line">goroutine <span class="token number">1</span> <span class="token punctuation">[</span>chan receive<span class="token punctuation">]</span>:</span>
<span class="line">main.main<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">        C:/Users/Administrator/GolandProjects/learn/main.go:20 +0x79</span>
<span class="line"></span></code></pre></div></details><br><h3 id="channel-只读和只写" tabindex="-1"><a class="header-anchor" href="#channel-只读和只写"><span>Channel 只读和只写</span></a></h3><p>只是在原有的<code>Channel</code>上加了一层限制，只能读或只能写，默认的<code>Channel</code>是读写都支持的</p><details class="hint-container details"><summary>点击查看完整代码</summary><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">package</span> main</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token string">&quot;fmt&quot;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">chanReadOnly</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token comment">// 声明带缓冲区的channel，默认是支持读写的</span></span>
<span class="line">	ch <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token builtin">int</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span></span>
<span class="line">	ch <span class="token operator">&lt;-</span> <span class="token number">100</span></span>
<span class="line">	ch <span class="token operator">&lt;-</span> <span class="token number">200</span></span>
<span class="line">	ch <span class="token operator">&lt;-</span> <span class="token number">300</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 声明为只读channel</span></span>
<span class="line">	<span class="token keyword">var</span> chReadOnly <span class="token operator">&lt;-</span><span class="token keyword">chan</span> <span class="token builtin">int</span></span>
<span class="line">	chReadOnly <span class="token operator">=</span> ch</span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 读数据</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token operator">&lt;-</span>chReadOnly<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 写数据会报错</span></span>
<span class="line">	<span class="token comment">//chReadOnly &lt;- 400</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">chanWriteOnly</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token comment">// 声明只写channel</span></span>
<span class="line">	ch <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span><span class="token operator">&lt;-</span> <span class="token builtin">int</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 写数据</span></span>
<span class="line">	ch <span class="token operator">&lt;-</span> <span class="token number">100</span></span>
<span class="line">	ch <span class="token operator">&lt;-</span> <span class="token number">200</span></span>
<span class="line">	ch <span class="token operator">&lt;-</span> <span class="token number">300</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 读数据会报错</span></span>
<span class="line">	<span class="token comment">//fmt.Println(&lt;-ch)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token function">chanReadOnly</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token function">chanWriteOnly</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre></div></details><br><h3 id="channel的典型用法" tabindex="-1"><a class="header-anchor" href="#channel的典型用法"><span>Channel的典型用法</span></a></h3><br><h3 id="channel的错误处理" tabindex="-1"><a class="header-anchor" href="#channel的错误处理"><span>Channel的错误处理</span></a></h3><br><h3 id="select-多路复用用法" tabindex="-1"><a class="header-anchor" href="#select-多路复用用法"><span>Select 多路复用用法</span></a></h3><p><strong>说明</strong></p><p><code>select</code>是专门为<code>Goroutine</code>设计的，类似于<code>switch..case</code>语法</p><ul><li>每个<code>case </code>表达式中都只能包含操作<code>Channel</code>的表达式，比如读或写</li><li>如果有多个<code>case </code>都可以运行，<code>select</code>会随机公平地选出一个执行，其他不会执行</li><li>如果多个<code>case </code>都不能运行，若有<code>default </code>子句，则执行该语句，反之，<code>select </code>将阻塞，直到某个<code>case </code>可以运行</li><li>空<code>select</code>会一直阻塞</li></ul><details class="hint-container details"><summary>（1）基础示例</summary><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">package</span> main</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">(</span></span>
<span class="line">	<span class="token string">&quot;fmt&quot;</span></span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	c1 <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token builtin">int</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span></span>
<span class="line">	c2 <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token builtin">int</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 测试1：直接执行会执行default语句</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 测试2: 给C1管道写入数据；结果：在C1管道中读取到值： 1</span></span>
<span class="line">	<span class="token comment">//c1 &lt;- 1</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 测试3，直接关闭管道；结果：C1管道中的数据为零值:  0</span></span>
<span class="line">	<span class="token comment">//close(c1)</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 测试4，两个管道都关闭，那么select会随机取一个，然后执行select后面的逻辑</span></span>
<span class="line">	<span class="token comment">//close(c1)</span></span>
<span class="line">	<span class="token comment">//close(c2)</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 在多个管道中，只要有一个操作成功就执行相应逻辑</span></span>
<span class="line">	<span class="token keyword">select</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token keyword">case</span> v<span class="token punctuation">,</span> ok <span class="token operator">:=</span> <span class="token operator">&lt;-</span>c1<span class="token punctuation">:</span></span>
<span class="line">		<span class="token keyword">if</span> ok <span class="token punctuation">{</span></span>
<span class="line">			fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;在C1管道中读取到值：&quot;</span><span class="token punctuation">,</span> v<span class="token punctuation">)</span></span>
<span class="line">		<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">			fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;C1管道中的数据为零值: &quot;</span><span class="token punctuation">,</span> v<span class="token punctuation">)</span></span>
<span class="line">		<span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">	<span class="token keyword">case</span> v<span class="token punctuation">,</span> ok <span class="token operator">:=</span> <span class="token operator">&lt;-</span>c2<span class="token punctuation">:</span></span>
<span class="line">		<span class="token keyword">if</span> ok <span class="token punctuation">{</span></span>
<span class="line">			fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;在C2管道中读取到值：&quot;</span><span class="token punctuation">,</span> v<span class="token punctuation">)</span></span>
<span class="line">		<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">			fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;C2管道中的数据为零值: &quot;</span><span class="token punctuation">,</span> v<span class="token punctuation">)</span></span>
<span class="line">		<span class="token punctuation">}</span></span>
<span class="line">	<span class="token keyword">default</span><span class="token punctuation">:</span></span>
<span class="line">		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;select default运行&quot;</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre></div></details><details class="hint-container details"><summary>（2）for{ select }问题：只能跳出select不能跳出for循环</summary><p>当需要循环操作时需要与<code>for</code>连用，这时候如果<code>select</code>中含有<code>break</code>，那么只能跳出<code>select</code>层而不能跳出<code>for</code>循环，下面演示一下</p><p>问题代码</p><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">package</span> main</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">(</span></span>
<span class="line">	<span class="token string">&quot;fmt&quot;</span></span>
<span class="line">	<span class="token string">&quot;math/rand&quot;</span></span>
<span class="line">	<span class="token string">&quot;time&quot;</span></span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token comment">// 初始化channel</span></span>
<span class="line">	ch <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token builtin">int</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 抽奖，获奖的ID放入channel中</span></span>
<span class="line">	<span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">		rand<span class="token punctuation">.</span><span class="token function">Seed</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">UnixNano</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">		<span class="token keyword">for</span> <span class="token keyword">range</span> time<span class="token punctuation">.</span><span class="token function">Tick</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span>Second<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">			ch <span class="token operator">&lt;-</span> rand<span class="token punctuation">.</span><span class="token function">Intn</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span></span>
<span class="line">		<span class="token punctuation">}</span></span>
<span class="line">	<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 开奖，从channel中读数据</span></span>
<span class="line">	<span class="token keyword">for</span> <span class="token punctuation">{</span></span>
<span class="line">		<span class="token keyword">select</span> <span class="token punctuation">{</span></span>
<span class="line">		<span class="token keyword">case</span> v <span class="token operator">:=</span> <span class="token operator">&lt;-</span>ch<span class="token punctuation">:</span></span>
<span class="line">			<span class="token keyword">if</span> v <span class="token operator">&gt;=</span> <span class="token number">100</span> <span class="token operator">&amp;&amp;</span> v <span class="token operator">&lt;=</span> <span class="token number">400</span> <span class="token punctuation">{</span> <span class="token comment">// 为了提高中奖几率..</span></span>
<span class="line">				fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;恭喜你中奖了，请去领奖&quot;</span><span class="token punctuation">)</span></span>
<span class="line">				<span class="token keyword">break</span></span>
<span class="line">			<span class="token punctuation">}</span></span>
<span class="line">		<span class="token punctuation">}</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 领奖</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;感谢CCTV, 感谢MTV, 感谢党和人民的栽培...&quot;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre></div><p>修正-方式1：使用break 标签</p><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">package</span> main</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">(</span></span>
<span class="line">	<span class="token string">&quot;fmt&quot;</span></span>
<span class="line">	<span class="token string">&quot;math/rand&quot;</span></span>
<span class="line">	<span class="token string">&quot;time&quot;</span></span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token comment">// 初始化channel</span></span>
<span class="line">	ch <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token builtin">int</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 抽奖，获奖的ID放入channel中</span></span>
<span class="line">	<span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">		rand<span class="token punctuation">.</span><span class="token function">Seed</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">UnixNano</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">		<span class="token keyword">for</span> <span class="token keyword">range</span> time<span class="token punctuation">.</span><span class="token function">Tick</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span>Second<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">			ch <span class="token operator">&lt;-</span> rand<span class="token punctuation">.</span><span class="token function">Intn</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span></span>
<span class="line">		<span class="token punctuation">}</span></span>
<span class="line">	<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 开奖，从channel中读数据</span></span>
<span class="line">ForEnd<span class="token punctuation">:</span>		<span class="token comment">// 添加一个标签</span></span>
<span class="line">	<span class="token keyword">for</span> <span class="token punctuation">{</span></span>
<span class="line">		<span class="token keyword">select</span> <span class="token punctuation">{</span></span>
<span class="line">		<span class="token keyword">case</span> v <span class="token operator">:=</span> <span class="token operator">&lt;-</span>ch<span class="token punctuation">:</span></span>
<span class="line">			<span class="token keyword">if</span> v <span class="token operator">&gt;=</span> <span class="token number">100</span> <span class="token operator">&amp;&amp;</span> v <span class="token operator">&lt;=</span> <span class="token number">400</span> <span class="token punctuation">{</span> <span class="token comment">// 为了提高中奖几率..</span></span>
<span class="line">				fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;恭喜你中奖了，请去领奖&quot;</span><span class="token punctuation">)</span></span>
<span class="line">				<span class="token keyword">break</span> ForEnd	<span class="token comment">// 跳出此标签</span></span>
<span class="line">			<span class="token punctuation">}</span></span>
<span class="line">		<span class="token punctuation">}</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 领奖</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;感谢CCTV, 感谢MTV, 感谢党和人民的栽培...&quot;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre></div><p>修正-方式2：使用goto 标签</p><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">package</span> main</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">(</span></span>
<span class="line">	<span class="token string">&quot;fmt&quot;</span></span>
<span class="line">	<span class="token string">&quot;math/rand&quot;</span></span>
<span class="line">	<span class="token string">&quot;time&quot;</span></span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token comment">// 初始化channel</span></span>
<span class="line">	ch <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token builtin">int</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 抽奖，获奖的ID放入channel中</span></span>
<span class="line">	<span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">		rand<span class="token punctuation">.</span><span class="token function">Seed</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">UnixNano</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">		<span class="token keyword">for</span> <span class="token keyword">range</span> time<span class="token punctuation">.</span><span class="token function">Tick</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span>Second<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">			ch <span class="token operator">&lt;-</span> rand<span class="token punctuation">.</span><span class="token function">Intn</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span></span>
<span class="line">		<span class="token punctuation">}</span></span>
<span class="line">	<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 开奖，从channel中读数据</span></span>
<span class="line">	<span class="token keyword">for</span> <span class="token punctuation">{</span></span>
<span class="line">		<span class="token keyword">select</span> <span class="token punctuation">{</span></span>
<span class="line">		<span class="token keyword">case</span> v <span class="token operator">:=</span> <span class="token operator">&lt;-</span>ch<span class="token punctuation">:</span></span>
<span class="line">			<span class="token keyword">if</span> v <span class="token operator">&gt;=</span> <span class="token number">100</span> <span class="token operator">&amp;&amp;</span> v <span class="token operator">&lt;=</span> <span class="token number">400</span> <span class="token punctuation">{</span> <span class="token comment">// 为了提高中奖几率..</span></span>
<span class="line">				fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;恭喜你中奖了，请去领奖&quot;</span><span class="token punctuation">)</span></span>
<span class="line">				<span class="token keyword">goto</span> ForEnd	<span class="token comment">// 跳到指定标签</span></span>
<span class="line">			<span class="token punctuation">}</span></span>
<span class="line">		<span class="token punctuation">}</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line">ForEnd<span class="token punctuation">:</span> <span class="token comment">// 定义标签</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 领奖</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;感谢CCTV, 感谢MTV, 感谢党和人民的栽培...&quot;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre></div></details><details class="hint-container details"><summary>（3）练习：设置函数执行超时时间</summary><p>有问题版本，主要是学习超时核心逻辑</p><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">package</span> main</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">(</span></span>
<span class="line">	<span class="token string">&quot;fmt&quot;</span></span>
<span class="line">	<span class="token string">&quot;time&quot;</span></span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">Add</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token builtin">int</span> <span class="token punctuation">{</span></span>
<span class="line">	time<span class="token punctuation">.</span><span class="token function">Sleep</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span>Second <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token comment">// 模拟函数耗时操作</span></span>
<span class="line">	<span class="token keyword">return</span> x <span class="token operator">+</span> y</span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token comment">// 声明并初始化channel</span></span>
<span class="line">	ch <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token builtin">int</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 执行协程</span></span>
<span class="line">	<span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">		ret <span class="token operator">:=</span> <span class="token function">Add</span><span class="token punctuation">(</span><span class="token number">111</span><span class="token punctuation">,</span> <span class="token number">222</span><span class="token punctuation">)</span> <span class="token comment">// 这个是我们原有的函数,并不做任何修改，非侵入式做超时控制</span></span>
<span class="line">		ch <span class="token operator">&lt;-</span> ret</span>
<span class="line">	<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 超时控制</span></span>
<span class="line">	<span class="token keyword">select</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token keyword">case</span> <span class="token operator">&lt;-</span>time<span class="token punctuation">.</span><span class="token function">After</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span>Second <span class="token operator">*</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;执行超时&quot;</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token keyword">case</span> v<span class="token punctuation">,</span> ok <span class="token operator">:=</span> <span class="token operator">&lt;-</span>ch<span class="token punctuation">:</span></span>
<span class="line">		<span class="token keyword">if</span> ok <span class="token punctuation">{</span></span>
<span class="line">			fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;执行成功: &quot;</span><span class="token punctuation">,</span> v<span class="token punctuation">)</span></span>
<span class="line">		<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">			fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;执行报错: &quot;</span><span class="token punctuation">,</span> v<span class="token punctuation">)</span></span>
<span class="line">		<span class="token punctuation">}</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 都有哪些问题？</span></span>
<span class="line"><span class="token comment">// (1) main内代码太多了，将超时控制的代码单独封装到一个函数中</span></span>
<span class="line"><span class="token comment">// (2) Goroutine泄漏：假设超时以后，协程中还会写数据到channel中，而外边已经没有读的了，会一直阻塞，造成Goroutine泄漏</span></span>
<span class="line"><span class="token comment">// (3) 该函数Add返回值没有包含错误，在实际场景中有些函数会有错误，错误如何传递？</span></span>
<span class="line"></span></code></pre></div><br><p>优化后版本，还算完美</p><ul><li><p>单独封装了一个函数</p></li><li><p><code>Goroutine</code>泄漏问题将无缓冲的<code>channel</code>改为带缓冲区的<code>channel</code>，但仍需要原本的<code>Add</code>函数执行完成后才会退出<code>AddWithTimeout</code>内部启动的协程。</p><p>Go不支持外部杀死一个正在运行的协程，参考：<a href="https://github.com/golang/go/issues/32610" target="_blank" rel="noopener noreferrer">https://github.com/golang/go/issues/32610</a></p></li><li><p>添加传递错误，<code>channel</code>修改为通知型</p></li></ul><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">package</span> main</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">(</span></span>
<span class="line">	<span class="token string">&quot;errors&quot;</span></span>
<span class="line">	<span class="token string">&quot;fmt&quot;</span></span>
<span class="line">	<span class="token string">&quot;log&quot;</span></span>
<span class="line">	<span class="token string">&quot;runtime&quot;</span></span>
<span class="line">	<span class="token string">&quot;time&quot;</span></span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">Add</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	time<span class="token punctuation">.</span><span class="token function">Sleep</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span>Second <span class="token operator">*</span> <span class="token number">5</span><span class="token punctuation">)</span> <span class="token comment">// 模拟函数耗时操作</span></span>
<span class="line">	<span class="token keyword">return</span> x <span class="token operator">+</span> y<span class="token punctuation">,</span> <span class="token boolean">nil</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">AddWithTimeout</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> timeout <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>ret <span class="token builtin">int</span><span class="token punctuation">,</span> err <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token comment">// 声明并初始化channel</span></span>
<span class="line">	ch <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token keyword">struct</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 执行协程</span></span>
<span class="line">	<span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">		ret<span class="token punctuation">,</span> err <span class="token operator">=</span> <span class="token function">Add</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span> <span class="token comment">// 这个是我们原有的函数,并不做任何修改</span></span>
<span class="line">		ch <span class="token operator">&lt;-</span> <span class="token keyword">struct</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">{</span><span class="token punctuation">}</span></span>
<span class="line">	<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 超时控制</span></span>
<span class="line">	<span class="token keyword">select</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token keyword">case</span> <span class="token operator">&lt;-</span>time<span class="token punctuation">.</span><span class="token function">After</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span>Millisecond <span class="token operator">*</span> time<span class="token punctuation">.</span><span class="token function">Duration</span><span class="token punctuation">(</span>timeout<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">		err <span class="token operator">=</span> errors<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span>fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span><span class="token string">&quot;Function executed for more than %d seconds: AddWithTimeout(%d, %d)&quot;</span><span class="token punctuation">,</span> timeout<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token keyword">case</span> <span class="token operator">&lt;-</span>ch<span class="token punctuation">:</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line">	<span class="token keyword">return</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// 开启多个协程</span></span>
<span class="line">	<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">100000</span><span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span></span>
<span class="line">		<span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">			ret<span class="token punctuation">,</span> err <span class="token operator">:=</span> <span class="token function">AddWithTimeout</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">5000</span><span class="token punctuation">)</span></span>
<span class="line">			ret <span class="token operator">=</span> ret</span>
<span class="line">			err <span class="token operator">=</span> err</span>
<span class="line">			<span class="token comment">//fmt.Printf(&quot;执行结果: %d, %v\n&quot;, ret, err)</span></span>
<span class="line">		<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment">// 每隔1秒输出当前Goroutine数量</span></span>
<span class="line">	<span class="token keyword">for</span> <span class="token keyword">range</span> time<span class="token punctuation">.</span><span class="token function">Tick</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span>Second<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">		g <span class="token operator">:=</span> runtime<span class="token punctuation">.</span><span class="token function">NumGoroutine</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">		log<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;当前Goroutine数量: %d\n&quot;</span><span class="token punctuation">,</span> g<span class="token punctuation">)</span></span>
<span class="line">		<span class="token keyword">if</span> g <span class="token operator">&lt;=</span> <span class="token number">1</span> <span class="token punctuation">{</span></span>
<span class="line">			<span class="token keyword">break</span></span>
<span class="line">		<span class="token punctuation">}</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre></div></details><details class="hint-container details"><summary>（4）练习：多个协程顺序打印数字</summary><p>有4个<code>goroutine</code>，每个<code>goroutine</code>打印一个数字，要求按照1<code>/2/3/4</code>这样的顺序打印输出</p><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">package</span> main</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">(</span></span>
<span class="line">	<span class="token string">&quot;log&quot;</span></span>
<span class="line">	<span class="token string">&quot;time&quot;</span></span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">type</span> Token <span class="token keyword">struct</span><span class="token punctuation">{</span><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">newWorker</span><span class="token punctuation">(</span>id <span class="token builtin">int</span><span class="token punctuation">,</span> ch <span class="token keyword">chan</span> Token<span class="token punctuation">,</span> nextCh <span class="token keyword">chan</span> Token<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token keyword">for</span> <span class="token punctuation">{</span></span>
<span class="line">		token <span class="token operator">:=</span> <span class="token operator">&lt;-</span>ch</span>
<span class="line">		log<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>id <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span></span>
<span class="line">		time<span class="token punctuation">.</span><span class="token function">Sleep</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span>Second<span class="token punctuation">)</span></span>
<span class="line">		nextCh <span class="token operator">&lt;-</span> token</span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	chs <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token keyword">chan</span> Token<span class="token punctuation">{</span></span>
<span class="line">		<span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> Token<span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">		<span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> Token<span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">		<span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> Token<span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">		<span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> Token<span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 启动4个协程</span></span>
<span class="line">	<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">4</span><span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span></span>
<span class="line">		<span class="token keyword">go</span> <span class="token function">newWorker</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> chs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> chs<span class="token punctuation">[</span><span class="token punctuation">(</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">%</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 给第一个chan发送数据</span></span>
<span class="line">	chs<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">&lt;-</span> Token<span class="token punctuation">{</span><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 会一直阻塞</span></span>
<span class="line">	<span class="token keyword">select</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre></div></details><br><h3 id="context-上下文管理" tabindex="-1"><a class="header-anchor" href="#context-上下文管理"><span>Context 上下文管理</span></a></h3><p>官方文档：<a href="https://pkg.go.dev/context" target="_blank" rel="noopener noreferrer">https://pkg.go.dev/context</a></p><p><code>context</code>是Go的标准库，用来管理<code>Goroutine</code>的上下文，<code>context</code>是并发安全的</p><p>使用上下文的程序应遵循以下规则</p><ul><li>不要在结构类型中存储上下文；相反，将上下文显式地传递给每个需要它的函数</li><li>上下文应该是第一个参数，通常命名为<code>ctx</code></li><li>即使函数允许，也不要传递nil上下文。如果您不确定要使用哪个上下文，请使用<code>context.TODO()</code></li></ul><br><details class="hint-container details"><summary>（1）WithCancel：取消协程</summary><p>用来取消子协程，以及孙子协程，以及孙子的孙子协程等</p><p>函数签名</p><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">func</span> <span class="token function">WithCancel</span><span class="token punctuation">(</span>parent Context<span class="token punctuation">)</span> <span class="token punctuation">(</span>ctx Context<span class="token punctuation">,</span> cancel CancelFunc<span class="token punctuation">)</span></span>
<span class="line"></span></code></pre></div><p>先看一段正常的代码</p><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">package</span> main</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">(</span></span>
<span class="line">	<span class="token string">&quot;log&quot;</span></span>
<span class="line">	<span class="token string">&quot;sync&quot;</span></span>
<span class="line">	<span class="token string">&quot;time&quot;</span></span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">worker</span><span class="token punctuation">(</span>wg <span class="token operator">*</span>sync<span class="token punctuation">.</span>WaitGroup<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">defer</span> wg<span class="token punctuation">.</span><span class="token function">Done</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span></span>
<span class="line">		log<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span></span>
<span class="line">		time<span class="token punctuation">.</span><span class="token function">Sleep</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span>Second<span class="token punctuation">)</span></span>
<span class="line">	<span class="token punctuation">}</span>	</span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	wg <span class="token operator">:=</span> <span class="token function">new</span><span class="token punctuation">(</span>sync<span class="token punctuation">.</span>WaitGroup<span class="token punctuation">)</span></span>
<span class="line">	wg<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	<span class="token keyword">go</span> <span class="token function">worker</span><span class="token punctuation">(</span>wg<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	wg<span class="token punctuation">.</span><span class="token function">Wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre></div><p>增加取消功能</p><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">package</span> main</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">(</span></span>
<span class="line">	<span class="token string">&quot;context&quot;</span></span>
<span class="line">	<span class="token string">&quot;log&quot;</span></span>
<span class="line">	<span class="token string">&quot;sync&quot;</span></span>
<span class="line">	<span class="token string">&quot;time&quot;</span></span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">worker</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> wg <span class="token operator">*</span>sync<span class="token punctuation">.</span>WaitGroup<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token keyword">defer</span> wg<span class="token punctuation">.</span><span class="token function">Done</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">LOOP<span class="token punctuation">:</span></span>
<span class="line">	<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span></span>
<span class="line">		<span class="token comment">// 退出信号</span></span>
<span class="line">		<span class="token keyword">select</span> <span class="token punctuation">{</span></span>
<span class="line">		<span class="token keyword">case</span> <span class="token operator">&lt;-</span>ctx<span class="token punctuation">.</span><span class="token function">Done</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">			<span class="token keyword">break</span> LOOP</span>
<span class="line">		<span class="token keyword">default</span><span class="token punctuation">:</span></span>
<span class="line">		<span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">		<span class="token comment">// 业务代码</span></span>
<span class="line">		log<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span></span>
<span class="line">		time<span class="token punctuation">.</span><span class="token function">Sleep</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span>Second<span class="token punctuation">)</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token comment">// 初始化</span></span>
<span class="line">    <span class="token comment">// Background返回一个空Context。它永远不会被取消，没有截止日期，也没有值。</span></span>
<span class="line">	<span class="token comment">// Background是所有Context树的根。</span></span>
<span class="line">	ctx<span class="token punctuation">,</span> cancel <span class="token operator">:=</span> context<span class="token punctuation">.</span><span class="token function">WithCancel</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token function">Background</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">	wg <span class="token operator">:=</span> <span class="token function">new</span><span class="token punctuation">(</span>sync<span class="token punctuation">.</span>WaitGroup<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 开始工作了</span></span>
<span class="line">	wg<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token keyword">go</span> <span class="token function">worker</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> wg<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 5秒后退出</span></span>
<span class="line">	time<span class="token punctuation">.</span><span class="token function">Sleep</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span>Second <span class="token operator">*</span> <span class="token number">5</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token function">cancel</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">	wg<span class="token punctuation">.</span><span class="token function">Wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre></div></details><details class="hint-container details"><summary>（2）WithDeadline和WithTimeout：增加过期时间</summary><p>函数签名</p><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token comment">// WithDeadline和WithTimeout是在WithCancel的基础上，增加了一个过期时间</span></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">WithDeadline</span><span class="token punctuation">(</span>parent Context<span class="token punctuation">,</span> d time<span class="token punctuation">.</span>Time<span class="token punctuation">)</span> <span class="token punctuation">(</span>Context<span class="token punctuation">,</span> CancelFunc<span class="token punctuation">)</span>			<span class="token comment">// 增加一个具体的过期时间点</span></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">WithTimeout</span><span class="token punctuation">(</span>parent Context<span class="token punctuation">,</span> timeout time<span class="token punctuation">.</span>Duration<span class="token punctuation">)</span> <span class="token punctuation">(</span>Context<span class="token punctuation">,</span> CancelFunc<span class="token punctuation">)</span>	<span class="token comment">// 增加一个相对的过期时间段</span></span>
<span class="line"></span></code></pre></div><p>函数超时控制</p><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">package</span> main</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">(</span></span>
<span class="line">	<span class="token string">&quot;context&quot;</span></span>
<span class="line">	<span class="token string">&quot;log&quot;</span></span>
<span class="line">	<span class="token string">&quot;sync&quot;</span></span>
<span class="line">	<span class="token string">&quot;time&quot;</span></span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">worker</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> wg <span class="token operator">*</span>sync<span class="token punctuation">.</span>WaitGroup<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token keyword">defer</span> wg<span class="token punctuation">.</span><span class="token function">Done</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">LOOP<span class="token punctuation">:</span></span>
<span class="line">	<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span></span>
<span class="line"></span>
<span class="line">		<span class="token comment">// 退出信号</span></span>
<span class="line">		<span class="token keyword">select</span> <span class="token punctuation">{</span></span>
<span class="line">		<span class="token keyword">case</span> <span class="token operator">&lt;-</span>ctx<span class="token punctuation">.</span><span class="token function">Done</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">			<span class="token keyword">break</span> LOOP</span>
<span class="line">		<span class="token keyword">default</span><span class="token punctuation">:</span></span>
<span class="line">		<span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">		<span class="token comment">// 业务代码</span></span>
<span class="line">		log<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span></span>
<span class="line">		time<span class="token punctuation">.</span><span class="token function">Sleep</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span>Second<span class="token punctuation">)</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token comment">// 初始化</span></span>
<span class="line">	ctx<span class="token punctuation">,</span> cancel <span class="token operator">:=</span> context<span class="token punctuation">.</span><span class="token function">WithTimeout</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token function">Background</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> time<span class="token punctuation">.</span>Second<span class="token operator">*</span><span class="token number">5</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">defer</span> <span class="token function">cancel</span><span class="token punctuation">(</span><span class="token punctuation">)</span>	<span class="token comment">// 这是一个好习惯</span></span>
<span class="line">	wg <span class="token operator">:=</span> <span class="token function">new</span><span class="token punctuation">(</span>sync<span class="token punctuation">.</span>WaitGroup<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 开始工作了</span></span>
<span class="line">	wg<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token keyword">go</span> <span class="token function">worker</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> wg<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 等待任务完成或超时</span></span>
<span class="line">	wg<span class="token punctuation">.</span><span class="token function">Wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre></div></details><details class="hint-container details"><summary>（3）WithValue：可以携带一个值</summary><p>函数签名</p><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">func</span> <span class="token function">WithValue</span><span class="token punctuation">(</span>parent Context<span class="token punctuation">,</span> key<span class="token punctuation">,</span> val any<span class="token punctuation">)</span> Context</span>
<span class="line"></span></code></pre></div><p>示例代码</p><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">package</span> main</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">(</span></span>
<span class="line">	<span class="token string">&quot;context&quot;</span></span>
<span class="line">	<span class="token string">&quot;fmt&quot;</span></span>
<span class="line">	<span class="token string">&quot;log&quot;</span></span>
<span class="line">	<span class="token string">&quot;sync&quot;</span></span>
<span class="line">	<span class="token string">&quot;time&quot;</span></span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">Work</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> wg <span class="token operator">*</span>sync<span class="token punctuation">.</span>WaitGroup<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token keyword">defer</span> wg<span class="token punctuation">.</span><span class="token function">Done</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">5</span><span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span></span>
<span class="line">		log<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span></span>
<span class="line">		time<span class="token punctuation">.</span><span class="token function">Sleep</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span>Second<span class="token punctuation">)</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>ctx<span class="token punctuation">.</span><span class="token function">Value</span><span class="token punctuation">(</span><span class="token string">&quot;key&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token comment">// 初始化</span></span>
<span class="line">	ctx <span class="token operator">:=</span> context<span class="token punctuation">.</span><span class="token function">WithValue</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token function">Background</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;key&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;value&quot;</span><span class="token punctuation">)</span></span>
<span class="line">	wg <span class="token operator">:=</span> <span class="token function">new</span><span class="token punctuation">(</span>sync<span class="token punctuation">.</span>WaitGroup<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 工作</span></span>
<span class="line">	wg<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token keyword">go</span> <span class="token function">Work</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> wg<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 等待工作完成</span></span>
<span class="line">	wg<span class="token punctuation">.</span><span class="token function">Wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre></div></details><br><h2 id="并发原语" tabindex="-1"><a class="header-anchor" href="#并发原语"><span>并发原语</span></a></h2><h3 id="互斥锁和读写锁" tabindex="-1"><a class="header-anchor" href="#互斥锁和读写锁"><span>互斥锁和读写锁</span></a></h3><p>官方文档：<a href="https://pkg.go.dev/sync" target="_blank" rel="noopener noreferrer">https://pkg.go.dev/sync</a></p><p><code>sync</code>是Go的标准库，提供了最基本的同步原语，使用时需要注意：对象一旦被使用就不应该被复制。</p><details class="hint-container details"><summary>（1）锁说明</summary><p>锁接口</p><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token comment">// A Locker represents an object that can be locked and unlocked.</span></span>
<span class="line"><span class="token keyword">type</span> Locker <span class="token keyword">interface</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token function">Lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token function">Unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre></div><p>互斥锁</p><p><code>sync.Mutex</code> 互斥锁，在某一时刻只能有一个协程可以拿到锁，拿不到的会一直阻塞，适合读少写多的场景</p><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token function">Lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token function">Unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>		<span class="token comment">// 加锁/解锁</span></span>
<span class="line"><span class="token function">TryLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>			<span class="token comment">// 尝试获取锁，返回布尔值，此函数不会阻塞</span></span>
<span class="line"></span></code></pre></div><p>读写锁</p><p><code>sync.RWMutex</code> 读写锁，在某一时刻只能由任意的<code>reader</code>持有，或者是只能被单个的<code>writer</code>持有，适合读多写少的场景</p><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token function">Lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token function">Unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>     	<span class="token comment">// 写操作调用的方法</span></span>
<span class="line"><span class="token function">RLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token function">RUnlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>   	<span class="token comment">// 读操作调用的方法</span></span>
<span class="line"><span class="token function">TryLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token function">TryRLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>	<span class="token comment">// 尝试获取锁,不会阻塞</span></span>
<span class="line"><span class="token function">RLocker</span><span class="token punctuation">(</span><span class="token punctuation">)</span>           	<span class="token comment">// 为读操作返回一个Locker接口的对象，他的Lock方法会调用RLock，他的Unlock会调用RUnlock</span></span>
<span class="line"></span></code></pre></div><p><strong>💡 注意：未持有锁的协程也可以释放锁</strong></p></details><details class="hint-container details"><summary>（2）测试代码</summary><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">package</span> main</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">(</span></span>
<span class="line">	<span class="token string">&quot;log&quot;</span></span>
<span class="line">	<span class="token string">&quot;sync&quot;</span></span>
<span class="line">	<span class="token string">&quot;time&quot;</span></span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token keyword">var</span> mu sync<span class="token punctuation">.</span>Mutex</span>
<span class="line">	<span class="token keyword">var</span> wg sync<span class="token punctuation">.</span>WaitGroup</span>
<span class="line"></span>
<span class="line">	wg<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	<span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">		mu<span class="token punctuation">.</span><span class="token function">Lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">		log<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;获取锁&quot;</span><span class="token punctuation">)</span></span>
<span class="line">		wg<span class="token punctuation">.</span><span class="token function">Done</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	<span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">		time<span class="token punctuation">.</span><span class="token function">Sleep</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span>Second<span class="token punctuation">)</span></span>
<span class="line">		mu<span class="token punctuation">.</span><span class="token function">Unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">		log<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;释放锁&quot;</span><span class="token punctuation">)</span></span>
<span class="line">		wg<span class="token punctuation">.</span><span class="token function">Done</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	wg<span class="token punctuation">.</span><span class="token function">Wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token comment">// 未持有锁的协程也可以释放锁，但是非常不推荐这么使用</span></span>
<span class="line"></span></code></pre></div></details><details class="hint-container details"><summary>（3）测试代码</summary><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">package</span> main</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">(</span></span>
<span class="line">	<span class="token string">&quot;log&quot;</span></span>
<span class="line">	<span class="token string">&quot;sync&quot;</span></span>
<span class="line">	<span class="token string">&quot;time&quot;</span></span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token keyword">var</span> wg sync<span class="token punctuation">.</span>WaitGroup</span>
<span class="line">	<span class="token keyword">var</span> mu sync<span class="token punctuation">.</span>Mutex</span>
<span class="line"></span>
<span class="line">	wg<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">		time<span class="token punctuation">.</span><span class="token function">Sleep</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span>Second <span class="token operator">*</span> <span class="token number">1</span><span class="token punctuation">)</span></span>
<span class="line">		mu<span class="token punctuation">.</span><span class="token function">Lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">		log<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;f1 lock&quot;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">		time<span class="token punctuation">.</span><span class="token function">Sleep</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span>Second <span class="token operator">*</span> <span class="token number">10</span><span class="token punctuation">)</span></span>
<span class="line">		mu<span class="token punctuation">.</span><span class="token function">Unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">		log<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;f1 unlock&quot;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">		wg<span class="token punctuation">.</span><span class="token function">Done</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	<span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">		time<span class="token punctuation">.</span><span class="token function">Sleep</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span>Second <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span></span>
<span class="line">		mu<span class="token punctuation">.</span><span class="token function">Unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">		log<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;f2 unlock&quot;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">		time<span class="token punctuation">.</span><span class="token function">Sleep</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span>Second <span class="token operator">*</span> <span class="token number">5</span><span class="token punctuation">)</span></span>
<span class="line">		mu<span class="token punctuation">.</span><span class="token function">Lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">		log<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;f2 lock&quot;</span><span class="token punctuation">)</span></span>
<span class="line">		wg<span class="token punctuation">.</span><span class="token function">Done</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	wg<span class="token punctuation">.</span><span class="token function">Wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">	log<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;End&quot;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre></div></details><br><h3 id="并发安全的map" tabindex="-1"><a class="header-anchor" href="#并发安全的map"><span>并发安全的Map</span></a></h3><details class="hint-container details"><summary>（1）原生Map+读写锁</summary><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">package</span> main</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">(</span></span>
<span class="line">	<span class="token string">&quot;log&quot;</span></span>
<span class="line">	<span class="token string">&quot;sync&quot;</span></span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">type</span> RWMap <span class="token keyword">struct</span> <span class="token punctuation">{</span></span>
<span class="line">	sync<span class="token punctuation">.</span>RWMutex</span>
<span class="line">	m <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">]</span><span class="token builtin">int</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 构造函数</span></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">NewRWMap</span><span class="token punctuation">(</span>n <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token operator">*</span>RWMap <span class="token punctuation">{</span></span>
<span class="line">	<span class="token keyword">return</span> <span class="token operator">&amp;</span>RWMap<span class="token punctuation">{</span></span>
<span class="line">		m<span class="token punctuation">:</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 读操作</span></span>
<span class="line"><span class="token keyword">func</span> <span class="token punctuation">(</span>m <span class="token operator">*</span>RWMap<span class="token punctuation">)</span> <span class="token function">Load</span><span class="token punctuation">(</span>k <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">,</span> <span class="token builtin">bool</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	m<span class="token punctuation">.</span><span class="token function">RLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token keyword">defer</span> m<span class="token punctuation">.</span><span class="token function">RUnlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">	v<span class="token punctuation">,</span> ok <span class="token operator">:=</span> m<span class="token punctuation">.</span>m<span class="token punctuation">[</span>k<span class="token punctuation">]</span></span>
<span class="line">	<span class="token keyword">return</span> v<span class="token punctuation">,</span> ok</span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 写操作</span></span>
<span class="line"><span class="token keyword">func</span> <span class="token punctuation">(</span>m <span class="token operator">*</span>RWMap<span class="token punctuation">)</span> <span class="token function">Store</span><span class="token punctuation">(</span>k <span class="token builtin">int</span><span class="token punctuation">,</span> v <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	m<span class="token punctuation">.</span><span class="token function">Lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token keyword">defer</span> m<span class="token punctuation">.</span><span class="token function">Unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">	m<span class="token punctuation">.</span>m<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> v</span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 删操作</span></span>
<span class="line"><span class="token keyword">func</span> <span class="token punctuation">(</span>m <span class="token operator">*</span>RWMap<span class="token punctuation">)</span> <span class="token function">Delete</span><span class="token punctuation">(</span>k <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	m<span class="token punctuation">.</span><span class="token function">Lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token keyword">defer</span> m<span class="token punctuation">.</span><span class="token function">Unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token function">delete</span><span class="token punctuation">(</span>m<span class="token punctuation">.</span>m<span class="token punctuation">,</span> k<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 遍历操作</span></span>
<span class="line"><span class="token keyword">func</span> <span class="token punctuation">(</span>m <span class="token operator">*</span>RWMap<span class="token punctuation">)</span> <span class="token function">Range</span><span class="token punctuation">(</span>f <span class="token keyword">func</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span> v <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token builtin">bool</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	m<span class="token punctuation">.</span><span class="token function">RLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token keyword">defer</span> m<span class="token punctuation">.</span><span class="token function">RUnlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token keyword">for</span> k<span class="token punctuation">,</span> v <span class="token operator">:=</span> <span class="token keyword">range</span> m<span class="token punctuation">.</span>m <span class="token punctuation">{</span></span>
<span class="line">		<span class="token keyword">if</span> <span class="token operator">!</span><span class="token function">f</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span> v<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">			<span class="token keyword">return</span></span>
<span class="line">		<span class="token punctuation">}</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 复合操作</span></span>
<span class="line"><span class="token keyword">func</span> <span class="token punctuation">(</span>m <span class="token operator">*</span>RWMap<span class="token punctuation">)</span> <span class="token function">LoadAndDelete</span><span class="token punctuation">(</span>k <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">,</span> <span class="token builtin">bool</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	m<span class="token punctuation">.</span><span class="token function">RLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token keyword">defer</span> m<span class="token punctuation">.</span><span class="token function">RUnlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">	v<span class="token punctuation">,</span> ok <span class="token operator">:=</span> m<span class="token punctuation">.</span>m<span class="token punctuation">[</span>k<span class="token punctuation">]</span></span>
<span class="line">	<span class="token function">delete</span><span class="token punctuation">(</span>m<span class="token punctuation">.</span>m<span class="token punctuation">,</span> k<span class="token punctuation">)</span></span>
<span class="line">	<span class="token keyword">return</span> v<span class="token punctuation">,</span> ok</span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token punctuation">(</span>m <span class="token operator">*</span>RWMap<span class="token punctuation">)</span> <span class="token function">LoadAndStore</span><span class="token punctuation">(</span>k <span class="token builtin">int</span><span class="token punctuation">,</span> v <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">,</span> <span class="token builtin">bool</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	m<span class="token punctuation">.</span><span class="token function">RLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token keyword">defer</span> m<span class="token punctuation">.</span><span class="token function">RUnlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">	v<span class="token punctuation">,</span> ok <span class="token operator">:=</span> m<span class="token punctuation">.</span>m<span class="token punctuation">[</span>k<span class="token punctuation">]</span></span>
<span class="line">	<span class="token keyword">if</span> ok <span class="token punctuation">{</span></span>
<span class="line">		<span class="token keyword">return</span> v<span class="token punctuation">,</span> <span class="token boolean">true</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line">	m<span class="token punctuation">.</span>m<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> v</span>
<span class="line">	<span class="token keyword">return</span> v<span class="token punctuation">,</span> <span class="token boolean">false</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 获取大小</span></span>
<span class="line"><span class="token keyword">func</span> <span class="token punctuation">(</span>m <span class="token operator">*</span>RWMap<span class="token punctuation">)</span> <span class="token function">Len</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">int</span> <span class="token punctuation">{</span></span>
<span class="line">	m<span class="token punctuation">.</span><span class="token function">RLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token keyword">defer</span> m<span class="token punctuation">.</span><span class="token function">RUnlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token keyword">return</span> <span class="token function">len</span><span class="token punctuation">(</span>m<span class="token punctuation">.</span>m<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token comment">// 初始化</span></span>
<span class="line">	<span class="token keyword">var</span> wg sync<span class="token punctuation">.</span>WaitGroup</span>
<span class="line">	m <span class="token operator">:=</span> <span class="token function">NewRWMap</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 写数据</span></span>
<span class="line">	log<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;开始写入数据&quot;</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10000000</span><span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span></span>
<span class="line">		wg<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span></span>
<span class="line">		<span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span>i <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">			m<span class="token punctuation">.</span><span class="token function">Store</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> i<span class="token punctuation">)</span></span>
<span class="line">			wg<span class="token punctuation">.</span><span class="token function">Done</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">		<span class="token punctuation">}</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token comment">// 注意这里要将i传入</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line">	wg<span class="token punctuation">.</span><span class="token function">Wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">	log<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;写入数据完成&quot;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 遍历</span></span>
<span class="line">	log<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;开始遍历数据&quot;</span><span class="token punctuation">)</span></span>
<span class="line">	m<span class="token punctuation">.</span><span class="token function">Range</span><span class="token punctuation">(</span><span class="token keyword">func</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span> v <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token builtin">bool</span> <span class="token punctuation">{</span></span>
<span class="line">		<span class="token keyword">if</span> k <span class="token operator">!=</span> v <span class="token punctuation">{</span></span>
<span class="line">			log<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;key is error: %d&quot;</span><span class="token punctuation">,</span> k<span class="token punctuation">)</span></span>
<span class="line">		<span class="token punctuation">}</span></span>
<span class="line">		<span class="token keyword">return</span> <span class="token boolean">true</span></span>
<span class="line">	<span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">	log<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;遍历数据完成&quot;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre></div></details><details class="hint-container details"><summary>（2）标准库 sync.Map</summary><ul><li><p><code>sync.Map</code>是Go为我们提供的并发安全的<code>Map</code>，适用于读多写少的场景</p></li><li><p>与原生<code>map</code> + <code>sync.RWMutex</code>类似，相比而言<code>sync.Map</code>读的性能更好写的性能更差</p></li></ul><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">package</span> main</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">(</span></span>
<span class="line">	<span class="token string">&quot;fmt&quot;</span></span>
<span class="line">	<span class="token string">&quot;sync&quot;</span></span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token keyword">var</span> m sync<span class="token punctuation">.</span>Map</span>
<span class="line">	<span class="token keyword">var</span> wg sync<span class="token punctuation">.</span>WaitGroup</span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 写数据，并发写</span></span>
<span class="line">	<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">20</span><span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span></span>
<span class="line">		wg<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span></span>
<span class="line">		<span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span>i <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">			<span class="token keyword">defer</span> wg<span class="token punctuation">.</span><span class="token function">Done</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">			m<span class="token punctuation">.</span><span class="token function">Store</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> i<span class="token punctuation">)</span></span>
<span class="line">		<span class="token punctuation">}</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line">	wg<span class="token punctuation">.</span><span class="token function">Wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token comment">// 写数据，支持不同的数据类型</span></span>
<span class="line">	m<span class="token punctuation">.</span><span class="token function">Store</span><span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span></span>
<span class="line">	m<span class="token punctuation">.</span><span class="token function">Store</span><span class="token punctuation">(</span><span class="token char">&#39;a&#39;</span><span class="token punctuation">,</span> <span class="token string">&quot;中国&quot;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 读数据</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>m<span class="token punctuation">.</span><span class="token function">Load</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span>            <span class="token comment">// 读取</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>m<span class="token punctuation">.</span><span class="token function">LoadAndDelete</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span>   <span class="token comment">// 读取并删除</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>m<span class="token punctuation">.</span><span class="token function">LoadOrStore</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 读取,第二个返回值代表是否读取到，若读不到则设置value为该值并返回</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 删除数据</span></span>
<span class="line">	m<span class="token punctuation">.</span><span class="token function">Delete</span><span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">)</span> <span class="token comment">// 无返回值</span></span>
<span class="line">	m<span class="token punctuation">.</span><span class="token function">Delete</span><span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 遍历</span></span>
<span class="line">	m<span class="token punctuation">.</span><span class="token function">Range</span><span class="token punctuation">(</span><span class="token keyword">func</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> value any<span class="token punctuation">)</span> <span class="token builtin">bool</span> <span class="token punctuation">{</span></span>
<span class="line">		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">)</span></span>
<span class="line">		<span class="token keyword">return</span> <span class="token boolean">true</span></span>
<span class="line">	<span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre></div></details><details class="hint-container details"><summary>（3）第三方库：通过<code>map</code>分片实现</summary><p><code>Github</code>地址：<a href="https://github.com/orcaman/concurrent-map" target="_blank" rel="noopener noreferrer">https://github.com/orcaman/concurrent-map</a></p><p><code>concurrent-map</code>提供了一种高性能的解决方案:通过对内部<code>map</code>进行分片，降低锁粒度，从而达到最少的锁等待时间(锁冲突)</p><p><strong>实现逻辑</strong></p><ul><li>默认对<code>map</code>分了32片（每一片是一个结构体，每个结构体包含原生Map和读写锁），所有分片存储在一个切片中<code>[]*ConcurrentMapShared</code></li><li>每次操作时(增删改查)，先通过<code>GetShard(key)</code>获取<code>key</code>所在的分片，然后对分片加锁后再操作</li></ul><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">package</span> main</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">(</span></span>
<span class="line">	<span class="token string">&quot;github.com/orcaman/concurrent-map&quot;</span></span>
<span class="line">	<span class="token string">&quot;log&quot;</span></span>
<span class="line">	<span class="token string">&quot;strconv&quot;</span></span>
<span class="line">	<span class="token string">&quot;sync&quot;</span></span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token comment">// 初始化</span></span>
<span class="line">	<span class="token keyword">var</span> wg sync<span class="token punctuation">.</span>WaitGroup</span>
<span class="line">	m <span class="token operator">:=</span> cmap<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 初始化Map</span></span>
<span class="line">	loop <span class="token operator">:=</span> <span class="token number">1000000</span> <span class="token comment">// 循环次数</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 写数据，值必须为string，这是代码里写死的</span></span>
<span class="line">	<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> loop<span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span></span>
<span class="line">		wg<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span></span>
<span class="line">		<span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span>i <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">			<span class="token keyword">defer</span> wg<span class="token punctuation">.</span><span class="token function">Done</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">			m<span class="token punctuation">.</span><span class="token function">Set</span><span class="token punctuation">(</span>strconv<span class="token punctuation">.</span><span class="token function">Itoa</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">,</span> i<span class="token operator">*</span>i<span class="token punctuation">)</span></span>
<span class="line">		<span class="token punctuation">}</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line">	wg<span class="token punctuation">.</span><span class="token function">Wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 获取数据并校验</span></span>
<span class="line">	<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> loop<span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span></span>
<span class="line">		wg<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span></span>
<span class="line">		<span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span>i <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">			<span class="token keyword">defer</span> wg<span class="token punctuation">.</span><span class="token function">Done</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">			<span class="token keyword">if</span> v<span class="token punctuation">,</span> ok <span class="token operator">:=</span> m<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span>strconv<span class="token punctuation">.</span><span class="token function">Itoa</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> ok <span class="token punctuation">{</span></span>
<span class="line">				<span class="token keyword">if</span> v <span class="token operator">!=</span> i<span class="token operator">*</span>i <span class="token punctuation">{</span></span>
<span class="line">					log<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;key err: %d\n&quot;</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span></span>
<span class="line">				<span class="token punctuation">}</span></span>
<span class="line">			<span class="token punctuation">}</span></span>
<span class="line">		<span class="token punctuation">}</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line">	wg<span class="token punctuation">.</span><span class="token function">Wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre></div></details><br><h3 id="确保只执行一次" tabindex="-1"><a class="header-anchor" href="#确保只执行一次"><span>确保只执行一次</span></a></h3><p><code>sync.Once</code>只暴露了一个方法<code>Do</code>,多次调用<code>Do</code>方法，但是只有第一次调用<code>Do</code>方法时参数<code>f</code>函数才会执行，<code>f</code>函数是无参数无返回值的函数</p><details class="hint-container details"><summary>单例模式与重置</summary><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">package</span> main</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">(</span></span>
<span class="line">	<span class="token string">&quot;fmt&quot;</span></span>
<span class="line">	<span class="token string">&quot;sync&quot;</span></span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">type</span> Person <span class="token keyword">struct</span> <span class="token punctuation">{</span></span>
<span class="line">	name <span class="token builtin">string</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">var</span> <span class="token punctuation">(</span></span>
<span class="line">	once   sync<span class="token punctuation">.</span>Once</span>
<span class="line">	person <span class="token operator">*</span>Person</span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">NewPerson</span><span class="token punctuation">(</span>name <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token operator">*</span>Person <span class="token punctuation">{</span></span>
<span class="line">	once<span class="token punctuation">.</span><span class="token function">Do</span><span class="token punctuation">(</span><span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">		person <span class="token operator">=</span> <span class="token operator">&amp;</span>Person<span class="token punctuation">{</span>name<span class="token punctuation">:</span> name<span class="token punctuation">}</span></span>
<span class="line">	<span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token keyword">return</span> person</span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">RestPerson</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	once <span class="token operator">=</span> sync<span class="token punctuation">.</span>Once<span class="token punctuation">{</span><span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token comment">// 单例模式</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%p\n&quot;</span><span class="token punctuation">,</span> <span class="token function">NewPerson</span><span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%p\n&quot;</span><span class="token punctuation">,</span> <span class="token function">NewPerson</span><span class="token punctuation">(</span><span class="token string">&quot;b&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 重置</span></span>
<span class="line">	<span class="token function">RestPerson</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    </span>
<span class="line">    <span class="token comment">// 继续单例模式</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%p\n&quot;</span><span class="token punctuation">,</span> <span class="token function">NewPerson</span><span class="token punctuation">(</span><span class="token string">&quot;c&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%p\n&quot;</span><span class="token punctuation">,</span> <span class="token function">NewPerson</span><span class="token punctuation">(</span><span class="token string">&quot;d&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 输出结果</span></span>
<span class="line"><span class="token comment">// 0xc00004a250</span></span>
<span class="line"><span class="token comment">// 0xc00004a250</span></span>
<span class="line"><span class="token comment">// 0xc00004a260</span></span>
<span class="line"><span class="token comment">// 0xc00004a260</span></span>
<span class="line"></span></code></pre></div><blockquote><p>👀 其他方式实现单例模式</p><p>方法1：定义包级别的变量<br> 方法2：包级别<code>init</code>函数初始化<br> 方法3：在<code>main</code>函数中，执行一个初始化函数</p></blockquote></details><br><h3 id="缓存池提高性能" tabindex="-1"><a class="header-anchor" href="#缓存池提高性能"><span>缓存池提高性能</span></a></h3><p><code>sync.Pool</code>是一个临时缓存池，并发安全</p><p><strong>注意事项</strong></p><ul><li>池对象可以随时被垃圾回收掉，所以HTTP长连接、数据库长连接等不适合使用它</li><li>池中要放入引用类型的对象，不然是对象的拷贝则起不到缓存池的作用</li><li>在对象用完以后，放入池中之前，最好做一下清理工作，不然下次从池中会拿到一个有使用痕迹的对象</li><li><code>Get()</code>和<code>Put(x)</code>是并发安全的，但是<code>New()</code>不是并发安全的，但是并不影响我们使用</li></ul><details class="hint-container details"><summary>（1）基本使用</summary><p><strong>定义和方法</strong></p><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token comment">// sync.Pool结构体定义</span></span>
<span class="line"><span class="token keyword">type</span> Pool <span class="token keyword">struct</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token operator">...</span> 			<span class="token comment">// 忽略</span></span>
<span class="line">	New <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> any	<span class="token comment">// 当池为空时会调用此方法来创建对象并放入池中</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// sync.Pool结构体方法</span></span>
<span class="line"><span class="token keyword">func</span> <span class="token punctuation">(</span>p <span class="token operator">*</span>Pool<span class="token punctuation">)</span> <span class="token function">Get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> any <span class="token punctuation">{</span><span class="token punctuation">}</span>		<span class="token comment">// 从池中取走一个元素，同时会在池中删除这个元素</span></span>
<span class="line">								<span class="token comment">// 如果Pool中没有元素了，会使用结构体的New方法创建一个元素</span></span>
<span class="line">        						<span class="token comment">// 如果结构体没有定义New方法，那么Get方法会返回nil，所以在使用Get时要判断nil的情况</span></span>
<span class="line"><span class="token keyword">func</span> <span class="token punctuation">(</span>p <span class="token operator">*</span>Pool<span class="token punctuation">)</span> <span class="token function">Put</span><span class="token punctuation">(</span>x any<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>	<span class="token comment">// 将元素放到Pool，如果元素为nil，那么Pool会忽略这个值</span></span>
<span class="line"></span></code></pre></div><p><strong>基本使用</strong></p><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">package</span> main</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">(</span></span>
<span class="line">	<span class="token string">&quot;fmt&quot;</span></span>
<span class="line">	<span class="token string">&quot;sync&quot;</span></span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">type</span> User <span class="token keyword">struct</span> <span class="token punctuation">{</span></span>
<span class="line">	Name <span class="token builtin">string</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token punctuation">(</span>u <span class="token operator">*</span>User<span class="token punctuation">)</span> <span class="token function">Clean</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	u<span class="token punctuation">.</span>Name <span class="token operator">=</span> <span class="token string">&quot;&quot;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token comment">// 初始化池</span></span>
<span class="line">	pool <span class="token operator">:=</span> <span class="token operator">&amp;</span>sync<span class="token punctuation">.</span>Pool<span class="token punctuation">{</span></span>
<span class="line">		New<span class="token punctuation">:</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token punctuation">{</span></span>
<span class="line">			<span class="token keyword">return</span> <span class="token function">new</span><span class="token punctuation">(</span>User<span class="token punctuation">)</span></span>
<span class="line">		<span class="token punctuation">}</span><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 从池中获取对象</span></span>
<span class="line">	user <span class="token operator">:=</span> pool<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token operator">*</span>User<span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%#v %p\n&quot;</span><span class="token punctuation">,</span> user<span class="token punctuation">,</span> user<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 使用对象</span></span>
<span class="line">	user<span class="token punctuation">.</span>Name <span class="token operator">=</span> <span class="token string">&quot;bob&quot;</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%#v %p\n&quot;</span><span class="token punctuation">,</span> user<span class="token punctuation">,</span> user<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 用完了，放回池中</span></span>
<span class="line">	user<span class="token punctuation">.</span><span class="token function">Clean</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 放回池之前执行清理工作，不然下次从池中会拿到一个有使用痕迹的对象</span></span>
<span class="line">	pool<span class="token punctuation">.</span><span class="token function">Put</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 再次申请一个</span></span>
<span class="line">	user2 <span class="token operator">:=</span> pool<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token operator">*</span>User<span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%#v %p\n&quot;</span><span class="token punctuation">,</span> user2<span class="token punctuation">,</span> user2<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 输出结果</span></span>
<span class="line"><span class="token comment">// &amp;main.User{Name:&quot;&quot;} 0xc00004a250</span></span>
<span class="line"><span class="token comment">// &amp;main.User{Name:&quot;bob&quot;} 0xc00004a250</span></span>
<span class="line"><span class="token comment">// &amp;main.User{Name:&quot;&quot;} 0xc00004a250</span></span>
<span class="line"></span></code></pre></div></details><br><h3 id="并发安全的字节池" tabindex="-1"><a class="header-anchor" href="#并发安全的字节池"><span>并发安全的字节池</span></a></h3><details class="hint-container details"><summary>（1）sync.Pool实现</summary><p>代码来自<code>Hugo</code>：<a href="https://github.com/gohugoio/hugo" target="_blank" rel="noopener noreferrer">https://github.com/gohugoio/hugo</a></p><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">package</span> main</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">(</span></span>
<span class="line">	<span class="token string">&quot;bytes&quot;</span></span>
<span class="line">	<span class="token string">&quot;fmt&quot;</span></span>
<span class="line">	<span class="token string">&quot;sync&quot;</span></span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">var</span> bufferPool <span class="token operator">=</span> <span class="token operator">&amp;</span>sync<span class="token punctuation">.</span>Pool<span class="token punctuation">{</span></span>
<span class="line">	New<span class="token punctuation">:</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> any <span class="token punctuation">{</span></span>
<span class="line">		<span class="token keyword">return</span> <span class="token operator">&amp;</span>bytes<span class="token punctuation">.</span>Buffer<span class="token punctuation">{</span><span class="token punctuation">}</span></span>
<span class="line">	<span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// GetBuffer returns a buffer from the pool.</span></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">GetBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>buf <span class="token operator">*</span>bytes<span class="token punctuation">.</span>Buffer<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token keyword">return</span> bufferPool<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token operator">*</span>bytes<span class="token punctuation">.</span>Buffer<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// PutBuffer returns a buffer to the pool.</span></span>
<span class="line"><span class="token comment">// The buffer is reset before it is put back into circulation.</span></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">PutBuffer</span><span class="token punctuation">(</span>buf <span class="token operator">*</span>bytes<span class="token punctuation">.</span>Buffer<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	buf<span class="token punctuation">.</span><span class="token function">Reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">	bufferPool<span class="token punctuation">.</span><span class="token function">Put</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token comment">// 从池子取出对象</span></span>
<span class="line">	buf <span class="token operator">:=</span> <span class="token function">GetBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;长度: %d | 容量: %d\n&quot;</span><span class="token punctuation">,</span> buf<span class="token punctuation">.</span><span class="token function">Len</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> buf<span class="token punctuation">.</span><span class="token function">Cap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 使用</span></span>
<span class="line">	<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10000</span><span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span></span>
<span class="line">		buf<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span><span class="token string">&quot;Hello&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;长度: %d | 容量: %d\n&quot;</span><span class="token punctuation">,</span> buf<span class="token punctuation">.</span><span class="token function">Len</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> buf<span class="token punctuation">.</span><span class="token function">Cap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 放入池子</span></span>
<span class="line">	<span class="token function">PutBuffer</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 再次从池子取出</span></span>
<span class="line">	buf2 <span class="token operator">:=</span> <span class="token function">GetBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;长度: %d | 容量: %d\n&quot;</span><span class="token punctuation">,</span> buf2<span class="token punctuation">.</span><span class="token function">Len</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> buf2<span class="token punctuation">.</span><span class="token function">Cap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre></div></details><details class="hint-container details"><summary>（2）使用channel实现</summary><p>代码来自minio：<a href="https://github.com/minio/minio" target="_blank" rel="noopener noreferrer">https://github.com/minio/minio</a></p><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">package</span> main</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token string">&quot;fmt&quot;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// BytePoolCap implements a leaky pool of []byte in the form of a bounded channel.</span></span>
<span class="line"><span class="token keyword">type</span> BytePoolCap <span class="token keyword">struct</span> <span class="token punctuation">{</span></span>
<span class="line">	c    <span class="token keyword">chan</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span></span>
<span class="line">	w    <span class="token builtin">int</span></span>
<span class="line">	wcap <span class="token builtin">int</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// NewBytePoolCap creates a new BytePool bounded to the given maxSize, with new</span></span>
<span class="line"><span class="token comment">// byte arrays sized based on width.</span></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">NewBytePoolCap</span><span class="token punctuation">(</span>maxSize <span class="token builtin">int</span><span class="token punctuation">,</span> width <span class="token builtin">int</span><span class="token punctuation">,</span> capwidth <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>bp <span class="token operator">*</span>BytePoolCap<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token keyword">return</span> <span class="token operator">&amp;</span>BytePoolCap<span class="token punctuation">{</span></span>
<span class="line">		c<span class="token punctuation">:</span>    <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span><span class="token punctuation">,</span> maxSize<span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">		w<span class="token punctuation">:</span>    width<span class="token punctuation">,</span></span>
<span class="line">		wcap<span class="token punctuation">:</span> capwidth<span class="token punctuation">,</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// Get gets a []byte from the BytePool, or creates a new one if none are</span></span>
<span class="line"><span class="token comment">// available in the pool.</span></span>
<span class="line"><span class="token keyword">func</span> <span class="token punctuation">(</span>bp <span class="token operator">*</span>BytePoolCap<span class="token punctuation">)</span> <span class="token function">Get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>b <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token keyword">select</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token keyword">case</span> b <span class="token operator">=</span> <span class="token operator">&lt;-</span>bp<span class="token punctuation">.</span>c<span class="token punctuation">:</span></span>
<span class="line">	<span class="token comment">// reuse existing buffer</span></span>
<span class="line">	<span class="token keyword">default</span><span class="token punctuation">:</span></span>
<span class="line">		<span class="token comment">// create new buffer</span></span>
<span class="line">		<span class="token keyword">if</span> bp<span class="token punctuation">.</span>wcap <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token punctuation">{</span></span>
<span class="line">			b <span class="token operator">=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span><span class="token punctuation">,</span> bp<span class="token punctuation">.</span>w<span class="token punctuation">,</span> bp<span class="token punctuation">.</span>wcap<span class="token punctuation">)</span></span>
<span class="line">		<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">			b <span class="token operator">=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span><span class="token punctuation">,</span> bp<span class="token punctuation">.</span>w<span class="token punctuation">)</span></span>
<span class="line">		<span class="token punctuation">}</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line">	<span class="token keyword">return</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// Put returns the given Buffer to the BytePool.</span></span>
<span class="line"><span class="token keyword">func</span> <span class="token punctuation">(</span>bp <span class="token operator">*</span>BytePoolCap<span class="token punctuation">)</span> <span class="token function">Put</span><span class="token punctuation">(</span>b <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token keyword">select</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token keyword">case</span> bp<span class="token punctuation">.</span>c <span class="token operator">&lt;-</span> b<span class="token punctuation">:</span></span>
<span class="line">		<span class="token comment">// buffer went back into pool</span></span>
<span class="line">	<span class="token keyword">default</span><span class="token punctuation">:</span></span>
<span class="line">		<span class="token comment">// buffer didn&#39;t go back into pool, just discard</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// Width returns the width of the byte arrays in this pool.</span></span>
<span class="line"><span class="token keyword">func</span> <span class="token punctuation">(</span>bp <span class="token operator">*</span>BytePoolCap<span class="token punctuation">)</span> <span class="token function">Width</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>n <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token keyword">return</span> bp<span class="token punctuation">.</span>w</span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// WidthCap returns the cap width of the byte arrays in this pool.</span></span>
<span class="line"><span class="token keyword">func</span> <span class="token punctuation">(</span>bp <span class="token operator">*</span>BytePoolCap<span class="token punctuation">)</span> <span class="token function">WidthCap</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>n <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token keyword">return</span> bp<span class="token punctuation">.</span>wcap</span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token comment">// 初始化池子</span></span>
<span class="line">	pool <span class="token operator">:=</span> <span class="token function">NewBytePoolCap</span><span class="token punctuation">(</span><span class="token number">10000</span><span class="token punctuation">,</span> <span class="token number">512</span><span class="token punctuation">,</span> <span class="token number">512</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 从池子取出对象</span></span>
<span class="line">	buf <span class="token operator">:=</span> pool<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;长度: %d | 容量: %d\n&quot;</span><span class="token punctuation">,</span> <span class="token function">len</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">cap</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 使用</span></span>
<span class="line">	<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10000</span><span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span></span>
<span class="line">		buf <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span> <span class="token char">&#39;h&#39;</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;长度: %d | 容量: %d\n&quot;</span><span class="token punctuation">,</span> <span class="token function">len</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">cap</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 放入池子</span></span>
<span class="line">	pool<span class="token punctuation">.</span><span class="token function">Put</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 再次从池子取出</span></span>
<span class="line">	buf2 <span class="token operator">:=</span> pool<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;长度: %d | 容量: %d\n&quot;</span><span class="token punctuation">,</span> <span class="token function">len</span><span class="token punctuation">(</span>buf2<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">cap</span><span class="token punctuation">(</span>buf2<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre></div></details><details class="hint-container details"><summary>（3）注意事项：内存泄漏问题</summary><p>描述：当<code>byte</code>很大的时候，再放入池子，就会引起内存泄漏</p><p>解决：放回池子时判断<code>Byte</code>大小，如果很大就直接丢弃</p><p>参考：</p><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token comment">// fmt包print.go文件</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 定义池子</span></span>
<span class="line"><span class="token keyword">var</span> ppFree <span class="token operator">=</span> sync<span class="token punctuation">.</span>Pool<span class="token punctuation">{</span></span>
<span class="line">	New<span class="token punctuation">:</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> any <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token function">new</span><span class="token punctuation">(</span>pp<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 放回池子操作</span></span>
<span class="line"><span class="token keyword">func</span> <span class="token punctuation">(</span>p <span class="token operator">*</span>pp<span class="token punctuation">)</span> <span class="token function">free</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token comment">// Proper usage of a sync.Pool requires each entry to have approximately</span></span>
<span class="line">	<span class="token comment">// the same memory cost. To obtain this property when the stored type</span></span>
<span class="line">	<span class="token comment">// contains a variably-sized buffer, we add a hard limit on the maximum buffer</span></span>
<span class="line">	<span class="token comment">// to place back in the pool.</span></span>
<span class="line">	<span class="token comment">//</span></span>
<span class="line">	<span class="token comment">// See https://golang.org/issue/23199</span></span>
<span class="line">	<span class="token keyword">if</span> <span class="token function">cap</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span>buf<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">64</span><span class="token operator">&lt;&lt;</span><span class="token number">10</span> <span class="token punctuation">{</span>	<span class="token comment">// 容量过大则丢弃</span></span>
<span class="line">		<span class="token keyword">return</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">	p<span class="token punctuation">.</span>buf <span class="token operator">=</span> p<span class="token punctuation">.</span>buf<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span></span>
<span class="line">	p<span class="token punctuation">.</span>arg <span class="token operator">=</span> <span class="token boolean">nil</span></span>
<span class="line">	p<span class="token punctuation">.</span>value <span class="token operator">=</span> reflect<span class="token punctuation">.</span>Value<span class="token punctuation">{</span><span class="token punctuation">}</span></span>
<span class="line">	p<span class="token punctuation">.</span>wrappedErr <span class="token operator">=</span> <span class="token boolean">nil</span></span>
<span class="line">	ppFree<span class="token punctuation">.</span><span class="token function">Put</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre></div></details><details class="hint-container details"><summary>（4）注意事项：内存浪费问题</summary><p>描述：如果池子内的<code>buffer</code>比较大，但是实际用的话比较小，就存在浪费问题了</p><p>解决：定义多种规格的池子，按需使用</p><p>参考：</p><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token comment">// net/http包server.go</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">var</span> <span class="token punctuation">(</span></span>
<span class="line">	bufioReaderPool   sync<span class="token punctuation">.</span>Pool</span>
<span class="line">	bufioWriter2kPool sync<span class="token punctuation">.</span>Pool</span>
<span class="line">	bufioWriter4kPool sync<span class="token punctuation">.</span>Pool</span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre></div></details><br><h3 id="条件变量基础使用" tabindex="-1"><a class="header-anchor" href="#条件变量基础使用"><span>条件变量基础使用</span></a></h3><p><code>sync.Cond</code>并不被推荐使用，这里权当了解一下</p><details class="hint-container details"><summary>点击查看完整代码</summary><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">package</span> main</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">(</span></span>
<span class="line">	<span class="token string">&quot;log&quot;</span></span>
<span class="line">	<span class="token string">&quot;sync&quot;</span></span>
<span class="line">	<span class="token string">&quot;time&quot;</span></span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">var</span> done <span class="token operator">=</span> <span class="token boolean">false</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">read</span><span class="token punctuation">(</span>name <span class="token builtin">string</span><span class="token punctuation">,</span> c <span class="token operator">*</span>sync<span class="token punctuation">.</span>Cond<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	c<span class="token punctuation">.</span>L<span class="token punctuation">.</span><span class="token function">Lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token keyword">for</span> <span class="token operator">!</span>done <span class="token punctuation">{</span></span>
<span class="line">		c<span class="token punctuation">.</span><span class="token function">Wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 会释放锁，被唤醒时又会重新获得锁</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line">	log<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> <span class="token string">&quot;starts reading&quot;</span><span class="token punctuation">)</span></span>
<span class="line">	c<span class="token punctuation">.</span>L<span class="token punctuation">.</span><span class="token function">Unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">write</span><span class="token punctuation">(</span>name <span class="token builtin">string</span><span class="token punctuation">,</span> c <span class="token operator">*</span>sync<span class="token punctuation">.</span>Cond<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	log<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> <span class="token string">&quot;starts writing&quot;</span><span class="token punctuation">)</span></span>
<span class="line">	time<span class="token punctuation">.</span><span class="token function">Sleep</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span>Second<span class="token punctuation">)</span></span>
<span class="line">	c<span class="token punctuation">.</span>L<span class="token punctuation">.</span><span class="token function">Lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">	done <span class="token operator">=</span> <span class="token boolean">true</span></span>
<span class="line">	c<span class="token punctuation">.</span>L<span class="token punctuation">.</span><span class="token function">Unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">	log<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> <span class="token string">&quot;wakes all&quot;</span><span class="token punctuation">)</span></span>
<span class="line">	c<span class="token punctuation">.</span><span class="token function">Broadcast</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	cond <span class="token operator">:=</span> sync<span class="token punctuation">.</span><span class="token function">NewCond</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>sync<span class="token punctuation">.</span>Mutex<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	<span class="token keyword">go</span> <span class="token function">read</span><span class="token punctuation">(</span><span class="token string">&quot;reader1&quot;</span><span class="token punctuation">,</span> cond<span class="token punctuation">)</span></span>
<span class="line">	<span class="token keyword">go</span> <span class="token function">read</span><span class="token punctuation">(</span><span class="token string">&quot;reader2&quot;</span><span class="token punctuation">,</span> cond<span class="token punctuation">)</span></span>
<span class="line">	<span class="token keyword">go</span> <span class="token function">read</span><span class="token punctuation">(</span><span class="token string">&quot;reader3&quot;</span><span class="token punctuation">,</span> cond<span class="token punctuation">)</span></span>
<span class="line">	<span class="token function">write</span><span class="token punctuation">(</span><span class="token string">&quot;writer&quot;</span><span class="token punctuation">,</span> cond<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	time<span class="token punctuation">.</span><span class="token function">Sleep</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span>Second <span class="token operator">*</span> <span class="token number">3</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre></div></details><br><h3 id="原子操作无锁并发" tabindex="-1"><a class="header-anchor" href="#原子操作无锁并发"><span>原子操作无锁并发</span></a></h3><p>官方文档：<a href="https://pkg.go.dev/sync/atomic" target="_blank" rel="noopener noreferrer">https://pkg.go.dev/sync/atomic</a></p><p><code>sync/atomic</code>包提供了一系列原子相关操作</p><p><strong>特点</strong></p><ul><li>原子操作是不允许中断的（<code>interrupt</code>），所以可以实现无锁并发（<code>lock-free</code>）</li><li>原子操作是不允许中断的（<code>interrupt</code>），所以它必须很快，所以提供的原子方法数量很少</li><li>原子操作由底层硬件实现，<code>Mutex</code>是由操作系统实现的，所以原子操作性能更好</li></ul><details class="hint-container details"><summary>（1）基本数据类型-原子操作方法</summary><table><thead><tr><th>分类</th><th>方法</th><th>说明</th></tr></thead><tbody><tr><td>加减法</td><td>(1)<code>AddInt32(addr *int32, delta int32) (new int32)</code><br>(2)<code>AddInt64(addr *int64, delta int64) (new int64)</code><br>(3)<code>AddUint32(addr *uint32, delta uint32) (new uint32)</code><br>(4)<code>AddUint64(addr *uint64, delta uint64) (new uint64)</code><br>(5)<code>AddUintptr(addr *uintptr, delta uintptr) (new uintptr)</code></td><td>（1）减法需要注意：<br>对于<code>Int</code>类型，加一个负数即可<br>对于<code>Uint</code>类型，使用位运算来得到负数<br>（2）这个只支持5种数据类型</td></tr><tr><td>交换</td><td>(1)<code>SwapInt32(addr *int32, new int32) (old int32)</code><br>(2)<code>SwapInt64(addr *int64, new int64) (old int64)</code><br>(3)<code>SwapUint32(addr *uint32, new uint32) (old uint32)</code><br>(4)<code>SwapUint64(addr *uint64, new uint64) (old uint64)</code><br>(5)<code>SwapUintptr(addr *uintptr, new uintptr) (old uintptr)</code><br>(6)<code>SwapPointer(addr *unsafe.Pointer, new unsafe.Pointer) (old unsafe.Pointer)</code></td><td>&quot;赋值&quot;并返回旧值</td></tr><tr><td>比较并交换</td><td>(1)<code>CompareAndSwapInt32(addr *int32, old, new int32) (swapped bool)</code><br>(2)<code>CompareAndSwapInt64(addr *int64, old, new int64) (swapped bool)</code><br>(3)<code>CompareAndSwapUint32(addr *uint32, old, new uint32) (swapped bool)</code><br>(4)<code>CompareAndSwapUint64(addr *uint64, old, new uint64) (swapped bool)</code><br>(5)<code>CompareAndSwapUintptr(addr *uintptr, old, new uintptr) (swapped bool)</code><br>(6)<code>CompareAndSwapPointer(addr *unsafe.Pointer, old, new unsafe.Pointer) (swapped bool)</code></td><td>&quot;比较并赋值&quot;并返回旧值</td></tr><tr><td>加载</td><td>(1)<code>LoadInt32(addr *int32) (val int32)</code><br>(2)<code>LoadInt64(addr *int64) (val int64)</code><br>(3)<code>LoadUint32(addr *uint32) (val uint32)</code><br>(4)<code>LoadUint64(addr *uint64) (val uint64)</code><br>(5)<code>LoadUintptr(addr *uintptr) (val uintptr)</code><br>(6)<code>LoadPointer(addr *unsafe.Pointer) (val unsafe.Pointer)</code></td><td>&quot;读取&quot;变量的值</td></tr><tr><td>存储</td><td>(1)<code>StoreInt32(addr *int32, val int32)</code><br>(2)<code>StoreInt64(addr *int64, val int64)</code><br>(3)<code>StoreUint32(addr *uint32, val uint32)</code><br>(4)<code>StoreUint64(addr *uint64, val uint64)</code><br>(5)<code>StoreUintptr(addr *uintptr, val uintptr)</code><br>(6)<code>StorePointer(addr *unsafe.Pointer, val unsafe.Pointer)</code></td><td>&quot;赋值&quot;不会返回旧值<br>这个和<code>Swap</code>系列函数很像</td></tr></tbody></table></details><details class="hint-container details"><summary>（2）基本数据类型-原子操作示例</summary><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">package</span> main</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">(</span></span>
<span class="line">	<span class="token string">&quot;fmt&quot;</span></span>
<span class="line">	<span class="token string">&quot;sync/atomic&quot;</span></span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">Add</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token comment">// 加法</span></span>
<span class="line">	<span class="token keyword">var</span> x <span class="token builtin">int32</span> <span class="token operator">=</span> <span class="token number">100</span></span>
<span class="line">	<span class="token keyword">var</span> y <span class="token builtin">uint32</span> <span class="token operator">=</span> <span class="token number">1000</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 因为x是有符号整数，可以减法可以写成加法，-1 -&gt; + -1</span></span>
<span class="line">	atomic<span class="token punctuation">.</span><span class="token function">AddInt32</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>x<span class="token punctuation">,</span> <span class="token function">int32</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 因为y是无符号整数，所以不能使用uint32(-1)</span></span>
<span class="line">	<span class="token comment">// 这时候可以使用^作为一元运算符使用，按位取反，得到类似-1的效果</span></span>
<span class="line">	atomic<span class="token punctuation">.</span><span class="token function">AddUint32</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>y<span class="token punctuation">,</span> <span class="token operator">^</span><span class="token function">uint32</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;加减法:\n&quot;</span><span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;x = %d\n&quot;</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;y = %d\n&quot;</span><span class="token punctuation">,</span> y<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">Swap</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;\n交换:\n&quot;</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token keyword">var</span> x <span class="token builtin">int32</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">100</span></span>
<span class="line">	<span class="token keyword">var</span> y <span class="token builtin">int32</span> <span class="token operator">=</span> <span class="token number">200</span></span>
<span class="line">	old <span class="token operator">:=</span> atomic<span class="token punctuation">.</span><span class="token function">SwapInt32</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span> <span class="token comment">// y值保持不变，x值更新为y值，old为x的旧值</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;x = %d\n&quot;</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;y = %d\n&quot;</span><span class="token punctuation">,</span> y<span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;old = %d\n&quot;</span><span class="token punctuation">,</span> old<span class="token punctuation">)</span>	</span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">CompareAndSwap</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token comment">// 先比较，再决定是否覆盖</span></span>
<span class="line">	<span class="token comment">// 如果x == y，那么用z覆盖x，并返回true</span></span>
<span class="line">	<span class="token comment">// 如果x != y，那么什么都不做，并返回false</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;\n比较并交换:\n&quot;</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token keyword">var</span> x <span class="token builtin">int32</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">300</span></span>
<span class="line">	<span class="token keyword">var</span> y <span class="token builtin">int32</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">300</span></span>
<span class="line">	<span class="token keyword">var</span> z <span class="token builtin">int32</span> <span class="token operator">=</span> <span class="token number">400</span></span>
<span class="line">	<span class="token keyword">if</span> atomic<span class="token punctuation">.</span><span class="token function">CompareAndSwapInt32</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> z<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">		fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;比较并交换成功: %d %d %d\n&quot;</span><span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> z<span class="token punctuation">)</span></span>
<span class="line">	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">		fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;比较并交换失败: %d %d %d\n&quot;</span><span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> z<span class="token punctuation">)</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">Load</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;\n加载:\n&quot;</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token keyword">var</span> x <span class="token builtin">int32</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">999</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;x = %d\n&quot;</span><span class="token punctuation">,</span> atomic<span class="token punctuation">.</span><span class="token function">LoadInt32</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// -999</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">Store</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;\n存储:\n&quot;</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token keyword">var</span> x <span class="token builtin">int32</span> <span class="token operator">=</span> <span class="token number">888</span></span>
<span class="line">	atomic<span class="token punctuation">.</span><span class="token function">StoreInt32</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>x<span class="token punctuation">,</span> <span class="token function">int32</span><span class="token punctuation">(</span><span class="token number">222</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;x = %d\n&quot;</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span> <span class="token comment">// 222</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token function">Add</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token function">Swap</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token function">CompareAndSwap</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token function">Load</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token function">Store</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre></div><p>输出结果</p><div class="language-bash" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line">加减法:</span>
<span class="line">x <span class="token operator">=</span> <span class="token number">99</span>                      </span>
<span class="line">y <span class="token operator">=</span> <span class="token number">999</span>                     </span>
<span class="line">                            </span>
<span class="line">交换:                       </span>
<span class="line">x <span class="token operator">=</span> <span class="token number">200</span>                     </span>
<span class="line">y <span class="token operator">=</span> <span class="token number">200</span>                     </span>
<span class="line">old <span class="token operator">=</span> <span class="token parameter variable">-100</span>                  </span>
<span class="line">                            </span>
<span class="line">比较并交换:                 </span>
<span class="line">比较并交换成功: <span class="token number">400</span> <span class="token parameter variable">-300</span> <span class="token number">400</span></span>
<span class="line">                            </span>
<span class="line">载入:                       </span>
<span class="line">x <span class="token operator">=</span> <span class="token parameter variable">-999</span>                    </span>
<span class="line">                            </span>
<span class="line">存储:                       </span>
<span class="line">x <span class="token operator">=</span> <span class="token number">222</span></span>
<span class="line"></span></code></pre></div></details><details class="hint-container details"><summary>（3）任意数据类型-原子操作示例</summary><p>如果是其他类型的数据，<code>atomic</code>为我们提供了<code>Value</code>结构体来原子操作</p><p>注意事项</p><ul><li>默认为<code>nil</code>值</li><li>原子值存储的第一个值，决定了它今后能且只能存储哪一个类型的值</li><li>切片、映射等不支持&quot;比较并交换&quot;</li></ul><p>示例代码</p><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">package</span> main</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">(</span></span>
<span class="line">	<span class="token string">&quot;fmt&quot;</span></span>
<span class="line">	<span class="token string">&quot;sync/atomic&quot;</span></span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token comment">// 初始化</span></span>
<span class="line">	<span class="token keyword">var</span> v atomic<span class="token punctuation">.</span>Value</span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 存储任意数据类型</span></span>
<span class="line">	v<span class="token punctuation">.</span><span class="token function">Store</span><span class="token punctuation">(</span><span class="token string">&quot;hello&quot;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 加载任意数据类型</span></span>
<span class="line">	x <span class="token operator">:=</span> v<span class="token punctuation">.</span><span class="token function">Load</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token builtin">string</span><span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;x的数据类型: %T | x的值: %#v\n&quot;</span><span class="token punctuation">,</span> x<span class="token punctuation">,</span> x<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 交换</span></span>
<span class="line">	v<span class="token punctuation">.</span><span class="token function">Swap</span><span class="token punctuation">(</span><span class="token string">&quot;world!&quot;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 比较并交换</span></span>
<span class="line">	<span class="token keyword">if</span> v<span class="token punctuation">.</span><span class="token function">CompareAndSwap</span><span class="token punctuation">(</span><span class="token string">&quot;world!&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;hello world!&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">		fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;比较并交换成功: %s\n&quot;</span><span class="token punctuation">,</span> v<span class="token punctuation">.</span><span class="token function">Load</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">		fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;比较并交换失败: %s\n&quot;</span><span class="token punctuation">,</span> v<span class="token punctuation">.</span><span class="token function">Load</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre></div></details><details class="hint-container details"><summary>（4）使用原子操作优化举例</summary><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">package</span> main</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">(</span></span>
<span class="line">	<span class="token string">&quot;fmt&quot;</span></span>
<span class="line">	<span class="token string">&quot;sync&quot;</span></span>
<span class="line">	<span class="token string">&quot;sync/atomic&quot;</span></span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token keyword">var</span> data <span class="token builtin">int64</span> <span class="token operator">=</span> <span class="token number">0</span></span>
<span class="line">	<span class="token keyword">var</span> wg sync<span class="token punctuation">.</span>WaitGroup</span>
<span class="line"></span>
<span class="line">	<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10000</span><span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span></span>
<span class="line">		wg<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span></span>
<span class="line">		<span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">			<span class="token comment">//data++                  // 非原子操作，这会引起数据竞争</span></span>
<span class="line">			atomic<span class="token punctuation">.</span><span class="token function">AddInt64</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>data<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment">// 原子操作</span></span>
<span class="line">			wg<span class="token punctuation">.</span><span class="token function">Done</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">		<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">	wg<span class="token punctuation">.</span><span class="token function">Wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre></div></details><br><h3 id="运行时数据竞争检测" tabindex="-1"><a class="header-anchor" href="#运行时数据竞争检测"><span>运行时数据竞争检测</span></a></h3><p>并发读写共享资源的时候会出现数据竞争<code>(data race)</code>，所以需要像锁等机制来进行保护</p><p>在编译<code>(cmpile)</code>、测试<code>（test）</code>、运行<code>（run）</code>前使用<code>--race</code>选项能检测数据竞争问题，</p><p>他的原理是：在程序运行以后，会监控程序对内存地址访问，并打印出提示</p><p>注意事项：</p><ul><li>如果程序在以后会访问某个资源，此时使用<code>--race</code>是检测不到的</li><li>开启了<code>--race</code>不要部署到线上，因为会有性能问题，测试期间可以开启<code>--race</code></li></ul><details class="hint-container details"><summary>并发不安全代码</summary><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">package</span> main</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">(</span></span>
<span class="line">	<span class="token string">&quot;fmt&quot;</span></span>
<span class="line">	<span class="token string">&quot;sync&quot;</span></span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token keyword">var</span> data <span class="token builtin">int</span> <span class="token operator">=</span> <span class="token number">0</span></span>
<span class="line">	<span class="token keyword">var</span> wg sync<span class="token punctuation">.</span>WaitGroup</span>
<span class="line"></span>
<span class="line">	<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10000</span><span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span></span>
<span class="line">		wg<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span></span>
<span class="line">		<span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">			data<span class="token operator">++</span></span>
<span class="line">			wg<span class="token punctuation">.</span><span class="token function">Done</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">		<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">	wg<span class="token punctuation">.</span><span class="token function">Wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 每次运行结果都不一样，大概在为9600左右，原理是产生了数据竞争，data++不是一个原子操作，操作是可以被打断的</span></span>
<span class="line"><span class="token comment">// 比如说 有2个协程同时拿到了data为100，那么协程1给data+1=101，协程2也给data+1=101，经过这俩协程一番操作，data只增长了1，</span></span>
<span class="line"><span class="token comment">// 所以我们虽然循环了一万次，其实结果要&lt;=10000，如果将上面的循环次数修改为100次，那么结果是正确的，但其实是还是有问题的</span></span>
<span class="line"></span></code></pre></div><p>下面开启<code>--race</code>检测数据竞争</p><div class="language-bash" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line">Goroutine <span class="token number">8</span> <span class="token punctuation">(</span>running<span class="token punctuation">)</span> created at:</span>
<span class="line">  main.main<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">      C:/Users/Administrator/GolandProjects/learn/main.go:14 +0x84</span>
<span class="line"></span>
<span class="line">Goroutine <span class="token number">7</span> <span class="token punctuation">(</span>finished<span class="token punctuation">)</span> created at:</span>
<span class="line">  main.main<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">      C:/Users/Administrator/GolandProjects/learn/main.go:14 +0x84</span>
<span class="line"><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span></span>
<span class="line"><span class="token number">10000</span></span>
<span class="line">Found <span class="token number">1</span> data race<span class="token punctuation">(</span>s<span class="token punctuation">)</span>	<span class="token comment"># 发现1个数据竞争</span></span>
<span class="line"><span class="token builtin class-name">exit</span> status <span class="token number">66</span></span>
<span class="line"></span></code></pre></div></details><details class="hint-container details"><summary>（1）解决方式1：加锁</summary><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">package</span> main</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">(</span></span>
<span class="line">	<span class="token string">&quot;fmt&quot;</span></span>
<span class="line">	<span class="token string">&quot;sync&quot;</span></span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token keyword">var</span> data <span class="token builtin">int</span> <span class="token operator">=</span> <span class="token number">0</span></span>
<span class="line">	<span class="token keyword">var</span> wg sync<span class="token punctuation">.</span>WaitGroup</span>
<span class="line">	<span class="token keyword">var</span> mu sync<span class="token punctuation">.</span>Mutex</span>
<span class="line"></span>
<span class="line">	<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10000</span><span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span></span>
<span class="line">		wg<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span></span>
<span class="line">		<span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">			mu<span class="token punctuation">.</span><span class="token function">Lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">			data<span class="token operator">++</span></span>
<span class="line">			mu<span class="token punctuation">.</span><span class="token function">Unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">			wg<span class="token punctuation">.</span><span class="token function">Done</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">		<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">	wg<span class="token punctuation">.</span><span class="token function">Wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 运行并开启--race检测</span></span>
<span class="line"><span class="token comment">// go run -race main.go  </span></span>
<span class="line"><span class="token comment">// 10000</span></span>
<span class="line"></span></code></pre></div></details><details class="hint-container details"><summary>（2）解决方式2：原子操作</summary><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">package</span> main</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">(</span></span>
<span class="line">	<span class="token string">&quot;fmt&quot;</span></span>
<span class="line">	<span class="token string">&quot;sync&quot;</span></span>
<span class="line">	<span class="token string">&quot;sync/atomic&quot;</span></span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token keyword">var</span> data <span class="token builtin">int64</span> <span class="token operator">=</span> <span class="token number">0</span></span>
<span class="line">	<span class="token keyword">var</span> wg sync<span class="token punctuation">.</span>WaitGroup</span>
<span class="line"></span>
<span class="line">	<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10000</span><span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span></span>
<span class="line">		wg<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span></span>
<span class="line">		<span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">			<span class="token comment">//data++ // 非原子操作，这会引起数据竞争</span></span>
<span class="line">			atomic<span class="token punctuation">.</span><span class="token function">AddInt64</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>data<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment">// 原子操作,这里手动将data的类型改为了int64,如果不改类型如何做?</span></span>
<span class="line">			wg<span class="token punctuation">.</span><span class="token function">Done</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">		<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">	wg<span class="token punctuation">.</span><span class="token function">Wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre></div></details><h2 id="-6" tabindex="-1"><a class="header-anchor" href="#-6"><span></span></a></h2><h2 id="程序优化" tabindex="-1"><a class="header-anchor" href="#程序优化"><span>程序优化</span></a></h2><h3 id="基础优化" tabindex="-1"><a class="header-anchor" href="#基础优化"><span>基础优化</span></a></h3><details class="hint-container details"><summary>（1）gofmt格式化代码</summary><p>说明：</p><ul><li><code>gofmt</code>是一个内置的独立的二进制命令，推荐使用</li><li><code>go fmt</code>是一个精简版的gofmt，相当于<code>gofmt -l -w</code></li></ul><p>推荐命令</p><div class="language-bash" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line">gofmt <span class="token parameter variable">-w</span> <span class="token parameter variable">-r</span> <span class="token string">&quot;interface{} -&gt; any&quot;</span> <span class="token builtin class-name">.</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 参数解释</span></span>
<span class="line"><span class="token comment"># -w 会修改源文件</span></span>
<span class="line"><span class="token comment"># -r 指定了一条重写规则,将所有的interface{}替换为any</span></span>
<span class="line"></span></code></pre></div><p>测试用例</p><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">package</span> main</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token string">&quot;fmt&quot;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">Ge</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token builtin">bool</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token keyword">if</span> a <span class="token operator">&gt;=</span> b <span class="token punctuation">{</span></span>
<span class="line">		<span class="token keyword">return</span> <span class="token boolean">true</span></span>
<span class="line">	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">		<span class="token keyword">return</span> <span class="token boolean">false</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">a <span class="token operator">:=</span> <span class="token number">1</span></span>
<span class="line">b <span class="token operator">:=</span> <span class="token number">2</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token function">Ge</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre></div><p>输出结果</p><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">package</span> main</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token string">&quot;fmt&quot;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">Ge</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token builtin">bool</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token keyword">if</span> a <span class="token operator">&gt;=</span> b <span class="token punctuation">{</span></span>
<span class="line">		<span class="token keyword">return</span> <span class="token boolean">true</span></span>
<span class="line">	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">		<span class="token keyword">return</span> <span class="token boolean">false</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    a <span class="token operator">:=</span> <span class="token number">1</span></span>
<span class="line">    b <span class="token operator">:=</span> <span class="token number">2</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token function">Ge</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// a和b的缩进已经被正确格式化</span></span>
<span class="line"><span class="token comment">// 对于Ge函数，并没有格式化成 return a &gt;= b</span></span>
<span class="line"></span></code></pre></div></details><details class="hint-container details"><summary>（2）go vet静态代码检查</summary><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">package</span> main</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token string">&quot;fmt&quot;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%d\n&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;hello world!&quot;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"></span></code></pre></div><p>输出结果</p><div class="language-bash" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line">C:<span class="token punctuation">\</span>Users<span class="token punctuation">\</span>Administrator<span class="token punctuation">\</span>Desktop<span class="token punctuation">\</span>example<span class="token operator">&gt;</span>go run main.go</span>
<span class="line">%<span class="token operator">!</span>d<span class="token punctuation">(</span>string<span class="token operator">=</span>hello world<span class="token operator">!</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">C:<span class="token punctuation">\</span>Users<span class="token punctuation">\</span>Administrator<span class="token punctuation">\</span>Desktop<span class="token punctuation">\</span>cli-tpl<span class="token operator">&gt;</span>go vet <span class="token builtin class-name">.</span>       </span>
<span class="line"><span class="token comment"># example</span></span>
<span class="line">.<span class="token punctuation">\</span>main.go:6:2: fmt.Printf <span class="token function">format</span> %d has arg <span class="token string">&quot;hello world!&quot;</span> of wrong <span class="token builtin class-name">type</span> string</span>
<span class="line"></span></code></pre></div></details><br><h3 id="单元测试" tabindex="-1"><a class="header-anchor" href="#单元测试"><span>单元测试</span></a></h3><p>说明：</p><ul><li>文件名要以<code>_test.go</code>结尾</li><li>函数签名<code>TestXXX(t *testing.T)</code>，其中<code>XXX</code>可以自定义，一般为我们要测试的函数</li><li>测试当前目录下所有文件：<code>go test .</code></li></ul><details class="hint-container details"><summary>（1）单元测试举例</summary><p><code>main.go</code></p><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">package</span> main</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">(</span></span>
<span class="line">	<span class="token string">&quot;fmt&quot;</span></span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">Add</span><span class="token punctuation">(</span>n1<span class="token punctuation">,</span> n2 <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token builtin">int</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token keyword">return</span> n1 <span class="token operator">+</span> n2</span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">Fibonacci</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">int64</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token keyword">var</span> a<span class="token punctuation">,</span> b <span class="token builtin">int64</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span></span>
<span class="line">	<span class="token keyword">return</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">int64</span> <span class="token punctuation">{</span></span>
<span class="line">		a<span class="token punctuation">,</span> b <span class="token operator">=</span> b<span class="token punctuation">,</span> a<span class="token operator">+</span>b</span>
<span class="line">		<span class="token keyword">return</span> a</span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	fib <span class="token operator">:=</span> <span class="token function">Fibonacci</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">100</span><span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span></span>
<span class="line">		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token function">fib</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre></div><p><code>main_test.go</code></p><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">package</span> main</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token string">&quot;testing&quot;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">TestAdd</span><span class="token punctuation">(</span>t <span class="token operator">*</span>testing<span class="token punctuation">.</span>T<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	tests <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token keyword">struct</span><span class="token punctuation">{</span> a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c <span class="token builtin">int</span> <span class="token punctuation">}</span><span class="token punctuation">{</span></span>
<span class="line">		<span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">		<span class="token punctuation">{</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">		<span class="token punctuation">{</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">		<span class="token punctuation">{</span><span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token comment">// 这里故意写错</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">	<span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> v <span class="token operator">:=</span> <span class="token keyword">range</span> tests <span class="token punctuation">{</span></span>
<span class="line">		<span class="token keyword">if</span> ret <span class="token operator">:=</span> <span class="token function">Add</span><span class="token punctuation">(</span>v<span class="token punctuation">.</span>a<span class="token punctuation">,</span> v<span class="token punctuation">.</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span> ret <span class="token operator">!=</span> v<span class="token punctuation">.</span>c <span class="token punctuation">{</span></span>
<span class="line">			t<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">&quot;Add(%d, %d) got %d, expectd %d\n&quot;</span><span class="token punctuation">,</span> v<span class="token punctuation">.</span>a<span class="token punctuation">,</span> v<span class="token punctuation">.</span>b<span class="token punctuation">,</span> ret<span class="token punctuation">,</span> v<span class="token punctuation">.</span>c<span class="token punctuation">)</span></span>
<span class="line">		<span class="token punctuation">}</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre></div><p>输出结果</p><div class="language-bash" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token comment"># 运行</span></span>
<span class="line">D:<span class="token punctuation">\</span>application<span class="token punctuation">\</span>GoLand<span class="token punctuation">\</span>demo<span class="token operator">&gt;</span>go <span class="token builtin class-name">test</span> <span class="token builtin class-name">.</span></span>
<span class="line">--- FAIL: TestAdd <span class="token punctuation">(</span><span class="token number">0</span>.00s<span class="token punctuation">)</span></span>
<span class="line">    main_test.go:15: Add<span class="token punctuation">(</span><span class="token number">6</span>, <span class="token number">7</span><span class="token punctuation">)</span> got <span class="token number">13</span>, expectd <span class="token number">14</span></span>
<span class="line">FAIL</span>
<span class="line">FAIL    demo    <span class="token number">0</span>.628s</span>
<span class="line">FAIL</span>
<span class="line"></span></code></pre></div></details><details class="hint-container details"><summary>（2）查看代码覆盖率</summary><p>1、还是使用上面的代码，在单元测试的同时输出代码覆盖率</p><div class="language-bash" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line">D:<span class="token punctuation">\</span>application<span class="token punctuation">\</span>GoLand<span class="token punctuation">\</span>demo<span class="token operator">&gt;</span>go <span class="token builtin class-name">test</span> <span class="token parameter variable">-coverprofile</span><span class="token operator">=</span>c.out <span class="token builtin class-name">.</span></span>
<span class="line">--- FAIL: TestAdd <span class="token punctuation">(</span><span class="token number">0</span>.00s<span class="token punctuation">)</span></span>
<span class="line">    main_test.go:15: Add<span class="token punctuation">(</span><span class="token number">6</span>, <span class="token number">7</span><span class="token punctuation">)</span> got <span class="token number">13</span>, expectd <span class="token number">14</span></span>
<span class="line">FAIL</span>
<span class="line">coverage: <span class="token number">12.5</span>% of statements        <span class="token comment"># 代码覆盖率只有12.5%</span></span>
<span class="line">FAIL    demo    <span class="token number">0</span>.593s</span>
<span class="line">FAIL</span>
<span class="line"></span></code></pre></div><p>2、看一下c.out的内容，看不懂，不过没关系</p><div class="language-bash" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line">mode: <span class="token builtin class-name">set</span></span>
<span class="line">demo/main.go:7.26,9.2 <span class="token number">1</span> <span class="token number">1</span></span>
<span class="line">demo/main.go:11.31,13.22 <span class="token number">2</span> <span class="token number">0</span></span>
<span class="line">demo/main.go:13.22,16.3 <span class="token number">2</span> <span class="token number">0</span></span>
<span class="line">demo/main.go:19.13,21.27 <span class="token number">2</span> <span class="token number">0</span></span>
<span class="line">demo/main.go:21.27,23.3 <span class="token number">1</span> <span class="token number">0</span></span>
<span class="line"></span></code></pre></div><p>3、使用下面的命令会打开浏览器，红色的就是没有测试到的代码</p><div class="language-bash" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line">D:<span class="token punctuation">\</span>application<span class="token punctuation">\</span>GoLand<span class="token punctuation">\</span>demo<span class="token operator">&gt;</span>go tool cover <span class="token parameter variable">-html</span><span class="token operator">=</span>c.out</span>
<span class="line"></span></code></pre></div><p><img src="https://tuchuang-1257805459.cos.accelerate.myqcloud.com//image-20221119112441117.png" alt="image-20221119112441117"></p><p><strong>4、修正单元测试中的错误并优化代码覆盖率</strong></p><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">package</span> main</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token string">&quot;testing&quot;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">TestAdd</span><span class="token punctuation">(</span>t <span class="token operator">*</span>testing<span class="token punctuation">.</span>T<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	tests <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token keyword">struct</span><span class="token punctuation">{</span> a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c <span class="token builtin">int</span> <span class="token punctuation">}</span><span class="token punctuation">{</span></span>
<span class="line">		<span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">		<span class="token punctuation">{</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">		<span class="token punctuation">{</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">		<span class="token punctuation">{</span><span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token comment">// 修正错误</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">	<span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> v <span class="token operator">:=</span> <span class="token keyword">range</span> tests <span class="token punctuation">{</span></span>
<span class="line">		<span class="token keyword">if</span> ret <span class="token operator">:=</span> <span class="token function">Add</span><span class="token punctuation">(</span>v<span class="token punctuation">.</span>a<span class="token punctuation">,</span> v<span class="token punctuation">.</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span> ret <span class="token operator">!=</span> v<span class="token punctuation">.</span>c <span class="token punctuation">{</span></span>
<span class="line">			t<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">&quot;Add(%d, %d) got %d, expectd %d\n&quot;</span><span class="token punctuation">,</span> v<span class="token punctuation">.</span>a<span class="token punctuation">,</span> v<span class="token punctuation">.</span>b<span class="token punctuation">,</span> ret<span class="token punctuation">,</span> v<span class="token punctuation">.</span>c<span class="token punctuation">)</span></span>
<span class="line">		<span class="token punctuation">}</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">TestFibonacci</span><span class="token punctuation">(</span>t <span class="token operator">*</span>testing<span class="token punctuation">.</span>T<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	tests <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int64</span><span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">	fib <span class="token operator">:=</span> <span class="token function">Fibonacci</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> v <span class="token operator">:=</span> <span class="token keyword">range</span> tests <span class="token punctuation">{</span></span>
<span class="line">		<span class="token keyword">if</span> ret <span class="token operator">:=</span> <span class="token function">fib</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> ret <span class="token operator">!=</span> v <span class="token punctuation">{</span></span>
<span class="line">			t<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">&quot;TestFibonacci()=&gt;fib() got %d, expected %d\n&quot;</span><span class="token punctuation">,</span> ret<span class="token punctuation">,</span> v<span class="token punctuation">)</span></span>
<span class="line">		<span class="token punctuation">}</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre></div><p><strong>5、再次测试</strong></p><div class="language-bash" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token comment"># 执行单元测试</span></span>
<span class="line">D:<span class="token punctuation">\</span>application<span class="token punctuation">\</span>GoLand<span class="token punctuation">\</span>demo<span class="token operator">&gt;</span>go <span class="token builtin class-name">test</span> <span class="token parameter variable">-coverprofile</span><span class="token operator">=</span>c.out <span class="token builtin class-name">.</span></span>
<span class="line">ok      demo    <span class="token number">0</span>.040s  coverage: <span class="token number">62.5</span>% of statements      <span class="token comment"># 已经提高到62.5%</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 查看哪些代码没有测试到</span></span>
<span class="line">D:<span class="token punctuation">\</span>application<span class="token punctuation">\</span>GoLand<span class="token punctuation">\</span>demo<span class="token operator">&gt;</span>go tool cover <span class="token parameter variable">-html</span><span class="token operator">=</span>c.out</span>
<span class="line"></span></code></pre></div><p><img src="https://tuchuang-1257805459.cos.accelerate.myqcloud.com//image-20221119113455828.png" alt="image-20221119113455828"></p></details><br><h3 id="模糊测试" tabindex="-1"><a class="header-anchor" href="#模糊测试"><span>模糊测试</span></a></h3><p>文档：<a href="https://go.dev/security/fuzz/" target="_blank" rel="noopener noreferrer">https://go.dev/security/fuzz/</a></p><details class="hint-container details"><summary>（1）模糊测试：若测试不通过则会退出</summary><p><code>main_test.go</code></p><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">package</span> main</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token string">&quot;testing&quot;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">Equal</span><span class="token punctuation">(</span>a <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span><span class="token punctuation">,</span> b <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span><span class="token punctuation">)</span> <span class="token builtin">bool</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token keyword">range</span> a <span class="token punctuation">{</span></span>
<span class="line">		<span class="token keyword">if</span> a<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">!=</span> b<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token punctuation">{</span></span>
<span class="line">			<span class="token keyword">return</span> <span class="token boolean">false</span></span>
<span class="line">		<span class="token punctuation">}</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line">	<span class="token keyword">return</span> <span class="token boolean">true</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">FuzzEqual</span><span class="token punctuation">(</span>f <span class="token operator">*</span>testing<span class="token punctuation">.</span>F<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	f<span class="token punctuation">.</span><span class="token function">Fuzz</span><span class="token punctuation">(</span><span class="token keyword">func</span><span class="token punctuation">(</span>t <span class="token operator">*</span>testing<span class="token punctuation">.</span>T<span class="token punctuation">,</span> a <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span><span class="token punctuation">,</span> b <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">		<span class="token function">Equal</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span></span>
<span class="line">	<span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre></div><p>输出结果</p><div class="language-bash" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line">D:<span class="token punctuation">\</span>application<span class="token punctuation">\</span>GoLand<span class="token punctuation">\</span>example<span class="token operator">&gt;</span>go <span class="token builtin class-name">test</span> <span class="token parameter variable">-fuzz</span> <span class="token builtin class-name">.</span></span>
<span class="line">fuzz: elapsed: 0s, gathering baseline coverage: <span class="token number">0</span>/10 completed</span>
<span class="line">failure <span class="token keyword">while</span> testing seed corpus entry: FuzzEqual/84ed65595ad05a58</span>
<span class="line">fuzz: elapsed: 0s, gathering baseline coverage: <span class="token number">0</span>/10 completed</span>
<span class="line">--- FAIL: FuzzEqual <span class="token punctuation">(</span><span class="token number">0</span>.04s<span class="token punctuation">)</span>                                                                                  </span>
<span class="line">    --- FAIL: FuzzEqual <span class="token punctuation">(</span><span class="token number">0</span>.00s<span class="token punctuation">)</span>                                                                              </span>
<span class="line">        testing.go:1485: panic: runtime error: index out of range <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> with length <span class="token number">0</span>                          </span>
<span class="line">            goroutine <span class="token number">14</span> <span class="token punctuation">[</span>running<span class="token punctuation">]</span>:                                                                          </span>
<span class="line">            runtime/debug.Stack<span class="token punctuation">(</span><span class="token punctuation">)</span>                                                                            </span>
<span class="line">                D:/software/go1.21/src/runtime/debug/stack.go:24 +0x9e                                       </span>
<span class="line">            testing.tRunner.func1<span class="token punctuation">(</span><span class="token punctuation">)</span>                                                                          </span>
<span class="line">                D:/software/go1.21/src/testing/testing.go:1485 +0x1f6                                        </span>
<span class="line">            panic<span class="token punctuation">(</span><span class="token punctuation">{</span>0x9c2f80, 0xc00000e168<span class="token punctuation">}</span><span class="token punctuation">)</span>                                                                  </span>
<span class="line">                D:/software/go1.21/src/runtime/panic.go:884 +0x213                                           </span>
<span class="line">            example.Equal<span class="token punctuation">(</span><span class="token punctuation">..</span>.<span class="token punctuation">)</span>                                                                               </span>
<span class="line">                D:/application/GoLand/example/main_test.go:7                                                 </span>
<span class="line">            example.FuzzEqual.func1<span class="token punctuation">(</span>0x7?, <span class="token punctuation">{</span>0xc000010648?, 0x1?, 0x0?<span class="token punctuation">}</span>, <span class="token punctuation">{</span>0xb793b0?, 0x0?, 0x0?<span class="token punctuation">}</span><span class="token punctuation">)</span>              </span>
<span class="line">                D:/application/GoLand/example/main_test.go:16 +0x13d                                         </span>
<span class="line">            reflect.Value.call<span class="token punctuation">(</span><span class="token punctuation">{</span>0x9a3660?, 0x9e3158?, 0x80ea96?<span class="token punctuation">}</span>, <span class="token punctuation">{</span>0x9d28b3, 0x4<span class="token punctuation">}</span>, <span class="token punctuation">{</span>0xc00005e3c0, 0x3, 0x4?<span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">                D:/software/go1.21/src/reflect/value.go:586 +0xb07                                           </span>
<span class="line">            reflect.Value.Call<span class="token punctuation">(</span><span class="token punctuation">{</span>0x9a3660?, 0x9e3158?, 0xae9230?<span class="token punctuation">}</span>, <span class="token punctuation">{</span>0xc00005e3c0?, 0x9d1ea0?, 0xc000010660?<span class="token punctuation">}</span><span class="token punctuation">)</span> </span>
<span class="line">                D:/software/go1.21/src/reflect/value.go:370 +0xbc                                            </span>
<span class="line">            testing.<span class="token punctuation">(</span>*F<span class="token punctuation">)</span>.Fuzz.func1.1<span class="token punctuation">(</span>0x0?<span class="token punctuation">)</span></span>
<span class="line">                D:/software/go1.21/src/testing/fuzz.go:335 +0x3f3</span>
<span class="line">            testing.tRunner<span class="token punctuation">(</span>0xc0000d0000, 0xc0000b0480<span class="token punctuation">)</span></span>
<span class="line">                D:/software/go1.21/src/testing/testing.go:1576 +0x10b</span>
<span class="line">            created by testing.<span class="token punctuation">(</span>*F<span class="token punctuation">)</span>.Fuzz.func1</span>
<span class="line">                D:/software/go1.21/src/testing/fuzz.go:322 +0x5b9</span>
<span class="line"></span>
<span class="line"></span>
<span class="line">FAIL</span>
<span class="line"><span class="token builtin class-name">exit</span> status <span class="token number">1</span></span>
<span class="line">FAIL    example <span class="token number">0</span>.068s</span>
<span class="line"></span></code></pre></div></details><details class="hint-container details"><summary>（2）模糊测试：修正代码，测试会一直持续下去，直到遇到测试失败的用例</summary><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">package</span> main</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token string">&quot;testing&quot;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">Equal</span><span class="token punctuation">(</span>a <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span><span class="token punctuation">,</span> b <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span><span class="token punctuation">)</span> <span class="token builtin">bool</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token keyword">if</span> <span class="token function">len</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token function">len</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">		<span class="token keyword">return</span> <span class="token boolean">false</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line">	<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token keyword">range</span> a <span class="token punctuation">{</span></span>
<span class="line">		<span class="token keyword">if</span> a<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">!=</span> b<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token punctuation">{</span></span>
<span class="line">			<span class="token keyword">return</span> <span class="token boolean">false</span></span>
<span class="line">		<span class="token punctuation">}</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line">	<span class="token keyword">return</span> <span class="token boolean">true</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">FuzzEqual</span><span class="token punctuation">(</span>f <span class="token operator">*</span>testing<span class="token punctuation">.</span>F<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	f<span class="token punctuation">.</span><span class="token function">Fuzz</span><span class="token punctuation">(</span><span class="token keyword">func</span><span class="token punctuation">(</span>t <span class="token operator">*</span>testing<span class="token punctuation">.</span>T<span class="token punctuation">,</span> a <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span><span class="token punctuation">,</span> b <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">		<span class="token function">Equal</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span></span>
<span class="line">	<span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre></div><p>输出结果</p><div class="language-bash" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line">D:<span class="token punctuation">\</span>application<span class="token punctuation">\</span>GoLand<span class="token punctuation">\</span>example<span class="token operator">&gt;</span>go <span class="token builtin class-name">test</span> <span class="token parameter variable">-fuzz</span> <span class="token builtin class-name">.</span></span>
<span class="line">fuzz: elapsed: 0s, gathering baseline coverage: <span class="token number">0</span>/10 completed</span>
<span class="line">fuzz: elapsed: 0s, gathering baseline coverage: <span class="token number">10</span>/10 completed, now fuzzing with <span class="token number">8</span> workers</span>
<span class="line">fuzz: elapsed: 3s, execs: <span class="token number">479364</span> <span class="token punctuation">(</span><span class="token number">159361</span>/sec<span class="token punctuation">)</span>, new interesting: <span class="token number">0</span> <span class="token punctuation">(</span>total: <span class="token number">10</span><span class="token punctuation">)</span></span>
<span class="line">fuzz: elapsed: 6s, execs: <span class="token number">987591</span> <span class="token punctuation">(</span><span class="token number">169596</span>/sec<span class="token punctuation">)</span>, new interesting: <span class="token number">0</span> <span class="token punctuation">(</span>total: <span class="token number">10</span><span class="token punctuation">)</span></span>
<span class="line">fuzz: elapsed: 9s, execs: <span class="token number">1483634</span> <span class="token punctuation">(</span><span class="token number">165532</span>/sec<span class="token punctuation">)</span>, new interesting: <span class="token number">0</span> <span class="token punctuation">(</span>total: <span class="token number">10</span><span class="token punctuation">)</span></span>
<span class="line">fuzz: elapsed: 12s, execs: <span class="token number">1979287</span> <span class="token punctuation">(</span><span class="token number">165039</span>/sec<span class="token punctuation">)</span>, new interesting: <span class="token number">0</span> <span class="token punctuation">(</span>total: <span class="token number">10</span><span class="token punctuation">)</span></span>
<span class="line">fuzz: elapsed: 15s, execs: <span class="token number">2496426</span> <span class="token punctuation">(</span><span class="token number">172389</span>/sec<span class="token punctuation">)</span>, new interesting: <span class="token number">0</span> <span class="token punctuation">(</span>total: <span class="token number">10</span><span class="token punctuation">)</span></span>
<span class="line">fuzz: elapsed: 18s, execs: <span class="token number">3019692</span> <span class="token punctuation">(</span><span class="token number">173678</span>/sec<span class="token punctuation">)</span>, new interesting: <span class="token number">0</span> <span class="token punctuation">(</span>total: <span class="token number">10</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">..</span>.</span>
<span class="line"></span></code></pre></div></details><details class="hint-container details"><summary>（3）模糊测试：手动添加测试用例</summary><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">package</span> main</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token string">&quot;testing&quot;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">Equal</span><span class="token punctuation">(</span>a <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span><span class="token punctuation">,</span> b <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span><span class="token punctuation">)</span> <span class="token builtin">bool</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token keyword">if</span> <span class="token function">len</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token function">len</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">		<span class="token keyword">return</span> <span class="token boolean">false</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line">	<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token keyword">range</span> a <span class="token punctuation">{</span></span>
<span class="line">		<span class="token keyword">if</span> a<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">!=</span> b<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token punctuation">{</span></span>
<span class="line">			<span class="token keyword">return</span> <span class="token boolean">false</span></span>
<span class="line">		<span class="token punctuation">}</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line">	<span class="token keyword">return</span> <span class="token boolean">true</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">FuzzEqual</span><span class="token punctuation">(</span>f <span class="token operator">*</span>testing<span class="token punctuation">.</span>F<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	f<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span><span class="token punctuation">{</span><span class="token char">&#39;a&#39;</span><span class="token punctuation">,</span> <span class="token char">&#39;b&#39;</span><span class="token punctuation">,</span> <span class="token char">&#39;c&#39;</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span><span class="token punctuation">{</span><span class="token char">&#39;a&#39;</span><span class="token punctuation">,</span> <span class="token char">&#39;b&#39;</span><span class="token punctuation">,</span> <span class="token char">&#39;c&#39;</span><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">	f<span class="token punctuation">.</span><span class="token function">Fuzz</span><span class="token punctuation">(</span><span class="token keyword">func</span><span class="token punctuation">(</span>t <span class="token operator">*</span>testing<span class="token punctuation">.</span>T<span class="token punctuation">,</span> a <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span><span class="token punctuation">,</span> b <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">		<span class="token function">Equal</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span></span>
<span class="line">	<span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre></div><p>输出结果</p><div class="language-bash" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line">fuzz: elapsed: 0s, gathering baseline coverage: <span class="token number">0</span>/11 completed</span>
<span class="line">fuzz: elapsed: 0s, gathering baseline coverage: <span class="token number">11</span>/11 completed, now fuzzing with <span class="token number">8</span> workers</span>
<span class="line">fuzz: elapsed: 3s, execs: <span class="token number">507288</span> <span class="token punctuation">(</span><span class="token number">168238</span>/sec<span class="token punctuation">)</span>, new interesting: <span class="token number">0</span> <span class="token punctuation">(</span>total: <span class="token number">11</span><span class="token punctuation">)</span></span>
<span class="line">fuzz: elapsed: 6s, execs: <span class="token number">1019869</span> <span class="token punctuation">(</span><span class="token number">171634</span>/sec<span class="token punctuation">)</span>, new interesting: <span class="token number">0</span> <span class="token punctuation">(</span>total: <span class="token number">11</span><span class="token punctuation">)</span></span>
<span class="line">fuzz: elapsed: 9s, execs: <span class="token number">1550486</span> <span class="token punctuation">(</span><span class="token number">176602</span>/sec<span class="token punctuation">)</span>, new interesting: <span class="token number">0</span> <span class="token punctuation">(</span>total: <span class="token number">11</span><span class="token punctuation">)</span></span>
<span class="line">fuzz: elapsed: 12s, execs: <span class="token number">2075441</span> <span class="token punctuation">(</span><span class="token number">174965</span>/sec<span class="token punctuation">)</span>, new interesting: <span class="token number">0</span> <span class="token punctuation">(</span>total: <span class="token number">11</span><span class="token punctuation">)</span></span>
<span class="line">fuzz: elapsed: 15s, execs: <span class="token number">2582182</span> <span class="token punctuation">(</span><span class="token number">168777</span>/sec<span class="token punctuation">)</span>, new interesting: <span class="token number">0</span> <span class="token punctuation">(</span>total: <span class="token number">11</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">..</span>.</span>
<span class="line"></span></code></pre></div></details><details class="hint-container details"><summary>（4）模糊测试：指定测试时长</summary><div class="language-bash" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token comment"># 注意这里-fuzz=Fuzz</span></span>
<span class="line"><span class="token comment"># 1、-fuzz 其实后面还有个值 regexp, 写一个正则用来测试哪些函数</span></span>
<span class="line"><span class="token comment"># 2、当仅用-fuzz的时候不写值也没问题，但是如果后面还有选项，则必须写成这种形式 -fuzz=regexp</span></span>
<span class="line"><span class="token comment"># 3、所有的模糊测试函数都要以Fuzz开头，所以这里我们直接就写Fuzz，用于测试所有的函数</span></span>
<span class="line">D:<span class="token punctuation">\</span>application<span class="token punctuation">\</span>GoLand<span class="token punctuation">\</span>example<span class="token operator">&gt;</span>go <span class="token builtin class-name">test</span> <span class="token parameter variable">-fuzz</span><span class="token operator">=</span>Fuzz <span class="token parameter variable">-fuzztime</span><span class="token operator">=</span>10s <span class="token builtin class-name">.</span></span>
<span class="line">fuzz: elapsed: 0s, gathering baseline coverage: <span class="token number">0</span>/11 completed</span>
<span class="line">fuzz: elapsed: 0s, gathering baseline coverage: <span class="token number">11</span>/11 completed, now fuzzing with <span class="token number">8</span> workers</span>
<span class="line">fuzz: elapsed: 3s, execs: <span class="token number">478618</span> <span class="token punctuation">(</span><span class="token number">158705</span>/sec<span class="token punctuation">)</span>, new interesting: <span class="token number">0</span> <span class="token punctuation">(</span>total: <span class="token number">11</span><span class="token punctuation">)</span></span>
<span class="line">fuzz: elapsed: 6s, execs: <span class="token number">980187</span> <span class="token punctuation">(</span><span class="token number">167299</span>/sec<span class="token punctuation">)</span>, new interesting: <span class="token number">0</span> <span class="token punctuation">(</span>total: <span class="token number">11</span><span class="token punctuation">)</span></span>
<span class="line">fuzz: elapsed: 9s, execs: <span class="token number">1508852</span> <span class="token punctuation">(</span><span class="token number">176493</span>/sec<span class="token punctuation">)</span>, new interesting: <span class="token number">0</span> <span class="token punctuation">(</span>total: <span class="token number">11</span><span class="token punctuation">)</span></span>
<span class="line">fuzz: elapsed: 10s, execs: <span class="token number">1690426</span> <span class="token punctuation">(</span><span class="token number">161845</span>/sec<span class="token punctuation">)</span>, new interesting: <span class="token number">0</span> <span class="token punctuation">(</span>total: <span class="token number">11</span><span class="token punctuation">)</span></span>
<span class="line">PASS</span>
<span class="line">ok      example <span class="token number">10</span>.164s</span>
<span class="line"></span></code></pre></div></details><details class="hint-container details"><summary>（4）模糊测试：指定进程数</summary><div class="language-bash" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token comment"># 默认启动的进程数等于逻辑CPU核心数,这会消耗比较多的资源, -parallel指定进程数</span></span>
<span class="line">D:<span class="token punctuation">\</span>application<span class="token punctuation">\</span>GoLand<span class="token punctuation">\</span>example<span class="token operator">&gt;</span>go <span class="token builtin class-name">test</span> <span class="token parameter variable">-fuzz</span><span class="token operator">=</span>Fuzz <span class="token parameter variable">-fuzztime</span><span class="token operator">=</span>10s <span class="token parameter variable">-parallel</span><span class="token operator">=</span><span class="token number">1</span> <span class="token builtin class-name">.</span> </span>
<span class="line">fuzz: elapsed: 0s, gathering baseline coverage: <span class="token number">0</span>/11 completed</span>
<span class="line">fuzz: elapsed: 0s, gathering baseline coverage: <span class="token number">11</span>/11 completed, now fuzzing with <span class="token number">1</span> workers</span>
<span class="line">fuzz: elapsed: 3s, execs: <span class="token number">113279</span> <span class="token punctuation">(</span><span class="token number">37629</span>/sec<span class="token punctuation">)</span>, new interesting: <span class="token number">0</span> <span class="token punctuation">(</span>total: <span class="token number">11</span><span class="token punctuation">)</span></span>
<span class="line">fuzz: elapsed: 6s, execs: <span class="token number">224589</span> <span class="token punctuation">(</span><span class="token number">37204</span>/sec<span class="token punctuation">)</span>, new interesting: <span class="token number">0</span> <span class="token punctuation">(</span>total: <span class="token number">11</span><span class="token punctuation">)</span></span>
<span class="line">fuzz: elapsed: 9s, execs: <span class="token number">340262</span> <span class="token punctuation">(</span><span class="token number">38555</span>/sec<span class="token punctuation">)</span>, new interesting: <span class="token number">0</span> <span class="token punctuation">(</span>total: <span class="token number">11</span><span class="token punctuation">)</span></span>
<span class="line">fuzz: elapsed: 10s, execs: <span class="token number">379884</span> <span class="token punctuation">(</span><span class="token number">36828</span>/sec<span class="token punctuation">)</span>, new interesting: <span class="token number">0</span> <span class="token punctuation">(</span>total: <span class="token number">11</span><span class="token punctuation">)</span></span>
<span class="line">PASS</span>
<span class="line">ok      example <span class="token number">10</span>.109s</span>
<span class="line"></span></code></pre></div></details><br><h3 id="性能测试" tabindex="-1"><a class="header-anchor" href="#性能测试"><span>性能测试</span></a></h3><p>说明：</p><ul><li>文件名要以<code>_test.go</code>结尾</li><li>函数签名<code>BenchmarkXX(b *testing.B)</code>，，其中<code>XXX</code>可以自定义，一般为我们要测试的函数</li><li>测试当前目录下所有文件：<code>go test -bench . </code></li></ul><details class="hint-container details"><summary>（1）性能测试举例</summary><p><code>main_test.go</code></p><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">package</span> main</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token string">&quot;testing&quot;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 为了演示方法，将实际的代码也在写这里</span></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">Add</span><span class="token punctuation">(</span>n1<span class="token punctuation">,</span> n2 <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token builtin">int</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token keyword">return</span> n1 <span class="token operator">+</span> n2</span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">BenchmarkAdd</span><span class="token punctuation">(</span>b <span class="token operator">*</span>testing<span class="token punctuation">.</span>B<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token comment">// 这里是重置时间，如果上面有耗时初始化的话可以添加这一句</span></span>
<span class="line">	b<span class="token punctuation">.</span><span class="token function">ResetTimer</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// b.N是性能测试为我们提供的计数器</span></span>
<span class="line">	<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> b<span class="token punctuation">.</span>N<span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span></span>
<span class="line">		<span class="token function">Add</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre></div><p>输出结果</p><div class="language-bash" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token comment"># 基本参数</span></span>
<span class="line">D:<span class="token punctuation">\</span>application<span class="token punctuation">\</span>GoLand<span class="token punctuation">\</span>example<span class="token operator">&gt;</span>go <span class="token builtin class-name">test</span> <span class="token parameter variable">-bench</span> <span class="token builtin class-name">.</span></span>
<span class="line">goos: windows</span>
<span class="line">goarch: amd64</span>
<span class="line">pkg: example</span>
<span class="line">cpu: Intel<span class="token punctuation">(</span>R<span class="token punctuation">)</span> Core<span class="token punctuation">(</span>TM<span class="token punctuation">)</span> i7-4790K CPU @ <span class="token number">4</span>.00GHz</span>
<span class="line">BenchmarkAdd-8          <span class="token number">1000000000</span>               <span class="token number">0.2540</span> ns/op</span>
<span class="line">PASS</span>
<span class="line">ok      example <span class="token number">2</span>.602s</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 说明</span></span>
<span class="line"><span class="token comment"># 1.BenchmarkAdd是我们的测试函数名称</span></span>
<span class="line"><span class="token comment"># 2.-8这里的8指的是主机的逻辑CPU个数</span></span>
<span class="line"><span class="token comment"># 3.1000000000指的是该函数运行的次数</span></span>
<span class="line"><span class="token comment"># 4.0.2540 ns/op指的是每次运行函数消耗的纳秒</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 其他参数</span></span>
<span class="line"><span class="token parameter variable">-benchmem</span>        输出内存分配统计信息<span class="token punctuation">(</span>B/op 每次分配内存大小, allocs/op 每次分配内存次数<span class="token punctuation">)</span> go <span class="token builtin class-name">test</span> <span class="token parameter variable">-bench</span> <span class="token builtin class-name">.</span> <span class="token parameter variable">-benchmem</span></span>
<span class="line"></span>
<span class="line"><span class="token parameter variable">-benchtime</span> 1s    指定每个函数运行时长,默认为1s                    go <span class="token builtin class-name">test</span> <span class="token parameter variable">-bench</span> <span class="token builtin class-name">.</span> <span class="token parameter variable">-benchtime</span> 10s</span>
<span class="line"><span class="token parameter variable">-benchtime</span> 1000x 指定每个函数运行次数,注意后面要加个x,默认为十亿次    go <span class="token builtin class-name">test</span> <span class="token parameter variable">-bench</span> <span class="token builtin class-name">.</span> <span class="token parameter variable">-benchtime</span> 100x</span>
<span class="line"></span></code></pre></div></details><br><h3 id="pprof简介" tabindex="-1"><a class="header-anchor" href="#pprof简介"><span>PProf简介</span></a></h3><p>文档：</p><ul><li><a href="https://go.dev/doc/diagnostics" target="_blank" rel="noopener noreferrer">https://go.dev/doc/diagnostics</a></li><li><a href="https://go.dev/blog/pprof" target="_blank" rel="noopener noreferrer">https://go.dev/blog/pprof</a></li></ul><br><p>主要关注的性能指标</p><ul><li>CPU Profile：报告程序的 CPU 使用情况，按照一定频率去采集应用程序在 CPU 和寄存器上面的数据</li><li>Memory Profile（Heap Profile）：报告程序的内存使用情况</li><li>Goroutine Profiling：报告 goroutines 的使用情况，有哪些 goroutine，它们的调用关系是怎样的</li><li>Block Profiling：报告 goroutines 不在运行状态的情况，可以用来分析和查找死锁等性能瓶颈</li></ul><p>Go标准库用于生成Profile</p><ul><li><p>runtime/pprof：适用于工具类应用</p></li><li><p>net/http/pprof：适用于服务类应用</p></li></ul><p>第三方辅助工具</p><ul><li><a href="https://graphviz.org/" target="_blank" rel="noopener noreferrer">Graphviz</a>：开源图形可视化软件，强烈建议安装</li></ul><br><p><strong>1、本地文件方式采集Profile</strong></p><details class="hint-container details"><summary>（1）采集CPU Profile：通用步骤详细介绍版</summary><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">package</span> main</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">(</span></span>
<span class="line">	<span class="token string">&quot;flag&quot;</span></span>
<span class="line">	<span class="token string">&quot;fmt&quot;</span></span>
<span class="line">	<span class="token string">&quot;log&quot;</span></span>
<span class="line">	<span class="token string">&quot;os&quot;</span></span>
<span class="line">	<span class="token string">&quot;runtime/pprof&quot;</span></span>
<span class="line">	<span class="token string">&quot;time&quot;</span></span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">var</span> <span class="token punctuation">(</span></span>
<span class="line">	cpuprofile <span class="token operator">=</span> flag<span class="token punctuation">.</span><span class="token function">String</span><span class="token punctuation">(</span><span class="token string">&quot;cpuprofile&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;write cpu profile to file&quot;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">A</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token comment">// 程序计时</span></span>
<span class="line">	start <span class="token operator">:=</span> time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token keyword">defer</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">		fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;Function-A    running time is %.2f seconds\n&quot;</span><span class="token punctuation">,</span> time<span class="token punctuation">.</span><span class="token function">Since</span><span class="token punctuation">(</span>start<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Seconds</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">	n <span class="token operator">:=</span> <span class="token number">10000</span> <span class="token operator">*</span> <span class="token number">10000</span> <span class="token operator">*</span> <span class="token number">800</span></span>
<span class="line">	sum <span class="token operator">:=</span> <span class="token number">0</span></span>
<span class="line">	<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span></span>
<span class="line">		sum <span class="token operator">+=</span> i</span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line">	<span class="token function">B</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">B</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token comment">// 程序计时</span></span>
<span class="line">	start <span class="token operator">:=</span> time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token keyword">defer</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">		fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;Function-B    running time is %.2f seconds\n&quot;</span><span class="token punctuation">,</span> time<span class="token punctuation">.</span><span class="token function">Since</span><span class="token punctuation">(</span>start<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Seconds</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">	n <span class="token operator">:=</span> <span class="token number">10000</span> <span class="token operator">*</span> <span class="token number">10000</span> <span class="token operator">*</span> <span class="token number">200</span></span>
<span class="line">	sum <span class="token operator">:=</span> <span class="token number">0</span></span>
<span class="line">	<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span></span>
<span class="line">		sum <span class="token operator">+=</span> i</span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token comment">// 程序计时</span></span>
<span class="line">	start <span class="token operator">:=</span> time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token keyword">defer</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">		fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;Function-Main running time is %.2f seconds\n&quot;</span><span class="token punctuation">,</span> time<span class="token punctuation">.</span><span class="token function">Since</span><span class="token punctuation">(</span>start<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Seconds</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 解析命令行参数</span></span>
<span class="line">	flag<span class="token punctuation">.</span><span class="token function">Parse</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 采集 CPU Profile</span></span>
<span class="line">	<span class="token keyword">if</span> <span class="token operator">*</span>cpuprofile <span class="token operator">!=</span> <span class="token string">&quot;&quot;</span> <span class="token punctuation">{</span></span>
<span class="line">		f<span class="token punctuation">,</span> err <span class="token operator">:=</span> os<span class="token punctuation">.</span><span class="token function">Create</span><span class="token punctuation">(</span><span class="token operator">*</span>cpuprofile<span class="token punctuation">)</span></span>
<span class="line">		<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span></span>
<span class="line">			log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span></span>
<span class="line">		<span class="token punctuation">}</span></span>
<span class="line">        <span class="token keyword">defer</span> f<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">		err <span class="token operator">=</span> pprof<span class="token punctuation">.</span><span class="token function">StartCPUProfile</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span></span>
<span class="line">		<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span></span>
<span class="line">			log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">		<span class="token punctuation">}</span></span>
<span class="line">		<span class="token keyword">defer</span> pprof<span class="token punctuation">.</span><span class="token function">StopCPUProfile</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 主要的代码区域</span></span>
<span class="line">	<span class="token function">A</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre></div><p>1、执行程序</p><div class="language-bash" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line">D:<span class="token punctuation">\</span>application<span class="token punctuation">\</span>GoLand<span class="token punctuation">\</span>example<span class="token operator">&gt;</span>go run main.go <span class="token parameter variable">-cpuprofile</span><span class="token operator">=</span>cpu.prof</span>
<span class="line">Function-B    running <span class="token function">time</span> is <span class="token number">5.00</span> seconds</span>
<span class="line">Function-A    running <span class="token function">time</span> is <span class="token number">24.99</span> seconds</span>
<span class="line">Function-Main running <span class="token function">time</span> is <span class="token number">25.12</span> seconds</span>
<span class="line"></span></code></pre></div><p>2、以终端方式解析CPU Profile文件</p><div class="language-bash" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token comment"># 1、打开Profile文件</span></span>
<span class="line">D:<span class="token punctuation">\</span>application<span class="token punctuation">\</span>GoLand<span class="token punctuation">\</span>example<span class="token operator">&gt;</span> go tool pprof cpu.prof</span>
<span class="line">File: main.exe</span>
<span class="line">Build ID: xxx<span class="token punctuation">\</span>main.exe2023-02-04 <span class="token number">15</span>:13:07.8986166 +0800 CST</span>
<span class="line">Type: cpu</span>
<span class="line">Time: Feb <span class="token number">4</span>, <span class="token number">2023</span> at <span class="token number">3</span>:13pm <span class="token punctuation">(</span>CST<span class="token punctuation">)</span></span>
<span class="line">Duration: <span class="token number">25</span>.12s, Total samples <span class="token operator">=</span> <span class="token number">15</span>.48s <span class="token punctuation">(</span><span class="token number">61.63</span>%<span class="token punctuation">)</span></span>
<span class="line">Entering interactive mode <span class="token punctuation">(</span>type <span class="token string">&quot;help&quot;</span> <span class="token keyword">for</span> commands, <span class="token string">&quot;o&quot;</span> <span class="token keyword">for</span> options<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 说明</span></span>
<span class="line"><span class="token comment"># Duration: 25.12s                 程序运行的总时间，这与我们统计的 Function-Main 时间相同</span></span>
<span class="line"><span class="token comment"># Total samples = 15.48s (61.63%)  数据采样的总时间，15.48 / 25.12 ~= 61.63%</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># ----------------------------------------------------------------------------------</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 2、执行top命令</span></span>
<span class="line"><span class="token punctuation">(</span>pprof<span class="token punctuation">)</span> <span class="token function">top</span></span>
<span class="line">Showing nodes accounting <span class="token keyword">for</span> <span class="token number">15</span>.22s, <span class="token number">98.32</span>% of <span class="token number">15</span>.48s total</span>
<span class="line">Dropped <span class="token number">31</span> nodes <span class="token punctuation">(</span>cum <span class="token operator">&lt;=</span> <span class="token number">0</span>.08s<span class="token punctuation">)</span></span>
<span class="line">Showing <span class="token function">top</span> <span class="token number">10</span> nodes out of <span class="token number">14</span></span>
<span class="line">      flat  flat%   sum%        cum   cum%</span>
<span class="line">    <span class="token number">12</span>.07s <span class="token number">77.97</span>% <span class="token number">77.97</span>%     <span class="token number">15</span>.13s <span class="token number">97.74</span>%  main.A</span>
<span class="line">     <span class="token number">3</span>.04s <span class="token number">19.64</span>% <span class="token number">97.61</span>%      <span class="token number">3</span>.05s <span class="token number">19.70</span>%  main.B</span>
<span class="line">     <span class="token number">0</span>.08s  <span class="token number">0.52</span>% <span class="token number">98.13</span>%      <span class="token number">0</span>.08s  <span class="token number">0.52</span>%  runtime.stdcall1</span>
<span class="line">     <span class="token number">0</span>.02s  <span class="token number">0.13</span>% <span class="token number">98.26</span>%      <span class="token number">0</span>.20s  <span class="token number">1.29</span>%  runtime.findRunnable</span>
<span class="line">     <span class="token number">0</span>.01s <span class="token number">0.065</span>% <span class="token number">98.32</span>%      <span class="token number">0</span>.09s  <span class="token number">0.58</span>%  runtime.startm</span>
<span class="line">         <span class="token number">0</span>     <span class="token number">0</span>% <span class="token number">98.32</span>%     <span class="token number">15</span>.13s <span class="token number">97.74</span>%  main.main</span>
<span class="line">         <span class="token number">0</span>     <span class="token number">0</span>% <span class="token number">98.32</span>%     <span class="token number">15</span>.13s <span class="token number">97.74</span>%  runtime.main</span>
<span class="line">         <span class="token number">0</span>     <span class="token number">0</span>% <span class="token number">98.32</span>%      <span class="token number">0</span>.32s  <span class="token number">2.07</span>%  runtime.mcall</span>
<span class="line">         <span class="token number">0</span>     <span class="token number">0</span>% <span class="token number">98.32</span>%      <span class="token number">0</span>.08s  <span class="token number">0.52</span>%  runtime.notewakeup</span>
<span class="line">         <span class="token number">0</span>     <span class="token number">0</span>% <span class="token number">98.32</span>%      <span class="token number">0</span>.31s  <span class="token number">2.00</span>%  runtime.park_m</span>
<span class="line">         </span>
<span class="line"><span class="token comment"># 说明</span></span>
<span class="line"><span class="token comment"># 15.22s指的是top列出来的采样时间，占据总的采样时间15.48s 的 98.32%</span></span>
<span class="line"><span class="token comment"># 函数main.A的flat时间是12.07秒，指的是函数A中直接操作的时间，不包含调用其他函数的时间</span></span>
<span class="line"><span class="token comment"># 函数main.A的cum 时间是15.13秒，指的是函数A中直接操作的时间 + 调用其他函数的时间</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># ----------------------------------------------------------------------------------</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 3、调整显示单位</span></span>
<span class="line"><span class="token punctuation">(</span>pprof<span class="token punctuation">)</span> <span class="token assign-left variable">unit</span><span class="token operator">=</span>milliseconds </span>
<span class="line"><span class="token punctuation">(</span>pprof<span class="token punctuation">)</span> <span class="token function">top</span></span>
<span class="line">Showing nodes accounting <span class="token keyword">for</span> 15220ms, <span class="token number">98.32</span>% of 15480ms total</span>
<span class="line">Dropped <span class="token number">31</span> nodes <span class="token punctuation">(</span>cum <span class="token operator">&lt;=</span> <span class="token number">77</span>.40ms<span class="token punctuation">)</span></span>
<span class="line">Showing <span class="token function">top</span> <span class="token number">10</span> nodes out of <span class="token number">14</span></span>
<span class="line">      flat  flat%   sum%        cum   cum%</span>
<span class="line">   12070ms <span class="token number">77.97</span>% <span class="token number">77.97</span>%    15130ms <span class="token number">97.74</span>%  main.A</span>
<span class="line">    3040ms <span class="token number">19.64</span>% <span class="token number">97.61</span>%     3050ms <span class="token number">19.70</span>%  main.B</span>
<span class="line">      80ms  <span class="token number">0.52</span>% <span class="token number">98.13</span>%       80ms  <span class="token number">0.52</span>%  runtime.stdcall1</span>
<span class="line">      20ms  <span class="token number">0.13</span>% <span class="token number">98.26</span>%      200ms  <span class="token number">1.29</span>%  runtime.findRunnable</span>
<span class="line">      10ms <span class="token number">0.065</span>% <span class="token number">98.32</span>%       90ms  <span class="token number">0.58</span>%  runtime.startm</span>
<span class="line">         <span class="token number">0</span>     <span class="token number">0</span>% <span class="token number">98.32</span>%    15130ms <span class="token number">97.74</span>%  main.main</span>
<span class="line">         <span class="token number">0</span>     <span class="token number">0</span>% <span class="token number">98.32</span>%    15130ms <span class="token number">97.74</span>%  runtime.main</span>
<span class="line">         <span class="token number">0</span>     <span class="token number">0</span>% <span class="token number">98.32</span>%      320ms  <span class="token number">2.07</span>%  runtime.mcall</span>
<span class="line">         <span class="token number">0</span>     <span class="token number">0</span>% <span class="token number">98.32</span>%       80ms  <span class="token number">0.52</span>%  runtime.notewakeup</span>
<span class="line">         <span class="token number">0</span>     <span class="token number">0</span>% <span class="token number">98.32</span>%      310ms  <span class="token number">2.00</span>%  runtime.park_m</span>
<span class="line"></span>
<span class="line"><span class="token comment"># ----------------------------------------------------------------------------------</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 4、查看函数A的详细信息</span></span>
<span class="line"><span class="token punctuation">(</span>pprof<span class="token punctuation">)</span> list A </span>
<span class="line">Total: 15480ms</span>
<span class="line">ROUTINE <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span> main.A <span class="token keyword">in</span> D:<span class="token punctuation">\</span>application<span class="token punctuation">\</span>GoLand<span class="token punctuation">\</span>example<span class="token punctuation">\</span>main.go</span>
<span class="line">   12070ms    15130ms <span class="token punctuation">(</span>flat, cum<span class="token punctuation">)</span> <span class="token number">97.74</span>% of Total</span>
<span class="line">         <span class="token builtin class-name">.</span>          <span class="token builtin class-name">.</span>     <span class="token number">16</span>:func <span class="token function-name function">A</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">         <span class="token builtin class-name">.</span>          <span class="token builtin class-name">.</span>     <span class="token number">17</span>:   // 程序计时</span>
<span class="line">         <span class="token builtin class-name">.</span>          <span class="token builtin class-name">.</span>     <span class="token number">18</span>:   start :<span class="token operator">=</span> time.Now<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">         <span class="token builtin class-name">.</span>          <span class="token builtin class-name">.</span>     <span class="token number">19</span>:   defer <span class="token function-name function">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">         <span class="token builtin class-name">.</span>          <span class="token builtin class-name">.</span>     <span class="token number">20</span>:           fmt.Printf<span class="token punctuation">(</span><span class="token string">&quot;Function-A    running time is %.2f seconds<span class="token entity" title="\n">\n</span>&quot;</span>, time.Since<span class="token punctuation">(</span>start<span class="token punctuation">)</span>.Seconds<span class="token punctuation">(</span><span class="token punctuation">))</span></span>
<span class="line">         <span class="token builtin class-name">.</span>          <span class="token builtin class-name">.</span>     <span class="token number">21</span>:   <span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">         <span class="token builtin class-name">.</span>          <span class="token builtin class-name">.</span>     <span class="token number">22</span>:   n :<span class="token operator">=</span> <span class="token number">10000</span> * <span class="token number">10000</span> * <span class="token number">800</span></span>
<span class="line">         <span class="token builtin class-name">.</span>          <span class="token builtin class-name">.</span>     <span class="token number">23</span>:   <span class="token function">sum</span> :<span class="token operator">=</span> <span class="token number">0</span></span>
<span class="line">   12070ms    12080ms     <span class="token number">24</span>:   <span class="token keyword">for</span> i :<span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i++ <span class="token punctuation">{</span></span>
<span class="line">         <span class="token builtin class-name">.</span>          <span class="token builtin class-name">.</span>     <span class="token number">25</span>:           <span class="token function">sum</span> <span class="token operator">+=</span> i</span>
<span class="line">         <span class="token builtin class-name">.</span>          <span class="token builtin class-name">.</span>     <span class="token number">26</span>:   <span class="token punctuation">}</span></span>
<span class="line">         <span class="token builtin class-name">.</span>     3050ms     <span class="token number">27</span>:   B<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">         <span class="token builtin class-name">.</span>          <span class="token builtin class-name">.</span>     <span class="token number">28</span>:<span class="token punctuation">}</span></span>
<span class="line">         <span class="token builtin class-name">.</span>          <span class="token builtin class-name">.</span>     <span class="token number">29</span>:</span>
<span class="line">         <span class="token builtin class-name">.</span>          <span class="token builtin class-name">.</span>     <span class="token number">30</span>:func <span class="token function-name function">B</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">         <span class="token builtin class-name">.</span>          <span class="token builtin class-name">.</span>     <span class="token number">31</span>:   // 程序计时</span>
<span class="line">         <span class="token builtin class-name">.</span>          <span class="token builtin class-name">.</span>     <span class="token number">32</span>:   start :<span class="token operator">=</span> time.Now<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre></div><p>3、以Web方式解析CPU Profile文件</p><div class="language-bash" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token comment"># 打开Profile文件</span></span>
<span class="line">D:<span class="token punctuation">\</span>application<span class="token punctuation">\</span>GoLand<span class="token punctuation">\</span>example<span class="token operator">&gt;</span> go tool pprof <span class="token parameter variable">-http</span><span class="token operator">=</span>:8080 cpu.prof  </span>
<span class="line">Serving web UI on http://localhost:8080</span>
<span class="line"></span></code></pre></div><p>（1）Graph视图：默认视图</p><ul><li>runtime.main调用了main方法，main方法调用了A方法，A方法又调用了B方法</li><li>12.07 / 15.13和3.04 / 3.05就是我们之前看到的flat和cum值</li></ul><p><img src="https://tuchuang-1257805459.cos.accelerate.myqcloud.com//image-20230204154458824.png" alt="image-20230204154458824"></p><p>（2）Top视图：View --&gt; Top</p><ul><li>点击对应的列可以进行升序或降序排序</li><li>修改显示单位的话需要手动修改URL查询字符串，比如 http://localhost:8080/ui/top?unit=milliseconds</li></ul><p><img src="https://tuchuang-1257805459.cos.accelerate.myqcloud.com//image-20230204154808874.png" alt="image-20230204154808874"></p><p>（3）火焰图：View --&gt; Flame Graph</p><p><img src="https://tuchuang-1257805459.cos.accelerate.myqcloud.com//image-20230204155316910.png" alt="image-20230204155316910"></p></details><details class="hint-container details"><summary>（2）采集堆内存Heap Memory Profile</summary><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">package</span> main</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">(</span></span>
<span class="line">	<span class="token string">&quot;flag&quot;</span></span>
<span class="line">	<span class="token string">&quot;fmt&quot;</span></span>
<span class="line">	<span class="token string">&quot;log&quot;</span></span>
<span class="line">	<span class="token string">&quot;os&quot;</span></span>
<span class="line">	<span class="token string">&quot;runtime&quot;</span></span>
<span class="line">	<span class="token string">&quot;runtime/pprof&quot;</span></span>
<span class="line">	<span class="token string">&quot;strconv&quot;</span></span>
<span class="line">	<span class="token string">&quot;time&quot;</span></span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">var</span> <span class="token punctuation">(</span></span>
<span class="line">	cpuprofile <span class="token operator">=</span> flag<span class="token punctuation">.</span><span class="token function">String</span><span class="token punctuation">(</span><span class="token string">&quot;cpuprofile&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;write cpu profile to file&quot;</span><span class="token punctuation">)</span></span>
<span class="line">	memprofile <span class="token operator">=</span> flag<span class="token punctuation">.</span><span class="token function">String</span><span class="token punctuation">(</span><span class="token string">&quot;memprofile&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;write memory profile to file&quot;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">A</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token comment">// 程序计时</span></span>
<span class="line">	start <span class="token operator">:=</span> time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token keyword">defer</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">		fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;Function-A    running time is %.2f seconds\n&quot;</span><span class="token punctuation">,</span> time<span class="token punctuation">.</span><span class="token function">Since</span><span class="token punctuation">(</span>start<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Seconds</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 程序逻辑</span></span>
<span class="line">	<span class="token keyword">var</span> s <span class="token builtin">string</span></span>
<span class="line">	<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10000</span><span class="token operator">*</span><span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span></span>
<span class="line">		s <span class="token operator">+=</span> strconv<span class="token punctuation">.</span><span class="token function">Itoa</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line">	s <span class="token operator">+=</span> <span class="token string">&quot;hello world!&quot;</span></span>
<span class="line">	<span class="token function">B</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">B</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token comment">// 程序计时</span></span>
<span class="line">	start <span class="token operator">:=</span> time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token keyword">defer</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">		fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;Function-B    running time is %.2f seconds\n&quot;</span><span class="token punctuation">,</span> time<span class="token punctuation">.</span><span class="token function">Since</span><span class="token punctuation">(</span>start<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Seconds</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 程序逻辑</span></span>
<span class="line">	data <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10000</span><span class="token operator">*</span><span class="token number">100</span><span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span></span>
<span class="line">		data <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> i<span class="token punctuation">)</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token comment">// 程序计时</span></span>
<span class="line">	start <span class="token operator">:=</span> time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token keyword">defer</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">		fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;Function-Main running time is %.2f seconds\n&quot;</span><span class="token punctuation">,</span> time<span class="token punctuation">.</span><span class="token function">Since</span><span class="token punctuation">(</span>start<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Seconds</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 解析命令行参数</span></span>
<span class="line">	flag<span class="token punctuation">.</span><span class="token function">Parse</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 采集 CPU Profile</span></span>
<span class="line">	<span class="token keyword">if</span> <span class="token operator">*</span>cpuprofile <span class="token operator">!=</span> <span class="token string">&quot;&quot;</span> <span class="token punctuation">{</span></span>
<span class="line">		f<span class="token punctuation">,</span> err <span class="token operator">:=</span> os<span class="token punctuation">.</span><span class="token function">Create</span><span class="token punctuation">(</span><span class="token operator">*</span>cpuprofile<span class="token punctuation">)</span></span>
<span class="line">		<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span></span>
<span class="line">			log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span></span>
<span class="line">		<span class="token punctuation">}</span></span>
<span class="line">        <span class="token keyword">defer</span> f<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">		err <span class="token operator">=</span> pprof<span class="token punctuation">.</span><span class="token function">StartCPUProfile</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span></span>
<span class="line">		<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span></span>
<span class="line">			log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span></span>
<span class="line">		<span class="token punctuation">}</span></span>
<span class="line">		<span class="token keyword">defer</span> pprof<span class="token punctuation">.</span><span class="token function">StopCPUProfile</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 采集 Memory Profile</span></span>
<span class="line">	<span class="token keyword">if</span> <span class="token operator">*</span>memprofile <span class="token operator">!=</span> <span class="token string">&quot;&quot;</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token comment">// 内存概要信息采样频率，代表每分配多少个字节，就对堆内存的使用情况进行一次采样</span></span>
<span class="line">		runtime<span class="token punctuation">.</span>MemProfileRate <span class="token operator">=</span> <span class="token number">1</span></span>
<span class="line">		<span class="token keyword">defer</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">			f<span class="token punctuation">,</span> err <span class="token operator">:=</span> os<span class="token punctuation">.</span><span class="token function">Create</span><span class="token punctuation">(</span><span class="token operator">*</span>memprofile<span class="token punctuation">)</span></span>
<span class="line">			<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span></span>
<span class="line">				log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span></span>
<span class="line">			<span class="token punctuation">}</span></span>
<span class="line">			<span class="token keyword">defer</span> f<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">			<span class="token comment">//runtime.GC()</span></span>
<span class="line">			err <span class="token operator">=</span> pprof<span class="token punctuation">.</span><span class="token function">WriteHeapProfile</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span></span>
<span class="line">			<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span></span>
<span class="line">				log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span></span>
<span class="line">			<span class="token punctuation">}</span></span>
<span class="line">		<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 主要的代码区域</span></span>
<span class="line">	<span class="token function">A</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre></div><p>输出结果</p><div class="language-bash" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token comment"># 1、执行程序</span></span>
<span class="line">D:<span class="token punctuation">\</span>application<span class="token punctuation">\</span>GoLand<span class="token punctuation">\</span>example<span class="token operator">&gt;</span> go run main.go <span class="token parameter variable">-memprofile</span><span class="token operator">=</span>mem.prof</span>
<span class="line">Function-B    running <span class="token function">time</span> is <span class="token number">0.01</span> seconds</span>
<span class="line">Function-A    running <span class="token function">time</span> is <span class="token number">3.19</span> seconds</span>
<span class="line">Function-Main running <span class="token function">time</span> is <span class="token number">3.22</span> seconds</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 2、打开Memory Profile文件</span></span>
<span class="line">D:<span class="token punctuation">\</span>application<span class="token punctuation">\</span>GoLand<span class="token punctuation">\</span>example<span class="token operator">&gt;</span> go tool pprof <span class="token parameter variable">-http</span><span class="token operator">=</span>:8080 mem.prof </span>
<span class="line">Serving web UI on http://localhost:8080</span>
<span class="line"></span></code></pre></div><p><strong>1、Top视图：SAMPLE类型默认是inuse_space</strong></p><p><img src="https://tuchuang-1257805459.cos.accelerate.myqcloud.com//image-20230204155817805.png" alt="image-20230204155817805"></p><p><strong>2、内存SAMPLE说明</strong></p><ul><li>inuse_space：已分配但尚未释放的内存量</li><li>inuse_objects：已分配但尚未释放的对象数量</li><li>alloc_space：分配的内存总量（包含已释放的）</li><li>alloc_objects：分配的对象总数（包含已释放的）</li></ul></details><details class="hint-container details"><summary>（3）采集Goroutine信息</summary><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">package</span> main</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">(</span></span>
<span class="line">	<span class="token string">&quot;flag&quot;</span></span>
<span class="line">	<span class="token string">&quot;log&quot;</span></span>
<span class="line">	<span class="token string">&quot;os&quot;</span></span>
<span class="line">	<span class="token string">&quot;runtime&quot;</span></span>
<span class="line">	<span class="token string">&quot;runtime/pprof&quot;</span></span>
<span class="line">	<span class="token string">&quot;time&quot;</span></span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">var</span> <span class="token punctuation">(</span></span>
<span class="line">	cpuprofile       <span class="token operator">=</span> flag<span class="token punctuation">.</span><span class="token function">String</span><span class="token punctuation">(</span><span class="token string">&quot;cpuprofile&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;write cpu profile to file&quot;</span><span class="token punctuation">)</span></span>
<span class="line">	memprofile       <span class="token operator">=</span> flag<span class="token punctuation">.</span><span class="token function">String</span><span class="token punctuation">(</span><span class="token string">&quot;memprofile&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;write memory profile to file&quot;</span><span class="token punctuation">)</span></span>
<span class="line">	goroutineprofile <span class="token operator">=</span> flag<span class="token punctuation">.</span><span class="token function">String</span><span class="token punctuation">(</span><span class="token string">&quot;goroutineprofile&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;write goroutine profile to file&quot;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token comment">// 解析命令行参数</span></span>
<span class="line">	flag<span class="token punctuation">.</span><span class="token function">Parse</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 采集 CPU Profile</span></span>
<span class="line">	<span class="token keyword">if</span> <span class="token operator">*</span>cpuprofile <span class="token operator">!=</span> <span class="token string">&quot;&quot;</span> <span class="token punctuation">{</span></span>
<span class="line">		f<span class="token punctuation">,</span> err <span class="token operator">:=</span> os<span class="token punctuation">.</span><span class="token function">Create</span><span class="token punctuation">(</span><span class="token operator">*</span>cpuprofile<span class="token punctuation">)</span></span>
<span class="line">		<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span></span>
<span class="line">			log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span></span>
<span class="line">		<span class="token punctuation">}</span></span>
<span class="line">		<span class="token keyword">defer</span> f<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">		err <span class="token operator">=</span> pprof<span class="token punctuation">.</span><span class="token function">StartCPUProfile</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span></span>
<span class="line">		<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span></span>
<span class="line">			log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span></span>
<span class="line">		<span class="token punctuation">}</span></span>
<span class="line">		<span class="token keyword">defer</span> pprof<span class="token punctuation">.</span><span class="token function">StopCPUProfile</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 采集 Memory Profile</span></span>
<span class="line">	<span class="token keyword">if</span> <span class="token operator">*</span>memprofile <span class="token operator">!=</span> <span class="token string">&quot;&quot;</span> <span class="token punctuation">{</span></span>
<span class="line">		runtime<span class="token punctuation">.</span>MemProfileRate <span class="token operator">=</span> <span class="token number">1</span></span>
<span class="line">		<span class="token keyword">defer</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">			f<span class="token punctuation">,</span> err <span class="token operator">:=</span> os<span class="token punctuation">.</span><span class="token function">Create</span><span class="token punctuation">(</span><span class="token operator">*</span>memprofile<span class="token punctuation">)</span></span>
<span class="line">			<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span></span>
<span class="line">				log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span></span>
<span class="line">			<span class="token punctuation">}</span></span>
<span class="line">			<span class="token keyword">defer</span> f<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">			<span class="token comment">//runtime.GC()</span></span>
<span class="line">			err <span class="token operator">=</span> pprof<span class="token punctuation">.</span><span class="token function">WriteHeapProfile</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span></span>
<span class="line">			<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span></span>
<span class="line">				log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span></span>
<span class="line">			<span class="token punctuation">}</span></span>
<span class="line">		<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 采集 Goroutine Profile</span></span>
<span class="line">	<span class="token keyword">if</span> <span class="token operator">*</span>goroutineprofile <span class="token operator">!=</span> <span class="token string">&quot;&quot;</span> <span class="token punctuation">{</span></span>
<span class="line">		<span class="token keyword">defer</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">			f<span class="token punctuation">,</span> err <span class="token operator">:=</span> os<span class="token punctuation">.</span><span class="token function">Create</span><span class="token punctuation">(</span><span class="token operator">*</span>goroutineprofile<span class="token punctuation">)</span></span>
<span class="line">			<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span></span>
<span class="line">				log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span></span>
<span class="line">			<span class="token punctuation">}</span></span>
<span class="line">			<span class="token keyword">defer</span> f<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">			goroutineProfile <span class="token operator">:=</span> pprof<span class="token punctuation">.</span><span class="token function">Lookup</span><span class="token punctuation">(</span><span class="token string">&quot;goroutine&quot;</span><span class="token punctuation">)</span></span>
<span class="line">			<span class="token keyword">if</span> goroutineProfile <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span></span>
<span class="line">				log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span><span class="token string">&quot;pprof not found goroutine profile&quot;</span><span class="token punctuation">)</span></span>
<span class="line">			<span class="token punctuation">}</span></span>
<span class="line">			err <span class="token operator">=</span> goroutineProfile<span class="token punctuation">.</span><span class="token function">WriteTo</span><span class="token punctuation">(</span>f<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span></span>
<span class="line">			<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span></span>
<span class="line">				log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span></span>
<span class="line">			<span class="token punctuation">}</span></span>
<span class="line">		<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 主要的代码区域</span></span>
<span class="line">	<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span></span>
<span class="line">		<span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">			<span class="token keyword">for</span> <span class="token punctuation">{</span></span>
<span class="line">			<span class="token punctuation">}</span></span>
<span class="line">		<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 休眠1秒钟，等待所有的Goroutine都运行起来</span></span>
<span class="line">	time<span class="token punctuation">.</span><span class="token function">Sleep</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span>Second<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre></div><p>输出结果</p><div class="language-bash" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token comment"># 1、执行程序</span></span>
<span class="line">D:<span class="token punctuation">\</span>application<span class="token punctuation">\</span>GoLand<span class="token punctuation">\</span>example<span class="token operator">&gt;</span> go run main.go <span class="token parameter variable">-goroutineprofile</span><span class="token operator">=</span>goroutine.prof</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 2、打开Goroutine Profile文件</span></span>
<span class="line">D:<span class="token punctuation">\</span>application<span class="token punctuation">\</span>GoLand<span class="token punctuation">\</span>example<span class="token operator">&gt;</span> go tool pprof <span class="token parameter variable">-http</span><span class="token operator">=</span>:8080 goroutine.prof</span>
<span class="line"></span></code></pre></div><p><img src="https://tuchuang-1257805459.cos.accelerate.myqcloud.com//image-20230204162627192.png" alt="image-20230204162627192"></p></details><br><p><strong>2、HTTP服务方式采集Profile</strong></p><details class="hint-container details"><summary>点击查看详情</summary><ul><li>只需要添加 <code>_ &quot;net/http/pprof&quot;</code> 即可</li></ul><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">package</span> main</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">(</span></span>
<span class="line">	<span class="token string">&quot;fmt&quot;</span></span>
<span class="line">	<span class="token string">&quot;io&quot;</span></span>
<span class="line">	<span class="token string">&quot;log&quot;</span></span>
<span class="line">	<span class="token string">&quot;net/http&quot;</span></span>
<span class="line">	<span class="token boolean">_</span> <span class="token string">&quot;net/http/pprof&quot;</span></span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 处理器</span></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">indexHandler</span><span class="token punctuation">(</span>w http<span class="token punctuation">.</span>ResponseWriter<span class="token punctuation">,</span> req <span class="token operator">*</span>http<span class="token punctuation">.</span>Request<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	io<span class="token punctuation">.</span><span class="token function">WriteString</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> <span class="token string">&quot;Hello, world!\n&quot;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token comment">// 监听地址</span></span>
<span class="line">	addr <span class="token operator">:=</span> <span class="token string">&quot;127.0.0.1:80&quot;</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 注册路由</span></span>
<span class="line">	http<span class="token punctuation">.</span><span class="token function">HandleFunc</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">,</span> indexHandler<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 启动服务</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;* Running on http://&quot;</span> <span class="token operator">+</span> addr<span class="token punctuation">)</span></span>
<span class="line">	log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>http<span class="token punctuation">.</span><span class="token function">ListenAndServe</span><span class="token punctuation">(</span>addr<span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre></div><p>输出结果</p><div class="language-bash" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line">D:<span class="token punctuation">\</span>application<span class="token punctuation">\</span>GoLand<span class="token punctuation">\</span>example<span class="token operator">&gt;</span>go run main.go</span>
<span class="line">* Running on http://127.0.0.1:80</span>
<span class="line"></span></code></pre></div><p>1、通过交互式终端访问</p><div class="language-bash" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token comment"># 执行命令</span></span>
<span class="line"><span class="token comment"># 1.需要等待指定的seconds秒数，这里是60秒</span></span>
<span class="line"><span class="token comment"># 2.在等待期间手动或者使用命令访问几次Web服务，否则PProf抓取不到数据，在这里使用 ab -c 10 -n 1000 http://127.0.0.1/ 访问1000次</span></span>
<span class="line">D:<span class="token punctuation">\</span>application<span class="token punctuation">\</span>GoLand<span class="token punctuation">\</span>example<span class="token operator">&gt;</span>go tool pprof http://127.0.0.1:80/debug/pprof/profile?seconds<span class="token operator">=</span><span class="token number">60</span>   </span>
<span class="line">Fetching profile over HTTP from http://127.0.0.1:80/debug/pprof/profile?seconds<span class="token operator">=</span><span class="token number">60</span></span>
<span class="line">Saved profile <span class="token keyword">in</span> C:<span class="token punctuation">\</span>Users<span class="token punctuation">\</span>Administrator<span class="token punctuation">\</span>pprof<span class="token punctuation">\</span>pprof.main.exe.samples.cpu.001.pb.gz</span>
<span class="line">File: main.exe</span>
<span class="line">Build ID: C:<span class="token punctuation">\</span>Users<span class="token punctuation">\</span>Administrator<span class="token punctuation">\</span>AppData<span class="token punctuation">\</span>Local<span class="token punctuation">\</span>Temp<span class="token punctuation">\</span>go-build201671595<span class="token punctuation">\</span>b001<span class="token punctuation">\</span>exe<span class="token punctuation">\</span>main.exe2023-02-04 <span class="token number">16</span>:28:41.4866189 +0800 CST</span>
<span class="line">Type: cpu</span>
<span class="line">Time: Feb <span class="token number">4</span>, <span class="token number">2023</span> at <span class="token number">4</span>:36pm <span class="token punctuation">(</span>CST<span class="token punctuation">)</span></span>
<span class="line">Duration: <span class="token number">60</span>.01s, Total samples <span class="token operator">=</span> <span class="token number">0</span></span>
<span class="line">No samples were found with the default sample value type.</span>
<span class="line">Try <span class="token string">&quot;sample_index&quot;</span> <span class="token builtin class-name">command</span> to analyze different sample values.</span>
<span class="line">Entering interactive mode <span class="token punctuation">(</span>type <span class="token string">&quot;help&quot;</span> <span class="token keyword">for</span> commands, <span class="token string">&quot;o&quot;</span> <span class="token keyword">for</span> options<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">(</span>pprof<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 查看数据</span></span>
<span class="line"><span class="token punctuation">(</span>pprof<span class="token punctuation">)</span> <span class="token function">top</span></span>
<span class="line">Showing nodes accounting <span class="token keyword">for</span> 220ms, <span class="token number">100</span>% of 220ms total                           </span>
<span class="line">Showing <span class="token function">top</span> <span class="token number">10</span> nodes out of <span class="token number">100</span>                                                   </span>
<span class="line">      flat  flat%   sum%        cum   cum%                                        </span>
<span class="line">     130ms <span class="token number">59.09</span>% <span class="token number">59.09</span>%      130ms <span class="token number">59.09</span>%  runtime.cgocall                       </span>
<span class="line">      10ms  <span class="token number">4.55</span>% <span class="token number">63.64</span>%       10ms  <span class="token number">4.55</span>%  net/http.htmlSig.match                </span>
<span class="line">      10ms  <span class="token number">4.55</span>% <span class="token number">68.18</span>%       10ms  <span class="token number">4.55</span>%  runtime.<span class="token punctuation">(</span>*mheap<span class="token punctuation">)</span>.initSpan             </span>
<span class="line">      10ms  <span class="token number">4.55</span>% <span class="token number">72.73</span>%       10ms  <span class="token number">4.55</span>%  runtime.lockextra                     </span>
<span class="line">      10ms  <span class="token number">4.55</span>% <span class="token number">77.27</span>%       10ms  <span class="token number">4.55</span>%  runtime.readUintptr                   </span>
<span class="line">      10ms  <span class="token number">4.55</span>% <span class="token number">81.82</span>%       10ms  <span class="token number">4.55</span>%  runtime.stdcall1                      </span>
<span class="line">      10ms  <span class="token number">4.55</span>% <span class="token number">86.36</span>%       10ms  <span class="token number">4.55</span>%  runtime.stdcall2                      </span>
<span class="line">      10ms  <span class="token number">4.55</span>% <span class="token number">90.91</span>%       10ms  <span class="token number">4.55</span>%  runtime.writeHeapBits.write           </span>
<span class="line">      10ms  <span class="token number">4.55</span>% <span class="token number">95.45</span>%       10ms  <span class="token number">4.55</span>%  runtime/internal/atomic.<span class="token punctuation">(</span>*Uint64<span class="token punctuation">)</span>.Load</span>
<span class="line">      10ms  <span class="token number">4.55</span>%   <span class="token number">100</span>%      140ms <span class="token number">63.64</span>%  syscall.SyscallN</span>
<span class="line"></span></code></pre></div><p>注意上的输出，他会把Profile文件下载到本地 Saved profile in xxx，所以我们还可以利用本地起一个HTTP Server来分析，来看一下火焰图</p><div class="language-bash" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line">D:<span class="token punctuation">\</span>application<span class="token punctuation">\</span>GoLand<span class="token punctuation">\</span>example<span class="token operator">&gt;</span>go tool pprof <span class="token parameter variable">-http</span><span class="token operator">=</span>:8080 C:<span class="token punctuation">\</span>Users<span class="token punctuation">\</span>Administrator<span class="token punctuation">\</span>pprof<span class="token punctuation">\</span>pprof.main.exe.samples.cpu.001.pb.gz </span>
<span class="line">Serving web UI on http://localhost:8080</span>
<span class="line"></span></code></pre></div><p><img src="https://tuchuang-1257805459.cos.accelerate.myqcloud.com//image-20230204170130522.png" alt="image-20230204170130522"></p><p>2、通过Web界面访问</p><p><img src="https://tuchuang-1257805459.cos.accelerate.myqcloud.com//image-20230204164525538.png" alt="image-20230204164525538"></p></details><br><h3 id="高效字符串拼接" tabindex="-1"><a class="header-anchor" href="#高效字符串拼接"><span>高效字符串拼接</span></a></h3><details class="hint-container details"><summary>点击查看详情</summary><p><code>main_test.go</code></p><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">package</span> main</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">(</span></span>
<span class="line">	<span class="token string">&quot;bytes&quot;</span></span>
<span class="line">	<span class="token string">&quot;fmt&quot;</span></span>
<span class="line">	<span class="token string">&quot;strings&quot;</span></span>
<span class="line">	<span class="token string">&quot;testing&quot;</span></span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">var</span> s <span class="token operator">=</span> <span class="token string">&quot;hello world!&quot;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">BenchmarkStringAdd</span><span class="token punctuation">(</span>b <span class="token operator">*</span>testing<span class="token punctuation">.</span>B<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token keyword">var</span> str <span class="token builtin">string</span></span>
<span class="line">	<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> b<span class="token punctuation">.</span>N<span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span></span>
<span class="line">		str <span class="token operator">+=</span> s</span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">BenchmarkFmtSprintf</span><span class="token punctuation">(</span>b <span class="token operator">*</span>testing<span class="token punctuation">.</span>B<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token keyword">var</span> str <span class="token builtin">string</span></span>
<span class="line">	<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> b<span class="token punctuation">.</span>N<span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span></span>
<span class="line">		str <span class="token operator">=</span> fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span><span class="token string">&quot;%s%s&quot;</span><span class="token punctuation">,</span> str<span class="token punctuation">,</span> s<span class="token punctuation">)</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">BenchmarkByteBuffer</span><span class="token punctuation">(</span>b <span class="token operator">*</span>testing<span class="token punctuation">.</span>B<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token keyword">var</span> buffer bytes<span class="token punctuation">.</span>Buffer</span>
<span class="line">	<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> b<span class="token punctuation">.</span>N<span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span></span>
<span class="line">		buffer<span class="token punctuation">.</span><span class="token function">WriteString</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line">	<span class="token boolean">_</span> <span class="token operator">=</span> buffer<span class="token punctuation">.</span><span class="token function">String</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">BenchmarkStringsBuilder</span><span class="token punctuation">(</span>b <span class="token operator">*</span>testing<span class="token punctuation">.</span>B<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token keyword">var</span> builder strings<span class="token punctuation">.</span>Builder</span>
<span class="line">	<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> b<span class="token punctuation">.</span>N<span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span></span>
<span class="line">		builder<span class="token punctuation">.</span><span class="token function">WriteString</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line">	<span class="token boolean">_</span> <span class="token operator">=</span> builder<span class="token punctuation">.</span><span class="token function">String</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre></div><p>输出结果</p><div class="language-bash" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line">D:<span class="token punctuation">\</span>application<span class="token punctuation">\</span>GoLand<span class="token punctuation">\</span>example<span class="token operator">&gt;</span>go <span class="token builtin class-name">test</span> <span class="token parameter variable">-bench</span> <span class="token builtin class-name">.</span></span>
<span class="line">goos: windows</span>
<span class="line">goarch: amd64</span>
<span class="line">pkg: example</span>
<span class="line">cpu: Intel<span class="token punctuation">(</span>R<span class="token punctuation">)</span> Core<span class="token punctuation">(</span>TM<span class="token punctuation">)</span> i7-4790K CPU @ <span class="token number">4</span>.00GHz</span>
<span class="line">BenchmarkStringAdd-8              <span class="token number">108938</span>            <span class="token number">117779</span> ns/op</span>
<span class="line">BenchmarkFmtSprintf-8              <span class="token number">35947</span>            <span class="token number">117132</span> ns/op</span>
<span class="line">BenchmarkByteBuffer-8           <span class="token number">51002842</span>                <span class="token number">21.09</span> ns/op</span>
<span class="line">BenchmarkStringsBuilder-8       <span class="token number">80014401</span>                <span class="token number">15.30</span> ns/op</span>
<span class="line">PASS</span>
<span class="line">ok      example <span class="token number">21</span>.414s</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 分析结果: </span></span>
<span class="line"><span class="token comment"># 1、推荐使用strings.Builder</span></span>
<span class="line"><span class="token comment"># 2、还有一个常用的函数strings.Join用于将字符串类型的切片转为字符串，其内部也是调用的strings.Builder</span></span>
<span class="line"></span></code></pre></div></details><br><h3 id="内联函数" tabindex="-1"><a class="header-anchor" href="#内联函数"><span>内联函数</span></a></h3><ul><li>内联概念：比如说函数A调用了函数B，那么将函数B内联优化后，在函数A中会展开函数B的内容，而不是调用函数B</li><li>内联优势：避免了函数调用所带来的开销，使运行速度更快</li><li>内联劣势：编译后二进制体积会更大</li><li>何时发生： <ul><li>默认情况下由编译器决定是否内联</li><li>使用<code>go build -gcflags=&quot;-l&quot;</code>参数可设置全局关闭内联，若使用<code>-l -l</code>或更多的<code>-l</code>则又会打开内联，并启用更激进的内联策略</li><li>使用<code>//go:noinline</code>（写在函数定义的上一行, //和go之间不能有空格）告诉编译器对某个函数不要进行内联</li></ul></li></ul><details class="hint-container details"><summary>（1）使用内联和不使用内联性能对比</summary><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">package</span> main</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token string">&quot;testing&quot;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">//go:noinline</span></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">maxNoinline</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token builtin">int</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token keyword">if</span> a <span class="token operator">&lt;</span> b <span class="token punctuation">{</span></span>
<span class="line">		<span class="token keyword">return</span> b</span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line">	<span class="token keyword">return</span> a</span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">maxInline</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token builtin">int</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token keyword">if</span> a <span class="token operator">&lt;</span> b <span class="token punctuation">{</span></span>
<span class="line">		<span class="token keyword">return</span> b</span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line">	<span class="token keyword">return</span> a</span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">BenchmarkNoInline</span><span class="token punctuation">(</span>b <span class="token operator">*</span>testing<span class="token punctuation">.</span>B<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	x<span class="token punctuation">,</span> y <span class="token operator">:=</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span></span>
<span class="line">	b<span class="token punctuation">.</span><span class="token function">ResetTimer</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> b<span class="token punctuation">.</span>N<span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span></span>
<span class="line">		<span class="token function">maxNoinline</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">BenchmarkInline</span><span class="token punctuation">(</span>b <span class="token operator">*</span>testing<span class="token punctuation">.</span>B<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	x<span class="token punctuation">,</span> y <span class="token operator">:=</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span></span>
<span class="line">	b<span class="token punctuation">.</span><span class="token function">ResetTimer</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> b<span class="token punctuation">.</span>N<span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span></span>
<span class="line">		<span class="token function">maxInline</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre></div><p>输出结果</p><div class="language-bash" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line">D:<span class="token punctuation">\</span>application<span class="token punctuation">\</span>GoLand<span class="token punctuation">\</span>example<span class="token operator">&gt;</span>go <span class="token builtin class-name">test</span> <span class="token parameter variable">-bench</span> <span class="token builtin class-name">.</span></span>
<span class="line">goos: windows</span>
<span class="line">goarch: amd64</span>
<span class="line">pkg: example</span>
<span class="line">cpu: Intel<span class="token punctuation">(</span>R<span class="token punctuation">)</span> Core<span class="token punctuation">(</span>TM<span class="token punctuation">)</span> i7-4790K CPU @ <span class="token number">4</span>.00GHz</span>
<span class="line">BenchmarkNoInline-8     <span class="token number">794989972</span>                <span class="token number">1.436</span> ns/op</span>
<span class="line">BenchmarkInline-8       <span class="token number">1000000000</span>               <span class="token number">0.2432</span> ns/op</span>
<span class="line">PASS</span>
<span class="line">ok      example <span class="token number">3</span>.981s</span>
<span class="line"></span></code></pre></div></details><details class="hint-container details"><summary>（2）查看编译器优化策略</summary><div class="language-bash" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line">package main</span>
<span class="line"></span>
<span class="line">func add<span class="token punctuation">(</span>a, b int<span class="token punctuation">)</span> int <span class="token punctuation">{</span></span>
<span class="line">	<span class="token builtin class-name">return</span> a + b</span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">func sub<span class="token punctuation">(</span>a, b int<span class="token punctuation">)</span> int <span class="token punctuation">{</span></span>
<span class="line">	<span class="token builtin class-name">return</span> a - b</span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">func <span class="token function-name function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	add<span class="token punctuation">(</span><span class="token number">1</span>, <span class="token number">2</span><span class="token punctuation">)</span></span>
<span class="line">	sub<span class="token punctuation">(</span><span class="token number">1</span>, <span class="token number">2</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre></div><p>输出结果</p><div class="language-bash" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token comment"># -gcflags=&quot;-m&quot; 用于输出编译器优化策略，如果使用两个-m则输出更多内容</span></span>
<span class="line">D:<span class="token punctuation">\</span>application<span class="token punctuation">\</span>GoLand<span class="token punctuation">\</span>example<span class="token operator">&gt;</span>go build <span class="token parameter variable">-gcflags</span><span class="token operator">=</span><span class="token string">&quot;-m&quot;</span> main.go    </span>
<span class="line"><span class="token comment"># command-line-arguments</span></span>
<span class="line">.<span class="token punctuation">\</span>main.go:3:6: can inline <span class="token function">add</span></span>
<span class="line">.<span class="token punctuation">\</span>main.go:7:6: can inline sub</span>
<span class="line">.<span class="token punctuation">\</span>main.go:11:6: can inline main</span>
<span class="line">.<span class="token punctuation">\</span>main.go:12:5: inlining call to <span class="token function">add</span></span>
<span class="line">.<span class="token punctuation">\</span>main.go:13:5: inlining call to sub</span>
<span class="line"></span>
<span class="line">D:<span class="token punctuation">\</span>application<span class="token punctuation">\</span>GoLand<span class="token punctuation">\</span>example<span class="token operator">&gt;</span>go build <span class="token parameter variable">-gcflags</span><span class="token operator">=</span><span class="token string">&quot;-m -m&quot;</span> main.go </span>
<span class="line"><span class="token comment"># command-line-arguments</span></span>
<span class="line">.<span class="token punctuation">\</span>main.go:3:6: can inline <span class="token function">add</span> with cost <span class="token number">4</span> as: func<span class="token punctuation">(</span>int, int<span class="token punctuation">)</span> int <span class="token punctuation">{</span> <span class="token builtin class-name">return</span> a + b <span class="token punctuation">}</span></span>
<span class="line">.<span class="token punctuation">\</span>main.go:7:6: can inline sub with cost <span class="token number">4</span> as: func<span class="token punctuation">(</span>int, int<span class="token punctuation">)</span> int <span class="token punctuation">{</span> <span class="token builtin class-name">return</span> a - b <span class="token punctuation">}</span></span>
<span class="line">.<span class="token punctuation">\</span>main.go:11:6: can inline main with cost <span class="token number">16</span> as: <span class="token function-name function">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> add<span class="token punctuation">(</span><span class="token number">1</span>, <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span> sub<span class="token punctuation">(</span><span class="token number">1</span>, <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">}</span></span>
<span class="line">.<span class="token punctuation">\</span>main.go:12:5: inlining call to <span class="token function">add</span></span>
<span class="line">.<span class="token punctuation">\</span>main.go:13:5: inlining call to sub</span>
<span class="line"></span></code></pre></div></details><br><h3 id="代码生成" tabindex="-1"><a class="header-anchor" href="#代码生成"><span>代码生成</span></a></h3><p>文档：<a href="https://go.dev/blog/generate" target="_blank" rel="noopener noreferrer">https://go.dev/blog/generate</a></p><details class="hint-container details"><summary>（1）generate说明</summary><p>简单来说 就是在Go代码中添加特定的注释（比如<code>//go:generate command arg1 arg2</code>），然后执行命令 <code>go generate</code> 便能为我们自动生成代码</p><p>其原理是是调用 <code>command</code> 命令，并将 <code>arg1 arg2</code>作为参数传递给 <code>command</code></p></details><details class="hint-container details"><summary>（2）generate测试：stringer</summary><p>1、安装stringer作为command</p><div class="language-bash" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token comment"># 安装stringer</span></span>
<span class="line">D:<span class="token punctuation">\</span>application<span class="token punctuation">\</span>GoLand<span class="token punctuation">\</span>example<span class="token operator">&gt;</span>go <span class="token function">install</span> golang.org/x/tools/cmd/stringer@latest</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 查看帮助</span></span>
<span class="line">D:<span class="token punctuation">\</span>application<span class="token punctuation">\</span>GoLand<span class="token punctuation">\</span>example<span class="token operator">&gt;</span>stringer <span class="token parameter variable">-h</span></span>
<span class="line">Usage of stringer:                                                  </span>
<span class="line">        stringer <span class="token punctuation">[</span>flags<span class="token punctuation">]</span> <span class="token parameter variable">-type</span> T <span class="token punctuation">[</span>directory<span class="token punctuation">]</span>                        </span>
<span class="line">        stringer <span class="token punctuation">[</span>flags<span class="token punctuation">]</span> <span class="token parameter variable">-type</span> T files<span class="token punctuation">..</span>. <span class="token comment"># Must be a single package</span></span>
<span class="line">For <span class="token function">more</span> information, see:                                          </span>
<span class="line">        https://pkg.go.dev/golang.org/x/tools/cmd/stringer          </span>
<span class="line">Flags:                                                              </span>
<span class="line">  <span class="token parameter variable">-linecomment</span>                                                      </span>
<span class="line">        use line comment text as printed text when present          </span>
<span class="line">  <span class="token parameter variable">-output</span> string                                                    </span>
<span class="line">        output <span class="token function">file</span> name<span class="token punctuation">;</span> default srcdir/<span class="token operator">&lt;</span>type<span class="token operator">&gt;</span>_string.go</span>
<span class="line">  <span class="token parameter variable">-tags</span> string                                                      </span>
<span class="line">        comma-separated list of build tags to apply</span>
<span class="line">  <span class="token parameter variable">-trimprefix</span> prefix</span>
<span class="line">        trim the prefix from the generated constant names</span>
<span class="line">  <span class="token parameter variable">-type</span> string</span>
<span class="line">        comma-separated list of <span class="token builtin class-name">type</span> names<span class="token punctuation">;</span> must be <span class="token builtin class-name">set</span></span>
<span class="line"></span></code></pre></div><p>2、编写Go代码</p><p>项目根目录下创建一个文件 <code>weekday/weekday.go</code></p><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">package</span> weekday</span>
<span class="line"></span>
<span class="line"><span class="token comment">//go:generate stringer -type=Weekday</span></span>
<span class="line"><span class="token keyword">type</span> Weekday <span class="token builtin">int8</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">const</span> <span class="token punctuation">(</span></span>
<span class="line">	Sunday    Weekday <span class="token operator">=</span> <span class="token boolean">iota</span> <span class="token comment">// 星期日</span></span>
<span class="line">	Monday                   <span class="token comment">// 星期一</span></span>
<span class="line">	Tuesday                  <span class="token comment">// 星期二</span></span>
<span class="line">	Wednesday                <span class="token comment">// 星期三</span></span>
<span class="line">	Thursday                 <span class="token comment">// 星期四</span></span>
<span class="line">	Friday                   <span class="token comment">// 星期五</span></span>
<span class="line">	Saterday                 <span class="token comment">// 星期六</span></span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre></div><p>3、生成代码（可多次执行）</p><div class="language-bash" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token comment"># 生成代码方式1：指定单个文件</span></span>
<span class="line">D:<span class="token punctuation">\</span>application<span class="token punctuation">\</span>GoLand<span class="token punctuation">\</span>example<span class="token operator">&gt;</span>go generate weekday/weekday.go</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 生成代码方式2: 指定所有文件(推荐)</span></span>
<span class="line">D:<span class="token punctuation">\</span>application<span class="token punctuation">\</span>GoLand<span class="token punctuation">\</span>example<span class="token operator">&gt;</span>go generate ./<span class="token punctuation">..</span>.</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 上面的步骤等同于</span></span>
<span class="line">D:<span class="token punctuation">\</span>application<span class="token punctuation">\</span>GoLand<span class="token punctuation">\</span>example<span class="token operator">&gt;</span>stringer <span class="token parameter variable">-type</span><span class="token operator">=</span>Weekday weekday/weekday.go</span>
<span class="line"></span></code></pre></div><p>4、查看新生成的代码：看不懂没关系，这就不是给人看的</p><p><code>weekday_string.go</code></p><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token comment">// Code generated by &quot;stringer -type=Weekday&quot;; DO NOT EDIT.</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">package</span> weekday</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token string">&quot;strconv&quot;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token boolean">_</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token comment">// An &quot;invalid array index&quot; compiler error signifies that the constant values have changed.</span></span>
<span class="line">	<span class="token comment">// Re-run the stringer command to generate them again.</span></span>
<span class="line">	<span class="token keyword">var</span> x <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token keyword">struct</span><span class="token punctuation">{</span><span class="token punctuation">}</span></span>
<span class="line">	<span class="token boolean">_</span> <span class="token operator">=</span> x<span class="token punctuation">[</span>Sunday<span class="token operator">-</span><span class="token number">0</span><span class="token punctuation">]</span></span>
<span class="line">	<span class="token boolean">_</span> <span class="token operator">=</span> x<span class="token punctuation">[</span>Monday<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span></span>
<span class="line">	<span class="token boolean">_</span> <span class="token operator">=</span> x<span class="token punctuation">[</span>Tuesday<span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">]</span></span>
<span class="line">	<span class="token boolean">_</span> <span class="token operator">=</span> x<span class="token punctuation">[</span>Wednesday<span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">]</span></span>
<span class="line">	<span class="token boolean">_</span> <span class="token operator">=</span> x<span class="token punctuation">[</span>Thursday<span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">]</span></span>
<span class="line">	<span class="token boolean">_</span> <span class="token operator">=</span> x<span class="token punctuation">[</span>Friday<span class="token operator">-</span><span class="token number">5</span><span class="token punctuation">]</span></span>
<span class="line">	<span class="token boolean">_</span> <span class="token operator">=</span> x<span class="token punctuation">[</span>Saterday<span class="token operator">-</span><span class="token number">6</span><span class="token punctuation">]</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">const</span> _Weekday_name <span class="token operator">=</span> <span class="token string">&quot;SundayMondayTuesdayWednesdayThursdayFridaySaterday&quot;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">var</span> _Weekday_index <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">...</span><span class="token punctuation">]</span><span class="token builtin">uint8</span><span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">19</span><span class="token punctuation">,</span> <span class="token number">28</span><span class="token punctuation">,</span> <span class="token number">36</span><span class="token punctuation">,</span> <span class="token number">42</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token punctuation">(</span>i Weekday<span class="token punctuation">)</span> <span class="token function">String</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">string</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token keyword">if</span> i <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token operator">||</span> i <span class="token operator">&gt;=</span> <span class="token function">Weekday</span><span class="token punctuation">(</span><span class="token function">len</span><span class="token punctuation">(</span>_Weekday_index<span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">		<span class="token keyword">return</span> <span class="token string">&quot;Weekday(&quot;</span> <span class="token operator">+</span> strconv<span class="token punctuation">.</span><span class="token function">FormatInt</span><span class="token punctuation">(</span><span class="token function">int64</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;)&quot;</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line">	<span class="token keyword">return</span> _Weekday_name<span class="token punctuation">[</span>_Weekday_index<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">:</span>_Weekday_index<span class="token punctuation">[</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre></div><p>5、编写<code>main.go</code></p><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">package</span> main</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">(</span></span>
<span class="line">	<span class="token string">&quot;example/weekday&quot;</span></span>
<span class="line">	<span class="token string">&quot;fmt&quot;</span></span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token keyword">var</span> day weekday<span class="token punctuation">.</span>Weekday <span class="token operator">=</span> <span class="token number">0</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>day<span class="token punctuation">.</span><span class="token function">String</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre></div><p>输出结果</p><div class="language-bash" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line">D:<span class="token punctuation">\</span>application<span class="token punctuation">\</span>GoLand<span class="token punctuation">\</span>example<span class="token operator">&gt;</span>go run main.go</span>
<span class="line">Sunday  <span class="token comment"># 默认会使用变量名作为String()的返回值</span></span>
<span class="line"></span></code></pre></div><p>6、修改返回值（添加-linecomment参数）</p><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token comment">//go:generate stringer -type=Weekday -linecomment</span></span>
<span class="line"><span class="token keyword">type</span> Weekday <span class="token builtin">int8</span></span>
<span class="line"></span></code></pre></div><p>7、重新生成并执行</p><div class="language-bash" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token comment"># 重新生成代码,原来的文件不需要删除，会覆盖</span></span>
<span class="line">D:<span class="token punctuation">\</span>application<span class="token punctuation">\</span>GoLand<span class="token punctuation">\</span>example<span class="token operator">&gt;</span>go generate ./<span class="token punctuation">..</span>.</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 再次执行，会把我们的注释作为返回值返回</span></span>
<span class="line">D:<span class="token punctuation">\</span>application<span class="token punctuation">\</span>GoLand<span class="token punctuation">\</span>example<span class="token operator">&gt;</span>go run main.go</span>
<span class="line">星期日</span>
<span class="line"></span></code></pre></div></details><h2 id="-7" tabindex="-1"><a class="header-anchor" href="#-7"><span></span></a></h2><h2 id="编译与反编译" tabindex="-1"><a class="header-anchor" href="#编译与反编译"><span>编译与反编译</span></a></h2><h3 id="编译过程-1" tabindex="-1"><a class="header-anchor" href="#编译过程-1"><span>编译过程</span></a></h3><p><code>go help build</code>查看可使用的选项</p><ul><li>-x：输出编译命令（会真正编译）</li><li>-n：输出编译命令（不真正编译）</li><li>-work：输出编译所用的临时目录，并且编译完成后不删除它</li></ul><details class="hint-container details"><summary>（1）查看编译过程</summary><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">package</span> main</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token string">&quot;fmt&quot;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;Hello World!&quot;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre></div><p>输出结果</p><div class="language-bash" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line">D:<span class="token punctuation">\</span>application<span class="token punctuation">\</span>GoLand<span class="token punctuation">\</span>example<span class="token operator">&gt;</span>go build <span class="token parameter variable">-x</span> main.go</span>
<span class="line"><span class="token assign-left variable">WORK</span><span class="token operator">=</span>C:<span class="token punctuation">\</span>Users<span class="token punctuation">\</span>Administrator<span class="token punctuation">\</span>AppData<span class="token punctuation">\</span>Local<span class="token punctuation">\</span>Temp<span class="token punctuation">\</span>go-build1315443961</span>
<span class="line"><span class="token function">mkdir</span> <span class="token parameter variable">-p</span> <span class="token variable">$WORK</span><span class="token punctuation">\</span>b001<span class="token punctuation">\</span></span>
<span class="line"><span class="token function">cat</span> <span class="token operator">&gt;</span>C:<span class="token punctuation">\</span>Users<span class="token punctuation">\</span>Administrator<span class="token punctuation">\</span>AppData<span class="token punctuation">\</span>Local<span class="token punctuation">\</span>Temp<span class="token punctuation">\</span>go-build1315443961<span class="token punctuation">\</span>b001<span class="token punctuation">\</span>importcfg <span class="token operator">&lt;&lt;</span> <span class="token string">&#39;EOF&#39;<span class="token bash punctuation"> <span class="token comment"># internal</span></span></span>
<span class="line"># import config</span>
<span class="line">packagefile fmt=C:\Users\Administrator\AppData\Local\go-build\d0\d008751497390b11b47f716af2d48f0a52b4e4f15ad4e96f852ce896600f7a11-d</span>
<span class="line">packagefile runtime=C:\Users\Administrator\AppData\Local\go-build\dc\dca431b4db090566a675628d7dcbf136445f9a95f641dae937f91ea22bd2d4d9-d</span>
<span class="line">EOF</span></span>
<span class="line"><span class="token builtin class-name">cd</span> D:<span class="token punctuation">\</span>application<span class="token punctuation">\</span>GoLand<span class="token punctuation">\</span>example</span>
<span class="line"><span class="token string">&quot;D:<span class="token entity" title="\\">\\</span>software<span class="token entity" title="\\">\\</span>go1.21<span class="token entity" title="\\">\\</span>pkg<span class="token entity" title="\\">\\</span>tool<span class="token entity" title="\\">\\</span>windows_amd64<span class="token entity" title="\\">\\</span>compile.exe&quot;</span> <span class="token parameter variable">-o</span> <span class="token string">&quot;<span class="token variable">$WORK</span><span class="token entity" title="\\">\\</span>b001<span class="token entity" title="\\">\\</span>_pkg_.a&quot;</span> <span class="token parameter variable">-trimpath</span> <span class="token string">&quot;<span class="token variable">$WORK</span><span class="token entity" title="\\">\\</span>b001=&gt;&quot;</span> <span class="token parameter variable">-p</span> main <span class="token parameter variable">-complete</span> <span class="token parameter variable">-buildid</span> Lvvb2G_hP_XZ3usgOuTV/Lvvb2G_hP_XZ3usgOuTV <span class="token parameter variable">-goversion</span> go1.20.1 <span class="token parameter variable">-c</span><span class="token operator">=</span><span class="token number">4</span> <span class="token parameter variable">-nolocalimports</span> <span class="token parameter variable">-importc</span></span>
<span class="line"><span class="token function">fg</span> <span class="token string">&quot;<span class="token variable">$WORK</span><span class="token entity" title="\\">\\</span>b001<span class="token entity" title="\\">\\</span>importcfg&quot;</span> <span class="token parameter variable">-pack</span> <span class="token string">&quot;D:<span class="token entity" title="\\">\\</span>application<span class="token entity" title="\\">\\</span>GoLand<span class="token entity" title="\\">\\</span>example<span class="token entity" title="\\">\\</span>main.go&quot;</span></span>
<span class="line"><span class="token string">&quot;D:<span class="token entity" title="\\">\\</span>software<span class="token entity" title="\\">\\</span>go1.21<span class="token entity" title="\\">\\</span>pkg<span class="token entity" title="\\">\\</span>tool<span class="token entity" title="\\">\\</span>windows_amd64<span class="token entity" title="\\">\\</span>buildid.exe&quot;</span> <span class="token parameter variable">-w</span> <span class="token string">&quot;<span class="token variable">$WORK</span><span class="token entity" title="\\">\\</span>b001<span class="token entity" title="\\">\\</span>_pkg_.a&quot;</span> <span class="token comment"># internal</span></span>
<span class="line"><span class="token function">cp</span> <span class="token string">&quot;<span class="token variable">$WORK</span><span class="token entity" title="\\">\\</span>b001<span class="token entity" title="\\">\\</span>_pkg_.a&quot;</span> <span class="token string">&quot;C:<span class="token entity" title="\\">\\</span>Users<span class="token entity" title="\\">\\</span>Administrator<span class="token entity" title="\\">\\</span>AppData<span class="token entity" title="\\">\\</span>Local<span class="token entity" title="\\">\\</span>go-build<span class="token entity" title="\\">\\</span>d3<span class="token entity" title="\\">\\</span>d3b4da9f72bf2ddd499f74a20719b0b6f0653ba57a010820a6af34ee295b013e-d&quot;</span> <span class="token comment"># internal</span></span>
<span class="line"><span class="token function">cat</span> <span class="token operator">&gt;</span>C:<span class="token punctuation">\</span>Users<span class="token punctuation">\</span>Administrator<span class="token punctuation">\</span>AppData<span class="token punctuation">\</span>Local<span class="token punctuation">\</span>Temp<span class="token punctuation">\</span>go-build1315443961<span class="token punctuation">\</span>b001<span class="token punctuation">\</span>importcfg.link <span class="token operator">&lt;&lt;</span> <span class="token string">&#39;EOF&#39;<span class="token bash punctuation"> <span class="token comment"># internal   </span></span></span>
<span class="line">packagefile command-line-arguments=C:\Users\Administrator\AppData\Local\Temp\go-build1315443961\b001\_pkg_.a</span>
<span class="line">packagefile fmt=C:\Users\Administrator\AppData\Local\go-build\d0\d008751497390b11b47f716af2d48f0a52b4e4f15ad4e96f852ce896600f7a11-d</span>
<span class="line">packagefile runtime=C:\Users\Administrator\AppData\Local\go-build\dc\dca431b4db090566a675628d7dcbf136445f9a95f641dae937f91ea22bd2d4d9-d</span>
<span class="line">packagefile errors=C:\Users\Administrator\AppData\Local\go-build\22\22340e4366791f28988f6f3a7575d8aa9d265a337f86db249f8e2d1646b8536a-d</span>
<span class="line">packagefile internal/fmtsort=C:\Users\Administrator\AppData\Local\go-build\3f\3fd6aa7af7a08e705df8e8cb9fb108ed65ef986360dbda26bf751410c3a39a92-d</span>
<span class="line">packagefile io=C:\Users\Administrator\AppData\Local\go-build\97\97df67bc71f7570fa8f4eac00d9b9c61b439b1de1302e129b1115865e7d7c3f0-d</span>
<span class="line">packagefile math=C:\Users\Administrator\AppData\Local\go-build\2b\2ba07274a733f57ed10ea4bdf76311e25cecf552eca3b8fad78933c66fc6c4eb-d</span>
<span class="line">packagefile os=C:\Users\Administrator\AppData\Local\go-build\ce\ce5c7fa71ee246560c70b4617e2378a9350cd6ab635aa8b563c2ef491ad6999d-d</span>
<span class="line">packagefile reflect=C:\Users\Administrator\AppData\Local\go-build\d4\d43a8556707f808aab38d01959b7cb7fecc6c439d9cf9c48f482245fb7b5c657-d</span>
<span class="line">packagefile sort=C:\Users\Administrator\AppData\Local\go-build\27\27c3c6071b32e60ae3120228932bc2b694f17920cd6e2ee32638509bb77da635-d</span>
<span class="line">packagefile strconv=C:\Users\Administrator\AppData\Local\go-build\c8\c8a4ee954af0570536683f4073282acd047a0cceae89f6ab5b88b1cb4bd79100-d</span>
<span class="line">packagefile sync=C:\Users\Administrator\AppData\Local\go-build\45\45d5d1367ce2963835a3a556257da29e1c92365e2de346f0ae0dbbc16d6aae18-d</span>
<span class="line">packagefile unicode/utf8=C:\Users\Administrator\AppData\Local\go-build\eb\eba51109f217adfb74fee345457554f88b19d810b0cbc1e412f9ef0a1a1cbb12-d</span>
<span class="line">packagefile internal/abi=C:\Users\Administrator\AppData\Local\go-build\46\464fe3375423d934b34e66de338c0fc9fe28461865b53cf759e0947f7c938936-d</span>
<span class="line">packagefile internal/bytealg=C:\Users\Administrator\AppData\Local\go-build\c5\c56ae7575c75d81e23ce7b391325acf8a179ab64977582e69841577685ebae2a-d</span>
<span class="line">packagefile internal/coverage/rtcov=C:\Users\Administrator\AppData\Local\go-build\c3\c3d14dd3818d67f1128aff71e06ed75535a4a02bcc17061e441c5350b3ada97b-d</span>
<span class="line">packagefile internal/cpu=C:\Users\Administrator\AppData\Local\go-build\e9\e95f1c11f5b671b30445e88a4c3e1287fa414d9b26b7ba2d52c185b483ad90d6-d</span>
<span class="line">packagefile internal/goarch=C:\Users\Administrator\AppData\Local\go-build\6f\6fad28715acd394720e72837056967c0edb9d25d9346ab5af37884d9664f83d7-d</span>
<span class="line">packagefile internal/goexperiment=C:\Users\Administrator\AppData\Local\go-build\df\dfb99caf170c7d7fafecf1cc7e1646789b9fd36a4ce5d1c1729ef6b231e18e43-d</span>
<span class="line">packagefile internal/goos=C:\Users\Administrator\AppData\Local\go-build\8d\8dce0662be9de7e7187efcf7d7b9f7ce6fd2bc8a818da5e97448d07453ce9487-d</span>
<span class="line">packagefile runtime/internal/atomic=C:\Users\Administrator\AppData\Local\go-build\87\87eb5a1df29da1e540d700507b81647a113070d4bfac796f39a9b5bb72951e83-d</span>
<span class="line">packagefile runtime/internal/math=C:\Users\Administrator\AppData\Local\go-build\fb\fbfe122c54f39c16e6248588247c633785bfdd1803e61aa866db9d8382df41da-d</span>
<span class="line">packagefile runtime/internal/sys=C:\Users\Administrator\AppData\Local\go-build\1a\1a232e62b66e49a4736220bfbd16f052741940834787ebda972f48457f4b6c35-d</span>
<span class="line">packagefile internal/reflectlite=C:\Users\Administrator\AppData\Local\go-build\ee\eea138a62871ca89d08372e85ed43910b9b00ca6ec2b1f329943541efec00800-d</span>
<span class="line">packagefile math/bits=C:\Users\Administrator\AppData\Local\go-build\e3\e3e4d7abc7d9de219db31dbb3e6e841f078950ef083351ac654c5725acf9ef51-d</span>
<span class="line">packagefile internal/itoa=C:\Users\Administrator\AppData\Local\go-build\70\708a7883b82e58fa8ba023ac983f961b6a66327d6f6bd54a07b76a39e033c741-d</span>
<span class="line">packagefile internal/poll=C:\Users\Administrator\AppData\Local\go-build\0c\0c05dccbfddcfae4266371c925b634dd7e7f5e0e5312581ac079a21b6333ebef-d</span>
<span class="line">packagefile unicode=C:\Users\Administrator\AppData\Local\go-build\69\69ea000512b7cca606b0b6ec1602da34f5310f13a3bfc8053f92f2423746938e-d</span>
<span class="line">packagefile internal/race=C:\Users\Administrator\AppData\Local\go-build\af\af16ab7bf9027876983a2bbdb41af8fa9b8470171ed55f94e994ae573ac5176f-d</span>
<span class="line">packagefile internal/syscall/windows/sysdll=C:\Users\Administrator\AppData\Local\go-build\e2\e285864ad3bee135571cefd7bc643a2acfb030eacf31c4232c65a6ed99095f58-d</span>
<span class="line">packagefile internal/oserror=C:\Users\Administrator\AppData\Local\go-build\33\33e7514715431c2090d782d02f563a1addb0a540224befae479b38957c4ff56f-d</span>
<span class="line">packagefile path=C:\Users\Administrator\AppData\Local\go-build\3d\3d7bdea151cf8ecea3f0e470bdc6b0bb45a5fc8d20519b2b4834c848fb33f1ab-d</span>
<span class="line">packagefile internal/syscall/windows/registry=C:\Users\Administrator\AppData\Local\go-build\30\30f31e001bc5b82d506417871d973383a64464e8794fde68194efca52d56d663-d</span>
<span class="line">modinfo &quot;0w\xaf\f\x92t\b\x02A\xe1\xc1\a\xe6\xd6\x18\xe6path\tcommand-line-arguments\nbuild\t-buildmode=exe\nbuild\t-compiler=gc\nbuild\tCGO_ENABLED=0\nbuild\tGOARCH=amd64\nbuild\tGOOS=windows\nbuild\tGOAMD64=v1\n\xf92C1\x86\x18 r\x0</span>
<span class="line">0\x82B\x10A\x16\xd8\xf2&quot;</span>
<span class="line">EOF</span></span>
<span class="line"><span class="token function">mkdir</span> <span class="token parameter variable">-p</span> <span class="token variable">$WORK</span><span class="token punctuation">\</span>b001<span class="token punctuation">\</span>exe<span class="token punctuation">\</span></span>
<span class="line"><span class="token builtin class-name">cd</span> <span class="token builtin class-name">.</span></span>
<span class="line"><span class="token string">&quot;D:<span class="token entity" title="\\">\\</span>software<span class="token entity" title="\\">\\</span>go1.21<span class="token entity" title="\\">\\</span>pkg<span class="token entity" title="\\">\\</span>tool<span class="token entity" title="\\">\\</span>windows_amd64<span class="token entity" title="\\">\\</span>link.exe&quot;</span> <span class="token parameter variable">-o</span> <span class="token string">&quot;<span class="token variable">$WORK</span><span class="token entity" title="\\">\\</span>b001<span class="token entity" title="\\">\\</span>exe<span class="token entity" title="\\">\\</span>a.out.exe&quot;</span> <span class="token parameter variable">-importcfg</span> <span class="token string">&quot;<span class="token variable">$WORK</span><span class="token entity" title="\\">\\</span>b001<span class="token entity" title="\\">\\</span>importcfg.link&quot;</span> <span class="token parameter variable">-buildmode</span><span class="token operator">=</span>pie <span class="token parameter variable">-buildid</span><span class="token operator">=</span>Syb1GKdua8HgR-f5H8Sf/Lvvb2G_hP_XZ3usgOuTV/PnPlne2vLU_3XuTkyDQG/Syb1GKdua8Hg</span>
<span class="line">R-f5H8Sf <span class="token parameter variable">-extld</span><span class="token operator">=</span>gcc <span class="token string">&quot;<span class="token variable">$WORK</span><span class="token entity" title="\\">\\</span>b001<span class="token entity" title="\\">\\</span>_pkg_.a&quot;</span></span>
<span class="line"><span class="token string">&quot;D:<span class="token entity" title="\\">\\</span>software<span class="token entity" title="\\">\\</span>go1.21<span class="token entity" title="\\">\\</span>pkg<span class="token entity" title="\\">\\</span>tool<span class="token entity" title="\\">\\</span>windows_amd64<span class="token entity" title="\\">\\</span>buildid.exe&quot;</span> <span class="token parameter variable">-w</span> <span class="token string">&quot;<span class="token variable">$WORK</span><span class="token entity" title="\\">\\</span>b001<span class="token entity" title="\\">\\</span>exe<span class="token entity" title="\\">\\</span>a.out.exe&quot;</span> <span class="token comment"># internal</span></span>
<span class="line"><span class="token function">cp</span> <span class="token variable">$WORK</span><span class="token punctuation">\</span>b001<span class="token punctuation">\</span>exe<span class="token punctuation">\</span>a.out.exe main.exe</span>
<span class="line"><span class="token function">rm</span> <span class="token parameter variable">-r</span> <span class="token variable">$WORK</span><span class="token punctuation">\</span>b001<span class="token punctuation">\</span></span>
<span class="line"></span></code></pre></div></details><details class="hint-container details"><summary>（2）查看动态链接库</summary><p><strong>测试1：对于极简单的程序不会依赖任何动态链接库</strong></p><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">package</span> main</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token string">&quot;fmt&quot;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;Hello World!&quot;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre></div><p>输出结果</p><div class="language-bash" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token comment"># 编译</span></span>
<span class="line"><span class="token punctuation">[</span>root@ap-hongkang demo<span class="token punctuation">]</span><span class="token comment"># go build main.go</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 查看大小</span></span>
<span class="line"><span class="token punctuation">[</span>root@ap-hongkang demo<span class="token punctuation">]</span><span class="token comment"># ls -lh main</span></span>
<span class="line">-rwxr-xr-x <span class="token number">1</span> root root <span class="token number">1</span>.8M Feb  <span class="token number">3</span> <span class="token number">12</span>:38 main</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 查看动态链接库，没有任何依赖</span></span>
<span class="line"><span class="token punctuation">[</span>root@ap-hongkang demo<span class="token punctuation">]</span><span class="token comment"># ldd main</span></span>
<span class="line">        not a dynamic executable</span>
<span class="line"></span></code></pre></div><p><strong>测试2：对于部分标准库会依赖CGO相关的链接库</strong></p><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">package</span> main</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">(</span></span>
<span class="line">	<span class="token string">&quot;fmt&quot;</span></span>
<span class="line">	<span class="token string">&quot;io&quot;</span></span>
<span class="line">	<span class="token string">&quot;log&quot;</span></span>
<span class="line">	<span class="token string">&quot;net/http&quot;</span></span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 处理器</span></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">indexHandler</span><span class="token punctuation">(</span>w http<span class="token punctuation">.</span>ResponseWriter<span class="token punctuation">,</span> req <span class="token operator">*</span>http<span class="token punctuation">.</span>Request<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	io<span class="token punctuation">.</span><span class="token function">WriteString</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> <span class="token string">&quot;Hello, world!\n&quot;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token comment">// 监听地址</span></span>
<span class="line">	addr <span class="token operator">:=</span> <span class="token string">&quot;127.0.0.1:80&quot;</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 注册路由</span></span>
<span class="line">	http<span class="token punctuation">.</span><span class="token function">HandleFunc</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">,</span> indexHandler<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// 启动服务</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;* Running on http://&quot;</span> <span class="token operator">+</span> addr<span class="token punctuation">)</span></span>
<span class="line">	log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>http<span class="token punctuation">.</span><span class="token function">ListenAndServe</span><span class="token punctuation">(</span>addr<span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre></div><p>输出结果</p><div class="language-bash" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token comment"># 编译</span></span>
<span class="line"><span class="token punctuation">[</span>root@ap-hongkang demo<span class="token punctuation">]</span><span class="token comment"># go build main.go </span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 查看大小</span></span>
<span class="line"><span class="token punctuation">[</span>root@ap-hongkang demo<span class="token punctuation">]</span><span class="token comment"># ls -lh main</span></span>
<span class="line">-rwxr-xr-x <span class="token number">1</span> root root <span class="token number">6</span>.3M Feb  <span class="token number">3</span> <span class="token number">12</span>:44 main</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 查看动态链接库,发现依赖系统的动态链接库</span></span>
<span class="line"><span class="token punctuation">[</span>root@ap-hongkang demo<span class="token punctuation">]</span><span class="token comment"># ldd main</span></span>
<span class="line">        linux-vdso.so.1 <span class="token punctuation">(</span>0x00007fffd0bf6000<span class="token punctuation">)</span></span>
<span class="line">        libpthread.so.0 <span class="token operator">=</span><span class="token operator">&gt;</span> /lib64/libpthread.so.0 <span class="token punctuation">(</span>0x00007ff3ad7c8000<span class="token punctuation">)</span></span>
<span class="line">        libc.so.6 <span class="token operator">=</span><span class="token operator">&gt;</span> /lib64/libc.so.6 <span class="token punctuation">(</span>0x00007ff3ad403000<span class="token punctuation">)</span></span>
<span class="line">        /lib64/ld-linux-x86-64.so.2 <span class="token punctuation">(</span>0x00007ff3ad9e8000<span class="token punctuation">)</span></span>
<span class="line">        </span>
<span class="line"><span class="token comment"># 关闭CGO，再重新编译一次，发现没有依赖</span></span>
<span class="line"><span class="token punctuation">[</span>root@ap-hongkang demo<span class="token punctuation">]</span><span class="token comment"># CGO_ENABLED=0 go build main.go</span></span>
<span class="line"><span class="token punctuation">[</span>root@ap-hongkang demo<span class="token punctuation">]</span><span class="token comment"># ls -lh main</span></span>
<span class="line">-rwxr-xr-x <span class="token number">1</span> root root <span class="token number">6</span>.2M Feb  <span class="token number">3</span> <span class="token number">12</span>:45 main</span>
<span class="line"><span class="token punctuation">[</span>root@ap-hongkang demo<span class="token punctuation">]</span><span class="token comment"># ldd main</span></span>
<span class="line">        not a dynamic executable</span>
<span class="line"></span></code></pre></div></details><br><h3 id="交叉编译" tabindex="-1"><a class="header-anchor" href="#交叉编译"><span>交叉编译</span></a></h3><details class="hint-container details"><summary>（1）查看所支持的平台和架构</summary><div class="language-bash" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line">C:<span class="token punctuation">\</span>Users<span class="token punctuation">\</span>Administrator<span class="token operator">&gt;</span>go tool dist list</span>
<span class="line">aix/ppc64</span>
<span class="line">android/386</span>
<span class="line">android/amd64</span>
<span class="line">android/arm</span>
<span class="line">android/arm64</span>
<span class="line">darwin/amd64</span>
<span class="line">darwin/arm64</span>
<span class="line">dragonfly/amd64</span>
<span class="line">freebsd/386</span>
<span class="line">freebsd/amd64</span>
<span class="line">freebsd/arm</span>
<span class="line">freebsd/arm64</span>
<span class="line">freebsd/riscv64</span>
<span class="line">illumos/amd64</span>
<span class="line">ios/amd64</span>
<span class="line">ios/arm64</span>
<span class="line">js/wasm</span>
<span class="line">linux/386</span>
<span class="line">linux/amd64</span>
<span class="line">linux/arm</span>
<span class="line">linux/arm64</span>
<span class="line">linux/loong64</span>
<span class="line">linux/mips</span>
<span class="line">linux/mips64</span>
<span class="line">linux/mips64le</span>
<span class="line">linux/mipsle</span>
<span class="line">linux/ppc64</span>
<span class="line">linux/ppc64le</span>
<span class="line">linux/riscv64</span>
<span class="line">linux/s390x</span>
<span class="line">netbsd/386</span>
<span class="line">netbsd/amd64</span>
<span class="line">netbsd/arm</span>
<span class="line">netbsd/arm64</span>
<span class="line">openbsd/386</span>
<span class="line">openbsd/amd64</span>
<span class="line">openbsd/arm</span>
<span class="line">openbsd/arm64</span>
<span class="line">openbsd/mips64</span>
<span class="line">plan9/386</span>
<span class="line">plan9/amd64</span>
<span class="line">plan9/arm</span>
<span class="line">solaris/amd64</span>
<span class="line">windows/386</span>
<span class="line">windows/amd64</span>
<span class="line">windows/arm</span>
<span class="line">windows/arm64</span>
<span class="line"></span></code></pre></div></details><details class="hint-container details"><summary>（2）交叉编译，或者叫做跨平台编译</summary><p>交叉编译简单来说指的是在当前平台上可以编译出其他平台的可执行程序，比如在Windows下编译Linux二进制程序</p><p>对于<code>go</code>来说主要控制3个变量：</p><ul><li>CGO_ENABLED=0：Go在编译时可以选择使用C链接库(C链接库不打包进程序)或纯Go编译(打包所有内容)，<code>CGO_ENABLED</code>参数控制是否启用<code>CGO</code></li><li>GOOS=&lt;目标平台的操作系统&gt;，比如<code>windows</code>、<code>linux</code>、<code>darwin</code>、<code>freebsd</code></li><li>GOARCH=&lt;目标平台的体系架构&gt;，比如<code>amd64</code>,<code>386</code>、<code>arm</code></li></ul><div class="language-bash" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token comment"># Windows下编译Linux和Mac64位可执行程序</span></span>
<span class="line">SET <span class="token assign-left variable">CGO_ENABLED</span><span class="token operator">=</span><span class="token number">0</span></span>
<span class="line">SET <span class="token assign-left variable">GOOS</span><span class="token operator">=</span>linux</span>
<span class="line">SET <span class="token assign-left variable">GOARCH</span><span class="token operator">=</span>amd64</span>
<span class="line">go build <span class="token builtin class-name">.</span></span>
<span class="line"></span>
<span class="line">SET <span class="token assign-left variable">CGO_ENABLED</span><span class="token operator">=</span><span class="token number">0</span></span>
<span class="line">SET <span class="token assign-left variable">GOOS</span><span class="token operator">=</span>darwin</span>
<span class="line">SET <span class="token assign-left variable">GOARCH</span><span class="token operator">=</span>amd64</span>
<span class="line">go build <span class="token builtin class-name">.</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># Mac下编译Linux和Windows64位可执行程序</span></span>
<span class="line"><span class="token assign-left variable">CGO_ENABLED</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">GOOS</span><span class="token operator">=</span>linux   <span class="token assign-left variable">GOARCH</span><span class="token operator">=</span>amd64 go build <span class="token builtin class-name">.</span></span>
<span class="line"><span class="token assign-left variable">CGO_ENABLED</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">GOOS</span><span class="token operator">=</span>windows <span class="token assign-left variable">GOARCH</span><span class="token operator">=</span>amd64 go build <span class="token builtin class-name">.</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># Linux下编译Mac和Windows 64位可执行程序</span></span>
<span class="line"><span class="token assign-left variable">CGO_ENABLED</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">GOOS</span><span class="token operator">=</span>darwin  <span class="token assign-left variable">GOARCH</span><span class="token operator">=</span>amd64 go build <span class="token builtin class-name">.</span></span>
<span class="line"><span class="token assign-left variable">CGO_ENABLED</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">GOOS</span><span class="token operator">=</span>windows <span class="token assign-left variable">GOARCH</span><span class="token operator">=</span>amd64 go build <span class="token builtin class-name">.</span></span>
<span class="line"></span></code></pre></div></details><details class="hint-container details"><summary>（3）条件编译：使用TAG</summary><ul><li>源代码的开头第一行以注释的形式指定需要编译的平台</li><li>编译条件的注释和package 语句之间一定要隔一行</li></ul><p><code>main.go</code></p><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">package</span> main</span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token function">Hello</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre></div><p><code>hello1.go</code></p><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token comment">//go:build windows</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">package</span> main</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token string">&quot;fmt&quot;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">Hello</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;Hello Windows!&quot;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre></div><p><code>hello2.go</code></p><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token comment">//go:build linux</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">package</span> main</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token string">&quot;fmt&quot;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">Hello</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;Hello Linux!&quot;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre></div><p>输出结果</p><div class="language-bash" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token comment"># Windows上执行</span></span>
<span class="line">D:<span class="token punctuation">\</span>application<span class="token punctuation">\</span>GoLand<span class="token punctuation">\</span>example<span class="token operator">&gt;</span>go run <span class="token builtin class-name">.</span></span>
<span class="line">Hello Windows<span class="token operator">!</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># Linux上执行</span></span>
<span class="line"><span class="token punctuation">[</span>root@ap-hongkang demo<span class="token punctuation">]</span><span class="token comment"># go run .</span></span>
<span class="line">Hello Linux<span class="token operator">!</span></span>
<span class="line"></span></code></pre></div></details><details class="hint-container details"><summary>（4）条件编译：使用文件后缀</summary><ul><li>使用文件后缀名区分不同的编译平台</li></ul><p><code>main.go</code></p><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">package</span> main</span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token function">Hello</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre></div><p><code>hello_windows_amd64.go</code></p><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">package</span> main</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token string">&quot;fmt&quot;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">Hello</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;Hello Windows!&quot;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre></div><p><code>hello_linux_amd64.go</code></p><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">package</span> main</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token string">&quot;fmt&quot;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">Hello</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;Hello Linux!&quot;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre></div><p>输出结果</p><div class="language-bash" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token comment"># Windows上执行</span></span>
<span class="line">D:<span class="token punctuation">\</span>application<span class="token punctuation">\</span>GoLand<span class="token punctuation">\</span>example<span class="token operator">&gt;</span>go run <span class="token builtin class-name">.</span></span>
<span class="line">Hello Windows<span class="token operator">!</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># Linux上执行</span></span>
<span class="line"><span class="token punctuation">[</span>root@ap-hongkang demo<span class="token punctuation">]</span><span class="token comment"># go run .</span></span>
<span class="line">Hello Linux<span class="token operator">!</span></span>
<span class="line"></span></code></pre></div></details><br><h3 id="编译选项" tabindex="-1"><a class="header-anchor" href="#编译选项"><span>编译选项</span></a></h3><ul><li><code>gc</code>代表编译器，<code>gcflags</code>代表编译器选项（注意这里的gc和我们平常说的垃圾回收GC不是一回事）</li><li><code>ld</code>代表链接器，<code>ldflags</code> 代表链接器选项</li></ul><details class="hint-container details"><summary>（1）自动注入版本信息</summary><p><code>main.go</code>：这只是一段普通的、简单的Go代码</p><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">package</span> main</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">(</span></span>
<span class="line">	<span class="token string">&quot;fmt&quot;</span></span>
<span class="line">	<span class="token string">&quot;os&quot;</span></span>
<span class="line">	<span class="token string">&quot;strings&quot;</span></span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">var</span> <span class="token punctuation">(</span></span>
<span class="line">	Version   <span class="token builtin">string</span></span>
<span class="line">	GoVersion <span class="token builtin">string</span></span>
<span class="line">	GitCommit <span class="token builtin">string</span></span>
<span class="line">	BuildTime <span class="token builtin">string</span></span>
<span class="line">	OS        <span class="token builtin">string</span></span>
<span class="line">	Arch      <span class="token builtin">string</span></span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	args <span class="token operator">:=</span> os<span class="token punctuation">.</span>Args</span>
<span class="line">	<span class="token keyword">if</span> <span class="token function">len</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span> <span class="token operator">&gt;=</span> <span class="token number">2</span> <span class="token punctuation">{</span></span>
<span class="line">		<span class="token keyword">if</span> strings<span class="token punctuation">.</span><span class="token function">ToLower</span><span class="token punctuation">(</span>args<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">&quot;--version&quot;</span> <span class="token operator">||</span> strings<span class="token punctuation">.</span><span class="token function">ToLower</span><span class="token punctuation">(</span>args<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">&quot;-v&quot;</span> <span class="token punctuation">{</span></span>
<span class="line">			fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;Version:             %s\n&quot;</span><span class="token punctuation">,</span> Version<span class="token punctuation">)</span></span>
<span class="line">			fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;Go version:          %s\n&quot;</span><span class="token punctuation">,</span> GoVersion<span class="token punctuation">)</span></span>
<span class="line">			fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;Git commit:          %s\n&quot;</span><span class="token punctuation">,</span> GitCommit<span class="token punctuation">)</span></span>
<span class="line">			fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;Build time:          %s\n&quot;</span><span class="token punctuation">,</span> BuildTime<span class="token punctuation">)</span></span>
<span class="line">			fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;OS/Arch:             %s/%s\n&quot;</span><span class="token punctuation">,</span> OS<span class="token punctuation">,</span> Arch<span class="token punctuation">)</span></span>
<span class="line">			<span class="token keyword">return</span></span>
<span class="line">		<span class="token punctuation">}</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre></div><p>输出结果</p><div class="language-bash" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token comment"># 定义变量</span></span>
<span class="line"><span class="token assign-left variable">AppVersion</span><span class="token operator">=</span>v1.0.0</span>
<span class="line"><span class="token assign-left variable">GoVersion</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span>go version <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">&#39;{print $3}&#39;</span><span class="token variable">)</span></span></span>
<span class="line"><span class="token assign-left variable">GitCommit</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">git</span> rev-parse <span class="token parameter variable">--short</span> HEAD <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span>/dev/null <span class="token operator">||</span> <span class="token builtin class-name">echo</span> unknown<span class="token variable">)</span></span></span>
<span class="line"><span class="token assign-left variable">BuildTime</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">date</span> +<span class="token string">&quot;%Y-%m-%d %H:%M:%S %Z %z&quot;</span><span class="token variable">)</span></span></span>
<span class="line"><span class="token assign-left variable">OS</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span>go <span class="token function">env</span> GOOS<span class="token variable">)</span></span></span>
<span class="line"><span class="token assign-left variable">Arch</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span>go <span class="token function">env</span> GOARCH<span class="token variable">)</span></span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 生成flags</span></span>
<span class="line"><span class="token assign-left variable">flags</span><span class="token operator">=</span><span class="token string">&quot;-X main.Version=<span class="token variable">${AppVersion}</span> \</span>
<span class="line">       -X main.GoVersion=<span class="token variable">${GoVersion}</span> \</span>
<span class="line">       -X main.GitCommit=<span class="token variable">${GitCommit}</span> \</span>
<span class="line">       -X &#39;main.BuildTime=<span class="token variable">${BuildTime}</span>&#39; \</span>
<span class="line">       -X main.OS=<span class="token variable">${OS}</span> \</span>
<span class="line">       -X main.Arch=<span class="token variable">${Arch}</span>&quot;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 编译</span></span>
<span class="line">go build <span class="token parameter variable">-ldflags</span> <span class="token string">&quot;<span class="token variable">${flags}</span>&quot;</span> <span class="token builtin class-name">.</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 输出结果</span></span>
<span class="line"><span class="token punctuation">[</span>root@localhost example<span class="token punctuation">]</span><span class="token comment"># ./example -v</span></span>
<span class="line">Version:             v1.0.0</span>
<span class="line">Go version:          go1.18.9</span>
<span class="line">Git commit:          unknown</span>
<span class="line">Build time:          <span class="token number">2023</span>-04-16 <span class="token number">13</span>:46:43 CST +0800</span>
<span class="line">OS/Arch:             linux/amd64</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 分析</span></span>
<span class="line"><span class="token comment"># 这种方法对于 go install 很不友好</span></span>
<span class="line"></span></code></pre></div></details><br><h3 id="汇编相关" tabindex="-1"><a class="header-anchor" href="#汇编相关"><span>汇编相关</span></a></h3><details class="hint-container details"><summary>（1）查看汇编代码：使用Go原生方法</summary><p>我们通过分析<code>new</code>、<code>make</code>、<code>go</code>等关键字的汇编代码，查找他们实际运行的代码</p><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">package</span> main</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token string">&quot;fmt&quot;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">type</span> Empty <span class="token keyword">struct</span><span class="token punctuation">{</span><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">type</span> Point <span class="token keyword">struct</span> <span class="token punctuation">{</span></span>
<span class="line">	X <span class="token builtin">int</span></span>
<span class="line">	Y <span class="token builtin">int</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token comment">// new</span></span>
<span class="line">	empty <span class="token operator">:=</span> <span class="token function">new</span><span class="token punctuation">(</span>Empty<span class="token punctuation">)</span> <span class="token comment">// 第14行</span></span>
<span class="line">	point <span class="token operator">:=</span> <span class="token function">new</span><span class="token punctuation">(</span>Point<span class="token punctuation">)</span> <span class="token comment">// 第15行</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// make</span></span>
<span class="line">	s <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>          <span class="token comment">// 第18行</span></span>
<span class="line">	m <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token comment">// 第19行</span></span>
<span class="line">	c <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token keyword">struct</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>     <span class="token comment">// 第20行</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// go</span></span>
<span class="line">	<span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 第23行</span></span>
<span class="line">		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;Hello World!&quot;</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>empty<span class="token punctuation">)</span> <span class="token comment">// 第27行</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>point<span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre></div><p>输出结果</p><div class="language-bash" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token comment"># 方式1</span></span>
<span class="line"><span class="token punctuation">[</span>root@ap-hongkang ~<span class="token punctuation">]</span><span class="token comment"># go build -gcflags=&quot;-S&quot; main.go 2&gt;&amp;1 | grep -E &#39;main.go:&#39; | grep -E &#39;:14|:15|:18|:19|:20|:23|:27&#39;</span></span>
<span class="line">        0x0026 00038 <span class="token punctuation">(</span>/root/main.go:15<span class="token punctuation">)</span> LEAQ    type:main.Point<span class="token punctuation">(</span>SB<span class="token punctuation">)</span>, AX</span>
<span class="line">        0x002d 00045 <span class="token punctuation">(</span>/root/main.go:15<span class="token punctuation">)</span> PCDATA  <span class="token variable">$1</span>, <span class="token variable">$0</span></span>
<span class="line">        0x002d 00045 <span class="token punctuation">(</span>/root/main.go:15<span class="token punctuation">)</span> CALL    runtime.newobject<span class="token punctuation">(</span>SB<span class="token punctuation">)</span> <span class="token comment"># new(Point)调用的是runtime.newobject函数</span></span>
<span class="line">        0x0032 00050 <span class="token punctuation">(</span>/root/main.go:15<span class="token punctuation">)</span> MOVQ    AX, main.point+40<span class="token punctuation">(</span>SP<span class="token punctuation">)</span></span>
<span class="line">        0x0037 00055 <span class="token punctuation">(</span>/root/main.go:18<span class="token punctuation">)</span> XORL    BX, BX</span>
<span class="line">        0x0039 00057 <span class="token punctuation">(</span>/root/main.go:18<span class="token punctuation">)</span> MOVQ    BX, CX</span>
<span class="line">        0x003c 00060 <span class="token punctuation">(</span>/root/main.go:18<span class="token punctuation">)</span> LEAQ    type:int<span class="token punctuation">(</span>SB<span class="token punctuation">)</span>, AX</span>
<span class="line">        0x0043 00067 <span class="token punctuation">(</span>/root/main.go:18<span class="token punctuation">)</span> PCDATA  <span class="token variable">$1</span>, <span class="token variable">$1</span></span>
<span class="line">        0x0043 00067 <span class="token punctuation">(</span>/root/main.go:18<span class="token punctuation">)</span> CALL    runtime.makeslice<span class="token punctuation">(</span>SB<span class="token punctuation">)</span>  <span class="token comment"># make初始化切片调用的是runtime.makeslice函数</span></span>
<span class="line">        0x0048 00072 <span class="token punctuation">(</span>/root/main.go:18<span class="token punctuation">)</span> MOVQ    AX, main<span class="token punctuation">..</span>autotmp_61+64<span class="token punctuation">(</span>SP<span class="token punctuation">)</span></span>
<span class="line">        0x004d 00077 <span class="token punctuation">(</span>/root/main.go:19<span class="token punctuation">)</span> PCDATA  <span class="token variable">$1</span>, <span class="token variable">$2</span></span>
<span class="line">        0x004d 00077 <span class="token punctuation">(</span>/root/main.go:19<span class="token punctuation">)</span> CALL    runtime.makemap_small<span class="token punctuation">(</span>SB<span class="token punctuation">)</span> <span class="token comment"># make初始化map调用的是runtime.makemap_small函数</span></span>
<span class="line">        0x0052 00082 <span class="token punctuation">(</span>/root/main.go:19<span class="token punctuation">)</span> MOVQ    AX, main.m+48<span class="token punctuation">(</span>SP<span class="token punctuation">)</span></span>
<span class="line">        0x0057 00087 <span class="token punctuation">(</span>/root/main.go:20<span class="token punctuation">)</span> XORL    BX, BX</span>
<span class="line">        0x0059 00089 <span class="token punctuation">(</span>/root/main.go:20<span class="token punctuation">)</span> LEAQ    type:chan struct <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">(</span>SB<span class="token punctuation">)</span>, AX</span>
<span class="line">        0x0060 00096 <span class="token punctuation">(</span>/root/main.go:20<span class="token punctuation">)</span> PCDATA  <span class="token variable">$1</span>, <span class="token variable">$3</span></span>
<span class="line">        0x0060 00096 <span class="token punctuation">(</span>/root/main.go:20<span class="token punctuation">)</span> CALL    runtime.makechan<span class="token punctuation">(</span>SB<span class="token punctuation">)</span> <span class="token comment"># make初始化channel调用的是runtime.makechan函数</span></span>
<span class="line">        0x0065 00101 <span class="token punctuation">(</span>/root/main.go:20<span class="token punctuation">)</span> MOVQ    AX, main.c+56<span class="token punctuation">(</span>SP<span class="token punctuation">)</span></span>
<span class="line">        0x006a 00106 <span class="token punctuation">(</span>/root/main.go:23<span class="token punctuation">)</span> LEAQ    main.main.func1·f<span class="token punctuation">(</span>SB<span class="token punctuation">)</span>, AX</span>
<span class="line">        0x0071 00113 <span class="token punctuation">(</span>/root/main.go:23<span class="token punctuation">)</span> PCDATA  <span class="token variable">$1</span>, <span class="token variable">$4</span></span>
<span class="line">        0x0071 00113 <span class="token punctuation">(</span>/root/main.go:23<span class="token punctuation">)</span> CALL    runtime.newproc<span class="token punctuation">(</span>SB<span class="token punctuation">)</span>  <span class="token comment"># go关键字调用的是runtime.newproc函数</span></span>
<span class="line">        0x0076 00118 <span class="token punctuation">(</span>/root/main.go:27<span class="token punctuation">)</span> MOVUPS  X15, main<span class="token punctuation">..</span>autotmp_33+136<span class="token punctuation">(</span>SP<span class="token punctuation">)</span></span>
<span class="line">        0x007f 00127 <span class="token punctuation">(</span>/root/main.go:27<span class="token punctuation">)</span> LEAQ    type:*main.Empty<span class="token punctuation">(</span>SB<span class="token punctuation">)</span>, CX</span>
<span class="line">        0x0086 00134 <span class="token punctuation">(</span>/root/main.go:27<span class="token punctuation">)</span> MOVQ    CX, main<span class="token punctuation">..</span>autotmp_33+136<span class="token punctuation">(</span>SP<span class="token punctuation">)</span></span>
<span class="line">        0x008e 00142 <span class="token punctuation">(</span>/root/main.go:27<span class="token punctuation">)</span> LEAQ    runtime.zerobase<span class="token punctuation">(</span>SB<span class="token punctuation">)</span>, CX  <span class="token comment"># 空结构体就是一个变量: var zerobase uintptr</span></span>
<span class="line">        0x0095 00149 <span class="token punctuation">(</span>/root/main.go:27<span class="token punctuation">)</span> MOVQ    CX, main<span class="token punctuation">..</span>autotmp_33+144<span class="token punctuation">(</span>SP<span class="token punctuation">)</span></span>
<span class="line">        0x0000 00000 <span class="token punctuation">(</span>/root/main.go:23<span class="token punctuation">)</span> TEXT    main.main.func1<span class="token punctuation">(</span>SB<span class="token punctuation">)</span>, ABIInternal, <span class="token variable">$64</span>-0<span class="token comment"># 这里又到了23行说明输出顺序与行号并不完全一致</span></span>
<span class="line">        <span class="token punctuation">..</span>.</span>
<span class="line">        <span class="token comment"># 分析</span></span>
<span class="line">        <span class="token comment"># 1、首先new(Empty)对应的代码调用并没有输出出来，这说明new对于空结构体和非空结构体的初始化可能是不一样的，还需要进一步分析</span></span>
<span class="line">        <span class="token comment"># 2、通过第27行发现new初始化空结构体本质上是返回了一个全局的uintptr变量</span></span>
<span class="line">        <span class="token comment"># 3、make初始化map调用的是runtime.makemap_small,根据名字可以看出可能有多种初始化map的方法</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 方式2</span></span>
<span class="line"><span class="token punctuation">[</span>root@ap-hongkang ~<span class="token punctuation">]</span><span class="token comment"># go build main.go &amp;&amp; go tool objdump ./main | grep -E &#39;main.go:&#39; | grep -E &#39;:14|:15|:18|:19|:20|:23|:27&#39;</span></span>
<span class="line">  main.go:15            0x4804e6                488d05b3d60000          LEAQ 0xd6b3<span class="token punctuation">(</span>IP<span class="token punctuation">)</span>, AX</span>
<span class="line">  main.go:15            0x4804ed                e80ebcf8ff              CALL runtime.newobject<span class="token punctuation">(</span>SB<span class="token punctuation">)</span></span>
<span class="line">  main.go:15            0x4804f2                <span class="token number">4889442428</span>              MOVQ AX, 0x28<span class="token punctuation">(</span>SP<span class="token punctuation">)</span></span>
<span class="line">  main.go:18            0x4804f7                31db                    XORL BX, BX</span>
<span class="line">  main.go:18            0x4804f9                4889d9                  MOVQ BX, CX</span>
<span class="line">  main.go:18            0x4804fc                488d05fd790000          LEAQ 0x79fd<span class="token punctuation">(</span>IP<span class="token punctuation">)</span>, AX</span>
<span class="line">  main.go:18            0x480503                e8985afcff              CALL runtime.makeslice<span class="token punctuation">(</span>SB<span class="token punctuation">)</span></span>
<span class="line">  main.go:18            0x480508                <span class="token number">4889442440</span>              MOVQ AX, 0x40<span class="token punctuation">(</span>SP<span class="token punctuation">)</span></span>
<span class="line">  main.go:19            0x48050d                e82ec7f8ff              CALL runtime.makemap_small<span class="token punctuation">(</span>SB<span class="token punctuation">)</span></span>
<span class="line">  main.go:19            0x480512                <span class="token number">4889442430</span>              MOVQ AX, 0x30<span class="token punctuation">(</span>SP<span class="token punctuation">)</span></span>
<span class="line">  main.go:20            0x480517                31db                    XORL BX, BX</span>
<span class="line">  main.go:20            0x480519                488d05e0740000          LEAQ 0x74e0<span class="token punctuation">(</span>IP<span class="token punctuation">)</span>, AX</span>
<span class="line">  main.go:20            0x480520                e8db41f8ff              CALL runtime.makechan<span class="token punctuation">(</span>SB<span class="token punctuation">)</span></span>
<span class="line">  main.go:20            0x480525                <span class="token number">4889442438</span>              MOVQ AX, 0x38<span class="token punctuation">(</span>SP<span class="token punctuation">)</span></span>
<span class="line">  main.go:23            0x48052a                488d058f070200          LEAQ 0x2078f<span class="token punctuation">(</span>IP<span class="token punctuation">)</span>, AX</span>
<span class="line">  main.go:23            0x480531                e84ab7fbff              CALL runtime.newproc<span class="token punctuation">(</span>SB<span class="token punctuation">)</span></span>
<span class="line">  main.go:27            0x480536                440f11bc2488000000      MOVUPS X15, 0x88<span class="token punctuation">(</span>SP<span class="token punctuation">)</span></span>
<span class="line">  main.go:27            0x48053f                488d0dfa540000          LEAQ 0x54fa<span class="token punctuation">(</span>IP<span class="token punctuation">)</span>, CX</span>
<span class="line">  main.go:27            0x480546                48898c2488000000        MOVQ CX, 0x88<span class="token punctuation">(</span>SP<span class="token punctuation">)</span></span>
<span class="line">  main.go:27            0x48054e                488d0dfb890d00          LEAQ runtime.zerobase<span class="token punctuation">(</span>SB<span class="token punctuation">)</span>, CX</span>
<span class="line">  main.go:27            0x480555                48898c2490000000        MOVQ CX, 0x90<span class="token punctuation">(</span>SP<span class="token punctuation">)</span></span>
<span class="line">  main.go:23            0x4806a0                493b6610                CMPQ 0x10<span class="token punctuation">(</span>R14<span class="token punctuation">)</span>, SP</span>
<span class="line">  main.go:23            0x4806a4                <span class="token number">7656</span>                    JBE 0x4806fc</span>
<span class="line">  main.go:23            0x4806a6                4883ec40                SUBQ <span class="token variable">$0x40</span>, SP</span>
<span class="line">  main.go:23            0x4806aa                48896c2438              MOVQ BP, 0x38<span class="token punctuation">(</span>SP<span class="token punctuation">)</span></span>
<span class="line">  main.go:23            0x4806af                488d6c2438              LEAQ 0x38<span class="token punctuation">(</span>SP<span class="token punctuation">)</span>, BP</span>
<span class="line">  main.go:23            0x4806fc                0f1f4000                NOPL <span class="token number">0</span><span class="token punctuation">(</span>AX<span class="token punctuation">)</span></span>
<span class="line">  main.go:23            0x480700                e8fbaffdff              CALL runtime.morestack_noctxt.abi0<span class="token punctuation">(</span>SB<span class="token punctuation">)</span></span>
<span class="line">  main.go:23            0x480705                eb99                    JMP main.main.func1<span class="token punctuation">(</span>SB<span class="token punctuation">)</span></span>
<span class="line"></span></code></pre></div></details><details class="hint-container details"><summary>（2）查看汇编代码：使用可视化工具</summary><p>Github：<a href="https://github.com/loov/lensm" target="_blank" rel="noopener noreferrer">https://github.com/loov/lensm</a></p><p><strong>1、基础使用</strong></p><div class="language-bash" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token comment"># 安装</span></span>
<span class="line">go <span class="token function">install</span> loov.dev/lensm@main</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 编译程序</span></span>
<span class="line">go build <span class="token builtin class-name">.</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 查看帮助</span></span>
<span class="line">D:<span class="token punctuation">\</span>application<span class="token punctuation">\</span>GoLand<span class="token punctuation">\</span>example<span class="token operator">&gt;</span>lensm <span class="token parameter variable">--help</span></span>
<span class="line">Usage of lensm:</span>
<span class="line">  <span class="token parameter variable">-context</span> int                         </span>
<span class="line">        <span class="token builtin class-name">source</span> line context <span class="token punctuation">(</span>default <span class="token number">3</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token parameter variable">-filter</span> string                       </span>
<span class="line">        filter the functions by regexp </span>
<span class="line">  <span class="token parameter variable">-font</span> string                         </span>
<span class="line">        user font                      </span>
<span class="line">  -text-size int                       </span>
<span class="line">        default font size <span class="token punctuation">(</span>default <span class="token number">12</span><span class="token punctuation">)</span> </span>
<span class="line">  <span class="token parameter variable">-watch</span>                               </span>
<span class="line">        auto reload executable</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 使用lensm查看汇编</span></span>
<span class="line">lensm -text-size<span class="token operator">=</span><span class="token number">20</span> <span class="token parameter variable">--filter</span> main main.exe</span>
<span class="line"></span></code></pre></div><p><img src="https://tuchuang-1257805459.cos.accelerate.myqcloud.com//image-20230225114831320.png" alt="image-20230225114831320"></p><p><strong>2、解决中文乱码问题</strong></p><div class="language-bash" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token comment"># 指定一个可以显示中文的字体,注意并不是所有的字体都支持</span></span>
<span class="line">lensm -text-size<span class="token operator">=</span><span class="token number">20</span> <span class="token parameter variable">--font</span> C:<span class="token punctuation">\</span>Windows<span class="token punctuation">\</span>Fonts<span class="token punctuation">\</span>simkai.ttf <span class="token parameter variable">--filter</span> main main.exe</span>
<span class="line"></span></code></pre></div><p><img src="https://tuchuang-1257805459.cos.accelerate.myqcloud.com//image-20230225124432270.png" alt="image-20230225124432270"></p><p>字体文件名获取方法</p><p><img src="https://tuchuang-1257805459.cos.accelerate.myqcloud.com//image-20230225124648047.png" alt="image-20230225124648047"></p><p><strong>3、windows上设置别名</strong></p><div class="language-bash" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token comment"># 临时设置别名</span></span>
<span class="line">doskey <span class="token assign-left variable">lensm</span><span class="token operator">=</span>lensm -text-size<span class="token operator">=</span><span class="token number">16</span> <span class="token parameter variable">--font</span> C:<span class="token punctuation">\</span>Windows<span class="token punctuation">\</span>Fonts<span class="token punctuation">\</span>simkai.ttf <span class="token variable">$*</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 使用</span></span>
<span class="line">lensm <span class="token parameter variable">--filter</span> main main.exe</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 永久设置别名</span></span>
<span class="line"><span class="token comment"># 1、到GOPATH/bin目录下找到lensm.exe文件,改一个任意名字,比如 lensm-original.exe</span></span>
<span class="line"><span class="token comment"># 2、新建一个lensm.bat文件, 使用 lensm --filter main.exe 即可</span></span>
<span class="line">@echo off</span>
<span class="line">lensm-original -text-size<span class="token operator">=</span><span class="token number">16</span> <span class="token parameter variable">--font</span> C:<span class="token punctuation">\</span>Windows<span class="token punctuation">\</span>Fonts<span class="token punctuation">\</span>simkai.ttf %*</span>
<span class="line"><span class="token comment"># 3、新建一个lensmm.bat文件,用于固定 --filter main 参数， 使用 lensmm main.exe 即可</span></span>
<span class="line">@echo off</span>
<span class="line">lensm-original -text-size<span class="token operator">=</span><span class="token number">16</span> <span class="token parameter variable">--font</span> C:<span class="token punctuation">\</span>Windows<span class="token punctuation">\</span>Fonts<span class="token punctuation">\</span>simkai.ttf <span class="token parameter variable">--filter</span> main %*</span>
<span class="line"></span></code></pre></div></details><details class="hint-container details"><summary>（3）查看二进制所依赖的第三方包</summary><div class="language-go" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">package</span> main</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">(</span></span>
<span class="line">        <span class="token string">&quot;github.com/gin-gonic/gin&quot;</span></span>
<span class="line">        <span class="token string">&quot;log&quot;</span></span>
<span class="line">        <span class="token string">&quot;net/http&quot;</span></span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token comment">// 监听地址</span></span>
<span class="line">        addr <span class="token operator">:=</span> <span class="token string">&quot;127.0.0.1:80&quot;</span></span>
<span class="line"></span>
<span class="line">        <span class="token comment">// 实例化Gin路由引擎</span></span>
<span class="line">        r <span class="token operator">:=</span> gin<span class="token punctuation">.</span><span class="token function">Default</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">        <span class="token comment">// 注册路由</span></span>
<span class="line">        r<span class="token punctuation">.</span><span class="token function">GET</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">,</span> <span class="token keyword">func</span><span class="token punctuation">(</span>c <span class="token operator">*</span>gin<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                c<span class="token punctuation">.</span><span class="token function">String</span><span class="token punctuation">(</span>http<span class="token punctuation">.</span>StatusOK<span class="token punctuation">,</span> <span class="token string">&quot;Hello Gin!\n&quot;</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">        <span class="token comment">// 启动Gin Server</span></span>
<span class="line">        log<span class="token punctuation">.</span><span class="token function">Fatalln</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span><span class="token function">Run</span><span class="token punctuation">(</span>addr<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre></div><p>输出结果</p><div class="language-bash" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token comment"># 编译</span></span>
<span class="line"><span class="token punctuation">[</span>root@ap-hongkang demo<span class="token punctuation">]</span><span class="token comment"># go build -o main main.go</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 通过二进制可以发现其依赖的第三方模块以及是否开启CGO等信息</span></span>
<span class="line"><span class="token punctuation">[</span>root@ap-hongkang demo<span class="token punctuation">]</span><span class="token comment"># go version -m main</span></span>
<span class="line">main: go1.19.2</span>
<span class="line">        path    command-line-arguments</span>
<span class="line">        dep     github.com/gin-contrib/sse      v0.1.0  h1:Y/yl/+YNO8GZSjAhjMsSuLt29uWRFHdHYUb5lYOV9qE<span class="token operator">=</span></span>
<span class="line">        dep     github.com/gin-gonic/gin        v1.8.2  h1:UzKToD9/PoFj/V4rvlKqTRKnQYyz8Sc1MJlv4JHPtvY<span class="token operator">=</span></span>
<span class="line">        dep     github.com/go-playground/locales        v0.14.1 h1:EWaQ/wswjilfKLTECiXz7Rh+3BjFhfDFKv/oXslEjJA<span class="token operator">=</span></span>
<span class="line">        dep     github.com/go-playground/universal-translator   v0.18.1 h1:Bcnm0ZwsGyWbCzImXv+pAJnYK9S473LQFuzCbDbfSFY<span class="token operator">=</span></span>
<span class="line">        dep     github.com/go-playground/validator/v10  v10.11.2        h1:q3SHpufmypg+erIExEKUmsgmhDTyhcJ38oeKGACXohU<span class="token operator">=</span></span>
<span class="line">        dep     github.com/leodido/go-urn       v1.2.1  h1:BqpAaACuzVSgi/VLzGZIobT2z4v53pjosyNd9Yv6n/w<span class="token operator">=</span></span>
<span class="line">        dep     github.com/mattn/go-isatty      v0.0.17 h1:BTarxUcIeDqL27Mc+vyvdWYSL28zpIhv3RoTdsLMPng<span class="token operator">=</span></span>
<span class="line">        dep     github.com/pelletier/go-toml/v2 v2.0.6  h1:nrzqCb7j9cDFj2coyLNLaZuJTLjWjlaz6nvTvIwycIU<span class="token operator">=</span></span>
<span class="line">        dep     github.com/ugorji/go/codec      v1.2.8  h1:sgBJS6COt0b/P40VouWKdseidkDgHxYGm0SAglUHfP0<span class="token operator">=</span></span>
<span class="line">        dep     golang.org/x/crypto     v0.5.0  h1:U/0M97KRkSFvyD/3FSmdP5W5swImpNgle/EHFhOsQPE<span class="token operator">=</span></span>
<span class="line">        dep     golang.org/x/net        v0.5.0  h1:GyT4nK/YDHSqa1c4753ouYCDajOYKTja9Xb/OHtgvSw<span class="token operator">=</span></span>
<span class="line">        dep     golang.org/x/sys        v0.4.0  h1:Zr2JFtRQNX3BCZ8YtxRE9hNJYC8J6I1MVbMg6owUp18<span class="token operator">=</span></span>
<span class="line">        dep     golang.org/x/text       v0.6.0  h1:3XmdazWV+ubf7QgHSTWeykHOci5oeekaGJBLkrkaw4k<span class="token operator">=</span></span>
<span class="line">        dep     google.golang.org/protobuf      v1.28.1 h1:d0NfwRgPtno5B1Wa6L2DAG+KivqkdutMf1UhdNx175w<span class="token operator">=</span></span>
<span class="line">        dep     gopkg.in/yaml.v2        v2.4.0  h1:D8xgwECY7CYvx+Y2n4sBz93Jn9JRvxdiyyo8CTfuKaY<span class="token operator">=</span></span>
<span class="line">        build   <span class="token parameter variable">-compiler</span><span class="token operator">=</span>gc</span>
<span class="line">        build   <span class="token assign-left variable">CGO_ENABLED</span><span class="token operator">=</span><span class="token number">0</span></span>
<span class="line">        build   <span class="token assign-left variable">GOARCH</span><span class="token operator">=</span>amd64</span>
<span class="line">        build   <span class="token assign-left variable">GOOS</span><span class="token operator">=</span>linux</span>
<span class="line">        build   <span class="token assign-left variable">GOAMD64</span><span class="token operator">=</span>v1</span>
<span class="line"></span></code></pre></div></details></div><!--[--><!--]--></div><footer class="vp-page-meta"><!----><div class="vp-meta-item git-info"><div class="vp-meta-item last-updated"><span class="meta-item-label">最近更新: </span><time class="meta-item-info" datetime="2026-01-18T23:28:06.000Z" data-allow-mismatch>2026/1/18 23:28</time></div><div class="vp-meta-item contributors"><span class="meta-item-label">作者: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: vvfock3r@gmail.com">VVFock3r</span><!----><!--]--><!--]--></span></div></div></footer><!----><!--[--><!--]--></main><!--]--></div><!--[--><!----><!--]--><!--]--></div>
    <script type="module" src="/assets/app-1v6QchTO.js" defer></script>
  </body>
</html>
