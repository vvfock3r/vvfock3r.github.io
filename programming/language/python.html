<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.26" />
    <style>
      :root {
        --vp-c-bg: #fff;
      }

      [data-theme='dark'] {
        --vp-c-bg: #1b1b1f;
      }

      html,
      body {
        background-color: var(--vp-c-bg);
      }
    </style>
    <script>
      const useChoice = localStorage.getItem('vuepress-color-scheme')
      const systemStatus =
        'matchMedia' in window
          ? window.matchMedia('(prefers-color-scheme: dark)').matches
          : false

      if (useChoice === 'light') {
        document.documentElement.dataset.theme = 'light'
      } else if (useChoice === 'dark' || systemStatus) {
        document.documentElement.dataset.theme = 'dark'
      }
    </script>
    <link rel="icon" href="/favicon.png"><title>Python | VVFock3r Docs</title><meta name="description" content="VVFock3r Docs">
    <link rel="preload" href="/assets/style-DLxkznZ8.css" as="style"><link rel="stylesheet" href="/assets/style-DLxkznZ8.css">
    <link rel="modulepreload" href="/assets/app-D4_ZvgBW.js"><link rel="modulepreload" href="/assets/python.html-CAp8UQ1U.js">
    <link rel="prefetch" href="/assets/index.html-BvNcgyNn.js" as="script"><link rel="prefetch" href="/assets/about.html-C1RVxhD3.js" as="script"><link rel="prefetch" href="/assets/vuepress.html-DPp5Sitj.js" as="script"><link rel="prefetch" href="/assets/Pyenv.html-uIlBXEWx.js" as="script"><link rel="prefetch" href="/assets/go.html-BwAp3bCF.js" as="script"><link rel="prefetch" href="/assets/404.html-CbI4QavJ.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><div class="vp-theme-container external-link-icon" vp-container><!--[--><header class="vp-navbar" vp-navbar><div class="vp-toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a class="route-link" href="/"><img class="vp-site-logo" src="/logo.png" alt="VVFock3r Docs"><span class="vp-site-name vp-hide-mobile" aria-hidden="true">VVFock3r Docs</span></a></span><div class="vp-navbar-items-wrapper" style=""><!--[--><!--]--><nav class="vp-navbar-items vp-hide-mobile" aria-label="site navigation"><!--[--><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="💻 编程开发"><span class="title">💻 编程开发</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="💻 编程开发"><span class="title">💻 编程开发</span><span class="right arrow"></span></button><ul class="vp-navbar-dropdown" style="display:none;"><!--[--><li class="vp-navbar-dropdown-item"><!--[--><h4 class="vp-navbar-dropdown-subtitle"><span>🔥 编程语言 · 核心文档</span></h4><ul class="vp-navbar-dropdown-subitem-wrapper"><!--[--><li class="vp-navbar-dropdown-subitem"><a class="route-link route-link-active auto-link" href="/programming/language/python.html" aria-label="Python · 语法基础"><!--[--><!--[--><!--]--><!--]-->Python · 语法基础<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/programming/language/python-module.html" aria-label="Python · 常用模块"><!--[--><!--[--><!--]--><!--]-->Python · 常用模块<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/programming/language/go.html" aria-label="Go · 语言语法"><!--[--><!--[--><!--]--><!--]-->Go · 语言语法<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/programming/language/go-module.html" aria-label="Go · 常用模块"><!--[--><!--[--><!--]--><!--]-->Go · 常用模块<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/programming/language/sql.html" aria-label="SQL · 数据库查询"><!--[--><!--[--><!--]--><!--]-->SQL · 数据库查询<!--[--><!--[--><!--]--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/about/about.html" aria-label="ℹ️ 关于"><!--[--><!--[--><!--]--><!--]-->ℹ️ 关于<!--[--><!--[--><!--]--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button type="button" class="vp-toggle-color-mode-button" title="toggle color mode"><svg class="light-icon" viewbox="0 0 32 32" style=""><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg class="dark-icon" viewbox="0 0 32 32" style="display:none;"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!----></div></header><!--]--><div class="vp-sidebar-mask"></div><!--[--><aside class="vp-sidebar" vp-sidebar><nav class="vp-navbar-items" aria-label="site navigation"><!--[--><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="💻 编程开发"><span class="title">💻 编程开发</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="💻 编程开发"><span class="title">💻 编程开发</span><span class="right arrow"></span></button><ul class="vp-navbar-dropdown" style="display:none;"><!--[--><li class="vp-navbar-dropdown-item"><!--[--><h4 class="vp-navbar-dropdown-subtitle"><span>🔥 编程语言 · 核心文档</span></h4><ul class="vp-navbar-dropdown-subitem-wrapper"><!--[--><li class="vp-navbar-dropdown-subitem"><a class="route-link route-link-active auto-link" href="/programming/language/python.html" aria-label="Python · 语法基础"><!--[--><!--[--><!--]--><!--]-->Python · 语法基础<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/programming/language/python-module.html" aria-label="Python · 常用模块"><!--[--><!--[--><!--]--><!--]-->Python · 常用模块<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/programming/language/go.html" aria-label="Go · 语言语法"><!--[--><!--[--><!--]--><!--]-->Go · 语言语法<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/programming/language/go-module.html" aria-label="Go · 常用模块"><!--[--><!--[--><!--]--><!--]-->Go · 常用模块<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/programming/language/sql.html" aria-label="SQL · 数据库查询"><!--[--><!--[--><!--]--><!--]-->SQL · 数据库查询<!--[--><!--[--><!--]--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/about/about.html" aria-label="ℹ️ 关于"><!--[--><!--[--><!--]--><!--]-->ℹ️ 关于<!--[--><!--[--><!--]--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="vp-sidebar-items"><!--[--><li><p tabindex="0" class="vp-sidebar-item vp-sidebar-heading">Python <!----></p><!----></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="vp-page"><!--[--><!--]--><div vp-content><!--[--><!--]--><div id="content"><h1 id="python" tabindex="-1"><a class="header-anchor" href="#python"><span>Python</span></a></h1><p>官网：<a href="https://www.python.org" target="_blank" rel="noopener noreferrer">https://www.python.org</a></p><p>FTP：<a href="https://www.python.org/ftp/python/" target="_blank" rel="noopener noreferrer">https://www.python.org/ftp/python/</a></p><p>PyPI：<a href="https://pypi.org/" target="_blank" rel="noopener noreferrer">https://pypi.org/</a></p><p>piwheels（专为树莓派提供预编译的 Python wheel 二进制安装包）：<a href="https://www.piwheels.org/" target="_blank" rel="noopener noreferrer">https://www.piwheels.org/</a></p><br><h2 id="一、python环境介绍" tabindex="-1"><a class="header-anchor" href="#一、python环境介绍"><span>一、Python环境介绍</span></a></h2><h3 id="解释器的多种实现" tabindex="-1"><a class="header-anchor" href="#解释器的多种实现"><span>解释器的多种实现</span></a></h3><p>官方文档：<a href="https://docs.python.org/3/reference/introduction.html#implementations" target="_blank" rel="noopener noreferrer">https://docs.python.org/3/reference/introduction.html#implementations</a></p><p><strong><span style="color:red;">CPython</span></strong></p><p>这是最早出现并持续维护的 Python 实现，主要以 <strong>C 语言</strong> 编写（少量平台相关代码使用其他语言）。</p><p>Python 语言规范的<strong>事实参考实现</strong>，新的语言特性通常首先在CPython 中实现并发布。</p><p>日常开发中使用的 <code>Python</code>，通常指的就是 <strong>CPython</strong>。</p><hr><p><strong><span style="color:red;">Jython</span></strong></p><p>以 <strong>Java 语言</strong> 编写的 Python 实现，运行在 <strong>JVM</strong> 之上。 可作为 Java 应用的脚本语言，或用于编写能够直接调用 <strong>Java 类库</strong> 的 Python 程序。</p><p>当前主要支持 Python 2.7 语义，对 Python 3 的支持长期受限</p><p>项目主页：<a href="http://www.jython.org/" target="_blank" rel="noopener noreferrer">http://www.jython.org/</a></p><hr><p><strong><span style="color:red;">Python for .NET</span></strong></p><p><strong>并非独立的 Python 解释器实现</strong>，而是一个用于 <strong>CPython 与 .NET CLR 互操作的桥接库</strong>。</p><p>它允许：</p><ul><li>在 Python 中直接调用 .NET 类库</li><li>在 .NET 程序中嵌入并调用 CPython</li></ul><p>底层仍然依赖 <strong>CPython 解释器</strong>，本身不实现 Python 语言语义。</p><p>项目主页：<a href="https://pythonnet.github.io/" target="_blank" rel="noopener noreferrer">https://pythonnet.github.io/</a></p><hr><p><strong><span style="color:red;">IronPython</span></strong></p><p>运行在 <strong>.NET CLR</strong> 上的 Python 实现，基于 <strong>DLR（Dynamic Language Runtime）</strong>， 将 Python 代码编译为 <strong>IL</strong> 并在 CLR 上执行。</p><p>与 Python for .NET 的主要区别在于：</p><p>IronPython 是一个 <strong>完整的 Python 语言实现</strong>，而不是对 CPython 的桥接。</p><p>该项目由 <strong>Jim Hugunin</strong> 创建（同时也是 Jython 的作者）。</p><p>项目主页：<a href="http://ironpython.net/" target="_blank" rel="noopener noreferrer">http://ironpython.net/</a></p><hr><p><strong><span style="color:red;">PyPy</span></strong></p><p>主要使用 <strong>RPython（Python 的受限子集）</strong> 编写的 Python 实现。</p><p>其核心特性包括：</p><ul><li><strong>JIT（即时编译）</strong></li><li>可插拔的 GC</li><li>非栈式支持（stackless-like behavior）</li></ul><p>PyPy 的设计目标之一是： 通过使用 RPython 编写解释器，使其 <strong>易于分析、优化和实验新的解释器与语言特性</strong>。</p><p>项目主页：<a href="http://pypy.org/" target="_blank" rel="noopener noreferrer">http://pypy.org/</a></p><hr><p><strong><span style="color:blue;">一句话总结</span></strong></p><ul><li><strong>CPython</strong>：官方参考实现，生态与兼容性最强</li><li><strong>Jython / IronPython</strong>：将 Python 深度融入 JVM / CLR</li><li><strong>Python for .NET</strong>：CPython ↔ .NET 的互操作桥梁</li><li><strong>PyPy</strong>：以 JIT 为核心，探索高性能与解释器设计空间</li></ul><br><h3 id="增强版交互式解释器" tabindex="-1"><a class="header-anchor" href="#增强版交互式解释器"><span>增强版交互式解释器</span></a></h3><p><strong><span style="color:red;">IPython</span></strong> 是对标准 Python REPL 的增强实现，提供了更强大的交互式开发体验，常被作为调试、探索和实验代码的工具。</p><p>核心特性：</p><ul><li>更友好的交互体验（自动补全、语法高亮、历史记录）</li><li>内建对象自省（<code>obj?</code>、<code>obj??</code>）</li><li>支持 <strong>魔法命令（magic commands）</strong>，如 <code>%timeit</code>、<code>%run</code>、<code>%debug</code></li><li>更强的异常回溯与调试信息</li><li>与科学计算生态（NumPy / SciPy / Matplotlib）深度集成</li></ul><p>IPython <strong>不是新的 Python 语法或解释器实现</strong>，而是运行在现有 Python 解释器（通常是 CPython）之上的增强交互层。</p><p>项目主页：<a href="https://ipython.org/" target="_blank" rel="noopener noreferrer">https://ipython.org/</a></p><hr><p><strong><span style="color:red;">Jupyter Notebook</span></strong> 是一个基于 Web 的交互式计算环境，最初由 IPython 项目演化而来，用于将：</p><ul><li><strong>代码</strong></li><li><strong>运行结果</strong></li><li><strong>图表</strong></li><li><strong>说明性文本（Markdown）</strong></li></ul><p>整合在同一个可复现的文档中。</p><p>核心特性：</p><ul><li>通过浏览器进行交互式编程</li><li>支持多语言内核（Python、R、Julia 等）</li><li>文档即代码，适合实验、数据分析与教学</li><li>可导出为 HTML、PDF 等多种格式</li></ul><p>在 Python 生态中，Jupyter Notebook <strong>通常以 IPython 作为 Python 内核</strong>，但两者在架构上是解耦的。</p><p>项目主页：<a href="https://jupyter.org/" target="_blank" rel="noopener noreferrer">https://jupyter.org/</a></p><br><h3 id="全局解释器锁-gil" tabindex="-1"><a class="header-anchor" href="#全局解释器锁-gil"><span>全局解释器锁（GIL）</span></a></h3><p><strong>GIL 是什么？</strong></p><p><strong>GIL（Global Interpreter Lock，全局解释器锁）</strong> 是 <strong>CPython</strong> 中的一种全局互斥锁。</p><p>它的作用是：在同一个 CPython 进程中，任意时刻只允许 <strong>一个线程执行 Python 字节码</strong>。</p><p>因此：</p><ul><li>多线程 <strong>不能在 CPU 密集型任务上真正并行</strong></li><li>这是 <strong>CPython 的实现细节</strong>，不是 Python 语言本身的特性</li></ul><hr><p><strong>为什么会有 GIL？</strong></p><p>CPython 使用 <strong>引用计数</strong> 进行内存管理，而引用计数的增减在多线程下需要被保护。</p><p>相比给每个对象加锁，引入一把 <strong>全局锁（GIL）</strong>：</p><ul><li>实现更简单</li><li>性能开销更低</li><li>更容易保证解释器稳定性</li></ul><hr><p><strong>GIL 的影响</strong></p><ul><li><strong>CPU 密集型任务</strong>：多线程效果差，推荐 <strong>多进程</strong></li><li><strong>I/O 密集型任务</strong>：多线程仍然有效（I/O 会释放 GIL）,但是： <ul><li>网络 I/O 多线程几乎必赚；</li><li>磁盘 I/O 是否提速，取决于磁盘是不是瓶颈，而不是 GIL</li></ul></li></ul><hr><p><strong>一句话总结</strong></p><blockquote><p><strong>GIL 是 CPython 为简化内存管理而引入的全局锁，它限制了 CPU 密集型多线程的并行能力，但在网络 I/O 场景下，多线程仍然可以有效并发</strong></p></blockquote><br><h3 id="常用选项及环境变量" tabindex="-1"><a class="header-anchor" href="#常用选项及环境变量"><span>常用选项及环境变量</span></a></h3><p>官方文档：<a href="https://docs.python.org/zh-cn/3/using/cmdline.html#interface-options" target="_blank" rel="noopener noreferrer">https://docs.python.org/zh-cn/3/using/cmdline.html#interface-options</a></p><details class="hint-container details"><summary>-c &lt;command&gt; 执行Python代码</summary><div class="language-bash" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line">python <span class="token parameter variable">-c</span> <span class="token string">&quot;import sys;print(&#39;.&#39;.join([str(x) for x in sys.version_info[:3]]))&quot;</span></span>
<span class="line"><span class="token number">3.13</span>.7</span>
<span class="line"></span></code></pre></div></details><details class="hint-container details"><summary>-m &lt;module-name&gt; 执行模块代码</summary><p>执行模块中<code>if __name__ == &#39;__main__&#39;:</code>下面的内容</p><div class="language-bash" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token comment"># 示例1 - 开启http server</span></span>
<span class="line">python <span class="token parameter variable">-m</span> http.server <span class="token number">80</span></span>
<span class="line">Serving HTTP on :: port <span class="token number">80</span> <span class="token punctuation">(</span>http://<span class="token punctuation">[</span>::<span class="token punctuation">]</span>:80/<span class="token punctuation">)</span> <span class="token punctuation">..</span>.</span>
<span class="line"></span>
<span class="line"><span class="token comment"># -------------------------------------------------------------</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 示例2 - 格式化JSON串，非JSON格式会报错</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># Linux</span></span>
<span class="line"><span class="token builtin class-name">echo</span> <span class="token string">&#39;{&quot;name&quot;:&quot;bob&quot;}&#39;</span> <span class="token operator">|</span> python <span class="token parameter variable">-m</span> json.tool</span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token string">&quot;name&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;bob&quot;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># Windows CMD</span></span>
<span class="line">C:<span class="token punctuation">\</span>Users<span class="token punctuation">\</span>VVFock3r<span class="token operator">&gt;</span>echo <span class="token punctuation">{</span><span class="token string">&quot;name&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;bob&quot;</span><span class="token punctuation">}</span> <span class="token operator">|</span> python <span class="token parameter variable">-m</span> json.tool</span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token string">&quot;name&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;bob&quot;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre></div></details><details class="hint-container details"><summary>-B 在导入模块时不生成.pyc文件</summary><div class="language-python" data-highlighter="prismjs" data-ext="py"><pre><code class="language-python"><span class="line"><span class="token comment"># pyc_test.py</span></span>
<span class="line"><span class="token keyword">def</span> <span class="token function">add</span><span class="token punctuation">(</span>x<span class="token punctuation">:</span><span class="token builtin">int</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span><span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">int</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">return</span> x <span class="token operator">+</span> y</span>
<span class="line"></span>
<span class="line"><span class="token comment"># test.py</span></span>
<span class="line"><span class="token keyword">import</span> pyc_test</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 测试</span></span>
<span class="line">python    test<span class="token punctuation">.</span>py	<span class="token comment"># 默认会生成__pycache__/pyc_test.cpython-39.pyc文件</span></span>
<span class="line">python <span class="token operator">-</span>B test<span class="token punctuation">.</span>py	<span class="token comment"># 不会生成pyc_test.pyc文件</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 环境变量参考</span></span>
<span class="line"><span class="token comment"># PYTHONDONTWRITEBYTECODE</span></span>
<span class="line"><span class="token comment"># 此变量如果被设为一个非空字符串，Python 将不会尝试在导入源模块时写入 .pyc 文件。 这相当于指定 -B 选项。</span></span>
<span class="line"></span></code></pre></div></details><details class="hint-container details"><summary>-u 禁用缓冲区</summary><div class="language-python" data-highlighter="prismjs" data-ext="py"><pre><code class="language-python"><span class="line"><span class="token comment"># test.py</span></span>
<span class="line"><span class="token keyword">import</span> time</span>
<span class="line"></span>
<span class="line"><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">print</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> end<span class="token operator">=</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 测试-1</span></span>
<span class="line">python    test<span class="token punctuation">.</span>py	<span class="token comment"># 这将一次性输出内容:0123456789</span></span>
<span class="line">python <span class="token operator">-</span>u test<span class="token punctuation">.</span>py	<span class="token comment"># 这将实时输出0123456789</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 环境变量参考</span></span>
<span class="line"><span class="token comment"># PYTHONUNBUFFERED</span></span>
<span class="line"><span class="token comment"># 此变量如果被设为一个非空字符串，它就相当于指定 -u 选项。</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 总结</span></span>
<span class="line"><span class="token comment"># 命令行中一般为行缓冲区，可以使用python -u参数来达到实时输出效果</span></span>
<span class="line"></span></code></pre></div></details><details class="hint-container details"><summary>-w args 警告控制</summary><div class="language-bash" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token comment"># warn_test.py</span></span>
<span class="line"><span class="token function">import</span> warnings</span>
<span class="line">warnings.warn<span class="token punctuation">(</span><span class="token string">&quot;this is warn message&quot;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 测试</span></span>
<span class="line">python warn_test.py				<span class="token comment"># 这会输出警告信息</span></span>
<span class="line">python <span class="token parameter variable">-Wignore</span> warn_test.py	<span class="token comment"># 不输出warn信息</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 环境变量参考 </span></span>
<span class="line"><span class="token comment"># PYTHONWARNINGS</span></span>
<span class="line"><span class="token comment"># 此变量等价于 -W 选项。 如果被设为一个以逗号分隔的字符串，它就相当于多次指定 -W，列表中后出现的过滤器优先级会高于列表中先出现的。</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 还可以在代码中设置 warnings.filterwarnings(&quot;ignore&quot;)来关闭警告</span></span>
<span class="line"><span class="token comment"># 更细致的控制请参考官方文档</span></span>
<span class="line"></span></code></pre></div></details><details class="hint-container details"><summary>-x 跳过第一行内容</summary><div class="language-python" data-highlighter="prismjs" data-ext="py"><pre><code class="language-python"><span class="line"><span class="token comment"># test.py</span></span>
<span class="line">fdafdref3fdfdfdafd</span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;hello world!&quot;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 测试</span></span>
<span class="line">python    test<span class="token punctuation">.</span>py	<span class="token comment"># 这会报错</span></span>
<span class="line">python <span class="token operator">-</span>x test<span class="token punctuation">.</span>py	<span class="token comment"># 因为跳过第一行了，不会报错</span></span>
<span class="line"></span></code></pre></div></details><details class="hint-container details"><summary>-E 忽略所有 <code>PYTHON*</code> 环境变量</summary><p>略</p></details><details class="hint-container details"><summary>-q 在交互模式下也不显示版权和版本信息</summary><div class="language-bash" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line">C:<span class="token punctuation">\</span>Users<span class="token punctuation">\</span>VVFock3r<span class="token operator">&gt;</span>python <span class="token parameter variable">-q</span></span>
<span class="line"><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> exit<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre></div></details><br><h3 id="执行虚拟环境中的代码" tabindex="-1"><a class="header-anchor" href="#执行虚拟环境中的代码"><span>执行虚拟环境中的代码</span></a></h3><details class="hint-container details"><summary>Windows .bat脚本</summary><div class="language-bash" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line">@echo off</span>
<span class="line"></span>
<span class="line">:: 进入项目根目录</span>
<span class="line"><span class="token builtin class-name">cd</span> /D D:<span class="token punctuation">\</span>person<span class="token punctuation">\</span>project</span>
<span class="line"></span>
<span class="line">:: 激活虚拟环境</span>
<span class="line">call .venv<span class="token punctuation">\</span>Scripts<span class="token punctuation">\</span>activate.bat</span>
<span class="line"></span>
<span class="line">:: 执行脚本</span>
<span class="line">.venv<span class="token punctuation">\</span>Scripts<span class="token punctuation">\</span>python main.py</span>
<span class="line"></span>
<span class="line">:: 撤销虚拟环境</span>
<span class="line">call .venv<span class="token punctuation">\</span>Scripts<span class="token punctuation">\</span>deactivate.bat</span>
<span class="line"></span>
<span class="line">:: 暂停</span>
<span class="line">pause</span>
<span class="line"></span></code></pre></div></details><details class="hint-container details"><summary>Linux .sh脚本，可以通过退出码判断是否执行成功</summary><div class="language-bash" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token shebang important">#!/usr/bin/env bash</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 遇到错误立即退出</span></span>
<span class="line"><span class="token builtin class-name">set</span> <span class="token parameter variable">-Eeuo</span> pipefail</span>
<span class="line"><span class="token builtin class-name">trap</span> <span class="token string">&#39;echo &quot;exit 1&#39;</span> ERR</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 进入项目根目录</span></span>
<span class="line"><span class="token builtin class-name">cd</span> /opt/project</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 激活虚拟环境</span></span>
<span class="line"><span class="token builtin class-name">source</span> .venv/bin/activate</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 执行脚本</span></span>
<span class="line">python main.py</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 退出虚拟环境</span></span>
<span class="line">deactivate</span>
<span class="line"></span></code></pre></div></details><br><h3 id="版本和依赖包管理工具-uv" tabindex="-1"><a class="header-anchor" href="#版本和依赖包管理工具-uv"><span>版本和依赖包管理工具 uv</span></a></h3><p>官网：<a href="https://docs.astral.sh/uv/" target="_blank" rel="noopener noreferrer">https://docs.astral.sh/uv/</a></p><p>Github：<a href="https://github.com/astral-sh/uv" target="_blank" rel="noopener noreferrer">https://github.com/astral-sh/uv</a></p><div class="hint-container tip"><p class="hint-container-title">提示</p><p><strong>1、设计目标</strong></p><p>用一个工具，统一解决 Python 的「版本管理 + 虚拟环境 + 依赖管理 + 安装加速」问题，并且做到极快、可复现、低心智负担</p><br><p><strong>2、特点</strong></p><ul><li><p>uv 自身是单一静态二进制文件，无需依赖系统 Python 或额外运行时，放进 PATH 即可用</p></li><li><p>直接下载预编译的 Python 二进制文件，不从源码编译，安装速度快且对 Windows 极其友好</p></li><li><p>集成 Python 版本管理、虚拟环境、依赖安装与锁定，避免 pyenv / venv / pip / poetry 多工具拼装</p></li><li><p>不劫持系统 PATH 和 python 命令，通过项目级 pin 控制 Python 版本，环境更可控</p></li></ul><br><p><strong>3、配置文件</strong></p><ul><li><p>pyproject.toml：Python 生态的标准项目配置文件，用于定义项目元数据、依赖以及工具配置（包括 uv），<strong>优先级最高</strong>，但并非必须存在</p></li><li><p>.python-version：用于指定项目所使用的 Python 版本，<code>uv python pin 3.14</code> 时会修改当前目录的<code>.python-version</code>，也可以手动修改。</p><p>当 pyproject.toml 中已声明 Python 版本时，该文件会被忽略</p></li><li><p>uv.lock：用于精确锁定所有依赖版本的锁文件，由 uv 自动生成和维护，不应手动编辑，必须与 <code>pyproject.toml</code> 搭配使用</p></li></ul><br><p><strong>4、注意事项</strong></p><ul><li><p>uv安装后的Python解释器可以直接调用，可以不经过uv，但并不易于使用</p></li><li><p>uv 管理的 Python 是&quot;只读解释器&quot;，不能做一些修改操作，比如用 <code>pip install</code> 往里面装包</p></li><li><p><code>pyproject.toml</code>、 <code>.python-version</code>、<code>uv.lock</code> 这三个文件应该提交到代码仓库</p></li></ul></div><details class="hint-container details"><summary>安装 uv 自身</summary><div class="language-bash" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token comment"># Linux</span></span>
<span class="line"><span class="token function">wget</span> <span class="token parameter variable">-c</span> https://github.com/astral-sh/uv/releases/latest/download/uv-x86_64-unknown-linux-gnu.tar.gz</span>
<span class="line"><span class="token function">tar</span> <span class="token parameter variable">-zxf</span> uv-x86_64-unknown-linux-gnu.tar.gz</span>
<span class="line"><span class="token function">cp</span> uv-x86_64-unknown-linux-gnu/* /usr/local/bin/</span>
<span class="line"></span>
<span class="line"><span class="token comment"># Windows</span></span>
<span class="line"><span class="token function">curl</span> <span class="token parameter variable">-L</span> <span class="token parameter variable">-o</span> uv-x86_64-pc-windows-msvc.zip https://github.com/astral-sh/uv/releases/download/0.9.22/uv-x86_64-pc-windows-msvc.zip</span>
<span class="line">7z x uv-x86_64-pc-windows-msvc.zip <span class="token parameter variable">-ouv</span> <span class="token comment"># 解压， 然后将二进制文件路径放入到 PATH 中</span></span>
<span class="line"></span></code></pre></div></details><details class="hint-container details"><summary>使用 uv 安装和卸载 Python</summary><div class="language-bash" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token comment"># 查看可用的 Python 版本, --all-versions 可以显示更多版本</span></span>
<span class="line">C:<span class="token punctuation">\</span>Users<span class="token punctuation">\</span>VVFock3r<span class="token punctuation">\</span>Desktop<span class="token operator">&gt;</span> uv python list</span>
<span class="line">cpython-3.15.0a3-windows-x86_64-none                 <span class="token operator">&lt;</span>download available<span class="token operator">&gt;</span></span>
<span class="line">cpython-3.15.0a3+freethreaded-windows-x86_64-none    <span class="token operator">&lt;</span>download available<span class="token operator">&gt;</span></span>
<span class="line">cpython-3.14.2-windows-x86_64-none                   <span class="token operator">&lt;</span>download available<span class="token operator">&gt;</span></span>
<span class="line">cpython-3.14.2-windows-x86_64-none                   <span class="token operator">&lt;</span>download available<span class="token operator">&gt;</span></span>
<span class="line">cpython-3.14.2+freethreaded-windows-x86_64-none      <span class="token operator">&lt;</span>download available<span class="token operator">&gt;</span></span>
<span class="line">cpython-3.13.11-windows-x86_64-none                  <span class="token operator">&lt;</span>download available<span class="token operator">&gt;</span></span>
<span class="line">cpython-3.13.11+freethreaded-windows-x86_64-none     <span class="token operator">&lt;</span>download available<span class="token operator">&gt;</span></span>
<span class="line">cpython-3.13.7-windows-x86_64-none                   <span class="token operator">&lt;</span>download available<span class="token operator">&gt;</span></span>
<span class="line">cpython-3.12.12-windows-x86_64-none                  <span class="token operator">&lt;</span>download available<span class="token operator">&gt;</span></span>
<span class="line">cpython-3.11.14-windows-x86_64-none                  <span class="token operator">&lt;</span>download available<span class="token operator">&gt;</span></span>
<span class="line">cpython-3.10.19-windows-x86_64-none                  <span class="token operator">&lt;</span>download available<span class="token operator">&gt;</span></span>
<span class="line">cpython-3.9.25-windows-x86_64-none                   <span class="token operator">&lt;</span>download available<span class="token operator">&gt;</span></span>
<span class="line">cpython-3.8.20-windows-x86_64-none                   <span class="token operator">&lt;</span>download available<span class="token operator">&gt;</span></span>
<span class="line">pypy-3.11.13-windows-x86_64-none                     <span class="token operator">&lt;</span>download available<span class="token operator">&gt;</span></span>
<span class="line">pypy-3.10.16-windows-x86_64-none                     <span class="token operator">&lt;</span>download available<span class="token operator">&gt;</span></span>
<span class="line">pypy-3.9.19-windows-x86_64-none                      <span class="token operator">&lt;</span>download available<span class="token operator">&gt;</span></span>
<span class="line">pypy-3.8.16-windows-x86_64-none                      <span class="token operator">&lt;</span>download available<span class="token operator">&gt;</span></span>
<span class="line">graalpy-3.12.0-windows-x86_64-none                   <span class="token operator">&lt;</span>download available<span class="token operator">&gt;</span></span>
<span class="line">graalpy-3.11.0-windows-x86_64-none                   <span class="token operator">&lt;</span>download available<span class="token operator">&gt;</span></span>
<span class="line">graalpy-3.10.0-windows-x86_64-none                   <span class="token operator">&lt;</span>download available<span class="token operator">&gt;</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 安装指定版本, -v 用于显示详情, 可以看到</span></span>
<span class="line"><span class="token comment">#     下载地址是: https://github.com/astral-sh/python-build-standalone/releases/xxx</span></span>
<span class="line"><span class="token comment">#     安装路径是: C:\Users\VVFock3r\.local\bin\python3.14.exe</span></span>
<span class="line"><span class="token comment"># 注意: 也可以不需要加版本号，一般用于已存在的项目, 按照项目规范安装python版本</span></span>
<span class="line">C:<span class="token punctuation">\</span>Users<span class="token punctuation">\</span>VVFock3r<span class="token punctuation">\</span>Desktop<span class="token operator">&gt;</span> uv python <span class="token function">install</span> <span class="token number">3.14</span>.2 <span class="token parameter variable">-v</span></span>
<span class="line">DEBUG uv <span class="token number">0.9</span>.22 <span class="token punctuation">(</span>82a6a66b8 <span class="token number">2026</span>-01-06<span class="token punctuation">)</span></span>
<span class="line">DEBUG Acquired exclusive lock <span class="token keyword">for</span> <span class="token variable"><span class="token variable">`</span>C:<span class="token punctuation">\</span>Users<span class="token punctuation">\</span>VVFock3r<span class="token punctuation">\</span>AppData<span class="token punctuation">\</span>Roaming<span class="token punctuation">\</span>uv<span class="token punctuation">\</span>python<span class="token variable">`</span></span></span>
<span class="line">DEBUG Using request <span class="token function">timeout</span> of 30s</span>
<span class="line">DEBUG No installation found <span class="token keyword">for</span> request <span class="token variable"><span class="token variable">`</span><span class="token number">3.14</span>.2 <span class="token punctuation">(</span>cpython-3.14.2-windows-x86_64-none<span class="token punctuation">)</span><span class="token variable">`</span></span></span>
<span class="line">DEBUG Found download <span class="token variable"><span class="token variable">`</span>cpython-3.14.2-windows-x86_64-none<span class="token variable">`</span></span> <span class="token keyword">for</span> request <span class="token variable"><span class="token variable">`</span><span class="token number">3.14</span>.2 <span class="token punctuation">(</span>cpython-3.14.2-windows-x86_64-none<span class="token punctuation">)</span><span class="token variable">`</span></span></span>
<span class="line">DEBUG Downloading https://github.com/astral-sh/python-build-standalone/releases/download/20251217/cpython-3.14.2%2B20251217-x86_64-pc-windows-msvc-install_only_stripped.tar.gz</span>
<span class="line">DEBUG Extracting cpython-3.14.2-20251217-x86_64-pc-windows-msvc-install_only_stripped.tar.gz to temporary location: C:<span class="token punctuation">\</span>Users<span class="token punctuation">\</span>VVFock3r<span class="token punctuation">\</span>AppData<span class="token punctuation">\</span>Roaming<span class="token punctuation">\</span>uv<span class="token punctuation">\</span>python<span class="token punctuation">\</span>.temp<span class="token punctuation">\</span>.tmpm8hbMJ</span>
<span class="line">Downloading cpython-3.14.2-windows-x86_64-none <span class="token punctuation">(</span>download<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token number">21</span>.2MiB<span class="token punctuation">)</span></span>
<span class="line"> Downloaded cpython-3.14.2-windows-x86_64-none <span class="token punctuation">(</span>download<span class="token punctuation">)</span></span>
<span class="line">DEBUG Moving C:<span class="token punctuation">\</span>Users<span class="token punctuation">\</span>VVFock3r<span class="token punctuation">\</span>AppData<span class="token punctuation">\</span>Roaming<span class="token punctuation">\</span>uv<span class="token punctuation">\</span>python<span class="token punctuation">\</span>.temp<span class="token punctuation">\</span>.tmpm8hbMJ<span class="token punctuation">\</span>python to C:<span class="token punctuation">\</span>Users<span class="token punctuation">\</span>VVFock3r<span class="token punctuation">\</span>AppData<span class="token punctuation">\</span>Roaming<span class="token punctuation">\</span>uv<span class="token punctuation">\</span>python<span class="token punctuation">\</span>cpython-3.14.2-windows-x86_64-none</span>
<span class="line">DEBUG Installed executable at <span class="token variable"><span class="token variable">`</span>C:<span class="token punctuation">\</span>Users<span class="token punctuation">\</span>VVFock3r<span class="token punctuation">\</span>.local<span class="token punctuation">\</span>bin<span class="token punctuation">\</span>python3.14.exe<span class="token variable">`</span></span> <span class="token keyword">for</span> cpython-3.14.2-windows-x86_64-none</span>
<span class="line">Installed Python <span class="token number">3.14</span>.2 <span class="token keyword">in</span> <span class="token number">9</span>.79s</span>
<span class="line"> + cpython-3.14.2-windows-x86_64-none <span class="token punctuation">(</span>python3.14.exe<span class="token punctuation">)</span></span>
<span class="line">warning: <span class="token variable"><span class="token variable">`</span>C:<span class="token punctuation">\</span>Users<span class="token punctuation">\</span>VVFock3r<span class="token punctuation">\</span>.local<span class="token punctuation">\</span>bin<span class="token variable">`</span></span> is not on your <span class="token environment constant">PATH</span><span class="token builtin class-name">.</span> To use installed Python executables, run <span class="token variable"><span class="token variable">`</span><span class="token builtin class-name">set</span> <span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span><span class="token string">&quot;C:<span class="token entity" title="\\">\\</span>Users<span class="token entity" title="\\">\\</span>VVFock3r<span class="token entity" title="\\">\\</span>.local<span class="token entity" title="\\">\\</span>bin;%PATH%&quot;</span><span class="token variable">`</span></span> or <span class="token variable"><span class="token variable">`</span>uv python update-shell<span class="token variable">`</span></span><span class="token builtin class-name">.</span></span>
<span class="line">DEBUG Released lock at <span class="token variable"><span class="token variable">`</span>C:<span class="token punctuation">\</span>Users<span class="token punctuation">\</span>VVFock3r<span class="token punctuation">\</span>AppData<span class="token punctuation">\</span>Roaming<span class="token punctuation">\</span>uv<span class="token punctuation">\</span>python<span class="token punctuation">\</span>.lock<span class="token variable">`</span></span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 卸载指定版本</span></span>
<span class="line">uv python uninstall <span class="token number">3.14</span></span>
<span class="line"></span></code></pre></div></details><details class="hint-container details"><summary>uv 只用于Python版本和虚拟环境管理时的简单用法</summary><div class="language-bash" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token comment"># 给&quot;当前项目&quot;固定一个 Python 版本，类似于 pyenv local, 一般是进入项目根目录后执行此命令</span></span>
<span class="line"><span class="token comment"># 会将指定的Python版本写入 .python-version</span></span>
<span class="line">uv python pin <span class="token number">3.14</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 建立虚拟环境, 相当于普通的 python -m venv .venv</span></span>
<span class="line">uv venv                             <span class="token comment"># 建立虚拟环境 .venv</span></span>
<span class="line">uv venv venv                        <span class="token comment"># 建立虚拟环境 venv。 注意：推荐使用 .venv 而不是 venv, 下面有原因</span></span>
<span class="line">uv venv venv <span class="token parameter variable">--python</span> <span class="token number">3.12</span>          <span class="token comment"># 建立虚拟环境 venv, 并指定Python版本</span></span>
<span class="line">uv venv venv <span class="token parameter variable">--python</span> <span class="token number">3.12</span> <span class="token parameter variable">--clear</span>  <span class="token comment"># --clear用于 如果venv虚拟环境已存在, 那么就删掉再重新建立虚拟环境</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 执行Python命令</span></span>
<span class="line">uv run python                       <span class="token comment"># 执行python命令, 版本优先级: pin 版本 &gt; 虚拟环境版本 &gt; 最新稳定版 &gt; 系统 PATH 中的 Python</span></span>
<span class="line">uv run <span class="token parameter variable">--python</span> <span class="token number">3.12</span> python         <span class="token comment"># 显示指定版本, 优先级最高</span></span>
<span class="line">uv run python main.py               <span class="token comment"># 执行一个python脚本</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 执行pip命令</span></span>
<span class="line"><span class="token comment"># 注意: </span></span>
<span class="line"><span class="token comment"># 	必须要有虚拟环境。</span></span>
<span class="line"><span class="token comment"># 	uv 的设计哲学：没有虚拟环境，就不要装依赖；除非你非常确定</span></span>
<span class="line">uv pip <span class="token function">install</span> flask                     <span class="token comment"># 虚拟环境是 .venv 时, 可以直接这样执行</span></span>
<span class="line"><span class="token assign-left variable">VIRTUAL_ENV</span><span class="token operator">=</span>./venv uv pip <span class="token function">install</span> flask  <span class="token comment"># 告诉uv虚拟环境目录, 再执行 uv pip xxx</span></span>
<span class="line"></span></code></pre></div></details><details class="hint-container details"><summary>uv 用于Python项目管理时的用法</summary><div class="language-bash" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token comment"># 初始化项目, 会在当前项目目录下创建以下文件（可以额外加参数做一些调整）</span></span>
<span class="line"><span class="token comment"># 	.gitignore</span></span>
<span class="line"><span class="token comment"># 	main.py</span></span>
<span class="line"><span class="token comment"># 	pyproject.toml</span></span>
<span class="line"><span class="token comment"># 	.python-version</span></span>
<span class="line"><span class="token comment"># 	README.md</span></span>
<span class="line"><span class="token comment"># 注意：需要在干净的目录下执行此命令, 不能重复执行</span></span>
<span class="line">uv init                <span class="token comment"># 默认用~/.python-verion 或 本地安装的最新稳定版</span></span>
<span class="line">uv init <span class="token parameter variable">--python</span> <span class="token number">3.14</span>  <span class="token comment"># 指定版本</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 创建虚拟环境</span></span>
<span class="line">uv venv</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 安装和移除依赖</span></span>
<span class="line"><span class="token comment"># 	不同于 uv pip install flask, 它还会额外修改 pyproject.toml 和 uv.lock</span></span>
<span class="line"><span class="token comment"># 	只在“开发、测试、构建、代码质量阶段”使用，而不会被最终程序在运行时 import 的包，都应该放进 dev 环境</span></span>
<span class="line">uv <span class="token function">add</span> flask         <span class="token comment"># 安装依赖</span></span>
<span class="line">uv <span class="token function">add</span> <span class="token parameter variable">--dev</span> pylint  <span class="token comment"># 安装在dev环境</span></span>
<span class="line">uv remove flask      <span class="token comment"># 移除依赖</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 严格按照项目声明的依赖，把当前环境同步成应有的样子</span></span>
<span class="line">uv <span class="token function">sync</span></span>
<span class="line">uv <span class="token function">sync</span> <span class="token parameter variable">--dev</span> <span class="token comment"># dev环境依赖也会安装</span></span>
<span class="line"></span></code></pre></div></details><br><h2 id="二、变量和数据结构" tabindex="-1"><a class="header-anchor" href="#二、变量和数据结构"><span>二、变量和数据结构</span></a></h2><h3 id="列表-list" tabindex="-1"><a class="header-anchor" href="#列表-list"><span>列表(list)</span></a></h3><p>文档：<a href="https://docs.python.org/zh-cn/3/library/stdtypes.html#list" target="_blank" rel="noopener noreferrer">https://docs.python.org/zh-cn/3/library/stdtypes.html#list</a></p><details class="hint-container details"><summary>列表推导式：简单形式</summary><div class="language-python" data-highlighter="prismjs" data-ext="py"><pre><code class="language-python"><span class="line"><span class="token comment"># 生成数字1-10</span></span>
<span class="line">x <span class="token operator">=</span> <span class="token punctuation">[</span>x <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">]</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 生成字母 a-z</span></span>
<span class="line">x <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token builtin">chr</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">:</span> x<span class="token punctuation">}</span> <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">97</span><span class="token punctuation">,</span> <span class="token number">123</span><span class="token punctuation">)</span><span class="token punctuation">]</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span></span>
<span class="line"></span></code></pre></div></details><details class="hint-container details"><summary>列表推导式：带if条件</summary><div class="language-python" data-highlighter="prismjs" data-ext="py"><pre><code class="language-python"><span class="line"><span class="token comment"># 生成数字1-10, 并过滤出偶数</span></span>
<span class="line">x <span class="token operator">=</span> <span class="token punctuation">[</span>x <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token keyword">if</span> x <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">]</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 等价与</span></span>
<span class="line">tmp <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span></span>
<span class="line"><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">if</span> i <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span></span>
<span class="line">        tmp<span class="token punctuation">.</span>append<span class="token punctuation">(</span>i<span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span>tmp<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># -----------------------------------------------------</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 生成数字1-10, 奇数不做处理, 偶数*2</span></span>
<span class="line">x <span class="token operator">=</span> <span class="token punctuation">[</span>x <span class="token operator">*</span> <span class="token number">2</span> <span class="token keyword">if</span> x <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token keyword">else</span> x <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">]</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 等价于</span></span>
<span class="line">tmp <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span></span>
<span class="line"><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">if</span> i <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span></span>
<span class="line">        tmp<span class="token punctuation">.</span>append<span class="token punctuation">(</span>i <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">else</span><span class="token punctuation">:</span></span>
<span class="line">        tmp<span class="token punctuation">.</span>append<span class="token punctuation">(</span>i<span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span>tmp<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 注意：两个例子中, if语句的位置不同, 如果要写在前面, 则必须有else语句, 否则会报错</span></span>
<span class="line"></span></code></pre></div></details><details class="hint-container details"><summary>列表推导式：多层循环</summary><div class="language-python" data-highlighter="prismjs" data-ext="py"><pre><code class="language-python"><span class="line"><span class="token comment"># 多层for循环</span></span>
<span class="line">points <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span> <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span> <span class="token keyword">for</span> y <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">]</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span>points<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 等价于</span></span>
<span class="line">tmp <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span></span>
<span class="line"><span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">for</span> y <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        tmp<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span>tmp<span class="token punctuation">)</span></span>
<span class="line"></span></code></pre></div></details><details class="hint-container details"><summary>列表常用方法</summary><table><thead><tr><th>分类</th><th>方法</th><th>说明</th></tr></thead><tbody><tr><td>插入元素</td><td><strong><code>append(self, object, /)</code></strong></td><td>在尾部插入一个元素，时间复杂度 O(1)</td></tr><tr><td></td><td><code>insert(self, index, object, /)</code></td><td>在指定索引处插入一个元素，时间复杂度 O(n)</td></tr><tr><td></td><td><code>extend(self, list)</code></td><td>列表合并（会改变原列表内容）</td></tr><tr><td>删除元素</td><td><strong><code>pop(self, index=-1, /)</code></strong></td><td>默认从索引为-1的位置弹出该值（弹出后列表删除该元素），<br>尾部弹出时间复杂度为 O(1)，其他位置弹出时间复杂度为 O(n)；<br>如果元素不存在，则引发 <code>IndexError</code></td></tr><tr><td></td><td><code>remove(self, value, /)</code></td><td>删除第一个值为value的元素，时间复杂度 O(n) ；<br>如果元素不存在，则引发 ValueError</td></tr><tr><td></td><td><code>clear(self, /)</code></td><td>清空列表所有元素， 时间复杂度 O(1)</td></tr><tr><td>列表反转</td><td><code>reverse(self, /)</code></td><td>列表反转（会改变原列表内容）</td></tr><tr><td></td><td><code>reversed(list)</code></td><td>列表反转，返回一个迭代器（不会改变原列表内容）</td></tr><tr><td>列表排序</td><td><code>sort(self, /, *, key=None, reverse=False)</code></td><td>根据key指定的函数进行排序，返回值为None（会改变原列表内容）</td></tr><tr><td></td><td><code>sorted(iterable, /, *, key=None, reverse=False)</code></td><td>根据key指定的函数进行排序，返回一个迭代器（不会改变原列表内容）</td></tr><tr><td>列表复制</td><td><code>copy(self, /)</code></td><td>返回一个新列表，浅拷贝（shadow copy），<br>根据被拷贝对象不同而操作不同：<br>（1）如果是不可变类型，则分配一块新内存地址；<br>（2）如果是可变类型，则直接引用</td></tr><tr><td></td><td><code>[::]</code></td><td>同<code>copy()</code></td></tr><tr><td></td><td><code>copy.deepcopy(x, memo=None, _nil=[])</code></td><td>返回一个新列表，深拷贝(deep copy)</td></tr><tr><td>列表查找</td><td><code>index(self, value, start=0, stop=9223372036854775807, /)</code></td><td>返回value在列表中的索引号，找不到抛出ValueError异常</td></tr><tr><td></td><td><code>count(self, value, /)</code></td><td>返回value在列表中出现的次数</td></tr></tbody></table></details><details class="hint-container details"><summary>列表效率对比：[] vs list() and .append() vs .insert()</summary><div class="language-python" data-highlighter="prismjs" data-ext="py"><pre><code class="language-python"><span class="line"><span class="token comment">#!/usr/bin/env python</span></span>
<span class="line"><span class="token comment"># -*- coding:utf-8 -*-</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> timeit</span>
<span class="line"><span class="token keyword">import</span> logging</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 初始化日志</span></span>
<span class="line">FORMAT <span class="token operator">=</span> <span class="token string">&#39;%(asctime)-15s\t [%(threadName)s, %(thread)d] %(message)s&#39;</span></span>
<span class="line">logging<span class="token punctuation">.</span>basicConfig<span class="token punctuation">(</span><span class="token builtin">format</span><span class="token operator">=</span>FORMAT<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token keyword">def</span> <span class="token function">test1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    logging<span class="token punctuation">.</span>warning<span class="token punctuation">(</span><span class="token string">&quot;[]和list()效率对比(运行100万次时间总和)&quot;</span><span class="token punctuation">)</span></span>
<span class="line">    logging<span class="token punctuation">.</span>warning<span class="token punctuation">(</span><span class="token string">&quot;         []: {}秒&quot;</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>timeit<span class="token punctuation">.</span>timeit<span class="token punctuation">(</span>stmt<span class="token operator">=</span><span class="token string">&quot;[]&quot;</span><span class="token punctuation">,</span> number<span class="token operator">=</span><span class="token number">1_000_000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">    logging<span class="token punctuation">.</span>warning<span class="token punctuation">(</span><span class="token string">&quot;     list(): {}秒&quot;</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>timeit<span class="token punctuation">.</span>timeit<span class="token punctuation">(</span>stmt<span class="token operator">=</span><span class="token string">&quot;list()&quot;</span><span class="token punctuation">,</span> number<span class="token operator">=</span><span class="token number">1_000_000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token keyword">def</span> <span class="token function">test2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">t1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        x <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span></span>
<span class="line">        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">100000</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">            x<span class="token punctuation">.</span>append<span class="token punctuation">(</span>i<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">t2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        x <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span></span>
<span class="line">        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">100000</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">            x<span class="token punctuation">.</span>insert<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">    logging<span class="token punctuation">.</span>warning<span class="token punctuation">(</span><span class="token string">&quot;append与insert效率对比(列表插入10万个数据,运行10次的时间总和)&quot;</span><span class="token punctuation">)</span></span>
<span class="line">    logging<span class="token punctuation">.</span>warning<span class="token punctuation">(</span><span class="token string">&quot;     append: {}秒&quot;</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>timeit<span class="token punctuation">.</span>timeit<span class="token punctuation">(</span>stmt<span class="token operator">=</span>t1<span class="token punctuation">,</span> number<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">    logging<span class="token punctuation">.</span>warning<span class="token punctuation">(</span><span class="token string">&quot;     insert: {}秒&quot;</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>timeit<span class="token punctuation">.</span>timeit<span class="token punctuation">(</span>stmt<span class="token operator">=</span>t2<span class="token punctuation">,</span> number<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line">test1<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">test2<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre></div><p>输出结果</p><div class="language-bash" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token number">2026</span>-01-02 <span class="token number">11</span>:47:54,316	 <span class="token punctuation">[</span>MainThread, <span class="token number">16076</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>和list<span class="token punctuation">(</span><span class="token punctuation">)</span>效率对比<span class="token punctuation">(</span>运行100万次时间总和<span class="token punctuation">)</span></span>
<span class="line"><span class="token number">2026</span>-01-02 <span class="token number">11</span>:47:54,335	 <span class="token punctuation">[</span>MainThread, <span class="token number">16076</span><span class="token punctuation">]</span>          <span class="token punctuation">[</span><span class="token punctuation">]</span>: <span class="token number">0.018049100000098406</span>秒</span>
<span class="line"><span class="token number">2026</span>-01-02 <span class="token number">11</span>:47:54,378	 <span class="token punctuation">[</span>MainThread, <span class="token number">16076</span><span class="token punctuation">]</span>      list<span class="token punctuation">(</span><span class="token punctuation">)</span>: <span class="token number">0.04234969999970417</span>秒</span>
<span class="line"><span class="token number">2026</span>-01-02 <span class="token number">11</span>:47:54,378	 <span class="token punctuation">[</span>MainThread, <span class="token number">16076</span><span class="token punctuation">]</span> append与insert效率对比<span class="token punctuation">(</span>列表插入10万个数据,运行10次的时间总和<span class="token punctuation">)</span></span>
<span class="line"><span class="token number">2026</span>-01-02 <span class="token number">11</span>:47:54,425	 <span class="token punctuation">[</span>MainThread, <span class="token number">16076</span><span class="token punctuation">]</span>      append: <span class="token number">0.04686989999981961</span>秒</span>
<span class="line"><span class="token number">2026</span>-01-02 <span class="token number">11</span>:48:11,463	 <span class="token punctuation">[</span>MainThread, <span class="token number">16076</span><span class="token punctuation">]</span>      insert: <span class="token number">17.038514000000305</span>秒</span>
<span class="line"></span></code></pre></div></details><details class="hint-container details"><summary>列表去重, 并保留原始顺序</summary><div class="language-python" data-highlighter="prismjs" data-ext="py"><pre><code class="language-python"><span class="line"><span class="token keyword">import</span> random</span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">Person</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        self<span class="token punctuation">.</span>name <span class="token operator">=</span> name</span>
<span class="line"></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">__repr__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token string-interpolation"><span class="token string">f&quot;&lt;Person </span><span class="token interpolation"><span class="token punctuation">{</span>self<span class="token punctuation">.</span>name<span class="token punctuation">}</span></span><span class="token string">&gt;&quot;</span></span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 定义数据</span></span>
<span class="line">l1 <span class="token operator">=</span> <span class="token punctuation">[</span>random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">]</span></span>
<span class="line">l2 <span class="token operator">=</span> <span class="token punctuation">[</span>Person<span class="token punctuation">(</span>random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">]</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;原始数据-1: &quot;</span><span class="token punctuation">,</span> l1<span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;原始数据-2: &quot;</span><span class="token punctuation">,</span> l2<span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 简单的去重方式, 简单但是有限制</span></span>
<span class="line"><span class="token comment"># list(set(l1))           适用于简单数据类型, 不适用于上面的l2, 不保证顺序</span></span>
<span class="line"><span class="token comment"># list(dict.fromkeys(l1)) 适用于简单数据类型, 不适用于上面的l2, 保证顺序</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 通用的去重方式 + 保证顺序</span></span>
<span class="line">t1 <span class="token operator">=</span> <span class="token builtin">set</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">u1 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span></span>
<span class="line"><span class="token keyword">for</span> i <span class="token keyword">in</span> l1<span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">if</span> i <span class="token keyword">not</span> <span class="token keyword">in</span> t1<span class="token punctuation">:</span></span>
<span class="line">        t1<span class="token punctuation">.</span>add<span class="token punctuation">(</span>i<span class="token punctuation">)</span></span>
<span class="line">        u1<span class="token punctuation">.</span>append<span class="token punctuation">(</span>i<span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;通用去重-1: &quot;</span><span class="token punctuation">,</span> u1<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">t2 <span class="token operator">=</span> <span class="token builtin">set</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">u2 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span></span>
<span class="line"><span class="token keyword">for</span> i <span class="token keyword">in</span> l2<span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">if</span> i<span class="token punctuation">.</span>name <span class="token keyword">not</span> <span class="token keyword">in</span> t2<span class="token punctuation">:</span></span>
<span class="line">        t2<span class="token punctuation">.</span>add<span class="token punctuation">(</span>i<span class="token punctuation">.</span>name<span class="token punctuation">)</span></span>
<span class="line">        u2<span class="token punctuation">.</span>append<span class="token punctuation">(</span>i<span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;通用去重-2: &quot;</span><span class="token punctuation">,</span> u2<span class="token punctuation">)</span></span>
<span class="line"></span></code></pre></div><p>输出结果</p><div class="language-bash" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line">原始数据-1:  <span class="token punctuation">[</span><span class="token number">4</span>, <span class="token number">1</span>, <span class="token number">4</span>, <span class="token number">2</span>, <span class="token number">1</span><span class="token punctuation">]</span></span>
<span class="line">原始数据-2:  <span class="token punctuation">[</span><span class="token operator">&lt;</span>Person <span class="token operator"><span class="token file-descriptor important">3</span>&gt;</span>, <span class="token operator">&lt;</span>Person <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span>, <span class="token operator">&lt;</span>Person <span class="token operator"><span class="token file-descriptor important">3</span>&gt;</span>, <span class="token operator">&lt;</span>Person <span class="token operator"><span class="token file-descriptor important">1</span>&gt;</span>, <span class="token operator">&lt;</span>Person <span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span><span class="token punctuation">]</span></span>
<span class="line"></span>
<span class="line">通用去重-1:  <span class="token punctuation">[</span><span class="token number">4</span>, <span class="token number">1</span>, <span class="token number">2</span><span class="token punctuation">]</span></span>
<span class="line">通用去重-2:  <span class="token punctuation">[</span><span class="token operator">&lt;</span>Person <span class="token operator"><span class="token file-descriptor important">3</span>&gt;</span>, <span class="token operator">&lt;</span>Person <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span>, <span class="token operator">&lt;</span>Person <span class="token operator"><span class="token file-descriptor important">1</span>&gt;</span>, <span class="token operator">&lt;</span>Person <span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span><span class="token punctuation">]</span></span>
<span class="line"></span></code></pre></div></details><details class="hint-container details"><summary>列表分组</summary><div class="language-python" data-highlighter="prismjs" data-ext="py"><pre><code class="language-python"><span class="line">l <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span><span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;原始数据: &quot;</span><span class="token punctuation">,</span> l<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 每三个元素分为一组, 最后一组不足3个元素会保留</span></span>
<span class="line">n <span class="token operator">=</span> <span class="token number">3</span></span>
<span class="line">l2 <span class="token operator">=</span> <span class="token punctuation">[</span>l<span class="token punctuation">[</span>x<span class="token punctuation">:</span>x <span class="token operator">+</span> n<span class="token punctuation">]</span> <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>l<span class="token punctuation">)</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">]</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;列表分组: &quot;</span><span class="token punctuation">,</span> l2<span class="token punctuation">)</span></span>
<span class="line"></span></code></pre></div><p>输出结果</p><div class="language-bash" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line">原始数据:  <span class="token punctuation">[</span><span class="token number">0</span>, <span class="token number">1</span>, <span class="token number">2</span>, <span class="token number">3</span>, <span class="token number">4</span>, <span class="token number">5</span>, <span class="token number">6</span>, <span class="token number">7</span>, <span class="token number">8</span>, <span class="token number">9</span><span class="token punctuation">]</span></span>
<span class="line">列表分组:  <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">0</span>, <span class="token number">1</span>, <span class="token number">2</span><span class="token punctuation">]</span>, <span class="token punctuation">[</span><span class="token number">3</span>, <span class="token number">4</span>, <span class="token number">5</span><span class="token punctuation">]</span>, <span class="token punctuation">[</span><span class="token number">6</span>, <span class="token number">7</span>, <span class="token number">8</span><span class="token punctuation">]</span>, <span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">]</span></span>
<span class="line"></span></code></pre></div></details><br><h3 id="元组-tuple" tabindex="-1"><a class="header-anchor" href="#元组-tuple"><span>元组(tuple)</span></a></h3><p>文档：<a href="https://docs.python.org/zh-cn/3/library/stdtypes.html#tuple" target="_blank" rel="noopener noreferrer">https://docs.python.org/zh-cn/3/library/stdtypes.html#tuple</a></p><details class="hint-container details"><summary>元祖方法</summary><table><thead><tr><th>分类</th><th>方法</th><th>说明</th></tr></thead><tbody><tr><td>查找</td><td><code>index(value, start=0, stop=9223372036854775807, /)</code></td><td>返回value在元组中第一次出现的索引号，找不到抛出ValueError异常</td></tr><tr><td></td><td><code>count(value, /)</code></td><td>返回value在元组中出现的次数</td></tr></tbody></table></details><details class="hint-container details"><summary>命名元组</summary><p>命名元组函数签名</p><div class="language-python" data-highlighter="prismjs" data-ext="py"><pre><code class="language-python"><span class="line">namedtuple<span class="token punctuation">(</span>typename<span class="token punctuation">,</span> field_names<span class="token punctuation">,</span> <span class="token operator">*</span><span class="token punctuation">,</span> rename<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> defaults<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> module<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre></div><p>示例代码</p><div class="language-python" data-highlighter="prismjs" data-ext="py"><pre><code class="language-python"><span class="line"><span class="token comment">#!/usr/bin/env python</span></span>
<span class="line"><span class="token comment"># -*- coding:utf-8 -*-</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">from</span> collections <span class="token keyword">import</span> namedtuple</span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token comment"># 命名元组 - 基本使用</span></span>
<span class="line">    Person <span class="token operator">=</span> namedtuple<span class="token punctuation">(</span><span class="token string">&quot;Person&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;sex&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;age&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span></span>
<span class="line">    user <span class="token operator">=</span> Person<span class="token punctuation">(</span><span class="token string">&quot;小明&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;男&quot;</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;</span><span class="token interpolation"><span class="token punctuation">{</span>user<span class="token punctuation">.</span>name<span class="token punctuation">}</span></span><span class="token string"> | </span><span class="token interpolation"><span class="token punctuation">{</span>user<span class="token punctuation">.</span>sex<span class="token punctuation">}</span></span><span class="token string"> | </span><span class="token interpolation"><span class="token punctuation">{</span>user<span class="token punctuation">.</span>age<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>  <span class="token comment"># 命名元组使用方法</span></span>
<span class="line">    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;</span><span class="token interpolation"><span class="token punctuation">{</span>user<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string"> | </span><span class="token interpolation"><span class="token punctuation">{</span>user<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string"> | </span><span class="token interpolation"><span class="token punctuation">{</span>user<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>  <span class="token comment"># 也可以像普通元组一样使用</span></span>
<span class="line">    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;</span><span class="token interpolation"><span class="token punctuation">{</span>user<span class="token punctuation">.</span>_fields<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>  <span class="token comment"># 查看所有的属性</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment"># 命名元组 - 安全模式</span></span>
<span class="line">    <span class="token comment">#   如果属性与python关键字时(比如def)重叠时，代码会报错，</span></span>
<span class="line">    <span class="token comment">#   使用rename=True可以避免这个错误，会将名字替换为 _索引</span></span>
<span class="line">    Product <span class="token operator">=</span> namedtuple<span class="token punctuation">(</span><span class="token string">&quot;Product&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;def&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;color&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;price&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;class&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> rename<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span></span>
<span class="line">    product <span class="token operator">=</span> Product<span class="token punctuation">(</span><span class="token string">&quot;冰糖雪梨&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;黄色&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;3元&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">print</span><span class="token punctuation">(</span>product<span class="token punctuation">.</span>_fields<span class="token punctuation">)</span>  <span class="token comment"># (&#39;name&#39;, &#39;_1&#39;, &#39;color&#39;, &#39;price&#39;, &#39;_4&#39;), 可以看到已经进行了替换</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment"># 命名元组 - 用的不是很多，其他的内容就一并带过了</span></span>
<span class="line">    <span class="token comment">#   默认参数</span></span>
<span class="line">    <span class="token comment">#   _replace(**kwargs)替换生成新的命名元组并返回</span></span>
<span class="line">    <span class="token comment">#   _make()批量给命名元组赋值</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">&#39;__main__&#39;</span><span class="token punctuation">:</span></span>
<span class="line">    main<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre></div></details><br><h3 id="字符串-str" tabindex="-1"><a class="header-anchor" href="#字符串-str"><span>字符串(str)</span></a></h3><p>文档：<a href="https://docs.python.org/3/library/stdtypes.html#str" target="_blank" rel="noopener noreferrer">https://docs.python.org/3/library/stdtypes.html#str</a></p><details class="hint-container details"><summary>（1）字符串类签名</summary><div class="language-python" data-highlighter="prismjs" data-ext="py"><pre><code class="language-python"><span class="line"><span class="token keyword">class</span> <span class="token class-name">str</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token operator">=</span><span class="token string">b&#39;&#39;</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">&#39;utf-8&#39;</span><span class="token punctuation">,</span> errors<span class="token operator">=</span><span class="token string">&#39;strict&#39;</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre></div><p>根据传入的对象创建一个新字符串</p><ul><li><p>如果<code>encoding</code>和<code>errors</code>都没有指定值，那么会调用<code>object.__str__()</code>，如果对象没有<code>__str__()</code>方法，那么会调用<code>repr(object)</code></p></li><li><p>如果encoding和errors至少指定一个值，那么该输入对象应该是一个 bytes-like对象，</p><p>此时就相当于<code>str(bytes, encoding, errors)</code> == <code>bytes.decode(encoding, errors)</code></p></li><li><p>encoding默认值从<code>sys.getdefaultencoding()</code>中获取</p></li></ul><div class="language-python" data-highlighter="prismjs" data-ext="py"><pre><code class="language-python"><span class="line"><span class="token comment">#!/usr/bin/env python</span></span>
<span class="line"><span class="token comment"># -*- coding:utf-8 -*-</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> sys</span>
<span class="line"></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span><span class="token string">b&#39;abc&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># b&#39;abc&#39;，这里是字节类型</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span><span class="token string">b&#39;abc&#39;</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">&quot;utf-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># abc，这里是字符串类型</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span>sys<span class="token punctuation">.</span>getdefaultencoding<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># utf-8</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span><span class="token string">b&#39;abc&#39;</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">&quot;utf-8&quot;</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token builtin">bytes</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">b&#39;abc&#39;</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">&quot;utf-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># True</span></span>
<span class="line"></span></code></pre></div></details><details class="hint-container details"><summary>（2）格式化输出的几种方法</summary><p>① 使用%（已经不推荐使用，仅作了解）</p><div class="language-python" data-highlighter="prismjs" data-ext="py"><pre><code class="language-python"><span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;I am %d years old, and i has %d friends&quot;</span> <span class="token operator">%</span> <span class="token punctuation">(</span><span class="token number">27</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&#39;%(language)s has %(number)03d quote types.&#39;</span> <span class="token operator">%</span> <span class="token punctuation">{</span><span class="token string">&#39;language&#39;</span><span class="token punctuation">:</span> <span class="token string">&quot;Python&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;number&quot;</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">}</span><span class="token punctuation">)</span>  </span>
<span class="line"></span>
<span class="line"><span class="token comment"># I am 27 years old, and i has 3 friends</span></span>
<span class="line"><span class="token comment"># Python has 002 quote types.</span></span>
<span class="line"></span></code></pre></div><p>② 使用format（推荐）</p><div class="language-python" data-highlighter="prismjs" data-ext="py"><pre><code class="language-python"><span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;Hello {name1}, hello {name2}&quot;</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>name1<span class="token operator">=</span><span class="token string">&quot;python&quot;</span><span class="token punctuation">,</span> name2<span class="token operator">=</span><span class="token string">&quot;world&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  </span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;Hello {name1}, hello {name2}&quot;</span><span class="token punctuation">.</span>format_map<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">&quot;name1&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;python&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;name2&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;world&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># Hello python, hello world</span></span>
<span class="line"><span class="token comment"># Hello python, hello world</span></span>
<span class="line"></span></code></pre></div><p>③ 使用f-string（推荐）</p><div class="language-python" data-highlighter="prismjs" data-ext="py"><pre><code class="language-python"><span class="line">name1 <span class="token operator">=</span> <span class="token string">&quot;python&quot;</span></span>
<span class="line">name2 <span class="token operator">=</span> <span class="token string">&quot;world&quot;</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;Hello </span><span class="token interpolation"><span class="token punctuation">{</span>name1<span class="token punctuation">}</span></span><span class="token string">, hello </span><span class="token interpolation"><span class="token punctuation">{</span>name2<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># Hello python, hello world</span></span>
<span class="line"></span></code></pre></div><p>输出方法总结</p><div class="language-python" data-highlighter="prismjs" data-ext="py"><pre><code class="language-python"><span class="line"><span class="token comment">#!/usr/bin/env python</span></span>
<span class="line"><span class="token comment"># -*- coding:utf-8 -*-</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 第1种方法</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;I am %s years old&quot;</span> <span class="token operator">%</span> <span class="token string">&quot;18&quot;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 第2种方法</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;I am %(year)d years old&quot;</span> <span class="token operator">%</span> <span class="token punctuation">{</span><span class="token string">&quot;year&quot;</span><span class="token punctuation">:</span> <span class="token number">18</span><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 第3种方法</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;I am {year} years old&quot;</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>year<span class="token operator">=</span><span class="token number">18</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 第4种方法</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;I am {} years old&quot;</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token number">18</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 第5种方法</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;I am {year} years old&quot;</span><span class="token punctuation">.</span>format_map<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">&quot;year&quot;</span><span class="token punctuation">:</span> <span class="token number">18</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 第6种方法</span></span>
<span class="line">year <span class="token operator">=</span> <span class="token number">18</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;I am </span><span class="token interpolation"><span class="token punctuation">{</span>year<span class="token punctuation">}</span></span><span class="token string"> years old&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre></div></details><details class="hint-container details"><summary>（3）格式化输修饰符</summary><p><strong>修饰符说明</strong></p><table><thead><tr><th>修饰符</th><th>说明</th></tr></thead><tbody><tr><td><code>^</code></td><td>剧中</td></tr><tr><td><code>&lt;</code></td><td>左对齐</td></tr><tr><td><code>&gt;</code></td><td>右对齐</td></tr><tr><td><code>,</code></td><td>逗号，可以做千位分隔符</td></tr><tr><td><code>{:n}</code></td><td>用空白补充该变量的长度到n(在两边补充)</td></tr><tr><td><code>{:#^n}</code></td><td>用#号补充该变量的长度到n(在两边补充)，并设置为剧中对齐；格式为：<code>补充-对齐-宽度-小数点保留位数</code></td></tr></tbody></table><p><strong>代码演示</strong></p><div class="language-python" data-highlighter="prismjs" data-ext="py"><pre><code class="language-python"><span class="line"><span class="token comment">#!/usr/bin/env python</span></span>
<span class="line"><span class="token comment"># -*- coding:utf-8 -*-</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># （1）保留两位小数</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&#39;\n(1) 默认情况下: 5/3 = </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token number">5</span> <span class="token operator">/</span> <span class="token number">3</span><span class="token punctuation">}</span></span><span class="token string"> | 保留两位小数: 5/3 = </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token number">5</span> <span class="token operator">/</span> <span class="token number">3</span><span class="token punctuation">:</span><span class="token format-spec">.2f</span><span class="token punctuation">}</span></span><span class="token string">\n&#39;</span></span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># (2) 千位分隔符</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&#39;(2) 千位分隔符: {:,}\n&#39;</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token number">123456789</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># （3）字符串长度为20,将字符串居中，两侧添加_</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;(3) 样式设置: {:_^20}\n&quot;</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token string">&quot;Hello World!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token comment"># (4) 中文对齐问题（命令行有效，Pycharm中汉字和英文宽度比例有问题）</span></span>
<span class="line"><span class="token comment">#     一个中文占据2个ASCII码的宽度</span></span>
<span class="line"><span class="token comment">#     一个ASCII码占1个字节大小，一个中文占3个字节大小</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">def</span> <span class="token function">is_chinese</span><span class="token punctuation">(</span>uchar<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token triple-quoted-string string">&#39;&#39;&#39;检测是否是中文&#39;&#39;&#39;</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment"># 针对中文标点符号，根据实际情况继续添加</span></span>
<span class="line">    symbols <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;、&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;。&quot;</span><span class="token punctuation">]</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span><span class="token builtin">list</span><span class="token punctuation">(</span><span class="token builtin">filter</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> x <span class="token keyword">in</span> symbols<span class="token punctuation">,</span> uchar<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token boolean">True</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment"># 中文检测</span></span>
<span class="line">    <span class="token keyword">if</span> uchar <span class="token operator">&gt;=</span> <span class="token string">u&#39;\u4e00&#39;</span> <span class="token keyword">and</span> uchar <span class="token operator">&lt;=</span> <span class="token string">u&#39;\u9fa5&#39;</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token boolean">True</span></span>
<span class="line">    <span class="token keyword">else</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token boolean">False</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token keyword">def</span> <span class="token function">chinese_number</span><span class="token punctuation">(</span>ustr<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token triple-quoted-string string">&#39;&#39;&#39;返回中文字符的数量&#39;&#39;&#39;</span></span>
<span class="line">    c_n <span class="token operator">=</span> <span class="token number">0</span></span>
<span class="line">    <span class="token keyword">for</span> i <span class="token keyword">in</span> ustr<span class="token punctuation">:</span></span>
<span class="line">        <span class="token keyword">if</span> is_chinese<span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">            c_n <span class="token operator">+=</span> <span class="token number">1</span></span>
<span class="line">    <span class="token keyword">return</span> c_n</span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;(4) 中文对齐问题(CMD下生效,Pycharm中有问题)&quot;</span><span class="token punctuation">)</span></span>
<span class="line">msg1 <span class="token operator">=</span> <span class="token punctuation">[</span></span>
<span class="line">    <span class="token string">&quot;调用该方法的字符串将作为元素之间的分隔&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string">&quot;此静态方法返回一个可供 str.translate() 使用的转换对照表。&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string">&#39;即那些具有&quot;Lm&quot;、&quot;Lt&quot;、&quot;Lu&quot;、&quot;Ll&quot; 或 &quot;Lo&quot; 之一的通用类别属性的字符&#39;</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">]</span></span>
<span class="line">msg2 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;占位符&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;占位符&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;占位符&quot;</span><span class="token punctuation">]</span></span>
<span class="line">fmt <span class="token operator">=</span> <span class="token string">&#39;[ |{name:{width}}| |{years:&lt;20}| ]&#39;</span></span>
<span class="line"><span class="token keyword">for</span> name<span class="token punctuation">,</span> years <span class="token keyword">in</span> <span class="token builtin">zip</span><span class="token punctuation">(</span>msg1<span class="token punctuation">,</span> msg2<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">print</span><span class="token punctuation">(</span>fmt<span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>name<span class="token operator">=</span>name<span class="token punctuation">,</span> width<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">100</span> <span class="token operator">-</span> chinese_number<span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> years<span class="token operator">=</span>years<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre></div><p>输出结果</p><p><img src="https://tuchuang-1257805459.cos.accelerate.myqcloud.com/image-20220405164801876.png" alt="image-20220405164801876"></p></details><details class="hint-container details"><summary>（4）字符串常用方法</summary><table><thead><tr><th>分类</th><th>方法</th><th>说明</th></tr></thead><tbody><tr><td>大小写转换</td><td>str.casefold()</td><td>返回一个新字符串，把所有大写字母改为小写（除了英文，对于其他语言同样有效）</td></tr><tr><td></td><td>str.lower()</td><td>返回一个新字符串，把所有大写字母改为小写（针对A-Z）</td></tr><tr><td></td><td>str.upper()</td><td>返回一个新字符串，把所有小写字母改为大写（针对A-Z）</td></tr><tr><td></td><td>str.swapcase()</td><td>翻转字符串，大写变小写，小写变大写</td></tr><tr><td>搜索</td><td>str.count(<em>sub</em>[, <em>start</em>[, <em>end</em>]])</td><td>返回sub在字符串出现的次数，start和end表示起始范围（可选）</td></tr><tr><td></td><td>str.find(<em>sub</em>[, <em>start</em>[, <em>end</em>]])</td><td>检查字符串sub是否包含在字符串中，如果有则返回索引值，没有则返回-1<br>只有当你明确确定位置或需要得到索引值时，才应该使用find方法，否则应该使用in<br>类似的还有<code>str.rfind</code>，从右向左开始查找</td></tr><tr><td></td><td>str.index(<em>sub</em>[, <em>start</em>[, <em>end</em>]])</td><td>与find类型，当sub找不到的时候会引发<code>ValueError异常</code><br>类似的还有rindex，从右向左开始查找</td></tr><tr><td>分割和合并</td><td>str.split(<em>sep=None</em>, <em>maxsplit=-1</em>)</td><td>以\n,\r和\r\n和空白为分隔符分割字符串，返回一个列表，sep指定分隔符，maxsplit指定分割次数<br>类似的有str.rsplit，从右向左开始分割</td></tr><tr><td></td><td>str.splitlines([<em>keepends</em>])</td><td>以\n,\r和\r\n为分隔符，返回一个列表;如果keepends为True,则分隔符保留，否则丢弃</td></tr><tr><td></td><td>str.join(<em>iterable</em>)</td><td>字符串连接<br>join里的参数的所有元素必须是字符串类型，否则会报错,解决方法可以这样：<br><code>&#39;-&#39;.join([str(x) for x in range(10)])</code></td></tr><tr><td>替换</td><td>str.replace(<em>old</em>, <em>new</em>[, <em>count</em>])</td><td>将字符串中的old替换为new，count指定替换次数，可选，默认全部替换</td></tr><tr><td>删除左右空白</td><td>str.strip([<em>chars</em>])</td><td>删除字符串两侧的字符，默认为空白，<br>类似的还有lstrip（只删除左边的字符）、rstrip（只删除右边的字符）</td></tr><tr><td>开头、结尾匹配</td><td>str.startswith(<em>prefix</em>[, <em>start</em>[, <em>end</em>]])</td><td>检查字符串是否以prefix子字符串开头，start和end表示匹配的起始范围（可选）</td></tr><tr><td></td><td>str.endswith(<em>suffix</em>[, <em>start</em>[, <em>end</em>]])</td><td>同上</td></tr><tr><td>制表符</td><td>str.expandtabs(<em>tabsize=8</em>)</td><td>返回一个新字符串，把字符串中的制表符(\t)替换成tabsize个空格，tabsize默认是8</td></tr><tr><td>类型判断</td><td>str.isdigit()</td><td>如果字符串只包含数字则返回True，否则返回False</td></tr><tr><td></td><td>str.isdecimal()</td><td>如果字符串只包含十进制数则返回True，否则返回False</td></tr><tr><td></td><td>str.isnumeric()</td><td>如果字符串只包含数字字符则返回True，否则返回False</td></tr><tr><td></td><td>str.isalpha()</td><td>如果字符串至少有一个字符并且所有字符都是字母则返回Trule,否则返回False</td></tr><tr><td></td><td>str.isalnum()</td><td>如果字符串至少有一个字符并且所有字符都是数字或者字母则返回Trule,否则返回False</td></tr><tr><td></td><td>str.isascii()</td><td>如果字符串为空或者为ASCII码返回True，否则返回False</td></tr><tr><td></td><td>更多类型判断...</td><td></td></tr></tbody></table></details><details class="hint-container details"><summary>（5）str和byte转换</summary><div class="language-python" data-highlighter="prismjs" data-ext="py"><pre><code class="language-python"><span class="line"><span class="token comment">#!/usr/bin/env python</span></span>
<span class="line"><span class="token comment"># -*- coding:utf-8 -*-</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&#39;中&#39;</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span>encoding<span class="token operator">=</span><span class="token string">&quot;utf-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># b&#39;\xe4\xb8\xad&#39;</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">b&#39;\xe4\xb8\xad&#39;</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">&quot;utf-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 中</span></span>
<span class="line"></span></code></pre></div></details><details class="hint-container details"><summary>（6）Template：处理不可信文本，str库提供</summary><div class="language-python" data-highlighter="prismjs" data-ext="py"><pre><code class="language-python"><span class="line"><span class="token keyword">from</span> string <span class="token keyword">import</span> Template</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 定义一个字符串模板, $name 和 $age 是占位符，不是 Python 表达式</span></span>
<span class="line">t <span class="token operator">=</span> Template<span class="token punctuation">(</span><span class="token string">&quot;$name is $age years old&quot;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 使用 substitute 方法进行变量替换, 返回值是一个普通的字符串（str）</span></span>
<span class="line"><span class="token comment"># name 和 age 会分别替换模板中的 $name 和 $age</span></span>
<span class="line"><span class="token comment"># 如果缺少变量，会抛出 KeyError</span></span>
<span class="line">s1 <span class="token operator">=</span> t<span class="token punctuation">.</span>substitute<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">&quot;Tom&quot;</span><span class="token punctuation">,</span> age<span class="token operator">=</span><span class="token number">18</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># safe_substitute：缺变量不会报错 → 原样保留, 比如 $age</span></span>
<span class="line">s2 <span class="token operator">=</span> t<span class="token punctuation">.</span>safe_substitute<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">&quot;Tom&quot;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span>s1<span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span>s2<span class="token punctuation">)</span></span>
<span class="line"></span></code></pre></div></details><details class="hint-container details"><summary>（7）t-string：安全模板字符串语法，需要Python 3.14+</summary><div class="language-python" data-highlighter="prismjs" data-ext="py"><pre><code class="language-python"><span class="line">name <span class="token operator">=</span> <span class="token string">&quot;Tom&quot;</span></span>
<span class="line">age <span class="token operator">=</span> <span class="token number">18</span></span>
<span class="line"></span>
<span class="line">s <span class="token operator">=</span> t<span class="token string">&quot;$name is $age years old&quot;</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span></span>
<span class="line"></span></code></pre></div></details><br><h3 id="字典-dict" tabindex="-1"><a class="header-anchor" href="#字典-dict"><span>字典(dict)</span></a></h3><p>文档：<a href="https://docs.python.org/zh-cn/3/library/stdtypes.html#dict" target="_blank" rel="noopener noreferrer">https://docs.python.org/zh-cn/3/library/stdtypes.html#dict</a></p><details class="hint-container details"><summary>（1）字典创建</summary><div class="language-python" data-highlighter="prismjs" data-ext="py"><pre><code class="language-python"><span class="line"><span class="token comment">#!/usr/bin/env python</span></span>
<span class="line"><span class="token comment"># -*- coding:utf-8 -*-</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># (1) 普通方法创建字典</span></span>
<span class="line">a <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>one<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> two<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> three<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span></span>
<span class="line">b <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&#39;one&#39;</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&#39;two&#39;</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">&#39;three&#39;</span><span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">}</span></span>
<span class="line">c <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">zip</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&#39;one&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;two&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;three&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">d <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token string">&#39;two&#39;</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">&#39;one&#39;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">&#39;three&#39;</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span></span>
<span class="line">e <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">&#39;three&#39;</span><span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">&#39;one&#39;</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&#39;two&#39;</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;(1) 普通方式创建的字典: </span><span class="token interpolation"><span class="token punctuation">{</span>a <span class="token operator">==</span> b <span class="token operator">==</span> c <span class="token operator">==</span> d <span class="token operator">==</span> e<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># (2) 通过fromkeys创建字典</span></span>
<span class="line">a <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span>
<span class="line">b <span class="token operator">=</span> a<span class="token punctuation">.</span>fromkeys<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;b&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;c&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;(2) 通过fromkeys创建字典: </span><span class="token interpolation"><span class="token punctuation">{</span>b<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># (3) 字典推导式</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;(3) 字典推导式&quot;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;    {}&quot;</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token punctuation">{</span>x<span class="token punctuation">:</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">list</span><span class="token punctuation">(</span><span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">65</span><span class="token punctuation">,</span> <span class="token number">68</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;    {}&quot;</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token punctuation">{</span>i<span class="token punctuation">:</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">65</span><span class="token punctuation">)</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">list</span><span class="token punctuation">(</span><span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre></div><p>输出结果</p><div class="language-bash" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> 普通方式创建的字典: True</span>
<span class="line"><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> 通过fromkeys创建字典: <span class="token punctuation">{</span><span class="token number">1</span>: <span class="token punctuation">[</span><span class="token string">&#39;a&#39;</span>, <span class="token string">&#39;b&#39;</span>, <span class="token string">&#39;c&#39;</span><span class="token punctuation">]</span>, <span class="token number">2</span>: <span class="token punctuation">[</span><span class="token string">&#39;a&#39;</span>, <span class="token string">&#39;b&#39;</span>, <span class="token string">&#39;c&#39;</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span> 字典推导式</span>
<span class="line">    <span class="token punctuation">{</span><span class="token number">65</span>: <span class="token string">&#39;A&#39;</span>, <span class="token number">66</span>: <span class="token string">&#39;B&#39;</span>, <span class="token number">67</span>: <span class="token string">&#39;C&#39;</span><span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">{</span><span class="token number">0</span>: <span class="token string">&#39;A&#39;</span>, <span class="token number">1</span>: <span class="token string">&#39;B&#39;</span>, <span class="token number">2</span>: <span class="token string">&#39;C&#39;</span><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre></div></details><details class="hint-container details"><summary>（2）字典方法</summary><table><thead><tr><th>分类</th><th>方法</th><th>说明</th></tr></thead><tbody><tr><td>添加</td><td>dict[key] = value</td><td>直接赋值，没有即新增，有的话为覆盖</td></tr><tr><td></td><td>dict.update(dict)</td><td>字典合并</td></tr><tr><td></td><td>dict.setdefault(k, [value])</td><td>k存在则返回v的值，否则设置dict[k] = value，并返回value的值</td></tr><tr><td>删除</td><td>del dict[key]</td><td>直接删除</td></tr><tr><td></td><td>dict.pop(key)</td><td>弹出value值，如果key未找到则抛出KeyError</td></tr><tr><td></td><td>dict.popitem ()</td><td>随机弹出键值对</td></tr><tr><td></td><td>dict.clear()</td><td>删除字典所有元素</td></tr><tr><td>查找</td><td>dict[key]</td><td>返回value值，如果key不存在，则抛出KeyError</td></tr><tr><td></td><td>dict.get(key, [default])</td><td>返回value值，如果key不存在，则返回default值或None</td></tr><tr><td>拷贝</td><td>dict.copy()</td><td>浅拷贝</td></tr><tr><td></td><td>copy.deepcopy(dict)</td><td>深拷贝</td></tr><tr><td>遍历</td><td>dict.keys()</td><td>返回所有的key</td></tr><tr><td></td><td>dict.values()</td><td>返回所有的value</td></tr><tr><td></td><td>dict.items()</td><td>返回k和v</td></tr></tbody></table></details><br><h3 id="可变集合-set" tabindex="-1"><a class="header-anchor" href="#可变集合-set"><span>可变集合(set)</span></a></h3><p>文档：<a href="https://docs.python.org/zh-cn/3/library/stdtypes.html#set" target="_blank" rel="noopener noreferrer">https://docs.python.org/zh-cn/3/library/stdtypes.html#set</a></p><details class="hint-container details"><summary>（1）创建集合</summary><div class="language-python" data-highlighter="prismjs" data-ext="py"><pre><code class="language-python"><span class="line"><span class="token comment">#!/usr/bin/env python</span></span>
<span class="line"><span class="token comment"># -*- coding:utf-8 -*-</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line">a <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">}</span></span>
<span class="line">b <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">&quot;B&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span>
<span class="line">c <span class="token operator">=</span> <span class="token builtin">set</span><span class="token punctuation">(</span><span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span></span>
<span class="line"></span></code></pre></div><p>输出结果</p><div class="language-bash" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">{</span><span class="token number">2</span>, <span class="token punctuation">(</span><span class="token number">1</span>, <span class="token number">2</span>, <span class="token number">3</span><span class="token punctuation">)</span>, <span class="token string">&#39;B&#39;</span><span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">{</span><span class="token number">0</span>, <span class="token number">1</span>, <span class="token number">2</span>, <span class="token number">3</span>, <span class="token number">4</span><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre></div></details><details class="hint-container details"><summary>（2）集合方法</summary><table><thead><tr><th>分类</th><th>方法</th><th>说明</th></tr></thead><tbody><tr><td>添加元素</td><td>.add(value)</td><td>添加元素</td></tr><tr><td></td><td>.update(set)</td><td>集合合并</td></tr><tr><td>删除元素</td><td>.remove(value)</td><td>删除元素，如果元素不存在则抛出KeyError错误</td></tr><tr><td></td><td>.clear()</td><td>删除所有元素</td></tr><tr><td></td><td>.pop()</td><td>从下标0开始弹出元素</td></tr><tr><td>拷贝</td><td>.copy()</td><td>浅拷贝</td></tr><tr><td>集合操作</td><td>.union(set)</td><td>返回一个新集合，是两个集合的并集</td></tr><tr><td></td><td>.intersection(set)</td><td>返回一个新集合，是两个集合的交集</td></tr><tr><td></td><td>.intersection_update(set)</td><td><strong>就地修改原集合，是两个集合的交集</strong></td></tr><tr><td></td><td>.difference(set)</td><td>返回一个新集合，是原集合独有的元素</td></tr><tr><td></td><td>.difference_update(set)</td><td><strong>就地修改原集合，是原集合独有的元素</strong></td></tr><tr><td></td><td>.issubset(set)</td><td>返回一个布尔值，判断原集合是否是新集合的子集</td></tr><tr><td></td><td>.issuperset(set)</td><td>返回一个布尔值，判断原集合是否是新集合的父集</td></tr><tr><td></td><td>.isdisjoint(set)</td><td>返回一个布尔值，判断两个集合是否【没有交集】</td></tr><tr><td></td><td>.symmetric_difference(set)</td><td>返回一个新集合，取两个集合不一样的所有元素</td></tr><tr><td></td><td>.symmetric_difference_update(set)</td><td><strong>就地修改原集合，取两个集合不一样的所有元素</strong></td></tr></tbody></table></details><br><h3 id="不可变集合-frozenset" tabindex="-1"><a class="header-anchor" href="#不可变集合-frozenset"><span>不可变集合(frozenset)</span></a></h3><p>文档：<a href="https://docs.python.org/zh-cn/3/library/stdtypes.html#frozenset" target="_blank" rel="noopener noreferrer">https://docs.python.org/zh-cn/3/library/stdtypes.html#frozenset</a></p><details class="hint-container details"><summary>不可变集合(frozenset)</summary><p>和<code>set</code>类似，只是少了许多方法，用法都是一样的</p><div class="language-python" data-highlighter="prismjs" data-ext="py"><pre><code class="language-python"><span class="line"><span class="token comment">#!/usr/bin/env python</span></span>
<span class="line"><span class="token comment"># -*- coding:utf-8 -*-</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line">a <span class="token operator">=</span> <span class="token builtin">frozenset</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">dir</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># frozenset({1, 2, 3})</span></span>
<span class="line"><span class="token comment"># [&#39;copy&#39;, &#39;difference&#39;, &#39;intersection&#39;, &#39;isdisjoint&#39;, &#39;issubset&#39;, &#39;issuperset&#39;, &#39;symmetric_difference&#39;, &#39;union&#39;]</span></span>
<span class="line"></span></code></pre></div></details><br><h3 id="可变对象和不可变对象" tabindex="-1"><a class="header-anchor" href="#可变对象和不可变对象"><span>可变对象和不可变对象</span></a></h3><p><strong>引用计数模型</strong></p><p><img src="https://tuchuang-1257805459.cos.accelerate.myqcloud.com/698051107556314373.png" alt="698051107556314373"></p><details class="hint-container details"><summary>（1）代码说明</summary><div class="language-python" data-highlighter="prismjs" data-ext="py"><pre><code class="language-python"><span class="line"><span class="token comment">#!/usr/bin/env python</span></span>
<span class="line"><span class="token comment"># -*- coding:utf-8 -*-</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> sys</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 使用sys.getrefcount(obj)可以查看一个对象的引用计数，因为这个API也会使对象增加一个临时引用，所以真实的引用计数应该再减去1</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 初始化变量</span></span>
<span class="line">a <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;代码: a = </span><span class="token interpolation"><span class="token punctuation">{</span>a<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;说明: 引用计数(a):</span><span class="token interpolation"><span class="token punctuation">{</span>sys<span class="token punctuation">.</span>getrefcount<span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">}</span></span><span class="token string">, 内存地址:</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">hex</span><span class="token punctuation">(</span><span class="token builtin">id</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">\n&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># b = a</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;代码: b = a&quot;</span><span class="token punctuation">)</span></span>
<span class="line">b <span class="token operator">=</span> a</span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;说明: &quot;</span></span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;     引用计数(a): </span><span class="token interpolation"><span class="token punctuation">{</span>sys<span class="token punctuation">.</span>getrefcount<span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">}</span></span><span class="token string">, 内存地址:</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">hex</span><span class="token punctuation">(</span><span class="token builtin">id</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;     引用计数(b): </span><span class="token interpolation"><span class="token punctuation">{</span>sys<span class="token punctuation">.</span>getrefcount<span class="token punctuation">(</span>b<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">}</span></span><span class="token string">, 内存地址:</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">hex</span><span class="token punctuation">(</span><span class="token builtin">id</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">\n&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 删除变量</span></span>
<span class="line"><span class="token keyword">del</span> a</span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;代码: del a&quot;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;说明: 引用计数(b): </span><span class="token interpolation"><span class="token punctuation">{</span>sys<span class="token punctuation">.</span>getrefcount<span class="token punctuation">(</span>b<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">}</span></span><span class="token string">, 内存地址:</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">hex</span><span class="token punctuation">(</span><span class="token builtin">id</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">\n&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">c <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;代码: c = </span><span class="token interpolation"><span class="token punctuation">{</span>c<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;     引用计数(b): </span><span class="token interpolation"><span class="token punctuation">{</span>sys<span class="token punctuation">.</span>getrefcount<span class="token punctuation">(</span>b<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">}</span></span><span class="token string">, 内存地址:</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">hex</span><span class="token punctuation">(</span><span class="token builtin">id</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;     引用计数(c): </span><span class="token interpolation"><span class="token punctuation">{</span>sys<span class="token punctuation">.</span>getrefcount<span class="token punctuation">(</span>c<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">}</span></span><span class="token string">, 内存地址:</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">hex</span><span class="token punctuation">(</span><span class="token builtin">id</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">\n&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;-------------------------------------------------------------------&quot;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 初始化变量</span></span>
<span class="line">a <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;代码: a = </span><span class="token interpolation"><span class="token punctuation">{</span>a<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;说明: 引用计数(a):</span><span class="token interpolation"><span class="token punctuation">{</span>sys<span class="token punctuation">.</span>getrefcount<span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">}</span></span><span class="token string">, 内存地址:</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">hex</span><span class="token punctuation">(</span><span class="token builtin">id</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">\n&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># b = a</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;代码: b = a&quot;</span><span class="token punctuation">)</span></span>
<span class="line">b <span class="token operator">=</span> a</span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;说明: &quot;</span></span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;     引用计数(a): </span><span class="token interpolation"><span class="token punctuation">{</span>sys<span class="token punctuation">.</span>getrefcount<span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">}</span></span><span class="token string">, 内存地址:</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">hex</span><span class="token punctuation">(</span><span class="token builtin">id</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;     引用计数(b): </span><span class="token interpolation"><span class="token punctuation">{</span>sys<span class="token punctuation">.</span>getrefcount<span class="token punctuation">(</span>b<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">}</span></span><span class="token string">, 内存地址:</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">hex</span><span class="token punctuation">(</span><span class="token builtin">id</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">\n&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 删除变量</span></span>
<span class="line"><span class="token keyword">del</span> a</span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;代码: del a&quot;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;说明: 引用计数(b): </span><span class="token interpolation"><span class="token punctuation">{</span>sys<span class="token punctuation">.</span>getrefcount<span class="token punctuation">(</span>b<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">}</span></span><span class="token string">, 内存地址:</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">hex</span><span class="token punctuation">(</span><span class="token builtin">id</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">\n&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">c <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;代码: c = </span><span class="token interpolation"><span class="token punctuation">{</span>c<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;     引用计数(b): </span><span class="token interpolation"><span class="token punctuation">{</span>sys<span class="token punctuation">.</span>getrefcount<span class="token punctuation">(</span>b<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">}</span></span><span class="token string">, 内存地址:</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">hex</span><span class="token punctuation">(</span><span class="token builtin">id</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;     引用计数(c): </span><span class="token interpolation"><span class="token punctuation">{</span>sys<span class="token punctuation">.</span>getrefcount<span class="token punctuation">(</span>c<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">}</span></span><span class="token string">, 内存地址:</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">hex</span><span class="token punctuation">(</span><span class="token builtin">id</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">\n&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;-&quot;</span> <span class="token operator">*</span> <span class="token number">100</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre></div><p>输出结果</p><div class="language-bash" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line">代码: a <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span>, <span class="token number">2</span>, <span class="token number">3</span><span class="token punctuation">]</span></span>
<span class="line">说明: 引用计数<span class="token punctuation">(</span>a<span class="token punctuation">)</span>:1, 内存地址:0x1e465c15208</span>
<span class="line"></span>
<span class="line">代码: b <span class="token operator">=</span> a</span>
<span class="line">说明: </span>
<span class="line">     引用计数<span class="token punctuation">(</span>a<span class="token punctuation">)</span>: <span class="token number">2</span>, 内存地址:0x1e465c15208</span>
<span class="line">     引用计数<span class="token punctuation">(</span>b<span class="token punctuation">)</span>: <span class="token number">2</span>, 内存地址:0x1e465c15208</span>
<span class="line"></span>
<span class="line">代码: del a</span>
<span class="line">说明: 引用计数<span class="token punctuation">(</span>b<span class="token punctuation">)</span>: <span class="token number">1</span>, 内存地址:0x1e465c15208</span>
<span class="line"></span>
<span class="line">代码: c <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span>, <span class="token number">2</span>, <span class="token number">3</span><span class="token punctuation">]</span></span>
<span class="line">     引用计数<span class="token punctuation">(</span>b<span class="token punctuation">)</span>: <span class="token number">1</span>, 内存地址:0x1e465c15208			<span class="token operator">=</span><span class="token operator">&gt;</span> </span>
<span class="line">     引用计数<span class="token punctuation">(</span>c<span class="token punctuation">)</span>: <span class="token number">1</span>, 内存地址:0x1e465c15408			<span class="token operator">=</span><span class="token operator">&gt;</span> 备注: 引用计数为1，且内存地址不一样</span>
<span class="line"></span>
<span class="line">-------------------------------------------------------------------</span>
<span class="line">代码: a <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span>, <span class="token number">2</span>, <span class="token number">3</span><span class="token punctuation">)</span></span>
<span class="line">说明: 引用计数<span class="token punctuation">(</span>a<span class="token punctuation">)</span>:3, 内存地址:0x1e46616cf48</span>
<span class="line"></span>
<span class="line">代码: b <span class="token operator">=</span> a</span>
<span class="line">说明: </span>
<span class="line">     引用计数<span class="token punctuation">(</span>a<span class="token punctuation">)</span>: <span class="token number">4</span>, 内存地址:0x1e46616cf48</span>
<span class="line">     引用计数<span class="token punctuation">(</span>b<span class="token punctuation">)</span>: <span class="token number">4</span>, 内存地址:0x1e46616cf48</span>
<span class="line"></span>
<span class="line">代码: del a</span>
<span class="line">说明: 引用计数<span class="token punctuation">(</span>b<span class="token punctuation">)</span>: <span class="token number">3</span>, 内存地址:0x1e46616cf48</span>
<span class="line"></span>
<span class="line">代码: c <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span>, <span class="token number">2</span>, <span class="token number">3</span><span class="token punctuation">)</span></span>
<span class="line">     引用计数<span class="token punctuation">(</span>b<span class="token punctuation">)</span>: <span class="token number">4</span>, 内存地址:0x1e46616cf48			<span class="token operator">=</span><span class="token operator">&gt;</span></span>
<span class="line">     引用计数<span class="token punctuation">(</span>c<span class="token punctuation">)</span>: <span class="token number">4</span>, 内存地址:0x1e46616cf48			<span class="token operator">=</span><span class="token operator">&gt;</span> 备注: 引用计数为不为1，且内存地址一样</span>
<span class="line"></span></code></pre></div></details><details class="hint-container details"><summary>（2）关于数字缓存的细节</summary><p>💡 不同Python版本对于一些细节处理并不一致，了解即可</p><div class="language-python" data-highlighter="prismjs" data-ext="py"><pre><code class="language-python"><span class="line"><span class="token comment">#!/usr/bin/env python</span></span>
<span class="line"><span class="token comment"># -*- coding:utf-8 -*-</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> sys</span>
<span class="line"></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;Python version: {}&quot;</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token string">&#39;.&#39;</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token keyword">for</span> x <span class="token keyword">in</span> sys<span class="token punctuation">.</span>version_info<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 这里使用3.7.9测试</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&#39;----------------------------------------------------------------------------------------------------&#39;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 测试1: -5 ~ 256范文内的数字会提前加载到内存中,进行缓存</span></span>
<span class="line">a<span class="token punctuation">,</span> b <span class="token operator">=</span> <span class="token number">1000</span><span class="token punctuation">,</span> <span class="token number">1000</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span>a <span class="token keyword">is</span> b<span class="token punctuation">)</span>  <span class="token comment"># b创建之前a尚未创建,所以a和b分配到了两块不同的内存地址,所以输出False</span></span>
<span class="line"></span>
<span class="line">a<span class="token punctuation">,</span> b <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span>a <span class="token keyword">is</span> b<span class="token punctuation">)</span>  <span class="token comment"># b创建之前a尚未创建, 但是-5~256范围内的数字已经提前加载到了内存中, a和b拿到了相同的内存地址,所以输出True</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&#39;----------------------------------------------------------------------------------------------------&#39;</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre></div><p>关于Python更多&quot;神奇&quot;的操作，可以参考 <a href="https://github.com/robertparley/wtfpython-cn" target="_blank" rel="noopener noreferrer">https://github.com/robertparley/wtfpython-cn</a></p></details><details class="hint-container details"><summary>（3）对象嵌套问题</summary><div class="language-python" data-highlighter="prismjs" data-ext="py"><pre><code class="language-python"><span class="line"><span class="token comment">#!/usr/bin/env python</span></span>
<span class="line"><span class="token comment"># -*- coding:utf-8 -*-</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># a是一个元组, 不可变对象</span></span>
<span class="line">a <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">hex</span><span class="token punctuation">(</span><span class="token builtin">id</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 0x2d731accf48</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 但是并不意味着 a的值永远就不能变</span></span>
<span class="line">a<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">hex</span><span class="token punctuation">(</span><span class="token builtin">id</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 0x2d731accf48</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>  <span class="token comment"># (1, 2, [3, 4])</span></span>
<span class="line"></span></code></pre></div></details><details class="hint-container details"><summary>（4）是否可哈希</summary><ul><li>可哈希 == 不可变对象</li><li>不可哈希 == 可变对象</li></ul><div class="language-python" data-highlighter="prismjs" data-ext="py"><pre><code class="language-python"><span class="line"><span class="token comment">#!/usr/bin/env python</span></span>
<span class="line"><span class="token comment"># -*- coding:utf-8 -*-</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 测试</span></span>
<span class="line">d <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span>
<span class="line">d<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;Python&quot;</span></span>
<span class="line">d<span class="token punctuation">[</span><span class="token number">5.0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;Go&quot;</span></span>
<span class="line">d<span class="token punctuation">[</span><span class="token number">5.1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;Java&quot;</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 输出结果: {5: &#39;Go&#39;, 5.1: &#39;Java&#39;}</span></span>
<span class="line"><span class="token comment"># 发现问题: 5.0的key怎么没了?</span></span>
<span class="line"><span class="token comment"># 分析原因:</span></span>
<span class="line"><span class="token comment">#   (1) 字典的key不允许重复,重复的话会覆盖前面的value</span></span>
<span class="line"><span class="token comment">#   (2) 字典如何判断key是否重复呢? 使用hash(key)检查哈希值是否重复来判断(扩展: 可变对象==不可哈希，所以不能用来做字典的key)</span></span>
<span class="line"><span class="token comment"># 确认原因(看如下代码)</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">hash</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token builtin">hash</span><span class="token punctuation">(</span><span class="token number">5.0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># True</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">hash</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token builtin">hash</span><span class="token punctuation">(</span><span class="token number">5.1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># False</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># set和 frozenset也是使用哈希值存的,我们来测试以下</span></span>
<span class="line">s <span class="token operator">=</span> <span class="token builtin">set</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">s<span class="token punctuation">.</span>add<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span></span>
<span class="line">s<span class="token punctuation">.</span>add<span class="token punctuation">(</span><span class="token number">5.0</span><span class="token punctuation">)</span></span>
<span class="line">s<span class="token punctuation">.</span>add<span class="token punctuation">(</span><span class="token number">5.1</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span>  <span class="token comment"># {5.1, 5}</span></span>
<span class="line"></span></code></pre></div></details><details class="hint-container details"><summary>（5）深浅拷贝</summary><p><strong>浅拷贝</strong></p><p>说明：拷贝后仅仅是最顶层开辟了新的空间，里层的元素内存地址还是一样的</p><p>方法：各类对象(list<code>/dict</code>)等的copy方法、对象[::]、copy.copy方法</p><p><strong>深拷贝</strong></p><p>说明：除了顶层拷贝还对子元素也进行了拷贝（本质上递归浅拷贝），两个元素真正意义上的互不影响</p><p>方法：copy.deepcopy()</p></details><br><h3 id="基本数据类型对比" tabindex="-1"><a class="header-anchor" href="#基本数据类型对比"><span><strong>基本数据类型对比</strong></span></a></h3><table><thead><tr><th>数据类型</th><th>(容器内的)元素是否有顺序</th><th>是否是可变对象</th><th>值或KEY是否允许重复</th></tr></thead><tbody><tr><td>数字</td><td>✔</td><td>❌</td><td>✔</td></tr><tr><td>布尔值</td><td>✔</td><td>❌</td><td>✔</td></tr><tr><td>列表</td><td>✔</td><td>✔</td><td>✔</td></tr><tr><td>元祖</td><td>✔</td><td>❌</td><td>✔</td></tr><tr><td>字符串</td><td>✔</td><td>❌</td><td>✔</td></tr><tr><td>字节序列(bytes)</td><td>✔</td><td>❌</td><td>✔</td></tr><tr><td>字节数组(bytesarray)</td><td>✔</td><td>✔</td><td>✔</td></tr><tr><td>字典</td><td>✔</td><td>✔</td><td>❌</td></tr><tr><td>集合</td><td>❌</td><td>✔</td><td>❌</td></tr><tr><td>不可变集合</td><td>❌</td><td>❌</td><td>❌</td></tr></tbody></table><br><h2 id="三、函数" tabindex="-1"><a class="header-anchor" href="#三、函数"><span>三、函数</span></a></h2><h3 id="函数说明" tabindex="-1"><a class="header-anchor" href="#函数说明"><span>函数说明</span></a></h3><p>使用<code>def</code>定义函数，<code>return</code>指定返回值，若没有指定返回值，会隐式返回<code>return None</code>，举例说明</p><div class="language-python" data-highlighter="prismjs" data-ext="py"><pre><code class="language-python"><span class="line"><span class="token comment">#!/usr/bin/env python</span></span>
<span class="line"><span class="token comment"># --*-- coding:utf-8 --*--</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">def</span> <span class="token function">add</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">return</span> x <span class="token operator">+</span> y</span>
<span class="line"></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span>add<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 3</span></span>
<span class="line"></span></code></pre></div><br><h3 id="函数参数详解" tabindex="-1"><a class="header-anchor" href="#函数参数详解"><span>函数参数详解</span></a></h3><details class="hint-container details"><summary>（1）常见形式和坑</summary><div class="language-python" data-highlighter="prismjs" data-ext="py"><pre><code class="language-python"><span class="line"><span class="token comment">#!/usr/bin/env python</span></span>
<span class="line"><span class="token comment"># --*-- coding:utf-8 --*--</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 定义一个无参函数</span></span>
<span class="line"><span class="token keyword">def</span> <span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token string">&quot;hello world!&quot;</span></span>
<span class="line"><span class="token comment"># ----------------------------------------------</span></span>
<span class="line"><span class="token comment"># 按位置传参和按关键字传参</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 定义一个普通函数</span></span>
<span class="line"><span class="token keyword">def</span> <span class="token function">add</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">return</span> x <span class="token operator">+</span> y</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 按位置传参,1对应形参x，2对应形参y；位置必须一一对应</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span>add<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 按关键字传参,形参传递位置可以任意调换</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span>add<span class="token punctuation">(</span>y<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span> x<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># ----------------------------------------------</span></span>
<span class="line"><span class="token comment"># 默认参数，调用时如果该参数没有传则使用默认值,有默认值得参数一定是放到参数最后面的，否则会报错</span></span>
<span class="line"><span class="token keyword">def</span> <span class="token function">add</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">return</span> x <span class="token operator">+</span> y</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 注意：注意默认参数值不要用 引用类型，比如下面这种可能与你的预期并不一致:</span></span>
<span class="line"><span class="token keyword">def</span> <span class="token function">add</span><span class="token punctuation">(</span>x<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">	x<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token keyword">return</span> x</span>
<span class="line">        </span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span>add<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token comment"># [100]</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span>add<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token comment"># [100, 100]</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 这里涉及到两个知识点</span></span>
<span class="line"><span class="token comment"># (1) 函数的默认参数存储在 .__defaults__属性中，它是一个元祖</span></span>
<span class="line"><span class="token comment">#	  为什么是元祖呢？因为他相对列表和字典会更节省内存。</span></span>
<span class="line"><span class="token comment"># 	  为什么会更节省内存呢？</span></span>
<span class="line"><span class="token comment">#     因为元祖是不可变对象，列表和字典是可变对象，Python创建列表的时候会多分配一些内存，用于以后快速扩充，而元祖在定义时就确定内存大小了</span></span>
<span class="line"><span class="token comment">#</span></span>
<span class="line"><span class="token comment"># (2) 可变对象和不可变对象的区别</span></span>
<span class="line"><span class="token comment">#	  对一个不可变对象变量有修改操作时，会重新开辟内存空间，复制变量值然后再操作</span></span>
<span class="line"><span class="token comment">#	  对一个可变对象变量有修改操作时，直接在对象所在内存操作</span></span>
<span class="line"><span class="token comment">#</span></span>
<span class="line"><span class="token comment"># 所以说，函数默认参数为不可变对象时，函数内部对默认参数操作不会影响到.__defaults__中的值，但是如果是可变对象恰恰相反，</span></span>
<span class="line"><span class="token comment"># 所以就有上面的结果了</span></span>
<span class="line"><span class="token comment">#</span></span>
<span class="line"><span class="token comment"># 常规的解决办法：</span></span>
<span class="line"><span class="token keyword">def</span> <span class="token function">add1</span><span class="token punctuation">(</span>x<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">if</span> x <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span></span>
<span class="line">        x <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">100</span><span class="token punctuation">]</span></span>
<span class="line">    <span class="token keyword">return</span> x</span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span>add1<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># [100]</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span>add1<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># [100]</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 另一种思路解决办法(这种方式有bug，杜绝使用，仅学习测试)</span></span>
<span class="line"><span class="token keyword">def</span> <span class="token function">add2</span><span class="token punctuation">(</span>x<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token comment"># 重新拷贝一份，不然会导致外边的变量发生变化</span></span>
<span class="line">    <span class="token comment"># 因为传递的是可变对象，修改的是同一份内存</span></span>
<span class="line">    x <span class="token operator">=</span> x<span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    x<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span></span>
<span class="line">    add2<span class="token punctuation">.</span>__defaults__ <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">)</span>  <span class="token comment"># 重新初始化默认参数</span></span>
<span class="line">    <span class="token keyword">return</span> x</span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span>add2<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># [100]</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span>add2<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># [100]</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 当然了，也不一定非要去解决，这种形式会让函数变得有状态，必要的时候也可以利用一下，</span></span>
<span class="line"><span class="token comment"># 但是能不用尽量不用这种形式，很容易出错</span></span>
<span class="line"><span class="token comment"># 让函数变得有状态也不是只有这一种形式，还可以利用闭包，后面会讲到</span></span>
<span class="line"></span></code></pre></div></details><details class="hint-container details"><summary>（2）可变参数和不可变参数</summary><p><code>*args</code>和<code>**kwargs</code>表示可变参数，在函数内部args是一个元祖，kwargs是一个字典</p><p>这两个参数不传递的话就使用默认值，即空元祖和空字典</p><div class="language-python" data-highlighter="prismjs" data-ext="py"><pre><code class="language-python"><span class="line"><span class="token comment">#!/usr/bin/env python</span></span>
<span class="line"><span class="token comment"># --*-- coding:utf-8 --*--</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">def</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">print</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">print</span><span class="token punctuation">(</span>kwargs<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">add<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span>  <span class="token comment"># args = (1,2,3,4)</span></span>
<span class="line">add<span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 如果是直接传递一个元祖/列表等，需要使用*解构，就等同于上面传递的形式</span></span>
<span class="line"></span>
<span class="line">add<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">&quot;VVFock3r&quot;</span><span class="token punctuation">,</span> language<span class="token operator">=</span><span class="token string">&quot;Python&quot;</span><span class="token punctuation">)</span>  <span class="token comment"># {&#39;name&#39;: &#39;VVFock3r&#39;, &#39;language&#39;: &#39;Python&#39;}</span></span>
<span class="line">add<span class="token punctuation">(</span><span class="token operator">**</span><span class="token punctuation">{</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;VVFock3r&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;language&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;Python&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>  <span class="token comment"># 同理，如果直接传递一个字段，使用**解构</span></span>
<span class="line"></span></code></pre></div></details><details class="hint-container details"><summary>（3）仅限位置形参(positional-only)和仅限关键字形参(keyword-only)</summary><p>仅限位置形参就是说只能使用<code>add(1,2)</code>这种形式来传递参数，</p><p>仅限关键字形参就是只能使用<code>add(x=1, y=2)</code>来调用参数（顺序可任意调整）</p><div class="language-python" data-highlighter="prismjs" data-ext="py"><pre><code class="language-python"><span class="line"><span class="token comment">#!/usr/bin/env python</span></span>
<span class="line"><span class="token comment"># --*-- coding:utf-8 --*--</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 在 / 前面的都是仅限位置形参，positional-only</span></span>
<span class="line"><span class="token keyword">def</span> <span class="token function">add1</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> <span class="token operator">/</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">return</span> x <span class="token operator">+</span> y</span>
<span class="line"></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span>add1<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 符合语法要求，输出3</span></span>
<span class="line"><span class="token comment"># print(add1(x=1, 2))  # 不符合语法要求，报错 SyntaxError: positional argument follows keyword argument</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 在 * 后面的都是仅限关键字形参，keyword-only</span></span>
<span class="line"><span class="token keyword">def</span> <span class="token function">add2</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">return</span> x <span class="token operator">+</span> y</span>
<span class="line"></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span>add2<span class="token punctuation">(</span>x<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> y<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 符合语法要求，输出3</span></span>
<span class="line"><span class="token comment"># print(add2(1, 2))  # 不符合语法要求，报错TypeError: add2() takes 0 positional arguments but 2 were given</span></span>
<span class="line"></span></code></pre></div></details><details class="hint-container details"><summary>（4）看一个比较&quot;复杂&quot;的函数定义</summary><div class="language-python" data-highlighter="prismjs" data-ext="py"><pre><code class="language-python"><span class="line"><span class="token comment">#!/usr/bin/env python</span></span>
<span class="line"><span class="token comment"># --*-- coding:utf-8 --*--</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 你能一眼看明白如何调用吗？</span></span>
<span class="line"><span class="token keyword">def</span> <span class="token function">login</span><span class="token punctuation">(</span>host<span class="token punctuation">,</span> user<span class="token punctuation">,</span> password<span class="token punctuation">,</span> <span class="token operator">/</span><span class="token punctuation">,</span> <span class="token operator">*</span><span class="token punctuation">,</span> ssl<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;host=&quot;</span><span class="token punctuation">,</span> host<span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;user=&quot;</span><span class="token punctuation">,</span> user<span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;password=&quot;</span><span class="token punctuation">,</span> password<span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;ssl=&quot;</span><span class="token punctuation">,</span> ssl<span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;kwargs=&quot;</span><span class="token punctuation">,</span> kwargs<span class="token punctuation">)</span></span>
<span class="line">  </span>
<span class="line"></span>
<span class="line">login<span class="token punctuation">(</span><span class="token string">&quot;127.0.0.1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;root&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;123456&quot;</span><span class="token punctuation">,</span> ssl<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> port<span class="token operator">=</span><span class="token number">12345</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre></div></details><br><h3 id="函数作用域和legb" tabindex="-1"><a class="header-anchor" href="#函数作用域和legb"><span>函数作用域和<code>LEGB</code></span></a></h3><ul><li><p>函数内部定义的变量为 局部变量，在函数外部不能直接使用</p></li><li><p>函数内部可以使用 全局变量，但是具有只读属性，如果需要修改 需要先使用<code>global 变量名</code>，否则会报错</p><p><code>UnboundLocalError: local variable &#39;x&#39; referenced before assignment</code></p></li><li><p>如果函数<code>fn1</code>内定义一个函数<code>fn2</code>，那么</p><ul><li><code>fn2</code>对全局变量和<code>fn1</code>中的变量具有只读属性</li><li><code>f2</code>要修改全局变量使用<code>global 变量名</code></li><li><code>f2</code>要修改<code>f1</code>变量要使用<code>nonlocal 变量名</code></li><li>如果<code>f2</code>中继续嵌套函数，那么规则与上述类似</li></ul></li></ul><details class="hint-container details"><summary>（1）函数作用域代码说明</summary><div class="language-python" data-highlighter="prismjs" data-ext="py"><pre><code class="language-python"><span class="line"><span class="token comment">#!/usr/bin/env python</span></span>
<span class="line"><span class="token comment"># --*-- coding:utf-8 --*--</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 定义全局变量</span></span>
<span class="line">x <span class="token operator">=</span> <span class="token number">100</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 定义外层函数</span></span>
<span class="line"><span class="token keyword">def</span> <span class="token function">outer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token comment"># 直接定义的话没问题，这和全局变量x没关系</span></span>
<span class="line">    <span class="token comment"># x = 1</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment"># 如果上面代码注释，函数内部没有定义x，直接修改全局变量x会报错，需要先global x</span></span>
<span class="line">    <span class="token comment"># global x</span></span>
<span class="line">    <span class="token comment"># x = x + 100</span></span>
<span class="line">    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;outer: x=&quot;</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">    a <span class="token operator">=</span> <span class="token number">1</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment"># 定义内层函数</span></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">inner</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token comment"># 修改全局变量</span></span>
<span class="line">        <span class="token comment"># global x</span></span>
<span class="line">        <span class="token comment"># x = x + 200</span></span>
<span class="line"></span>
<span class="line">        <span class="token comment"># 读取全局变量</span></span>
<span class="line">        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;inner: x=&quot;</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">        <span class="token comment"># --------------------</span></span>
<span class="line"></span>
<span class="line">        <span class="token comment"># 修改上层函数的变量</span></span>
<span class="line">        <span class="token comment"># nonlocal a</span></span>
<span class="line">        <span class="token comment"># a = a + 1</span></span>
<span class="line"></span>
<span class="line">        <span class="token comment"># 读取上层函数的变量</span></span>
<span class="line">        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;inner: a=&quot;</span><span class="token punctuation">,</span> a<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">    inner<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line">outer<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre></div><p>如果上面函数都看懂了的话，还有一个问题需要特别注意，为了方便起见写了一个最简单的形式，请看如下代码</p><div class="language-python" data-highlighter="prismjs" data-ext="py"><pre><code class="language-python"><span class="line"><span class="token comment">#!/usr/bin/env python</span></span>
<span class="line"><span class="token comment"># --*-- coding:utf-8 --*--</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 定义全局变量</span></span>
<span class="line">x <span class="token operator">=</span> <span class="token number">100</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">def</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">print</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span></span>
<span class="line">    x <span class="token operator">=</span> <span class="token number">100</span></span>
<span class="line"></span>
<span class="line">test<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre></div><p>上面代码会报错<code>UnboundLocalError: local variable &#39;x&#39; referenced before assignment</code>，这是什么鬼呢？</p><p>因为函数在定义之后，未调用之前，Python解释器就知道了<code>print(x)</code>中x用的是函数内部的x，因为第二行定义了<code>x=100</code>，</p><p>但是由于是先使用后定义，那就肯定会报错了，所以我们需要注意，如果函数内部要定义变量的话，一定要先定义再使用，当然了，函数外部也是先定义再使用</p></details><details class="hint-container details"><summary>（2）思考题</summary><div class="language-python" data-highlighter="prismjs" data-ext="py"><pre><code class="language-python"><span class="line"><span class="token comment">#!/usr/bin/env python</span></span>
<span class="line"><span class="token comment"># --*-- coding:utf-8 --*--</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">def</span> <span class="token function">outer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    c <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">100</span><span class="token punctuation">]</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">inner</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        c<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token number">100</span>  <span class="token comment"># 可以</span></span>
<span class="line">        <span class="token comment">#c.extend([1,2,3])  # 可以</span></span>
<span class="line">        <span class="token comment"># c = c + [1,2,3]    # 不可以</span></span>
<span class="line">        <span class="token keyword">print</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">    inner<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">outer<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre></div><p>使用嵌套函数同样可以保存函数的状态，至此已经有两种方式可以保存函数状态，请看如下代码</p><div class="language-python" data-highlighter="prismjs" data-ext="py"><pre><code class="language-python"><span class="line"><span class="token comment">#!/usr/bin/env python</span></span>
<span class="line"><span class="token comment"># --*-- coding:utf-8 --*--</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 方式一</span></span>
<span class="line"><span class="token keyword">def</span> <span class="token function">fn</span><span class="token punctuation">(</span>x<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    x<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token boolean">None</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token operator">&gt;=</span> <span class="token number">2</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&#39;函数已经调用过了&#39;</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">else</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&#39;函数第一次调用&#39;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">fn<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 函数第一次调用</span></span>
<span class="line">fn<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 函数已经调用过了</span></span>
<span class="line">fn<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 函数已经调用过了</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 方式二(推荐)</span></span>
<span class="line"><span class="token keyword">def</span> <span class="token function">fn1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    lock <span class="token operator">=</span> <span class="token boolean">False</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">fn2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token keyword">nonlocal</span> lock</span>
<span class="line">        <span class="token keyword">if</span> lock <span class="token keyword">is</span> <span class="token boolean">True</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&#39;函数已经调用过了&#39;</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">else</span><span class="token punctuation">:</span></span>
<span class="line">            lock <span class="token operator">=</span> <span class="token boolean">True</span></span>
<span class="line">            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&#39;函数第一次调用&#39;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">return</span> fn2</span>
<span class="line"></span>
<span class="line"></span>
<span class="line">fn2 <span class="token operator">=</span> fn1<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">fn2<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 函数第一次调用</span></span>
<span class="line">fn2<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 函数已经调用过了</span></span>
<span class="line">fn2<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 函数已经调用过了</span></span>
<span class="line">fn2<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 函数已经调用过了</span></span>
<span class="line"></span></code></pre></div></details><details class="hint-container details"><summary>（3）变量搜索顺序<code>LEGB</code></summary><ul><li><code>Local</code> 本地作用域</li><li><code>Enclosing</code> 嵌套函数的外部函数的命名空间</li><li><code>Global</code> 全局作用域</li><li><code>Build-in</code> 内置模块命名空间</li></ul><div class="language-python" data-highlighter="prismjs" data-ext="py"><pre><code class="language-python"><span class="line"><span class="token comment">#!/usr/bin/env python</span></span>
<span class="line"><span class="token comment"># --*-- coding:utf-8 --*--</span></span>
<span class="line"><span class="token keyword">import</span> builtins</span>
<span class="line"></span>
<span class="line">c <span class="token operator">=</span> <span class="token number">3</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">def</span> <span class="token function">fn1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    b <span class="token operator">=</span> <span class="token number">2</span></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">fn2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        a <span class="token operator">=</span> <span class="token number">1</span></span>
<span class="line">        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;本地作用域    a=&quot;</span><span class="token punctuation">,</span> a<span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;上层函数作用域 b=&quot;</span><span class="token punctuation">,</span> b<span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;全局作用域    c=&quot;</span><span class="token punctuation">,</span> c<span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;内置模块命名空间 builtins.dir == dir --&gt; &quot;</span><span class="token punctuation">,</span> builtins<span class="token punctuation">.</span><span class="token builtin">dir</span> <span class="token operator">==</span> <span class="token builtin">dir</span><span class="token punctuation">)</span></span>
<span class="line">    fn2<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">fn1<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token triple-quoted-string string">&#39;&#39;&#39;</span>
<span class="line">输出结果</span>
<span class="line"></span>
<span class="line">本地作用域    a= 1</span>
<span class="line">上层函数作用域 b= 2</span>
<span class="line">全局作用域    c= 3</span>
<span class="line">内置模块命名空间 builtins.dir == dir --&gt;  True</span>
<span class="line">&#39;&#39;&#39;</span></span>
<span class="line"></span></code></pre></div></details><br><h3 id="类型注解" tabindex="-1"><a class="header-anchor" href="#类型注解"><span>类型注解</span></a></h3><p>类型注解，用来说明参数是何种类型的对象，这只是说明，目的是方便开发人员，并不是强制一定要传入指定类型的对象</p><p>函数注解信息保存在<code>__annotations__</code>字典中</p><div class="language-python" data-highlighter="prismjs" data-ext="py"><pre><code class="language-python"><span class="line"><span class="token keyword">def</span> <span class="token function">add</span><span class="token punctuation">(</span>x<span class="token punctuation">:</span><span class="token builtin">int</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span><span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">int</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">return</span> x <span class="token operator">+</span> y</span>
<span class="line"></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span>add<span class="token punctuation">.</span>__annotations__<span class="token punctuation">)</span>  <span class="token comment">#{&#39;x&#39;: &lt;class &#39;int&#39;&gt;, &#39;y&#39;: &lt;class &#39;int&#39;&gt;, &#39;return&#39;: &lt;class &#39;int&#39;&gt;}</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span>add<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>     <span class="token comment"># 根据注解传入对应类型的参数，3</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span>add<span class="token punctuation">(</span><span class="token string">&#39;1&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;2&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># 传入不同类型参数也是可以的，非强制，12</span></span>
<span class="line"></span></code></pre></div><br><h3 id="函数签名" tabindex="-1"><a class="header-anchor" href="#函数签名"><span>函数签名</span></a></h3><p>函数签名，说白了就是描述函数参数的东西，除了写框架、调试器等，基本上用不到</p><details class="hint-container details"><summary>点击查看详情</summary><div class="language-python" data-highlighter="prismjs" data-ext="py"><pre><code class="language-python"><span class="line"><span class="token comment">#!/usr/bin/env python</span></span>
<span class="line"><span class="token comment"># --*-- coding:utf-8 --*--</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">from</span> inspect <span class="token keyword">import</span> signature</span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token keyword">def</span> <span class="token function">login</span><span class="token punctuation">(</span>host<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">,</span> user<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">,</span> pwd<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">,</span> <span class="token operator">*</span><span class="token punctuation">,</span> port<span class="token operator">=</span><span class="token number">3306</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">str</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token triple-quoted-string string">&quot;&quot;&quot;测试函数&quot;&quot;&quot;</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token string">&quot;ok&quot;</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line">sig <span class="token operator">=</span> signature<span class="token punctuation">(</span>login<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">for</span> index<span class="token punctuation">,</span> item <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>sig<span class="token punctuation">.</span>parameters<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    name<span class="token punctuation">,</span> param <span class="token operator">=</span> item</span>
<span class="line">    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;参数名称: {}&quot;</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>param<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;默认参数: {}&quot;</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token boolean">None</span> <span class="token keyword">if</span> param<span class="token punctuation">.</span>default <span class="token keyword">is</span> param<span class="token punctuation">.</span>empty <span class="token keyword">else</span> <span class="token builtin">str</span><span class="token punctuation">(</span>param<span class="token punctuation">.</span>default<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;参数类型: {}&quot;</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>param<span class="token punctuation">.</span>kind<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;参数注解: {}&quot;</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token boolean">None</span> <span class="token keyword">if</span> param<span class="token punctuation">.</span>annotation <span class="token keyword">is</span> param<span class="token punctuation">.</span>empty <span class="token keyword">else</span> <span class="token builtin">str</span><span class="token punctuation">(</span>param<span class="token punctuation">.</span>annotation<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    </span>
<span class="line"><span class="token triple-quoted-string string">&#39;&#39;&#39;</span>
<span class="line">参数名称: host</span>
<span class="line">默认参数: None</span>
<span class="line">参数类型: POSITIONAL_OR_KEYWORD</span>
<span class="line">参数注解: &lt;class &#39;str&#39;&gt;</span>
<span class="line"></span>
<span class="line">参数名称: user</span>
<span class="line">默认参数: None</span>
<span class="line">参数类型: POSITIONAL_OR_KEYWORD</span>
<span class="line">参数注解: &lt;class &#39;str&#39;&gt;</span>
<span class="line"></span>
<span class="line">参数名称: pwd</span>
<span class="line">默认参数: None</span>
<span class="line">参数类型: POSITIONAL_OR_KEYWORD</span>
<span class="line">参数注解: &lt;class &#39;str&#39;&gt;</span>
<span class="line"></span>
<span class="line">参数名称: port</span>
<span class="line">默认参数: 3306</span>
<span class="line">参数类型: KEYWORD_ONLY</span>
<span class="line">参数注解: None</span>
<span class="line">&#39;&#39;&#39;</span>    </span>
<span class="line"></span></code></pre></div></details><br><h3 id="匿名函数" tabindex="-1"><a class="header-anchor" href="#匿名函数"><span>匿名函数</span></a></h3><p>匿名函数，顾名思义，就是没有名字的函数，使用<code>lambda</code>定义</p><p>匿名函数通常和<code>filter</code>、<code>map</code>、<code>sorted</code>等高阶函数配合使用</p><p>匿名函数举例</p><div class="language-python" data-highlighter="prismjs" data-ext="py"><pre><code class="language-python"><span class="line"><span class="token comment">#!/usr/bin/env python</span></span>
<span class="line"><span class="token comment"># --*-- coding:utf-8 --*--</span></span>
<span class="line"></span>
<span class="line">x <span class="token operator">=</span> <span class="token keyword">lambda</span> x<span class="token punctuation">:</span> x <span class="token operator">*</span> <span class="token number">2</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span>x<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># 20</span></span>
<span class="line"></span></code></pre></div><p>匿名函数注意事项</p><div class="language-python" data-highlighter="prismjs" data-ext="py"><pre><code class="language-python"><span class="line"><span class="token comment">#!/usr/bin/env python</span></span>
<span class="line"><span class="token comment"># --*-- coding:utf-8 --*--</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 注意可能会遇到的问题</span></span>
<span class="line">x <span class="token operator">=</span> <span class="token number">10</span></span>
<span class="line">a <span class="token operator">=</span> <span class="token keyword">lambda</span> y<span class="token punctuation">:</span> x <span class="token operator">+</span> y</span>
<span class="line">x <span class="token operator">=</span> <span class="token number">20</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 20，因为lambda中的x为自有变量，在运行时才会进行绑定</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 如果希望在定义的时候绑定，那么可以这样做</span></span>
<span class="line">z <span class="token operator">=</span> <span class="token number">10</span></span>
<span class="line">b <span class="token operator">=</span> <span class="token keyword">lambda</span> y<span class="token punctuation">,</span> z<span class="token operator">=</span>z<span class="token punctuation">:</span> z <span class="token operator">+</span> y</span>
<span class="line">z <span class="token operator">=</span> <span class="token number">20</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span>b<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 10</span></span>
<span class="line"></span></code></pre></div><br><h3 id="变量函数" tabindex="-1"><a class="header-anchor" href="#变量函数"><span>变量函数</span></a></h3><table><thead><tr><th>内置函数</th><th>说明</th></tr></thead><tbody><tr><td>globals()</td><td>返回全局变量组成的字典</td></tr><tr><td>locals()</td><td>返回当前作用域内变量组成的字典，如果当前在全局则返回全局变量组成的字典</td></tr><tr><td>vars(obj)</td><td>返回obj对象作用域内变量组成的字典，<br>（1）如果不传参数，vars和locals作用一样<br>（2）如果传1个参数，等同于<code>obj.__dict__</code></td></tr></tbody></table><details class="hint-container details"><summary>点击查看完整代码</summary><div class="language-python" data-highlighter="prismjs" data-ext="py"><pre><code class="language-python"><span class="line"><span class="token comment">#!/usr/bin/env python</span></span>
<span class="line"><span class="token comment"># -*- coding:utf-8 -*-</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> logging</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 初始化日志</span></span>
<span class="line">FORMAT <span class="token operator">=</span> <span class="token string">&#39;%(asctime)-15s\t [%(threadName)s, %(thread)d] %(message)s&#39;</span></span>
<span class="line">logging<span class="token punctuation">.</span>basicConfig<span class="token punctuation">(</span><span class="token builtin">format</span><span class="token operator">=</span>FORMAT<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 定义全局变量</span></span>
<span class="line">x <span class="token operator">=</span> <span class="token number">1</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 测试1 - 全局作用域</span></span>
<span class="line">logging<span class="token punctuation">.</span>warning<span class="token punctuation">(</span><span class="token string">&quot;测试1: 在全局使用3个函数, 效果是一样的&quot;</span><span class="token punctuation">)</span></span>
<span class="line">logging<span class="token punctuation">.</span>warning<span class="token punctuation">(</span><span class="token builtin">globals</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token builtin">locals</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token builtin">vars</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 测试2 - 局部作用域(函数)</span></span>
<span class="line"><span class="token keyword">def</span> <span class="token function">test2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    logging<span class="token punctuation">.</span>warning<span class="token punctuation">(</span><span class="token string">&quot;测试2: 在函数内部, locals()和vars()效果是一样的, 他俩和global()是不一样的&quot;</span><span class="token punctuation">)</span></span>
<span class="line">    y <span class="token operator">=</span> <span class="token number">2</span></span>
<span class="line">    logging<span class="token punctuation">.</span>warning<span class="token punctuation">(</span><span class="token builtin">locals</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token builtin">vars</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">    logging<span class="token punctuation">.</span>warning<span class="token punctuation">(</span><span class="token builtin">locals</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token builtin">globals</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 测试3 - 局部作用域(对象)</span></span>
<span class="line"><span class="token keyword">def</span> <span class="token function">test3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">class</span> <span class="token class-name">MyObj</span><span class="token punctuation">:</span> <span class="token keyword">pass</span></span>
<span class="line"></span>
<span class="line">    logging<span class="token punctuation">.</span>warning<span class="token punctuation">(</span><span class="token string">&quot;测试3: var(obj) == obj.__dict__&quot;</span><span class="token punctuation">)</span></span>
<span class="line">    logging<span class="token punctuation">.</span>warning<span class="token punctuation">(</span><span class="token builtin">vars</span><span class="token punctuation">(</span>MyObj<span class="token punctuation">)</span> <span class="token operator">==</span> MyObj<span class="token punctuation">.</span>__dict__<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line">test2<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">test3<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre></div><p>输出结果</p><div class="language-bash" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token number">2026</span>-01-02 <span class="token number">16</span>:10:53,375	 <span class="token punctuation">[</span>MainThread, <span class="token number">1864</span><span class="token punctuation">]</span> 测试1: 在全局使用3个函数, 效果是一样的</span>
<span class="line"><span class="token number">2026</span>-01-02 <span class="token number">16</span>:10:53,375	 <span class="token punctuation">[</span>MainThread, <span class="token number">1864</span><span class="token punctuation">]</span> True</span>
<span class="line"><span class="token number">2026</span>-01-02 <span class="token number">16</span>:10:53,375	 <span class="token punctuation">[</span>MainThread, <span class="token number">1864</span><span class="token punctuation">]</span> 测试2: 在函数内部, locals<span class="token punctuation">(</span><span class="token punctuation">)</span>和vars<span class="token punctuation">(</span><span class="token punctuation">)</span>效果是一样的, 他俩和global<span class="token punctuation">(</span><span class="token punctuation">)</span>是不一样的</span>
<span class="line"><span class="token number">2026</span>-01-02 <span class="token number">16</span>:10:53,375	 <span class="token punctuation">[</span>MainThread, <span class="token number">1864</span><span class="token punctuation">]</span> True</span>
<span class="line"><span class="token number">2026</span>-01-02 <span class="token number">16</span>:10:53,375	 <span class="token punctuation">[</span>MainThread, <span class="token number">1864</span><span class="token punctuation">]</span> False</span>
<span class="line"><span class="token number">2026</span>-01-02 <span class="token number">16</span>:10:53,375	 <span class="token punctuation">[</span>MainThread, <span class="token number">1864</span><span class="token punctuation">]</span> 测试3: var<span class="token punctuation">(</span>obj<span class="token punctuation">)</span> <span class="token operator">==</span> obj.__dict__</span>
<span class="line"><span class="token number">2026</span>-01-02 <span class="token number">16</span>:10:53,375	 <span class="token punctuation">[</span>MainThread, <span class="token number">1864</span><span class="token punctuation">]</span> True</span>
<span class="line"></span></code></pre></div></details><br><h3 id="内置函数" tabindex="-1"><a class="header-anchor" href="#内置函数"><span>内置函数</span></a></h3><p>参考 <a href="https://docs.python.org/zh-cn/3/library/functions.html" target="_blank" rel="noopener noreferrer">https:<code>//docs</code>.python.org<code>/zh-cn/3/library/functions</code>.html</a></p><br><h3 id="functools" tabindex="-1"><a class="header-anchor" href="#functools"><span><code>functools</code></span></a></h3><details class="hint-container details"><summary>（1）reduce：把一组数据按某种规则从左到右不断累积计算，最后压缩成一个值</summary><p><code>reduce</code> 会先用传入的二元函数对集合中的第 1、2 个元素进行计算，然后将得到的结果与第 3 个元素继续用该函数运算，如此反复，最终得到一个结果</p><div class="language-python" data-highlighter="prismjs" data-ext="py"><pre><code class="language-python"><span class="line"><span class="token comment">#!/usr/bin/env python</span></span>
<span class="line"><span class="token comment"># --*-- coding:utf-8 --*--</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">from</span> functools <span class="token keyword">import</span> <span class="token builtin">reduce</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">def</span> <span class="token function">add</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">return</span> x <span class="token operator">+</span> y</span>
<span class="line"></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">reduce</span><span class="token punctuation">(</span>add<span class="token punctuation">,</span> <span class="token punctuation">[</span>x <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">101</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># 5050</span></span>
<span class="line"></span></code></pre></div></details><details class="hint-container details"><summary>（2）partial 和 partialmethod：把函数的一部分参数提前“绑定好”，得到一个参数更少的新函数</summary><p><strong>partial 用于普通函数</strong></p><div class="language-python" data-highlighter="prismjs" data-ext="py"><pre><code class="language-python"><span class="line"><span class="token comment">#!/usr/bin/env python</span></span>
<span class="line"><span class="token comment"># --*-- coding:utf-8 --*--</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">from</span> functools <span class="token keyword">import</span> partial</span>
<span class="line"></span>
<span class="line"><span class="token keyword">def</span> <span class="token function">add</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">return</span> x <span class="token operator">+</span> y</span>
<span class="line"></span>
<span class="line"></span>
<span class="line">new1 <span class="token operator">=</span> partial<span class="token punctuation">(</span>add<span class="token punctuation">,</span> y<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>  <span class="token comment"># 返回一个新函数</span></span>
<span class="line">new2 <span class="token operator">=</span> partial<span class="token punctuation">(</span>add<span class="token punctuation">,</span> x<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>  <span class="token comment"># 返回一个新函数</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span>new1<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token comment"># 3</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span>new2<span class="token punctuation">(</span>y<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 4</span></span>
<span class="line"></span></code></pre></div><p><strong>partialmethod 用于类中的方法</strong></p><div class="language-python" data-highlighter="prismjs" data-ext="py"><pre><code class="language-python"><span class="line"><span class="token keyword">from</span> functools <span class="token keyword">import</span> partialmethod</span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">Logger</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">log</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> level<span class="token punctuation">,</span> message<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;[</span><span class="token interpolation"><span class="token punctuation">{</span>level<span class="token punctuation">:</span><span class="token format-spec">&lt;5</span><span class="token punctuation">}</span></span><span class="token string">] </span><span class="token interpolation"><span class="token punctuation">{</span>message<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">    info <span class="token operator">=</span> partialmethod<span class="token punctuation">(</span>log<span class="token punctuation">,</span> <span class="token string">&quot;INFO&quot;</span><span class="token punctuation">)</span></span>
<span class="line">    error <span class="token operator">=</span> partialmethod<span class="token punctuation">(</span>log<span class="token punctuation">,</span> <span class="token string">&quot;ERROR&quot;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">&quot;__main__&quot;</span><span class="token punctuation">:</span></span>
<span class="line">    logger <span class="token operator">=</span> Logger<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    logger<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">&quot;启动成功&quot;</span><span class="token punctuation">)</span></span>
<span class="line">    logger<span class="token punctuation">.</span>error<span class="token punctuation">(</span><span class="token string">&quot;发生错误&quot;</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre></div></details><details class="hint-container details"><summary>（3）cached_property：带缓存功能的 property</summary><div class="language-python" data-highlighter="prismjs" data-ext="py"><pre><code class="language-python"><span class="line"><span class="token comment">#!/usr/bin/env python</span></span>
<span class="line"><span class="token comment"># --*-- coding:utf-8 --*--</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">from</span> functools <span class="token keyword">import</span> cached_property</span>
<span class="line"><span class="token keyword">import</span> random</span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">Test</span><span class="token punctuation">:</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment"># 普通的 property, 每次都是重新计算</span></span>
<span class="line">    <span class="token decorator annotation punctuation">@property</span></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">test1</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token keyword">return</span> random<span class="token punctuation">.</span>random<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment"># 带缓存的 property</span></span>
<span class="line">    <span class="token decorator annotation punctuation">@cached_property</span></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">test2</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token keyword">return</span> random<span class="token punctuation">.</span>random<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">&quot;__main__&quot;</span><span class="token punctuation">:</span></span>
<span class="line">    t <span class="token operator">=</span> Test<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment"># 普通的 property</span></span>
<span class="line">    <span class="token keyword">print</span><span class="token punctuation">(</span>t<span class="token punctuation">.</span>test1<span class="token punctuation">)</span>  <span class="token comment"># 0.0832563719467786</span></span>
<span class="line">    <span class="token keyword">print</span><span class="token punctuation">(</span>t<span class="token punctuation">.</span>test1<span class="token punctuation">)</span>  <span class="token comment"># 0.0832563719467786</span></span>
<span class="line">    <span class="token keyword">print</span><span class="token punctuation">(</span>t<span class="token punctuation">.</span>test1 <span class="token operator">==</span> t<span class="token punctuation">.</span>test1<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment"># 带缓存的 property</span></span>
<span class="line">    <span class="token keyword">print</span><span class="token punctuation">(</span>t<span class="token punctuation">.</span>test2<span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">print</span><span class="token punctuation">(</span>t<span class="token punctuation">.</span>test2<span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">print</span><span class="token punctuation">(</span>t<span class="token punctuation">.</span>test2 <span class="token operator">==</span> t<span class="token punctuation">.</span>test2<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment"># 手动清楚缓存, 以下两种方式都可以使用</span></span>
<span class="line">    <span class="token comment">#   第一种可读性好, Pycharm会报提醒</span></span>
<span class="line">    <span class="token comment">#   第二种可读性差, Pycharm不会报提醒</span></span>
<span class="line">    <span class="token comment"># del t.test2</span></span>
<span class="line">    <span class="token keyword">del</span> t<span class="token punctuation">.</span>__dict__<span class="token punctuation">[</span><span class="token string">&quot;test2&quot;</span><span class="token punctuation">]</span></span>
<span class="line">    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">print</span><span class="token punctuation">(</span>t<span class="token punctuation">.</span>test2<span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">print</span><span class="token punctuation">(</span>t<span class="token punctuation">.</span>test2<span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">print</span><span class="token punctuation">(</span>t<span class="token punctuation">.</span>test2 <span class="token operator">==</span> t<span class="token punctuation">.</span>test2<span class="token punctuation">)</span></span>
<span class="line"></span></code></pre></div></details><details class="hint-container details"><summary>（4）lru_cache：最近最少使用缓存</summary><ul><li>lru是什么？LRU是Least Recently Used的缩写，即最近最少使用，是一种常用的页面置换算法</li><li>函数签名：lru_cache(maxsize=128, typed=False)</li><li>maxsize代表最大可以缓存128个，如果设置为None代表禁用LRU功能，并且缓存可以无限增长，设置为2的幂时性能最好</li><li>typed 如果设置为True，则不同类型的函数参数将单独缓存，比如f(3)和f(3.0)将被分别缓存</li></ul><div class="language-python" data-highlighter="prismjs" data-ext="py"><pre><code class="language-python"><span class="line"><span class="token comment">#!/usr/bin/env python</span></span>
<span class="line"><span class="token comment"># --*-- coding:utf-8 --*--</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">from</span> functools <span class="token keyword">import</span> lru_cache</span>
<span class="line"></span>
<span class="line"><span class="token decorator annotation punctuation">@lru_cache</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">def</span> <span class="token function">fib</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token number">1</span> <span class="token keyword">if</span> n <span class="token operator">&lt;</span> <span class="token number">2</span> <span class="token keyword">else</span> fib<span class="token punctuation">(</span>n <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> fib<span class="token punctuation">(</span>n <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span>fib<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre></div></details><details class="hint-container details"><summary>（5）cmp_to_key：比较函数，<code>a</code> 和 <code>b</code> 谁应该排在前面？</summary><p>比较函数，需传入两个值 （x，y），计算 x &gt; y：</p><ul><li><p>大于时返回 1</p></li><li><p>等于时返回 0</p></li><li><p>小于时返回 -1</p></li></ul><div class="language-python" data-highlighter="prismjs" data-ext="py"><pre><code class="language-python"><span class="line"><span class="token comment">#!/usr/bin/env python</span></span>
<span class="line"><span class="token comment"># --*-- coding:utf-8 --*--</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">from</span> functools <span class="token keyword">import</span> cmp_to_key</span>
<span class="line"></span>
<span class="line">l <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">34</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">]</span></span>
<span class="line"></span>
<span class="line">l2 <span class="token operator">=</span> <span class="token builtin">sorted</span><span class="token punctuation">(</span>l<span class="token punctuation">,</span> key<span class="token operator">=</span>cmp_to_key<span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">,</span> y<span class="token punctuation">:</span> y <span class="token operator">-</span> x<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">l3 <span class="token operator">=</span> <span class="token builtin">sorted</span><span class="token punctuation">(</span>l<span class="token punctuation">,</span> key<span class="token operator">=</span>cmp_to_key<span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">,</span> y<span class="token punctuation">:</span> x <span class="token operator">-</span> y<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span>l2<span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span>l3<span class="token punctuation">)</span></span>
<span class="line"></span></code></pre></div><p>输出结果</p><div class="language-bash" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token punctuation">[</span><span class="token number">34</span>, <span class="token number">30</span>, <span class="token number">9</span>, <span class="token number">5</span>, <span class="token number">3</span><span class="token punctuation">]</span></span>
<span class="line"><span class="token punctuation">[</span><span class="token number">3</span>, <span class="token number">5</span>, <span class="token number">9</span>, <span class="token number">30</span>, <span class="token number">34</span><span class="token punctuation">]</span></span>
<span class="line"></span></code></pre></div></details><details class="hint-container details"><summary>（6）total_ordering：只要实现一个等于方法和一个比较方法，就能自动补全对象的全部排序运算符</summary><ul><li>这是一个类装饰器</li><li>要求此类需要实现<code>__eq__</code>，并实现其中一个： <code>__lt__()</code>, <code>__le__()</code>, <code>__gt__()</code>, <code>__ge__()</code>，装饰器自动补全剩余方法</li></ul><div class="language-python" data-highlighter="prismjs" data-ext="py"><pre><code class="language-python"><span class="line"><span class="token comment">#!/usr/bin/env python</span></span>
<span class="line"><span class="token comment"># --*-- coding:utf-8 --*--</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">from</span> functools <span class="token keyword">import</span> total_ordering</span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token decorator annotation punctuation">@total_ordering</span></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">Point</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        self<span class="token punctuation">.</span>x <span class="token operator">=</span> x</span>
<span class="line">        self<span class="token punctuation">.</span>y <span class="token operator">=</span> y</span>
<span class="line"></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">__eq__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> other<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token keyword">return</span> self<span class="token punctuation">.</span>x <span class="token operator">==</span> other<span class="token punctuation">.</span>x <span class="token keyword">and</span> self<span class="token punctuation">.</span>y <span class="token operator">==</span> other<span class="token punctuation">.</span>y</span>
<span class="line"></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">__lt__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> other<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token punctuation">(</span>self<span class="token punctuation">.</span>x<span class="token punctuation">,</span> self<span class="token punctuation">.</span>y<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token punctuation">(</span>other<span class="token punctuation">.</span>x<span class="token punctuation">,</span> other<span class="token punctuation">.</span>y<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">&#39;__main__&#39;</span><span class="token punctuation">:</span></span>
<span class="line">    a <span class="token operator">=</span> Point<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span></span>
<span class="line">    b <span class="token operator">=</span> Point<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span></span>
<span class="line">    c <span class="token operator">=</span> Point<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">print</span><span class="token punctuation">(</span>a <span class="token operator">&lt;</span> b<span class="token punctuation">)</span>  <span class="token comment"># True</span></span>
<span class="line">    <span class="token keyword">print</span><span class="token punctuation">(</span>b <span class="token operator">&gt;</span> c<span class="token punctuation">)</span>  <span class="token comment"># True</span></span>
<span class="line">    <span class="token keyword">print</span><span class="token punctuation">(</span>c <span class="token operator">==</span> a<span class="token punctuation">)</span>  <span class="token comment"># True</span></span>
<span class="line"></span></code></pre></div></details><br><h3 id="zip系列函数" tabindex="-1"><a class="header-anchor" href="#zip系列函数"><span>zip系列函数</span></a></h3><p>牢记一点：</p><ul><li><code>zip(a, b)</code> 按最短的可迭代对象截断</li><li><code>itertools.zip_longest(a, b)</code> 按最长的可迭代对象截断，可以自定义要补全的值</li></ul><details class="hint-container details"><summary>点击查看详情</summary><div class="language-python" data-highlighter="prismjs" data-ext="py"><pre><code class="language-python"><span class="line"><span class="token comment"># zip 把多个可迭代对象按位置打包成元组, 按最短的可迭代对象截断, 返回的是 迭代器</span></span>
<span class="line">a <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span></span>
<span class="line">b <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;b&quot;</span><span class="token punctuation">]</span></span>
<span class="line">c <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;A&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;B&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;C&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;D&quot;</span><span class="token punctuation">]</span></span>
<span class="line">x <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span><span class="token builtin">zip</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># itertools.zip_longest()  zip 的&quot;补全版&quot;，长度不够的用占位值填充</span></span>
<span class="line"><span class="token keyword">from</span> itertools <span class="token keyword">import</span> zip_longest</span>
<span class="line"></span>
<span class="line">x <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span>zip_longest<span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">,</span> fillvalue<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># * + zip（解包 / 反向 zip）, 按最短的可迭代对象截断</span></span>
<span class="line">pairs <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">]</span></span>
<span class="line">a<span class="token punctuation">,</span> b <span class="token operator">=</span> <span class="token builtin">zip</span><span class="token punctuation">(</span><span class="token operator">*</span>pairs<span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;-&quot;</span> <span class="token operator">*</span> <span class="token number">50</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 可能会遇到的用法</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 1.生成字典: dict(zip(keys, values))</span></span>
<span class="line">a <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">zip</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">&quot;4&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;5&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;6&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>  <span class="token comment"># {1: &#39;4&#39;, 2: &#39;5&#39;, 3: &#39;6&#39;}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 2.花式秀循环 zip(enumerate(a), b)</span></span>
<span class="line"><span class="token comment">#   带索引遍历 a，同时顺带拿 b 的同位置元素, 按最短的可迭代对象截断</span></span>
<span class="line">a <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&#39;x&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;y&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;z&#39;</span><span class="token punctuation">]</span></span>
<span class="line">b <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">]</span></span>
<span class="line"><span class="token keyword">for</span> <span class="token punctuation">(</span>index<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">,</span> other <span class="token keyword">in</span> <span class="token builtin">zip</span><span class="token punctuation">(</span><span class="token builtin">enumerate</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">print</span><span class="token punctuation">(</span>index<span class="token punctuation">,</span> value<span class="token punctuation">,</span> other<span class="token punctuation">)</span></span>
<span class="line"></span></code></pre></div><p>输出结果</p><div class="language-bash" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token number">1</span>, <span class="token string">&#39;a&#39;</span>, <span class="token string">&#39;A&#39;</span><span class="token punctuation">)</span>, <span class="token punctuation">(</span><span class="token number">2</span>, <span class="token string">&#39;b&#39;</span>, <span class="token string">&#39;B&#39;</span><span class="token punctuation">)</span><span class="token punctuation">]</span></span>
<span class="line"><span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token number">1</span>, <span class="token string">&#39;a&#39;</span>, <span class="token string">&#39;A&#39;</span><span class="token punctuation">)</span>, <span class="token punctuation">(</span><span class="token number">2</span>, <span class="token string">&#39;b&#39;</span>, <span class="token string">&#39;B&#39;</span><span class="token punctuation">)</span>, <span class="token punctuation">(</span><span class="token number">3</span>, None, <span class="token string">&#39;C&#39;</span><span class="token punctuation">)</span>, <span class="token punctuation">(</span>None, None, <span class="token string">&#39;D&#39;</span><span class="token punctuation">)</span><span class="token punctuation">]</span></span>
<span class="line"><span class="token punctuation">(</span><span class="token number">1</span>, <span class="token number">3</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">(</span><span class="token number">2</span>, <span class="token number">4</span><span class="token punctuation">)</span></span>
<span class="line">--------------------------------------------------</span>
<span class="line"><span class="token punctuation">{</span><span class="token number">1</span>: <span class="token string">&#39;4&#39;</span>, <span class="token number">2</span>: <span class="token string">&#39;5&#39;</span>, <span class="token number">3</span>: <span class="token string">&#39;6&#39;</span><span class="token punctuation">}</span></span>
<span class="line"><span class="token number">0</span> x <span class="token number">10</span></span>
<span class="line"><span class="token number">1</span> y <span class="token number">20</span></span>
<span class="line"><span class="token number">2</span> z <span class="token number">30</span></span>
<span class="line"></span></code></pre></div></details><br><h3 id="递归函数" tabindex="-1"><a class="header-anchor" href="#递归函数"><span>递归函数</span></a></h3><ul><li><p>Python对递归深度做了限制，以保护解释器，超过限制抛出<code>RecursionError:maxinum recursion depth exceeded</code></p></li><li><p>使用<code>sys.getrecursionlimit()</code>获取递归深度，默认为<code>1000</code>；</p></li><li><p><code>使用sys.setrecursionlimit(n)设置递归深度</code>，注意不要设置的太大，否则会导致栈溢出，</p><p>报错<code>OverflowError: signed integer ``is</code> <code>greater than maximum</code></p></li></ul><p>一个递归+缓存版的费布那切数列</p><div class="language-python" data-highlighter="prismjs" data-ext="py"><pre><code class="language-python"><span class="line"><span class="token comment">#!/usr/bin/env python</span></span>
<span class="line"><span class="token comment"># --*-- coding:utf-8 --*--</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">def</span> <span class="token function">fib</span><span class="token punctuation">(</span>n<span class="token punctuation">,</span> cache<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">if</span> cache <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span></span>
<span class="line">        cache <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">if</span> n <span class="token keyword">in</span> cache<span class="token punctuation">:</span></span>
<span class="line">        <span class="token keyword">return</span> cache<span class="token punctuation">[</span>n<span class="token punctuation">]</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">if</span> n <span class="token operator">&lt;</span> <span class="token number">2</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token number">1</span></span>
<span class="line">    cache<span class="token punctuation">[</span>n<span class="token punctuation">]</span> <span class="token operator">=</span> fib<span class="token punctuation">(</span>n <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> cache<span class="token punctuation">)</span> <span class="token operator">+</span> fib<span class="token punctuation">(</span>n <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">,</span> cache<span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">return</span> cache<span class="token punctuation">[</span>n<span class="token punctuation">]</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span>fib<span class="token punctuation">(</span><span class="token number">998</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre></div><br><h3 id="高阶函数" tabindex="-1"><a class="header-anchor" href="#高阶函数"><span>高阶函数</span></a></h3><p>高阶函数指的是可以将一个函数作为一个形参传递给一个函数 或 返回值是一个函数，这个函数就称为高阶函数</p><details class="hint-container details"><summary>（1）sorted</summary><p>sorted 排序函数，key指定自定义排序规则，reverse可以反转结果，返回列表</p><p>函数签名</p><div class="language-python" data-highlighter="prismjs" data-ext="py"><pre><code class="language-python"><span class="line"><span class="token builtin">sorted</span><span class="token punctuation">(</span>iterable<span class="token punctuation">,</span> <span class="token operator">/</span><span class="token punctuation">,</span> <span class="token operator">*</span><span class="token punctuation">,</span> key<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> reverse<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre></div><p>示例</p><div class="language-python" data-highlighter="prismjs" data-ext="py"><pre><code class="language-python"><span class="line"><span class="token comment">#!/usr/bin/env python</span></span>
<span class="line"><span class="token comment"># --*-- coding:utf-8 --*--</span></span>
<span class="line"></span>
<span class="line">L <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token string">&#39;b&#39;</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">&#39;a&#39;</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">&#39;c&#39;</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">&#39;d&#39;</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">]</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 排序，默认情况下按照ASCII排序</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">sorted</span><span class="token punctuation">(</span>L<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># [(&#39;a&#39;, 3), (&#39;b&#39;, 2), (&#39;c&#39;, 3), (&#39;d&#39;, 4)]</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 自定义排序规则，根据元祖索引为1的数据排序，或者说根据字典(元祖转为字典)的value排序</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">sorted</span><span class="token punctuation">(</span>L<span class="token punctuation">,</span> key<span class="token operator">=</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> x<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># [(&#39;b&#39;, 2), (&#39;a&#39;, 3), (&#39;c&#39;, 3), (&#39;d&#39;, 4)]</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 如果第一次排序有相同的，即x[1]相同，那么按照x[0]排序</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">sorted</span><span class="token punctuation">(</span>L<span class="token punctuation">,</span> key<span class="token operator">=</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> <span class="token punctuation">(</span>x<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> x<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># [(&#39;b&#39;, 2), (&#39;a&#39;, 3), (&#39;c&#39;, 3), (&#39;d&#39;, 4)]</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 如果x[0]我想按倒序排序，那么可以这样做</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">sorted</span><span class="token punctuation">(</span>L<span class="token punctuation">,</span> key<span class="token operator">=</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> <span class="token punctuation">(</span>x<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token builtin">ord</span><span class="token punctuation">(</span>x<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># [(&#39;b&#39;, 2), (&#39;c&#39;, 3), (&#39;a&#39;, 3), (&#39;d&#39;, 4)]</span></span>
<span class="line"></span></code></pre></div><p>仿写sorted函数</p><div class="language-python" data-highlighter="prismjs" data-ext="py"><pre><code class="language-python"><span class="line"><span class="token comment">#!/usr/bin/env python</span></span>
<span class="line"><span class="token comment"># --*-- coding:utf-8 --*--</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">def</span> <span class="token function">sorted</span><span class="token punctuation">(</span>iterable<span class="token punctuation">,</span> <span class="token operator">*</span><span class="token punctuation">,</span> key<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> reverse<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">if</span> key <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span></span>
<span class="line">        key <span class="token operator">=</span> <span class="token keyword">lambda</span> x<span class="token punctuation">:</span> x</span>
<span class="line"></span>
<span class="line">    <span class="token comment"># 保存排序好的数据</span></span>
<span class="line">    ret <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment"># 迭代对象</span></span>
<span class="line">    <span class="token keyword">for</span> z <span class="token keyword">in</span> iterable<span class="token punctuation">:</span></span>
<span class="line"></span>
<span class="line">        <span class="token comment"># 迭代已排好序的数据</span></span>
<span class="line">        <span class="token keyword">for</span> x<span class="token punctuation">,</span> y <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>ret<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line"></span>
<span class="line">            <span class="token comment"># 结果反转部分</span></span>
<span class="line">            flag <span class="token operator">=</span> key<span class="token punctuation">(</span>z<span class="token punctuation">)</span> <span class="token operator">&gt;</span> key<span class="token punctuation">(</span>y<span class="token punctuation">)</span> <span class="token keyword">if</span> reverse <span class="token keyword">else</span> key<span class="token punctuation">(</span>z<span class="token punctuation">)</span> <span class="token operator">&lt;</span> key<span class="token punctuation">(</span>y<span class="token punctuation">)</span></span>
<span class="line">            <span class="token keyword">if</span> flag<span class="token punctuation">:</span></span>
<span class="line">                ret<span class="token punctuation">.</span>insert<span class="token punctuation">(</span>x<span class="token punctuation">,</span> z<span class="token punctuation">)</span></span>
<span class="line">                <span class="token keyword">break</span></span>
<span class="line">        <span class="token keyword">else</span><span class="token punctuation">:</span></span>
<span class="line">            ret<span class="token punctuation">.</span>append<span class="token punctuation">(</span>z<span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">return</span> ret</span>
<span class="line"></span></code></pre></div></details><details class="hint-container details"><summary>（2）filter</summary><p>filter 筛选指定元素，函数可以为None时代表从序列中筛选出为真的元素，返回一个filter对象</p><p>使用filter过滤后，返回新的元素个数可能会减少</p><p>函数签名</p><div class="language-python" data-highlighter="prismjs" data-ext="py"><pre><code class="language-python"><span class="line"><span class="token builtin">filter</span><span class="token punctuation">(</span>function <span class="token keyword">or</span> <span class="token boolean">None</span><span class="token punctuation">,</span> iterable<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">filter</span> <span class="token builtin">object</span></span>
<span class="line"></span></code></pre></div><p>示例</p><div class="language-python" data-highlighter="prismjs" data-ext="py"><pre><code class="language-python"><span class="line"><span class="token comment">#!/usr/bin/env python</span></span>
<span class="line"><span class="token comment"># --*-- coding:utf-8 --*--</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">list</span><span class="token punctuation">(</span><span class="token builtin">filter</span><span class="token punctuation">(</span><span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token comment"># [1, 2, 3, 4, 5, 6, 7, 8, 9]</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">list</span><span class="token punctuation">(</span><span class="token builtin">filter</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> x <span class="token operator">%</span> <span class="token number">3</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token comment"># [0, 3, 6, 9, 12, 15, 18]</span></span>
<span class="line"></span></code></pre></div><p>仿写filter</p><div class="language-python" data-highlighter="prismjs" data-ext="py"><pre><code class="language-python"><span class="line"><span class="token comment">#!/usr/bin/env python</span></span>
<span class="line"><span class="token comment"># --*-- coding:utf-8 --*--</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">def</span> <span class="token function">filter</span><span class="token punctuation">(</span>fn<span class="token punctuation">,</span> iterable<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">if</span> fn <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span></span>
<span class="line">        fn <span class="token operator">=</span> <span class="token builtin">bool</span></span>
<span class="line">    <span class="token keyword">for</span> i <span class="token keyword">in</span> iterable<span class="token punctuation">:</span></span>
<span class="line">        <span class="token keyword">if</span> fn<span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token keyword">yield</span> i</span>
<span class="line"></span></code></pre></div></details><details class="hint-container details"><summary>（3）map</summary><p>将序列的每个元素都作用在函数上，返回一个map object</p><p>使用map后，新对象的元素个数不会变，值一般都会变</p><p>函数签名</p><div class="language-python" data-highlighter="prismjs" data-ext="py"><pre><code class="language-python"><span class="line"><span class="token builtin">map</span><span class="token punctuation">(</span>func<span class="token punctuation">,</span> <span class="token operator">*</span>iterables<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">map</span> <span class="token builtin">object</span></span>
<span class="line"></span></code></pre></div><p>举例</p><div class="language-python" data-highlighter="prismjs" data-ext="py"><pre><code class="language-python"><span class="line"><span class="token comment">#!/usr/bin/env python</span></span>
<span class="line"><span class="token comment"># --*-- coding:utf-8 --*--</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 将列表中的数字都转为字符串</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">list</span><span class="token punctuation">(</span><span class="token builtin">map</span><span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token comment"># [&#39;1&#39;, &#39;2&#39;, &#39;3&#39;, &#39;4&#39;, &#39;5&#39;]</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 小练习，使用map来求1-20之间的偶数？</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># (1)正常来说，肯定是先想到使用filter，先写一下</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">list</span><span class="token punctuation">(</span><span class="token builtin">filter</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> x <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token comment"># [2, 4, 6, 8, 10, 12, 14, 16, 18, 20]</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># (2) 使用map来写，总感觉哪里不对，元素个数多了~</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">list</span><span class="token punctuation">(</span><span class="token builtin">map</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> x <span class="token keyword">if</span> x <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">1</span> <span class="token keyword">else</span> <span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token comment"># [1, None, 3, None, 5, None, 7, None, 9, None, 11, None, 13, None, 15, None, 17, None, 19, None]</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># (3) 修改一下</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">list</span><span class="token punctuation">(</span><span class="token builtin">map</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> x <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># ----------------------------------------------------------------------------------------------------</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># map 可同时接收多个可迭代对象，有几个可迭代对象，那么函数的就该有几个参数</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">list</span><span class="token punctuation">(</span><span class="token builtin">map</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token punctuation">{</span>x<span class="token punctuation">:</span> y<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token comment"># [{1: 10}, {2: 11}, {3: 12}, {4: 13}, {5: 14}]</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 如果两个序列的元素个数不一致，以最短序列为标准（2.x中会以最长序列为标准）</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">list</span><span class="token punctuation">(</span><span class="token builtin">map</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token punctuation">{</span>x<span class="token punctuation">:</span> y<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token comment"># [{1: 10}, {2: 11}, {3: 12}, {4: 13}, {5: 14}]</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 如果要以最长序列为标准的话，自己实现了一个函数</span></span>
<span class="line"><span class="token keyword">from</span> itertools <span class="token keyword">import</span> zip_longest</span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token keyword">def</span> <span class="token function">map_longest</span><span class="token punctuation">(</span>func<span class="token punctuation">,</span> <span class="token operator">*</span>iterables<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    ret <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span></span>
<span class="line">    iter_list <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span>zip_longest<span class="token punctuation">(</span><span class="token operator">*</span>iterables<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment"># 获取可迭代对象的个数</span></span>
<span class="line">    iter_number <span class="token operator">=</span> <span class="token builtin">max</span><span class="token punctuation">(</span><span class="token builtin">list</span><span class="token punctuation">(</span><span class="token builtin">map</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">,</span> iter_list<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment"># 遍历每个可迭代对象</span></span>
<span class="line">    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>iter_number<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        ret<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">[</span>x<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token keyword">for</span> x <span class="token keyword">in</span> iter_list<span class="token punctuation">]</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token builtin">map</span><span class="token punctuation">(</span>func<span class="token punctuation">,</span> <span class="token operator">*</span>ret<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">list</span><span class="token punctuation">(</span>map_longest<span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token punctuation">{</span>x<span class="token punctuation">:</span> y<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token comment"># [{1: 10}, {2: 11}, {3: 12}, {4: 13}, {5: 14}, {None: 15}, {None: 16}, {None: 17}, {None: 18}, {None: 19}, {None: 20}]</span></span>
<span class="line"></span></code></pre></div><p>仿写map</p><div class="language-python" data-highlighter="prismjs" data-ext="py"><pre><code class="language-python"><span class="line"><span class="token comment">#!/usr/bin/env python</span></span>
<span class="line"><span class="token comment"># --*-- coding:utf-8 --*--</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">def</span> <span class="token function">map</span><span class="token punctuation">(</span>fn<span class="token punctuation">,</span> <span class="token operator">*</span>iterable<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">zip</span><span class="token punctuation">(</span><span class="token operator">*</span>iterable<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token keyword">yield</span> fn<span class="token punctuation">(</span><span class="token operator">*</span>i<span class="token punctuation">)</span></span>
<span class="line">starmap</span>
<span class="line"></span></code></pre></div><p><code>starmap</code>与map类似，不同的是对于多个可迭代对象的处理方式</p><div class="language-python" data-highlighter="prismjs" data-ext="py"><pre><code class="language-python"><span class="line"><span class="token comment">#!/usr/bin/env python</span></span>
<span class="line"><span class="token comment"># --*-- coding:utf-8 --*--</span></span>
<span class="line"><span class="token keyword">from</span> itertools <span class="token keyword">import</span> starmap</span>
<span class="line"></span>
<span class="line">data <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">]</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">list</span><span class="token punctuation">(</span><span class="token builtin">map</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token punctuation">{</span>x<span class="token punctuation">:</span> y<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token operator">*</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token comment"># [{1: 3}, {2: 4}]   map将1,3和24分别传进去</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">list</span><span class="token punctuation">(</span>starmap<span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token punctuation">{</span>x<span class="token punctuation">:</span> y<span class="token punctuation">}</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token comment"># [{1: 2}, {3: 4}]   start_map 将1,2和3,4分别传进去,start_map 只需要传递一个可迭代对象即可</span></span>
<span class="line"></span></code></pre></div></details><br><h3 id="装饰器基础" tabindex="-1"><a class="header-anchor" href="#装饰器基础"><span>装饰器基础</span></a></h3><details class="hint-container details"><summary>（1）柯里化(Currying)</summary><p>将原来接受2个参数的函数变成新的接受一个参数的函数的过程。新的函数是接受原有函数第二个参数的函数，比如：</p><p>原函数为: <code>add(1, 2)</code></p><p>柯里化后: <code>add(1)(2)</code></p><p>柯里化简单举例</p><div class="language-python" data-highlighter="prismjs" data-ext="py"><pre><code class="language-python"><span class="line"><span class="token comment">#!/usr/bin/env python</span></span>
<span class="line"><span class="token comment"># --*-- coding:utf-8 --*--</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 原函数</span></span>
<span class="line"><span class="token keyword">def</span> <span class="token function">add</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">return</span> x <span class="token operator">+</span> y</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 柯里化后</span></span>
<span class="line"><span class="token keyword">def</span> <span class="token function">add</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">fn</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token keyword">return</span> x <span class="token operator">+</span> y</span>
<span class="line">    </span>
<span class="line">    <span class="token keyword">return</span> fn</span>
<span class="line"></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span>add<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># 3</span></span>
<span class="line"></span></code></pre></div></details><details class="hint-container details"><summary>（2）闭包(Closure)</summary><p>闭包就是函数中再嵌套一个函数，内层函数中使用了外层函数的自有变量，就产生了闭包</p><p>外层函数<code>__closure__</code>属性是一个cell对象的元祖，每个cell对象的cell_contents属性对应产生闭包的自有变量的值</p><div class="language-python" data-highlighter="prismjs" data-ext="py"><pre><code class="language-python"><span class="line"><span class="token comment">#!/usr/bin/env python</span></span>
<span class="line"><span class="token comment"># --*-- coding:utf-8 --*--</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">def</span> <span class="token function">add</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    count <span class="token operator">=</span> <span class="token number">0</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">wrapper</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token keyword">return</span> x<span class="token punctuation">,</span> y</span>
<span class="line"></span>
<span class="line">    <span class="token keyword">return</span> wrapper</span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token keyword">for</span> i <span class="token keyword">in</span> add<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__closure__<span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">print</span><span class="token punctuation">(</span>i<span class="token punctuation">.</span>cell_contents<span class="token punctuation">)</span></span>
<span class="line">    <span class="token comment"># 1</span></span>
<span class="line">    <span class="token comment"># 2</span></span>
<span class="line"></span></code></pre></div></details><details class="hint-container details"><summary>（3）装饰器</summary><p>无参装饰器</p><div class="language-python" data-highlighter="prismjs" data-ext="py"><pre><code class="language-python"><span class="line"><span class="token comment">#!/usr/bin/env python</span></span>
<span class="line"><span class="token comment"># --*-- coding:utf-8 --*--</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> time</span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 无参装饰器</span></span>
<span class="line"><span class="token keyword">def</span> <span class="token function">timer</span><span class="token punctuation">(</span>func<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">wrapper</span><span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        start <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">        f <span class="token operator">=</span> func<span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span></span>
<span class="line">        end <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&#39;Runnint time: {time} seconds.&#39;</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>time<span class="token operator">=</span><span class="token punctuation">(</span>end <span class="token operator">-</span> start<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">return</span> f</span>
<span class="line"></span>
<span class="line">    <span class="token keyword">return</span> wrapper</span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token decorator annotation punctuation">@timer</span>  <span class="token comment"># 等同于 timer(add)(a, b)</span></span>
<span class="line"><span class="token keyword">def</span> <span class="token function">add</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">return</span> a <span class="token operator">+</span> b</span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span>add<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre></div><p>带参装饰器，需要再饰器函数的第一层再嵌套一个函数</p><div class="language-python" data-highlighter="prismjs" data-ext="py"><pre><code class="language-python"><span class="line"><span class="token keyword">import</span> time</span>
<span class="line"> </span>
<span class="line"><span class="token keyword">def</span> <span class="token function">timer</span><span class="token punctuation">(</span>start_time<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">_timer</span><span class="token punctuation">(</span>func<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token keyword">def</span> <span class="token function">wrapper</span><span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">            start <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">            f <span class="token operator">=</span> func<span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span></span>
<span class="line">            delta <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> start</span>
<span class="line">            <span class="token keyword">if</span> delta <span class="token operator">&gt;=</span> start_time<span class="token punctuation">:</span></span>
<span class="line">                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&#39;Runnint time: {time} seconds.&#39;</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>time<span class="token operator">=</span>delta<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">            <span class="token keyword">return</span> f</span>
<span class="line">        <span class="token keyword">return</span> wrapper</span>
<span class="line">    <span class="token keyword">return</span> _timer</span>
<span class="line"> </span>
<span class="line"><span class="token decorator annotation punctuation">@timer</span><span class="token punctuation">(</span>start_time<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span>        <span class="token comment"># 等同于timer(start_time=3)(add)(a, b)</span></span>
<span class="line"><span class="token keyword">def</span> <span class="token function">add</span><span class="token punctuation">(</span>a <span class="token punctuation">,</span>b<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">return</span> a <span class="token operator">+</span> b</span>
<span class="line"> </span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span>add<span class="token punctuation">(</span><span class="token number">1</span> <span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre></div><p>装饰器的副作用：部分属性会被覆盖,比如 <code>__name__</code>, <code>__doc__</code></p><p>使用装饰器<code>functools.wraps(func)</code> 或 函数<code>functools.update_wrapper(wrapper, func)</code> 可以消除这种影响</p><div class="language-python" data-highlighter="prismjs" data-ext="py"><pre><code class="language-python"><span class="line"><span class="token keyword">def</span> <span class="token function">timer</span><span class="token punctuation">(</span>start_time<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">_timer</span><span class="token punctuation">(</span>func<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token comment"># 方法1-推荐</span></span>
<span class="line">        <span class="token decorator annotation punctuation">@functools<span class="token punctuation">.</span>wraps</span><span class="token punctuation">(</span>func<span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">def</span> <span class="token function">wrapper</span><span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">            start <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">            f <span class="token operator">=</span> func<span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span></span>
<span class="line">            delta <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> start</span>
<span class="line">            <span class="token keyword">if</span> delta <span class="token operator">&gt;=</span> start_time<span class="token punctuation">:</span></span>
<span class="line">                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&#39;Runnint time: {time} seconds.&#39;</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>time<span class="token operator">=</span>delta<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">            <span class="token keyword">return</span> f</span>
<span class="line">        <span class="token comment"># 方法2</span></span>
<span class="line">        <span class="token comment"># functools.update_wrapper(wrapper, func)</span></span>
<span class="line">        <span class="token keyword">return</span> wrapper</span>
<span class="line">    <span class="token keyword">return</span> _timer</span>
<span class="line"></span></code></pre></div></details><br><h2 id="四、多线程" tabindex="-1"><a class="header-anchor" href="#四、多线程"><span>四、多线程</span></a></h2><h3 id="前置知识" tabindex="-1"><a class="header-anchor" href="#前置知识"><span>前置知识</span></a></h3><p><strong>1、并发和并行</strong></p><p><span style="color:red;font-weight:bold;">并发（Concurrent）：在同一时间点，一颗CPU核心交替做两件或多件事</span></p><p><span style="color:red;font-weight:bold;">并行（Parallel）：同一时间点，两颗或多颗CPU核心同时做两件或多件事</span></p><p>单单只看这些概念还是让人摸不着头脑，我们深入理解一下：</p><ul><li><p>在只有一颗CPU核心的处理器上面是无法实现并行的，但是可以实现并发</p></li><li><p>并行是提高并发的一种手段</p></li><li><p>由于CPython特殊的GIL锁，导致CPython不能实现并行，解决办法可以使用多进程来实现并行，</p><p>也可以使用PyPy等移除掉GIL的第三方解释器来执行</p></li></ul><br><p><strong>2、高并发解决方案</strong></p><p>上面我们讲的都是在编程语言范围内的并发，而在一个项目中，高并发的本质问题往往在于数据库能够承载的并发是有限的。解决高并发的关键就在于降低单库的连接数。</p><p>通常我们可以有以下几种方法：</p><ul><li>使用缓存，缓存命中便不会再去请求数据库</li><li>系统拆分，每个业务使用独立的一个数据库实例</li><li>读写分离，对同一个数据库进一步拆分，读和写分散在不同的数据库实例上</li><li>MQ削峰，服务端限速执行</li><li>限流操作，比如令牌桶等，超出则丢弃</li></ul><blockquote><p>实际情况中要根据项目的特性，是读多写少还是读少写多，综合不同的手段来达到高并发的目的</p></blockquote><br><p><strong>3、线程说明</strong></p><ul><li>线程是CPU调度的最小单元</li><li>每个可执行程序都会有一个主线程，主线程一般我们都用来做协调工作，由主线程来创建其他线程称为工作线程</li><li>线程之间数据共享</li><li>线程状态 <ul><li>就绪(Ready)：线程能够运行但是还没有开始运行，等待被调度</li><li>运行(Running)：线程一旦调度就处于运行中</li><li>阻塞(Blocked)：线程等待外部事件而无法运行，比如I<code>/O</code>等待</li><li>终止(Teminated)：线程退出</li></ul></li><li>工作线程一旦启动，不可暂停和取消，除非代码运行完成或抛出异常而停止；工作线程崩溃不影响主线程正常运行</li></ul><br><p><strong>4、CPython线程使用场景</strong></p><p>线程是最出名的实现并发和并行的方式之一，但是在CPython中由于GIL的存在，线程只能实现并发，而不能实现并行。</p><p>可以说CPython的线程并不是真正的线程，但是它在某些场景下仍旧可以为我们的代码提速，其原理在于：</p><ul><li>对于CPU密集型的应用，由于线程会一直霸占CPU，除非线程执行完成或主动交出控制权，所以使用多线程一般会导致程序变慢（线程创建和销毁需要开销）</li><li>对于IO密集型应用，遇到IO阻塞时系统会自动进行线程切换，所以可以极大的提高程序效率</li></ul><br><h3 id="基本使用" tabindex="-1"><a class="header-anchor" href="#基本使用"><span>基本使用</span></a></h3><details class="hint-container details"><summary>（1）函数形式</summary><div class="language-python" data-highlighter="prismjs" data-ext="py"><pre><code class="language-python"><span class="line"><span class="token comment">#!/usr/bin/env python</span></span>
<span class="line"><span class="token comment"># -*-coding:utf-8-*-</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">from</span> datetime <span class="token keyword">import</span> datetime</span>
<span class="line"><span class="token keyword">from</span> threading <span class="token keyword">import</span> Thread</span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 定义一个普通函数</span></span>
<span class="line"><span class="token keyword">def</span> <span class="token function">show_time</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&#39;{}{}&#39;</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>msg<span class="token punctuation">,</span> datetime<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 实例化Thread类，创建一个线程，执行我们的函数show_time，函数参数以元组形式使用args传递</span></span>
<span class="line"><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    t <span class="token operator">=</span> Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>show_time<span class="token punctuation">,</span> args<span class="token operator">=</span><span class="token punctuation">(</span><span class="token string">&quot;当前时间是: &quot;</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">    t<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre></div></details><details class="hint-container details"><summary>（2）类形式</summary><div class="language-python" data-highlighter="prismjs" data-ext="py"><pre><code class="language-python"><span class="line"><span class="token comment">#!/usr/bin/env python</span></span>
<span class="line"><span class="token comment"># -*-coding:utf-8-*-</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">from</span> datetime <span class="token keyword">import</span> datetime</span>
<span class="line"><span class="token keyword">from</span> threading <span class="token keyword">import</span> Thread</span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">ShowTime</span><span class="token punctuation">(</span>Thread<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">run</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token boolean">None</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&#39;当前时间是: {}\n&#39;</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>datetime<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> end<span class="token operator">=</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    t <span class="token operator">=</span> ShowTime<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    t<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre></div></details><br><h3 id="线程属性" tabindex="-1"><a class="header-anchor" href="#线程属性"><span>线程属性</span></a></h3><details class="hint-container details"><summary>Thread类详情</summary><p><strong>Thread类签名</strong></p><div class="language-python" data-highlighter="prismjs" data-ext="py"><pre><code class="language-python"><span class="line"><span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> group<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> target<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> args<span class="token operator">=</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> kwargs<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token operator">*</span><span class="token punctuation">,</span> daemon<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># targe		线程调度的函数</span></span>
<span class="line"><span class="token comment"># name		线程名字</span></span>
<span class="line"><span class="token comment"># args		线程函数参数，是一个元祖</span></span>
<span class="line"><span class="token comment"># daemon	后面有讲解</span></span>
<span class="line"></span></code></pre></div><p><strong>Thread实例属性和方法</strong></p><table><thead><tr><th>属性/方法</th><th>说明</th></tr></thead><tbody><tr><td>start()</td><td>执行任务（启动新线程）,start会启动新线程然后调用run方法，不会阻塞当前代码执行</td></tr><tr><td>run()</td><td>执行任务（在当前线程中），run方法会执行具体的任务</td></tr><tr><td>name/getName()</td><td>线程名，默认以Thread-1、Thread-2形式命名</td></tr><tr><td>setName()</td><td>设置线程名称</td></tr><tr><td>ident</td><td>线程ID，非0整数，线程启动后才会有ID，否则为None。线程退出，此ID依旧可以访问。此ID可以重复使用</td></tr><tr><td>is_alive()</td><td>返回线程是否还活着，等同于.isAlive()</td></tr></tbody></table><p><strong>threading模块属性和方法</strong></p><table><thead><tr><th>属性/方法</th><th>说明</th></tr></thead><tbody><tr><td>current_thread()</td><td>返回当前线程对象</td></tr><tr><td>get_ident()</td><td>返回当前线程的ID，非0整数</td></tr><tr><td>main_thread()</td><td>返回主线程对象</td></tr><tr><td>active_count()</td><td>当前处于alive状态的线程个数</td></tr><tr><td>enumerate()</td><td>返回所有的活着的线程列表，不包括未开始和已终止的线程</td></tr></tbody></table></details><br><h3 id="线程安全" tabindex="-1"><a class="header-anchor" href="#线程安全"><span>线程安全</span></a></h3><p>在多线程并发执行时， 无论线程调度顺序如何， 程序行为和结果都 <strong>始终正确、可预期</strong></p><details class="hint-container details"><summary>（1）queue 是线程安全的，但可能会写出线程不安全的代码</summary><p><strong>queue 线程不安全原理</strong></p><div class="language-python" data-highlighter="prismjs" data-ext="py"><pre><code class="language-python"><span class="line"><span class="token keyword">if</span> q<span class="token punctuation">.</span>qsize<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">:</span></span>
<span class="line">	q<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 问题描述：qsize()&gt;0不能保证一定能get()，qsize()&lt;maxsize不能保证一定put()</span></span>
<span class="line"><span class="token comment"># 原因在于：qsize()和get()本身是线程安全的,但是这两个组合到一块就不能保证是线程安全，因为这是两步操作了，中间是可能被打断的</span></span>
<span class="line"></span></code></pre></div><p><strong>queue 线程不安全举例</strong></p><div class="language-python" data-highlighter="prismjs" data-ext="py"><pre><code class="language-python"><span class="line"><span class="token comment">#!/usr/bin/env python</span></span>
<span class="line"><span class="token comment"># -*-coding:utf-8-*-</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> time</span>
<span class="line"><span class="token keyword">import</span> random</span>
<span class="line"><span class="token keyword">import</span> logging</span>
<span class="line"><span class="token keyword">from</span> queue <span class="token keyword">import</span> Queue</span>
<span class="line"><span class="token keyword">from</span> threading <span class="token keyword">import</span> Thread</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 初始化日志</span></span>
<span class="line">FORMAT <span class="token operator">=</span> <span class="token string">&#39;%(asctime)-15s\t [%(threadName)-10s, %(thread)d] %(message)s&#39;</span></span>
<span class="line">logging<span class="token punctuation">.</span>basicConfig<span class="token punctuation">(</span><span class="token builtin">format</span><span class="token operator">=</span>FORMAT<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 初始化队列</span></span>
<span class="line">q <span class="token operator">=</span> Queue<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 线程不安全代码</span></span>
<span class="line"><span class="token keyword">def</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">if</span> q<span class="token punctuation">.</span>qsize<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">:</span></span>
<span class="line">        time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span>random<span class="token punctuation">.</span>random<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">        q<span class="token punctuation">.</span>put<span class="token punctuation">(</span>random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">    logging<span class="token punctuation">.</span>warning<span class="token punctuation">(</span><span class="token string">&quot;队列大小: {}&quot;</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>q<span class="token punctuation">.</span>qsize<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 开启100个线程</span></span>
<span class="line"><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>test<span class="token punctuation">)</span><span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre></div><p><strong>解决办法：通过加锁，将访问共享资源的临界区并发数限制为 1，从而保证线程安全</strong></p><div class="language-python" data-highlighter="prismjs" data-ext="py"><pre><code class="language-python"><span class="line"><span class="token comment">#!/usr/bin/env python</span></span>
<span class="line"><span class="token comment"># -*-coding:utf-8-*-</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> time</span>
<span class="line"><span class="token keyword">import</span> random</span>
<span class="line"><span class="token keyword">import</span> logging</span>
<span class="line"><span class="token keyword">from</span> queue <span class="token keyword">import</span> Queue</span>
<span class="line"><span class="token keyword">from</span> threading <span class="token keyword">import</span> Thread<span class="token punctuation">,</span> Lock</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 初始化日志</span></span>
<span class="line">FORMAT <span class="token operator">=</span> <span class="token string">&#39;%(asctime)-15s\t [%(threadName)-17s %(thread)-6d] %(message)s&#39;</span></span>
<span class="line">logging<span class="token punctuation">.</span>basicConfig<span class="token punctuation">(</span><span class="token builtin">format</span><span class="token operator">=</span>FORMAT<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 初始化全局锁</span></span>
<span class="line">lock <span class="token operator">=</span> Lock<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 初始化队列</span></span>
<span class="line">q <span class="token operator">=</span> Queue<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token keyword">def</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">with</span> lock<span class="token punctuation">:</span></span>
<span class="line">        <span class="token keyword">if</span> q<span class="token punctuation">.</span>qsize<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">:</span></span>
<span class="line">            time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span>random<span class="token punctuation">.</span>random<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">            q<span class="token punctuation">.</span>put<span class="token punctuation">(</span>random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">        logging<span class="token punctuation">.</span>warning<span class="token punctuation">(</span><span class="token string">&quot;队列大小: {}&quot;</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>q<span class="token punctuation">.</span>qsize<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 开启100个线程</span></span>
<span class="line"><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>test<span class="token punctuation">)</span><span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre></div></details><br><h3 id="daemon" tabindex="-1"><a class="header-anchor" href="#daemon"><span>daemon</span></a></h3><div class="hint-container tip"><p class="hint-container-title">守护线程 或者叫 后台线程</p><ul><li>daemon = False：当主线程执行结束后，要等待非daemon线程执行完成</li><li>daemon = True：当主线程执行结束后，daemon线程也会立即退出</li><li>默认值：子线程的daemon的值优先从父线程中继承来，父线程如果不设置默认为False</li></ul></div><details class="hint-container details"><summary>daemon 介绍</summary><p><strong>daemon相关方法</strong></p><table><thead><tr><th>属性</th><th>说明</th></tr></thead><tbody><tr><td>threading.Thread(...., daemon=True)</td><td>创建线程时设置daemon属性</td></tr><tr><td>线程.setDaemon(True)</td><td>线程创建完成后，也可以设置daemon属性，必须在start之前</td></tr><tr><td>线程.isDaemon()/daemon</td><td>返回daemon状态</td></tr></tbody></table><p><strong>daemon线程应用场景</strong></p><ul><li><p>随时可以被终止的线程</p></li><li><p>后台任务，如发送心跳包、监控；</p></li><li><p>主线程工作才有用的线程，如主线程维护这公共资源，主线程已经清理了，准备退出，而工作线程使用这些资源已经没有意义了，一起退出最合适</p></li></ul></details><details class="hint-container details"><summary>daemon 代码示例</summary><div class="language-python" data-highlighter="prismjs" data-ext="py"><pre><code class="language-python"><span class="line"><span class="token comment">#!/usr/bin/env python</span></span>
<span class="line"><span class="token comment"># -*-coding:utf-8-*-</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> time</span>
<span class="line"><span class="token keyword">from</span> threading <span class="token keyword">import</span> Thread<span class="token punctuation">,</span> current_thread</span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token keyword">def</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">0.1</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;{}\n&quot;</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>current_thread<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">,</span> end<span class="token operator">=</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 开启10个线程</span></span>
<span class="line"><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token comment"># Thread(target=test).start()  # 未设置daemon属性，默认继承父线程，默认为False</span></span>
<span class="line">    Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>test<span class="token punctuation">,</span> daemon<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 设置daemon属性</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;End&quot;</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre></div><p>输出结果</p><div class="language-bash" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token comment"># 未设置daemon时，输出结果：</span></span>
<span class="line"><span class="token comment">#     End</span></span>
<span class="line"><span class="token comment">#     Thread-3</span></span>
<span class="line"><span class="token comment">#     Thread-2</span></span>
<span class="line"><span class="token comment">#     Thread-7</span></span>
<span class="line"><span class="token comment">#     Thread-5</span></span>
<span class="line"><span class="token comment">#     Thread-4</span></span>
<span class="line"><span class="token comment">#     Thread-6</span></span>
<span class="line"><span class="token comment">#     Thread-9</span></span>
<span class="line"><span class="token comment">#     Thread-1</span></span>
<span class="line"><span class="token comment">#     Thread-10</span></span>
<span class="line"><span class="token comment">#     Thread-8</span></span>
<span class="line"><span class="token comment">#</span></span>
<span class="line"><span class="token comment"># 设置daemon时，由于主线程很快会执行完成，而子线程会阻塞0.1秒，所以不会输出子线程名，输出结果：</span></span>
<span class="line"><span class="token comment">#     End</span></span>
<span class="line"></span></code></pre></div></details><br><h3 id="数据隔离-线程局部变量-local" tabindex="-1"><a class="header-anchor" href="#数据隔离-线程局部变量-local"><span>数据隔离 - 线程局部变量 local()</span></a></h3><div class="hint-container tip"><p class="hint-container-title">线程局部变量</p><p>创建全局变量 <code>request = threading.local()</code> 后， 所有线程访问的都是<strong>同一个 request 对象实例</strong>， 但该对象内部会为<strong>每个线程维护独立的属性存储空间</strong>。</p><p>因此，不同线程对 <code>request</code> 设置的属性彼此隔离， 互不影响，也不会污染主线程或其他线程的数据。</p></div><details class="hint-container details"><summary>点击查看详情</summary><div class="language-python" data-highlighter="prismjs" data-ext="py"><pre><code class="language-python"><span class="line"><span class="token comment">#!/usr/bin/env python</span></span>
<span class="line"><span class="token comment"># -*-coding:utf-8-*-</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> time</span>
<span class="line"><span class="token keyword">import</span> logging</span>
<span class="line"><span class="token keyword">from</span> threading <span class="token keyword">import</span> Thread<span class="token punctuation">,</span> local<span class="token punctuation">,</span> current_thread<span class="token punctuation">,</span> active_count</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 初始化日志</span></span>
<span class="line">FORMAT <span class="token operator">=</span> <span class="token string">&#39;%(asctime)-15s\t [%(threadName)s, %(thread)d] %(message)s&#39;</span></span>
<span class="line">logging<span class="token punctuation">.</span>basicConfig<span class="token punctuation">(</span><span class="token builtin">format</span><span class="token operator">=</span>FORMAT<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">Request</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">pass</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line">request <span class="token operator">=</span> local<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 初始化线程局部变量</span></span>
<span class="line"><span class="token comment"># request = Request()  # 初始化全局变量</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token keyword">def</span> <span class="token function">test</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    item<span class="token punctuation">.</span>thread_name <span class="token operator">=</span> current_thread<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>name</span>
<span class="line">    time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span></span>
<span class="line">    logging<span class="token punctuation">.</span>warning<span class="token punctuation">(</span><span class="token string">&#39;request.thread_name: {}&#39;</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span>thread_name<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line">threads <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span></span>
<span class="line"><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    t <span class="token operator">=</span> Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>test<span class="token punctuation">,</span> args<span class="token operator">=</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">    t<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    threads<span class="token punctuation">.</span>append<span class="token punctuation">(</span>t<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">for</span> i <span class="token keyword">in</span> threads<span class="token punctuation">:</span></span>
<span class="line">    i<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">logging<span class="token punctuation">.</span>warning<span class="token punctuation">(</span><span class="token string">&quot;End&quot;</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre></div><p>输出结果</p><div class="language-bash" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token number">2026</span>-01-17 <span class="token number">10</span>:07:16,226	 <span class="token punctuation">[</span>Thread-1 <span class="token punctuation">(</span>test<span class="token punctuation">)</span>, <span class="token number">8448</span><span class="token punctuation">]</span> request.thread_name: Thread-1 <span class="token punctuation">(</span>test<span class="token punctuation">)</span></span>
<span class="line"><span class="token number">2026</span>-01-17 <span class="token number">10</span>:07:16,227	 <span class="token punctuation">[</span>Thread-6 <span class="token punctuation">(</span>test<span class="token punctuation">)</span>, <span class="token number">11860</span><span class="token punctuation">]</span> request.thread_name: Thread-6 <span class="token punctuation">(</span>test<span class="token punctuation">)</span></span>
<span class="line"><span class="token number">2026</span>-01-17 <span class="token number">10</span>:07:16,227	 <span class="token punctuation">[</span>Thread-4 <span class="token punctuation">(</span>test<span class="token punctuation">)</span>, <span class="token number">1544</span><span class="token punctuation">]</span> request.thread_name: Thread-4 <span class="token punctuation">(</span>test<span class="token punctuation">)</span></span>
<span class="line"><span class="token number">2026</span>-01-17 <span class="token number">10</span>:07:16,227	 <span class="token punctuation">[</span>Thread-2 <span class="token punctuation">(</span>test<span class="token punctuation">)</span>, <span class="token number">3728</span><span class="token punctuation">]</span> request.thread_name: Thread-2 <span class="token punctuation">(</span>test<span class="token punctuation">)</span></span>
<span class="line"><span class="token number">2026</span>-01-17 <span class="token number">10</span>:07:16,227	 <span class="token punctuation">[</span>Thread-5 <span class="token punctuation">(</span>test<span class="token punctuation">)</span>, <span class="token number">10404</span><span class="token punctuation">]</span> request.thread_name: Thread-5 <span class="token punctuation">(</span>test<span class="token punctuation">)</span></span>
<span class="line"><span class="token number">2026</span>-01-17 <span class="token number">10</span>:07:16,227	 <span class="token punctuation">[</span>Thread-3 <span class="token punctuation">(</span>test<span class="token punctuation">)</span>, <span class="token number">4644</span><span class="token punctuation">]</span> request.thread_name: Thread-3 <span class="token punctuation">(</span>test<span class="token punctuation">)</span></span>
<span class="line"><span class="token number">2026</span>-01-17 <span class="token number">10</span>:07:16,227	 <span class="token punctuation">[</span>MainThread, <span class="token number">4620</span><span class="token punctuation">]</span> End</span>
<span class="line"></span></code></pre></div></details><br><h3 id="线程同步-等待线程完成-join" tabindex="-1"><a class="header-anchor" href="#线程同步-等待线程完成-join"><span>线程同步 - 等待线程完成 join()</span></a></h3><div class="hint-container tip"><p class="hint-container-title">等待线程结束</p><p>如果想让所有线程工作完毕后，主线程再执行代码，此时可以使用<code>线程.join()</code>来等待线程执行完毕</p><ul><li>阻塞线程直到执行完毕</li><li>它还可以设置超时时间，当超过超时时间，不管线程是否执行完毕，都会向下执行</li><li><code>join</code>无视<code>daemon</code>的值</li></ul></div><details class="hint-container details"><summary>将<code>daemon</code>代码改造一下，使代码最后再输出<code>End</code></summary><div class="language-python" data-highlighter="prismjs" data-ext="py"><pre><code class="language-python"><span class="line"><span class="token comment">#!/usr/bin/env python</span></span>
<span class="line"><span class="token comment"># -*-coding:utf-8-*-</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> time</span>
<span class="line"><span class="token keyword">from</span> threading <span class="token keyword">import</span> Thread<span class="token punctuation">,</span> current_thread</span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token keyword">def</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">0.1</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;{}\n&quot;</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>current_thread<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">,</span> end<span class="token operator">=</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 开启10个线程</span></span>
<span class="line">threads <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span></span>
<span class="line"><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    t <span class="token operator">=</span> Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>test<span class="token punctuation">,</span> daemon<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span></span>
<span class="line">    t<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    threads<span class="token punctuation">.</span>append<span class="token punctuation">(</span>t<span class="token punctuation">)</span>  <span class="token comment"># 将线程收集起来</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 等待每个线程执行完毕</span></span>
<span class="line"><span class="token keyword">for</span> thread <span class="token keyword">in</span> threads<span class="token punctuation">:</span></span>
<span class="line">    thread<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;End&quot;</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre></div></details><br><h3 id="线程同步-互斥锁-lock" tabindex="-1"><a class="header-anchor" href="#线程同步-互斥锁-lock"><span>线程同步 - 互斥锁 Lock</span></a></h3><div class="hint-container tip"><p class="hint-container-title">Lock类</p><ul><li><p>Lock：独占锁或叫做互斥锁，同一时间只有一个线程能获取到锁</p></li><li><p>RLock：可重入锁，同一时间只有一个线程能获取到锁，获取锁后可以多次 <code>acquire()</code>，但也需要执行相同次数的 <code>release()</code></p><blockquote><p>注意：这不是读写锁</p></blockquote></li></ul></div><details class="hint-container details"><summary>Lock 方法</summary><p><strong>Lock实例方法</strong></p><table><thead><tr><th>方法</th><th>说明</th></tr></thead><tbody><tr><td>acquire(blocking, timeout)</td><td>尝试获取锁，获取成功返回True，获取失败的话：<br>（1）默认会一直阻塞<br>（2）如果指定blocking为False，直接返回False，表示获取锁失败<br>（3）如果指定了timeout，那么超时以后返回False</td></tr><tr><td>release()</td><td>释放锁</td></tr><tr><td>locked()</td><td>查看是否上锁，已上锁返回True，否则返回False（注意RLOCK实例没有这个方法）</td></tr></tbody></table><p><strong>死锁和RLOCK</strong></p><p>连续两次acquire请求会导致死锁，因为第一次获得锁之后还没有释放时，第二次acquire请求紧接着就到来，</p><p>但是acquire会让程序阻塞，无法执行release()，这就导致锁永远无法释放，就像下面这样</p><div class="language-python" data-highlighter="prismjs" data-ext="py"><pre><code class="language-python"><span class="line">Lock<span class="token punctuation">.</span>acquire<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">Lock<span class="token punctuation">.</span>acquire<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">Lock<span class="token punctuation">.</span>release<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">Lock<span class="token punctuation">.</span>release<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre></div><p>RLock就不存在上面提到的死锁问题，只需要保证有多少次acquire()，就有多少次release()即可</p></details><details class="hint-container details"><summary>Lock 示例</summary><div class="language-python" data-highlighter="prismjs" data-ext="py"><pre><code class="language-python"><span class="line"><span class="token comment">#!/usr/bin/env python</span></span>
<span class="line"><span class="token comment"># -*-coding:utf-8-*-</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token keyword">from</span> threading <span class="token keyword">import</span> Thread<span class="token punctuation">,</span> current_thread<span class="token punctuation">,</span> Lock<span class="token punctuation">,</span> RLock</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 初始化锁</span></span>
<span class="line">lock <span class="token operator">=</span> Lock<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 全局变量</span></span>
<span class="line">data <span class="token operator">=</span> <span class="token number">0</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token keyword">def</span> <span class="token function">add</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">global</span> data</span>
<span class="line">    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1000000</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token comment"># 未加锁</span></span>
<span class="line">        data <span class="token operator">+=</span> n</span>
<span class="line"></span>
<span class="line">        <span class="token comment"># 加锁（方式一）</span></span>
<span class="line">        lock<span class="token punctuation">.</span>acquire<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">        data <span class="token operator">+=</span> n</span>
<span class="line">        lock<span class="token punctuation">.</span>release<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">        <span class="token comment"># 加锁（方式二）</span></span>
<span class="line">        <span class="token comment"># if lock.acquire():</span></span>
<span class="line">        <span class="token comment">#     data += n</span></span>
<span class="line">        <span class="token comment">#     lock.release()</span></span>
<span class="line"></span>
<span class="line">        <span class="token comment"># 加锁（方式三, 推荐）</span></span>
<span class="line">        <span class="token comment"># with lock:</span></span>
<span class="line">        <span class="token comment">#     data += n</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 开启2个线程, 一个线程不断+1，另一个线程不断-1</span></span>
<span class="line">t1 <span class="token operator">=</span> Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>add<span class="token punctuation">,</span> args<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">t2 <span class="token operator">=</span> Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>add<span class="token punctuation">,</span> args<span class="token operator">=</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">t1<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">t2<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">t1<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">t2<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;End&quot;</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre></div><p>输出结果</p><div class="language-bash" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token comment"># 未加锁输出结果：</span></span>
<span class="line"><span class="token comment"># 924375</span></span>
<span class="line"><span class="token comment"># End</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 加锁输出结果</span></span>
<span class="line"><span class="token comment"># 0</span></span>
<span class="line"><span class="token comment"># End</span></span>
<span class="line"></span></code></pre></div></details><br><h3 id="线程同步-事件-event" tabindex="-1"><a class="header-anchor" href="#线程同步-事件-event"><span>线程同步 - 事件 Event</span></a></h3><div class="hint-container tip"><p class="hint-container-title">Lock类</p><p>Event是线程通信间最简单的实现，使用一个变量flag，通过flag的True或False变化来执行不同操作。Event变化会通知到所有线程</p></div><details class="hint-container details"><summary>Event 方法</summary><p><strong>Event 实例方法</strong></p><table><thead><tr><th>方法</th><th>说明</th></tr></thead><tbody><tr><td>set()</td><td>标记为True</td></tr><tr><td>clear()</td><td>标记为False</td></tr><tr><td>is_set()</td><td>新创建的event或使用<code>clear</code>()后为False，当设置<code>set</code>()后返回True</td></tr><tr><td>wait(timeout=None)</td><td>等待，满足以下条件后立即执行：<br>（1）当调用<code>set</code>()后立即执行，此时wait返回值为True<br>（2）当超时后立即执行，此时wait返回值为False<br>默认会一直等待，用不超时</td></tr></tbody></table></details><details class="hint-container details"><summary>点击查看详情</summary><div class="language-python" data-highlighter="prismjs" data-ext="py"><pre><code class="language-python"><span class="line"><span class="token comment">#!/usr/bin/env python</span></span>
<span class="line"><span class="token comment"># -*-coding:utf-8-*-</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> time</span>
<span class="line"><span class="token keyword">import</span> threading</span>
<span class="line"><span class="token keyword">import</span> logging</span>
<span class="line"></span>
<span class="line">FORMAT <span class="token operator">=</span> <span class="token string">&#39;%(asctime)-15s\t [%(threadName)s, %(thread)d] %(message)s&#39;</span></span>
<span class="line">logging<span class="token punctuation">.</span>basicConfig<span class="token punctuation">(</span><span class="token builtin">format</span><span class="token operator">=</span>FORMAT<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token keyword">def</span> <span class="token function">test</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token comment"># 子线程中每隔3秒循环一次，无限循环，除非主线程主动暂停</span></span>
<span class="line">    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token keyword">if</span> event<span class="token punctuation">.</span>wait<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">            logging<span class="token punctuation">.</span>warning<span class="token punctuation">(</span><span class="token string">&quot;主线程通知退出&quot;</span><span class="token punctuation">)</span></span>
<span class="line">            <span class="token keyword">break</span></span>
<span class="line">        logging<span class="token punctuation">.</span>warning<span class="token punctuation">(</span><span class="token string">&quot;等待超时, 默认执行&quot;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 初始化event</span></span>
<span class="line">event <span class="token operator">=</span> threading<span class="token punctuation">.</span>Event<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 开启两个子线程</span></span>
<span class="line">threading<span class="token punctuation">.</span>Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>test<span class="token punctuation">,</span> args<span class="token operator">=</span><span class="token punctuation">(</span>event<span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">threading<span class="token punctuation">.</span>Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>test<span class="token punctuation">,</span> args<span class="token operator">=</span><span class="token punctuation">(</span>event<span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 模拟主线程运行中</span></span>
<span class="line">time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 通知所有子线程退出</span></span>
<span class="line">event<span class="token punctuation">.</span><span class="token builtin">set</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre></div></details><br><h3 id="event应用-延迟器-timer" tabindex="-1"><a class="header-anchor" href="#event应用-延迟器-timer"><span>Event应用 - 延迟器 Timer</span></a></h3><details class="hint-container details"><summary>点击查看详情</summary><div class="language-python" data-highlighter="prismjs" data-ext="py"><pre><code class="language-python"><span class="line"><span class="token comment">#!/usr/bin/env python</span></span>
<span class="line"><span class="token comment"># -*-coding:utf-8-*-</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> logging</span>
<span class="line"><span class="token keyword">from</span> threading <span class="token keyword">import</span> Timer</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 初始化日志</span></span>
<span class="line">FORMAT <span class="token operator">=</span> <span class="token string">&#39;%(asctime)-15s\t [%(threadName)s, %(thread)8d] %(message)s&#39;</span></span>
<span class="line">logging<span class="token punctuation">.</span>basicConfig<span class="token punctuation">(</span><span class="token builtin">format</span><span class="token operator">=</span>FORMAT<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token keyword">def</span> <span class="token function">add</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    ret <span class="token operator">=</span> x <span class="token operator">+</span> y</span>
<span class="line">    logging<span class="token punctuation">.</span>warning<span class="token punctuation">(</span>ret<span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">return</span> ret</span>
<span class="line"></span>
<span class="line"></span>
<span class="line">t <span class="token operator">=</span> Timer<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> add<span class="token punctuation">,</span> args<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 创建一个定时器，5秒后执行add函数</span></span>
<span class="line">t<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 启动线程</span></span>
<span class="line"></span>
<span class="line">logging<span class="token punctuation">.</span>warning<span class="token punctuation">(</span><span class="token string">&quot;延迟器已经启动...&quot;</span><span class="token punctuation">)</span></span>
<span class="line">logging<span class="token punctuation">.</span>warning<span class="token punctuation">(</span><span class="token string">&quot;做一些其他的事...&quot;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 取消线程</span></span>
<span class="line"><span class="token comment">#   此时函数还没有执行，程序退出</span></span>
<span class="line"><span class="token comment">#   如果函数已经运行，此时cancel依然可以正常执行，但是函数已经无法取消</span></span>
<span class="line"><span class="token comment"># t.cancel()</span></span>
<span class="line"></span></code></pre></div></details><br><h3 id="线程同步-阶段屏障-barrier" tabindex="-1"><a class="header-anchor" href="#线程同步-阶段屏障-barrier"><span>线程同步 - 阶段屏障 Barrier</span></a></h3><div class="hint-container tip"><p class="hint-container-title">Barrier 类</p><p>Barrier 用来让一组线程在某个“阶段点”集合，等所有人都到了，再一起继续往下执行。</p></div><details class="hint-container details"><summary>Barrier 方法</summary><p><strong>Barrier 实例化参数</strong></p><p><code>__init__(self, parties, action=None, timeout=None)</code></p><ul><li>parties：必须到齐的线程数</li><li>action：所有线程到齐时，由最后到达的线程执行的回调</li><li>timeout：全局默认超时</li></ul><p><strong>Barrier 实例方法</strong></p><table><thead><tr><th>方法</th><th>说明</th></tr></thead><tbody><tr><td>wait(timeout=None)</td><td>到达屏障并阻塞，直到所有线程到齐<br>返回值：一个整数 <code>0 ~ parties-1</code><br>最后到达的线程返回值通常为 <code>0</code><br>可用来让某个线程执行&quot;领队任务&quot;，比如 最后执行完的，负责合并结果</td></tr><tr><td>reset()</td><td>用于异常恢复或中止本轮同步<br>即让所有正在等待的线程抛 <code>BrokenBarrierError</code>，屏障恢复到初始状态，可重新使用</td></tr><tr><td>abort()</td><td>标记屏障为损坏状态<br>所有 wait 中线程立即抛异常<br>后续任何 wait 也会直接报 <code>BrokenBarrierError</code><br>必须 reset 才能恢复</td></tr><tr><td>parties</td><td>需要到达屏障的线程总数</td></tr><tr><td>n_waiting</td><td>当前正在等待中的线程数</td></tr><tr><td>broken</td><td>屏障是否已损坏</td></tr></tbody></table></details><details class="hint-container details"><summary>Barrier 示例</summary><div class="language-python" data-highlighter="prismjs" data-ext="py"><pre><code class="language-python"><span class="line"><span class="token keyword">import</span> time</span>
<span class="line"><span class="token keyword">import</span> random</span>
<span class="line"><span class="token keyword">from</span> threading <span class="token keyword">import</span> Thread<span class="token punctuation">,</span> Barrier<span class="token punctuation">,</span> current_thread</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 三个工作线程</span></span>
<span class="line">N <span class="token operator">=</span> <span class="token number">3</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 存放每个线程的计算结果</span></span>
<span class="line">results <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token boolean">None</span><span class="token punctuation">]</span> <span class="token operator">*</span> N</span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token keyword">def</span> <span class="token function">merge_results</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token comment"># 这个函数由“最后到达屏障的线程”自动执行</span></span>
<span class="line">    total <span class="token operator">=</span> <span class="token builtin">sum</span><span class="token punctuation">(</span>results<span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;\n&gt;&gt;&gt; 合并结果: </span><span class="token interpolation"><span class="token punctuation">{</span>results<span class="token punctuation">}</span></span><span class="token string"> =&gt; 总和 = </span><span class="token interpolation"><span class="token punctuation">{</span>total<span class="token punctuation">}</span></span><span class="token string">\n&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 设置屏障：3 个线程到齐时执行 merge_results</span></span>
<span class="line">barrier <span class="token operator">=</span> Barrier<span class="token punctuation">(</span>N<span class="token punctuation">,</span> action<span class="token operator">=</span>merge_results<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token keyword">def</span> <span class="token function">worker</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token comment"># ===== 第一阶段 =====</span></span>
<span class="line">    t <span class="token operator">=</span> random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span></span>
<span class="line">    time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span>t<span class="token punctuation">)</span></span>
<span class="line">    results<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> t <span class="token operator">*</span> <span class="token number">10</span></span>
<span class="line">    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;</span><span class="token interpolation"><span class="token punctuation">{</span>current_thread<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>name<span class="token punctuation">}</span></span><span class="token string"> 第一阶段完成，结果=</span><span class="token interpolation"><span class="token punctuation">{</span>results<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment"># 等所有线程完成第一阶段</span></span>
<span class="line">    barrier<span class="token punctuation">.</span>wait<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment"># ===== 第二阶段 =====</span></span>
<span class="line">    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;</span><span class="token interpolation"><span class="token punctuation">{</span>current_thread<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>name<span class="token punctuation">}</span></span><span class="token string"> 进入第二阶段继续工作&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line">    time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment"># 再次同步第二阶段结束</span></span>
<span class="line">    barrier<span class="token punctuation">.</span>wait<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">if</span> barrier<span class="token punctuation">.</span>wait<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;\n&gt;&gt;&gt; 第二阶段所有线程结束，任务完成 &lt;&lt;&lt;&quot;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 启动线程</span></span>
<span class="line"><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>N<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>worker<span class="token punctuation">,</span> args<span class="token operator">=</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre></div></details><br><h3 id="线程同步-信号量-semaphore" tabindex="-1"><a class="header-anchor" href="#线程同步-信号量-semaphore"><span>线程同步 - 信号量 Semaphore</span></a></h3><div class="hint-container tip"><p class="hint-container-title">Semaphore类</p><p>信号量本质上就是一个&quot;可用资源配额计数器&quot;，常用于限制并发数量，threading.Semaphore(3) 代表：</p><ul><li>初始值 = 系统允许同时使用该资源的最大配额为3</li><li>acquire(blocking=True, timeout=None) = 领取一个配额，计数器-1，若没有足够配额（&gt;=1）则默认进入等待状态</li><li>release() = 归还一个配额，计数器+1，.release() 可以直接调用，即使你从没 acquire()</li></ul><p>普通 Semaphore 允许多次 release，允许 超出初始值，BoundedSemaphore 会直接抛异常，防止错误释放</p></div><details class="hint-container details"><summary>限制并发数量</summary><div class="language-python" data-highlighter="prismjs" data-ext="py"><pre><code class="language-python"><span class="line"><span class="token keyword">import</span> time</span>
<span class="line"><span class="token keyword">import</span> random</span>
<span class="line"><span class="token keyword">import</span> threading</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 最多允许 3 个并发请求</span></span>
<span class="line">sem <span class="token operator">=</span> threading<span class="token punctuation">.</span>BoundedSemaphore<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token keyword">def</span> <span class="token function">send_request</span><span class="token punctuation">(</span>req_id<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">with</span> sem<span class="token punctuation">:</span>  <span class="token comment"># acquire() -&gt; release() 自动管理</span></span>
<span class="line">        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;[</span><span class="token interpolation"><span class="token punctuation">{</span>req_id<span class="token punctuation">}</span></span><span class="token string">] 请求开始&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">        <span class="token comment"># 模拟网络延迟</span></span>
<span class="line">        time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span>random<span class="token punctuation">.</span>uniform<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;[</span><span class="token interpolation"><span class="token punctuation">{</span>req_id<span class="token punctuation">}</span></span><span class="token string">] 请求完成&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 模拟 10 个请求</span></span>
<span class="line">threads <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span></span>
<span class="line"><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    t <span class="token operator">=</span> threading<span class="token punctuation">.</span>Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>send_request<span class="token punctuation">,</span> args<span class="token operator">=</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">    t<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    threads<span class="token punctuation">.</span>append<span class="token punctuation">(</span>t<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">for</span> t <span class="token keyword">in</span> threads<span class="token punctuation">:</span></span>
<span class="line">    t<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;全部请求处理完毕&quot;</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre></div></details><br><h3 id="线程同步-条件变量-condition" tabindex="-1"><a class="header-anchor" href="#线程同步-条件变量-condition"><span>线程同步 - 条件变量 Condition</span></a></h3><div class="hint-container tip"><p class="hint-container-title">Condition - 条件变量</p><p><strong>设计思想</strong></p><p>让一个线程等某种条件成立，然后被另一个线程通知</p><br><p><strong>解释</strong></p><p>Condition 内部维护一把锁（默认 RLock），线程在持锁状态下可以调用 <code>notify()</code> 或 <code>notify_all()</code> 唤醒一个或多个等待线程。</p><p>调用 <code>wait()</code> 时，线程会释放锁并进入等待状态；</p><p>当被其他线程唤醒时，会重新获取锁并继续执行；</p><p>唤醒哪个线程是不可控的（可以认为是随机的）。</p><br><p><strong>注意事项</strong></p><ul><li>Condition 是底层工具，功能强大但容易写错，能用 <code>Queue</code> 或 <code>Event</code> 就不要用 Condition</li><li>Condition 不存储任何状态，所有状态变量（如 <code>turn</code>、buffer）必须在持锁期间访问和修改</li><li>先改变共享状态，再唤醒其他线程，避免丢信号或唤醒线程看到错误状态</li></ul></div><details class="hint-container details"><summary>Condition 实例方法</summary><table><thead><tr><th>方法</th><th>说明</th></tr></thead><tbody><tr><td>acquire(blocking, timeout)</td><td>与RLock实例的acquire方法一致</td></tr><tr><td>release()</td><td>与RLock实例的release方法一致</td></tr><tr><td>notify(n=1)</td><td>唤醒一个或多个线程</td></tr><tr><td>notify_all()</td><td>唤醒所有线程</td></tr><tr><td>wait(timeout=None)</td><td>进入等待状态（这会释放锁），直到被唤醒或超时（又会重新获取锁），被唤醒返回True，超时返回False<br>如果未获得锁就使用wait，则报错<code>RuntimeError: cannot wait on un-acquired lock</code></td></tr><tr><td>wait_for(predicate, timeout=None)</td><td>wait_for是更灵活的一种wait方式，predicate需要指定一个可调用对象，<br>（1）当predicate()返回True，则继续往下执行<br>（2）当predicate()返回False，则和wait行为一致了<br>（3）timeout参数含义不变，若超时以后还会调用predicate一次</td></tr></tbody></table></details><details class="hint-container details"><summary>Condition 举例：线程 A 打印数字 <code>1,2,3,...</code>，线程 B 打印字母 <code>A,B,C,...</code>，两个线程必须 <strong>交替打印</strong></summary><div class="language-python" data-highlighter="prismjs" data-ext="py"><pre><code class="language-python"><span class="line"><span class="token keyword">from</span> threading <span class="token keyword">import</span> Thread<span class="token punctuation">,</span> Condition</span>
<span class="line"></span>
<span class="line">cond <span class="token operator">=</span> Condition<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">turn <span class="token operator">=</span> <span class="token string">&#39;num&#39;</span>  <span class="token comment"># 轮到谁打印：&#39;num&#39; 或 &#39;char&#39;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">def</span> <span class="token function">print_numbers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">global</span> turn</span>
<span class="line">    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token keyword">with</span> cond<span class="token punctuation">:</span></span>
<span class="line">            <span class="token keyword">while</span> turn <span class="token operator">!=</span> <span class="token string">&#39;num&#39;</span><span class="token punctuation">:</span>  <span class="token comment"># 条件不满足就等</span></span>
<span class="line">                cond<span class="token punctuation">.</span>wait<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">            <span class="token keyword">print</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> end<span class="token operator">=</span><span class="token string">&#39; &#39;</span><span class="token punctuation">)</span></span>
<span class="line">            turn <span class="token operator">=</span> <span class="token string">&#39;char&#39;</span>        <span class="token comment"># 改变状态</span></span>
<span class="line">            cond<span class="token punctuation">.</span>notify<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token comment"># 通知其他线程</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">def</span> <span class="token function">print_chars</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">global</span> turn</span>
<span class="line">    <span class="token keyword">for</span> c <span class="token keyword">in</span> <span class="token string">&#39;ABCDE&#39;</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token keyword">with</span> cond<span class="token punctuation">:</span></span>
<span class="line">            <span class="token keyword">while</span> turn <span class="token operator">!=</span> <span class="token string">&#39;char&#39;</span><span class="token punctuation">:</span></span>
<span class="line">                cond<span class="token punctuation">.</span>wait<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">            <span class="token keyword">print</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> end<span class="token operator">=</span><span class="token string">&#39; &#39;</span><span class="token punctuation">)</span></span>
<span class="line">            turn <span class="token operator">=</span> <span class="token string">&#39;num&#39;</span></span>
<span class="line">            cond<span class="token punctuation">.</span>notify<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 创建线程</span></span>
<span class="line">t1 <span class="token operator">=</span> Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>print_numbers<span class="token punctuation">)</span></span>
<span class="line">t2 <span class="token operator">=</span> Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>print_chars<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">t1<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">t2<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">t1<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">t2<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;\nDone&quot;</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre></div><p>输出结果</p><div class="language-bash" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token number">1</span> A <span class="token number">2</span> B <span class="token number">3</span> C <span class="token number">4</span> D <span class="token number">5</span> E </span>
<span class="line">Done</span>
<span class="line"></span></code></pre></div></details><br><h3 id="线程同步总结" tabindex="-1"><a class="header-anchor" href="#线程同步总结"><span>线程同步总结</span></a></h3><table><thead><tr><th>场景</th><th>需要的同步方式</th><th>说明</th></tr></thead><tbody><tr><td>主线程等待子线程完成</td><td><code>join()</code></td><td><strong>生命周期同步</strong>，等待线程结束</td></tr><tr><td>多线程修改共享变量</td><td><code>Lock / RLock</code></td><td><strong>互斥访问</strong>，防止数据竞争</td></tr><tr><td>限制并发访问数据库 / 网络 / GPU</td><td><code>Semaphore / BoundedSemaphore</code></td><td><strong>资源配额控制</strong>，限制同时访问数量</td></tr><tr><td>定时任务 / 启动信号 / 停止信号</td><td><code>Event</code></td><td><strong>状态通知</strong>，广播式唤醒</td></tr><tr><td>并行计算分阶段处理</td><td><code>Barrier</code></td><td><strong>阶段对齐</strong>，等待 n 个线程到达同一阶段点，再一起放行</td></tr><tr><td>生产者 — 消费者（手写队列）</td><td><code>Condition</code></td><td><strong>条件等待 + 精准唤醒</strong></td></tr><tr><td>生产者 — 消费者（标准写法）</td><td><code>Queue</code></td><td><strong>内置完成同步的安全队列</strong></td></tr><tr><td>线程池任务调度</td><td><code>Queue + Event</code></td><td><strong>任务流 + 停止通知</strong></td></tr><tr><td>多线程读多写少场景</td><td><code>RWLock</code> (第三方实现)</td><td><strong>读写分离锁</strong></td></tr><tr><td>多进程并发同步</td><td><code>multiprocessing</code> 同名同步对象</td><td><strong>跨进程同步</strong></td></tr></tbody></table><br><h3 id="任务调度框架" tabindex="-1"><a class="header-anchor" href="#任务调度框架"><span>任务调度框架</span></a></h3><div class="hint-container tip"><p class="hint-container-title">含义</p><p><code>concurrent.futures</code> = Python 的标准线程池 / 进程池任务调度框架</p><p><strong>它帮你解决：</strong></p><ul><li>线程创建与回收</li><li>任务队列</li><li>结果收集</li><li>异常传递</li><li>超时管理</li></ul><p><strong>核心对象</strong></p><ul><li>ThreadPoolExecutor：线程池</li><li>ProcessPoolExecutor：进程池</li></ul></div><details class="hint-container details"><summary>ThreadPoolExecutor 实例方法</summary><p>ThreadPoolExecutor 构造参数</p><table><thead><tr><th>参数</th><th>说明</th></tr></thead><tbody><tr><td>max_workers</td><td>指定线程池的最大线程数，默认为CPU核数的5倍</td></tr><tr><td>thread_name_prefix</td><td>指定线程池中线程的名称前缀</td></tr></tbody></table><p>ThreadPoolExecutor 实例方法</p><table><thead><tr><th>方法</th><th>说明</th></tr></thead><tbody><tr><td>submit(fn, *args, **kwargs)</td><td>提交任务，线程池会分配一个线程迟总任务，返回一个Future实例，如果池已经满了，还可以继续提交</td></tr><tr><td>shutdown(wait=True)</td><td>清理池，池中的线程/进程全部杀掉，同时不再接受新提交的任务，<br>如果继续提交会报错<code>RuntimeError: cannot schedule new futures after shutdown</code></td></tr></tbody></table><p>Future 实例方法</p><table><thead><tr><th>方法</th><th>说明</th></tr></thead><tbody><tr><td>done()</td><td>如果调用成功执行或取消成功，那么返回True，否则返回False</td></tr><tr><td>cancelled()</td><td>如果复用被成功的取消，那么返回True</td></tr><tr><td>running()</td><td>如果正在运行且不能被取消，那么返回True</td></tr><tr><td>cancel()</td><td>尝试取消调用，如果已经执行且不能取消返回False，否则返回True</td></tr><tr><td>result(timeout=None)</td><td>取返回的结果，timeout为None,一直等待返回，超时抛出concurrent.futures.TimeoutError异常</td></tr><tr><td>exception(timeout=None)</td><td>取返回的异常，timeout为None,一直等待返回,超时抛出concurrent.futures.TimeoutError异常</td></tr></tbody></table></details><details class="hint-container details"><summary>线程池演示</summary><div class="language-python" data-highlighter="prismjs" data-ext="py"><pre><code class="language-python"><span class="line"><span class="token comment">#!/usr/bin/env python</span></span>
<span class="line"><span class="token comment"># -*-coding:utf-8-*-</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> time</span>
<span class="line"><span class="token keyword">import</span> logging</span>
<span class="line"><span class="token keyword">from</span> concurrent<span class="token punctuation">.</span>futures <span class="token keyword">import</span> ThreadPoolExecutor</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 初始化日志</span></span>
<span class="line">FORMAT <span class="token operator">=</span> <span class="token string">&#39;%(asctime)-15s\t [%(threadName)s, %(thread)d] %(message)s&#39;</span></span>
<span class="line">logging<span class="token punctuation">.</span>basicConfig<span class="token punctuation">(</span><span class="token builtin">format</span><span class="token operator">=</span>FORMAT<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token keyword">def</span> <span class="token function">add</span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    logging<span class="token punctuation">.</span>warning<span class="token punctuation">(</span><span class="token string">&quot;Function add run&quot;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">    time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>  <span class="token comment"># 模拟函数龟速运行</span></span>
<span class="line">    <span class="token keyword">if</span> x <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">:</span>  <span class="token comment"># 模拟意外报错</span></span>
<span class="line">        <span class="token keyword">raise</span> Exception<span class="token punctuation">(</span><span class="token string">&quot;Error: Parameter x in add function is not allowed to be 2&quot;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">    ret <span class="token operator">=</span> x <span class="token operator">+</span> y  <span class="token comment"># 正确计算结果</span></span>
<span class="line"></span>
<span class="line">    logging<span class="token punctuation">.</span>warning<span class="token punctuation">(</span><span class="token string">&quot;Function add finished&quot;</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">return</span> ret</span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token keyword">with</span> ThreadPoolExecutor<span class="token punctuation">(</span>max_workers<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">,</span> thread_name_prefix<span class="token operator">=</span><span class="token string">&quot;Thread-Add&quot;</span><span class="token punctuation">)</span> <span class="token keyword">as</span> executor<span class="token punctuation">:</span></span>
<span class="line">    <span class="token comment"># 提交多个任务,并将任务收集起来</span></span>
<span class="line">    <span class="token comment"># 当任务数 &gt; 工作线程时，还可以继续提交任务，submit函数并不会阻塞，而是会将任务放到队列中</span></span>
<span class="line">    <span class="token comment"># 查看源码发现使用的是queue.SimpleQueue()，简单队列，先进先出，队列大小没有限制</span></span>
<span class="line">    tasks <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span></span>
<span class="line">    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        future <span class="token operator">=</span> executor<span class="token punctuation">.</span>submit<span class="token punctuation">(</span>add<span class="token punctuation">,</span> i<span class="token punctuation">,</span> i<span class="token punctuation">)</span></span>
<span class="line">        tasks<span class="token punctuation">.</span>append<span class="token punctuation">(</span>future<span class="token punctuation">)</span></span>
<span class="line">    <span class="token comment"># logging.warning(&quot;全部任务已提交&quot;)</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment"># 获取每个任务执行结果，并将结果收集起来</span></span>
<span class="line">    results <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span></span>
<span class="line">    <span class="token keyword">for</span> j <span class="token keyword">in</span> tasks<span class="token punctuation">:</span></span>
<span class="line">        <span class="token keyword">if</span> j<span class="token punctuation">.</span>exception<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>  <span class="token comment"># 线程未崩溃(报错)</span></span>
<span class="line">            results<span class="token punctuation">.</span>append<span class="token punctuation">(</span>j<span class="token punctuation">.</span>result<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">else</span><span class="token punctuation">:</span></span>
<span class="line">            results<span class="token punctuation">.</span>append<span class="token punctuation">(</span>j<span class="token punctuation">.</span>exception<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 线程崩溃信息</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment"># 依次输出每个任务的结果</span></span>
<span class="line">    <span class="token keyword">for</span> result <span class="token keyword">in</span> results<span class="token punctuation">:</span></span>
<span class="line">        logging<span class="token punctuation">.</span>warning<span class="token punctuation">(</span><span class="token string">&quot;add result: {}&quot;</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre></div></details><details class="hint-container details"><summary>进程池演示</summary></details><br><h2 id="五、协程" tabindex="-1"><a class="header-anchor" href="#五、协程"><span>五、协程</span></a></h2><h3 id="同步和异步" tabindex="-1"><a class="header-anchor" href="#同步和异步"><span>同步和异步</span></a></h3><p>对于一个函数来说，同步指的是函数返回值就是我们想要的最终结果，异步则指不会直接拿到最终结果。</p><p>那么异步函数如何拿到最终结果，可以有如下几种方法</p><ul><li>给异步函数传入一个回调函数，在回调函数中我们可以拿到最终结果</li><li>异步函数返回给我们一个中间结果，比如说是一个对象，通过对象的xx方法可以拿到结果</li></ul><p><span style="color:red;font-weight:bold;">总结：同步/异步就看是否能直接拿到最终结果，需要注意的是与代码运行时长是没有任何关系的</span></p><br><h3 id="阻塞和非阻塞" tabindex="-1"><a class="header-anchor" href="#阻塞和非阻塞"><span>阻塞和非阻塞</span></a></h3><p>阻塞和非阻塞直接讲并不容易讲清楚，所以这里结合队列做一下说明</p><p>阻塞队列</p><ul><li>入队阻塞：当队列满了之后再入队，则会进行阻塞，直到满足以下情况： <ul><li>若设置了超时时间，入队超时，阻塞结束</li><li>当其他线程消费队列数据后导致队列不满，本线程入队成功，阻塞结束</li></ul></li><li>出队阻塞：当队列为空时再出队，则会进行阻塞，直到满足以下情况： <ul><li>若设置了超时时间，出队超时，阻塞结束</li><li>当其他线程入队数据后，本线程出队成功，阻塞结束</li></ul></li></ul><p>非阻塞队列</p><ul><li>入队不会阻塞，如何保证不会阻塞： <ul><li>不考虑内存限制的话，最简单的方法就是不设置队列大小，一直可以放入数据</li><li>如果考虑内存限制的话，可以使用双端队列，当队列满了之后再放入数据会先把最开始的数据删掉，然后就能正常放入</li></ul></li><li>出队不会阻塞，如何保证不会阻塞： <ul><li>当队列为空时返回<code>None</code>或者报错即可</li></ul></li></ul><p>阻塞队列-入队阻塞演示</p><details class="hint-container details"><summary>点击查看完整代码</summary><div class="language-python" data-highlighter="prismjs" data-ext="py"><pre><code class="language-python"><span class="line"><span class="token comment">#!/usr/bin/env python</span></span>
<span class="line"><span class="token comment"># -*-coding:utf-8-*-</span></span>
<span class="line"></span>
<span class="line"><span class="token triple-quoted-string string">&#39;&#39;&#39;阻塞队列-入队阻塞演示&#39;&#39;&#39;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> logging</span>
<span class="line"><span class="token keyword">import</span> random</span>
<span class="line"><span class="token keyword">import</span> time</span>
<span class="line"><span class="token keyword">from</span> queue <span class="token keyword">import</span> Queue</span>
<span class="line"><span class="token keyword">from</span> threading <span class="token keyword">import</span> Thread</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 初始化日志</span></span>
<span class="line">FORMAT <span class="token operator">=</span> <span class="token string">&#39;%(asctime)-15s\t [%(threadName)s, %(thread)d] %(message)s&#39;</span></span>
<span class="line">logging<span class="token punctuation">.</span>basicConfig<span class="token punctuation">(</span><span class="token builtin">format</span><span class="token operator">=</span>FORMAT<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 初始化队列，队列大小为3</span></span>
<span class="line">q <span class="token operator">=</span> Queue<span class="token punctuation">(</span>maxsize<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 生产者</span></span>
<span class="line"><span class="token keyword">def</span> <span class="token function">producer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token triple-quoted-string string">&#39;&#39;&#39;入队阻塞：向队列中放入3个数据时，队列就已经满了，此时再进行put就会进行阻塞</span>
<span class="line">    &#39;&#39;&#39;</span></span>
<span class="line">    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        item <span class="token operator">=</span> random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">99</span><span class="token punctuation">)</span></span>
<span class="line">        q<span class="token punctuation">.</span>put<span class="token punctuation">(</span>item<span class="token punctuation">)</span></span>
<span class="line">        logging<span class="token punctuation">.</span>warning<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;队列放入数据: </span><span class="token interpolation"><span class="token punctuation">{</span>item<span class="token punctuation">}</span></span><span class="token string"> | 当前队列大小: </span><span class="token interpolation"><span class="token punctuation">{</span>q<span class="token punctuation">.</span>qsize<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string"> | 队列是否已满: </span><span class="token interpolation"><span class="token punctuation">{</span>q<span class="token punctuation">.</span>full<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 消费者</span></span>
<span class="line"><span class="token keyword">def</span> <span class="token function">consumer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token triple-quoted-string string">&#39;&#39;&#39;消费队列中的一个数据&#39;&#39;&#39;</span></span>
<span class="line">    time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>  <span class="token comment"># 为了更好的显示队列阻塞，所以让消费者先暂停3秒钟再消费</span></span>
<span class="line">    item <span class="token operator">=</span> q<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    logging<span class="token punctuation">.</span>warning<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;队列消费数据: </span><span class="token interpolation"><span class="token punctuation">{</span>item<span class="token punctuation">}</span></span><span class="token string"> | 当前队列大小: </span><span class="token interpolation"><span class="token punctuation">{</span>q<span class="token punctuation">.</span>qsize<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string"> | 队列是否已满: </span><span class="token interpolation"><span class="token punctuation">{</span>q<span class="token punctuation">.</span>full<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line">Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>producer<span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">&quot;Producer&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>consumer<span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">&quot;Consumer&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre></div></details><p>非阻塞队列-入队非阻塞演示</p><details class="hint-container details"><summary>点击查看完整代码</summary><div class="language-python" data-highlighter="prismjs" data-ext="py"><pre><code class="language-python"><span class="line"><span class="token comment">#!/usr/bin/env python</span></span>
<span class="line"><span class="token comment"># -*-coding:utf-8-*-</span></span>
<span class="line"></span>
<span class="line"><span class="token triple-quoted-string string">&#39;&#39;&#39;非阻塞队列-入队非阻塞演示&#39;&#39;&#39;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> logging</span>
<span class="line"><span class="token keyword">import</span> random</span>
<span class="line"><span class="token keyword">import</span> time</span>
<span class="line"><span class="token keyword">from</span> collections <span class="token keyword">import</span> deque</span>
<span class="line"><span class="token keyword">from</span> threading <span class="token keyword">import</span> Thread</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 初始化日志</span></span>
<span class="line">FORMAT <span class="token operator">=</span> <span class="token string">&#39;%(asctime)-15s\t [%(threadName)s, %(thread)d] %(message)s&#39;</span></span>
<span class="line">logging<span class="token punctuation">.</span>basicConfig<span class="token punctuation">(</span><span class="token builtin">format</span><span class="token operator">=</span>FORMAT<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 初始化双端队列，队列大小为3</span></span>
<span class="line">q <span class="token operator">=</span> deque<span class="token punctuation">(</span>maxlen<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 生产者</span></span>
<span class="line"><span class="token keyword">def</span> <span class="token function">producer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token triple-quoted-string string">&#39;&#39;&#39;入队非阻塞：向队列中放入3个数据时，队列就已经满了，此时再进行put就会删除之前放的数据，给新数据腾位置</span>
<span class="line">    &#39;&#39;&#39;</span></span>
<span class="line">    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        item <span class="token operator">=</span> random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">99</span><span class="token punctuation">)</span></span>
<span class="line">        q<span class="token punctuation">.</span>append<span class="token punctuation">(</span>item<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">        msg <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f&quot;队列放入数据: </span><span class="token interpolation"><span class="token punctuation">{</span>item<span class="token punctuation">}</span></span><span class="token string"> | 当前队列大小: </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">len</span><span class="token punctuation">(</span>q<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string"> | 队列是否已满: </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">str</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>q<span class="token punctuation">)</span> <span class="token operator">==</span> q<span class="token punctuation">.</span>maxlen<span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token format-spec">&lt;5</span><span class="token punctuation">}</span></span><span class="token string"> | 队列数据: </span><span class="token interpolation"><span class="token punctuation">{</span>q<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span></span>
<span class="line">        logging<span class="token punctuation">.</span>warning<span class="token punctuation">(</span>msg<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 消费者</span></span>
<span class="line"><span class="token keyword">def</span> <span class="token function">consumer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token triple-quoted-string string">&#39;&#39;&#39;消费队列中的一个数据&#39;&#39;&#39;</span></span>
<span class="line">    time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>  <span class="token comment"># 为了更好的显示队列非阻塞，所以让消费者先暂停3秒钟再消费</span></span>
<span class="line">    item <span class="token operator">=</span> q<span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">    msg <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f&quot;队列消费数据: </span><span class="token interpolation"><span class="token punctuation">{</span>item<span class="token punctuation">}</span></span><span class="token string"> | 当前队列大小: </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">len</span><span class="token punctuation">(</span>q<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string"> | 队列是否已满: </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">str</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>q<span class="token punctuation">)</span> <span class="token operator">==</span> q<span class="token punctuation">.</span>maxlen<span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token format-spec">&lt;5</span><span class="token punctuation">}</span></span><span class="token string"> | 队列数据: </span><span class="token interpolation"><span class="token punctuation">{</span>q<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span></span>
<span class="line">    logging<span class="token punctuation">.</span>warning<span class="token punctuation">(</span>msg<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line">Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>producer<span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">&quot;Producer&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>consumer<span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">&quot;Consumer&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre></div></details><p><span style="color:red;font-weight:bold;">总结：阻塞和非阻塞是指是否能直接能立即返回，需要注意的是与是否能直接拿到最终结果无关</span></p><br><h3 id="io" tabindex="-1"><a class="header-anchor" href="#io"><span>IO</span></a></h3><p>上面所说的同步/异步/阻塞/非阻塞都是概念性的，需要与具体的某个东西结合起来才符合我们的实际情况，比如阻塞队列，而与这些概念关系最密切的当属<code>IO</code>操作。</p><p>IO说简单点就是输入和输出(Input/Output)，往深入说就太太太复杂了，可以参考一下经典的三种IO模型：<code>select</code>、<code>poll</code>、<code>epoll</code></p><p>我们来列举常见的一些IO操作</p><ul><li>磁盘IO：读写文件</li><li>网络IO：发送/接收网络请求</li><li>与USB设备、显示器、键盘、鼠标等交互产生的IO，比如<code>print(&quot;hello&quot;)</code>就会涉及到IO操作</li></ul><p>IO操作类型</p><table><thead><tr><th>类型</th><th>说明</th></tr></thead><tbody><tr><td>同步阻塞IO</td><td>这是我们写代码最常用的方式，这种方式最符合开发者的思考逻辑，但是效率不高<br>比如使用<code>open</code>函数读写文件，使用第三方库<code>requests</code>发送网络请求等</td></tr><tr><td>同步非阻塞IO</td><td>一般不用，不在讨论范围内</td></tr><tr><td>异步阻塞IO</td><td>一般不用，不在讨论范围内</td></tr><tr><td>异步非阻塞IO</td><td>我们将要学习的协程，就是用来实现异步非阻塞IO，相比同步阻塞IO，代码会难写一些，但是效率更高</td></tr></tbody></table><h3 id="协程概念" tabindex="-1"><a class="header-anchor" href="#协程概念"><span>协程概念</span></a></h3><h3 id="协程基本使用" tabindex="-1"><a class="header-anchor" href="#协程基本使用"><span>协程基本使用</span></a></h3><p>官方文档：<a href="https://docs.python.org/zh-cn/3.9/library/asyncio.html" target="_blank" rel="noopener noreferrer">https://docs.python.org/zh-cn/3.9/library/asyncio.html</a></p><h4 id="定义协程函数" tabindex="-1"><a class="header-anchor" href="#定义协程函数"><span>定义协程函数</span></a></h4><p>使用<code>async</code>关键字定义的函数便是一个协程函数</p><h4 id="运行协程函数" tabindex="-1"><a class="header-anchor" href="#运行协程函数"><span>运行协程函数</span></a></h4><p>直接调用协程函数，返回的叫做协程对象</p><p>协程对象需要借助外力启动，才能真正执行函数代码，此时有如下几种方法</p><ul><li>在协程函数外部，使用<code>asyncio.run(协程对象)</code>，这个是协程执行最高入口点</li><li>在协程函数内部，可以使用几下几种方法运行新的协程： <ul><li>使用<code>await 协程对象</code></li><li>使用<code>await asyncio.create_task(协程对象)</code>并发运行一个或多个协程</li></ul></li></ul><blockquote><p>await是一个关键字，详细内容参考：可等待对象</p></blockquote><p>协程函数举例</p><div class="language-python" data-highlighter="prismjs" data-ext="py"><pre><code class="language-python"><span class="line"><span class="token comment">#!/usr/bin/env python</span></span>
<span class="line"><span class="token comment"># -*-coding:utf-8-*-</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> logging</span>
<span class="line"><span class="token keyword">import</span> asyncio</span>
<span class="line"><span class="token keyword">import</span> time</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 初始化日志</span></span>
<span class="line">FORMAT <span class="token operator">=</span> <span class="token string">&#39;%(asctime)-15s\t [%(threadName)s, %(thread)d] %(message)s&#39;</span></span>
<span class="line">logging<span class="token punctuation">.</span>basicConfig<span class="token punctuation">(</span><span class="token builtin">format</span><span class="token operator">=</span>FORMAT<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment"># 使用async关键字定义协程函数</span></span>
<span class="line">    logging<span class="token punctuation">.</span>warning<span class="token punctuation">(</span><span class="token string">&quot;hello&quot;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment"># 运行协程函数-方式2, 使用await</span></span>
<span class="line">    <span class="token comment"># 挂起当前协程，执行asyncio.sleep(3), 并等待它执行完成, asyncio.sleep与普通的time.sleep不一样，他是协程函数</span></span>
<span class="line">    <span class="token comment"># 这里需要执行3秒钟</span></span>
<span class="line">    <span class="token keyword">await</span> asyncio<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment"># 运行协程函数-方式3，并发执行多个协程</span></span>
<span class="line">    <span class="token comment"># 这里总共需要执行5秒钟，注意并不是10秒钟</span></span>
<span class="line">    task1 <span class="token operator">=</span> asyncio<span class="token punctuation">.</span>create_task<span class="token punctuation">(</span>asyncio<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">    task2 <span class="token operator">=</span> asyncio<span class="token punctuation">.</span>create_task<span class="token punctuation">(</span>asyncio<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">await</span> task1</span>
<span class="line">    <span class="token keyword">await</span> task2</span>
<span class="line"></span>
<span class="line">    logging<span class="token punctuation">.</span>warning<span class="token punctuation">(</span><span class="token string">&quot;wrold&quot;</span><span class="token punctuation">)</span>  <span class="token comment"># 继续执行当前协程</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment"># main函数总共需要执行3+5=8秒钟</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 运行协程函数-方式1, 这里是最高入口点</span></span>
<span class="line">asyncio<span class="token punctuation">.</span>run<span class="token punctuation">(</span>main<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre></div><h4 id="并发运行协程函数" tabindex="-1"><a class="header-anchor" href="#并发运行协程函数"><span>并发运行协程函数</span></a></h4><div class="language-python" data-highlighter="prismjs" data-ext="py"><pre><code class="language-python"><span class="line"><span class="token comment">#!/usr/bin/env python</span></span>
<span class="line"><span class="token comment"># -*-coding:utf-8-*-</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> logging</span>
<span class="line"><span class="token keyword">import</span> asyncio</span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 初始化日志</span></span>
<span class="line">FORMAT <span class="token operator">=</span> <span class="token string">&#39;%(asctime)-15s\t [%(threadName)s, %(thread)d] %(message)s&#39;</span></span>
<span class="line">logging<span class="token punctuation">.</span>basicConfig<span class="token punctuation">(</span><span class="token builtin">format</span><span class="token operator">=</span>FORMAT<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">show_message</span><span class="token punctuation">(</span>message<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">await</span> asyncio<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span></span>
<span class="line">    logging<span class="token punctuation">.</span>warning<span class="token punctuation">(</span>message<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">show_message2</span><span class="token punctuation">(</span>message<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">await</span> asyncio<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">return</span> message</span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token comment"># 并发运行多个协程1 - create_task - 输出结果是无序的</span></span>
<span class="line">    logging<span class="token punctuation">.</span>warning<span class="token punctuation">(</span><span class="token string">&quot;并发运行多个协程1 - create_task - 输出结果是无序的&quot;</span><span class="token punctuation">)</span></span>
<span class="line">    tasks <span class="token operator">=</span> <span class="token punctuation">[</span>asyncio<span class="token punctuation">.</span>create_task<span class="token punctuation">(</span>show_message<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;create_task_</span><span class="token interpolation"><span class="token punctuation">{</span>i<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">]</span></span>
<span class="line">    <span class="token keyword">for</span> task <span class="token keyword">in</span> tasks<span class="token punctuation">:</span></span>
<span class="line">        <span class="token keyword">await</span> task</span>
<span class="line">    logging<span class="token punctuation">.</span>warning<span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment"># 并发运行多个协程1 - create_task - 改写函数，仅让输出结果有序</span></span>
<span class="line">    logging<span class="token punctuation">.</span>warning<span class="token punctuation">(</span><span class="token string">&quot;并发运行多个协程1 - create_task - 改写函数，仅让输出结果有序&quot;</span><span class="token punctuation">)</span></span>
<span class="line">    tasks <span class="token operator">=</span> <span class="token punctuation">[</span>asyncio<span class="token punctuation">.</span>create_task<span class="token punctuation">(</span>show_message2<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;create_task_</span><span class="token interpolation"><span class="token punctuation">{</span>i<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">]</span></span>
<span class="line">    <span class="token keyword">for</span> task <span class="token keyword">in</span> tasks<span class="token punctuation">:</span></span>
<span class="line">        ret <span class="token operator">=</span> <span class="token keyword">await</span> task</span>
<span class="line">        logging<span class="token punctuation">.</span>warning<span class="token punctuation">(</span>ret<span class="token punctuation">)</span></span>
<span class="line">    logging<span class="token punctuation">.</span>warning<span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment"># 并发运行多个协程2 - gather - 输出结果是有顺序的</span></span>
<span class="line">    logging<span class="token punctuation">.</span>warning<span class="token punctuation">(</span><span class="token string">&quot;并发运行多个协程2 - gather - 输出结果是有顺序的&quot;</span><span class="token punctuation">)</span></span>
<span class="line">    tasks <span class="token operator">=</span> <span class="token punctuation">[</span>show_message2<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;create_task_</span><span class="token interpolation"><span class="token punctuation">{</span>i<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">]</span></span>
<span class="line">    rets <span class="token operator">=</span> <span class="token keyword">await</span> asyncio<span class="token punctuation">.</span>gather<span class="token punctuation">(</span><span class="token operator">*</span>tasks<span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">for</span> i <span class="token keyword">in</span> rets<span class="token punctuation">:</span></span>
<span class="line">        logging<span class="token punctuation">.</span>warning<span class="token punctuation">(</span>i<span class="token punctuation">)</span></span>
<span class="line">    logging<span class="token punctuation">.</span>warning<span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment"># 其他并发运行多个协程方法</span></span>
<span class="line">    <span class="token comment">#   * await asyncio.wait()</span></span>
<span class="line">    <span class="token comment">#   * asyncio.as_completed()</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 运行协程函数-方式1, 这里是最高入口点</span></span>
<span class="line">asyncio<span class="token punctuation">.</span>run<span class="token punctuation">(</span>main<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre></div><h4 id="协程函数的威力-测试网络io" tabindex="-1"><a class="header-anchor" href="#协程函数的威力-测试网络io"><span>协程函数的威力 - 测试网络IO</span></a></h4><p>协程属于异步但其内部编写的代码可能是同步阻塞的，下面以<code>requests</code>和<code>aiohttp</code>来做一个演示</p><p>安装第三方库</p><div class="language-bash" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line">pip <span class="token function">install</span> requests aiohttp</span>
<span class="line"></span></code></pre></div><p>代码演示</p><details class="hint-container details"><summary>点击查看完整代码</summary><div class="language-python" data-highlighter="prismjs" data-ext="py"><pre><code class="language-python"><span class="line"><span class="token comment">#!/usr/bin/env python</span></span>
<span class="line"><span class="token comment"># -*-coding:utf-8-*-</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> logging</span>
<span class="line"><span class="token keyword">import</span> asyncio</span>
<span class="line"><span class="token keyword">import</span> time</span>
<span class="line"><span class="token keyword">import</span> aiohttp</span>
<span class="line"><span class="token keyword">import</span> requests</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 初始化日志</span></span>
<span class="line">FORMAT <span class="token operator">=</span> <span class="token string">&#39;%(asctime)-15s\t [%(threadName)s, %(thread)d] %(message)s&#39;</span></span>
<span class="line">logging<span class="token punctuation">.</span>basicConfig<span class="token punctuation">(</span><span class="token builtin">format</span><span class="token operator">=</span>FORMAT<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">request_sync</span><span class="token punctuation">(</span>url<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">,</span> number<span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    start <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment"># 统计HTTP请求状态码结果</span></span>
<span class="line">    Counter <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token string">&quot;Success&quot;</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token string">&quot;Failed&quot;</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment"># 发送网络请求</span></span>
<span class="line">    <span class="token keyword">with</span> requests<span class="token punctuation">.</span>session<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> session<span class="token punctuation">:</span></span>
<span class="line">        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>number<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">            r <span class="token operator">=</span> session<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">)</span></span>
<span class="line">            <span class="token keyword">if</span> r<span class="token punctuation">.</span>status_code <span class="token operator">==</span> <span class="token number">200</span><span class="token punctuation">:</span></span>
<span class="line">                Counter<span class="token punctuation">[</span><span class="token string">&quot;Success&quot;</span><span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token number">1</span></span>
<span class="line">            <span class="token keyword">else</span><span class="token punctuation">:</span></span>
<span class="line">                Counter<span class="token punctuation">[</span><span class="token string">&quot;Failed&quot;</span><span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token number">1</span></span>
<span class="line"></span>
<span class="line">    logging<span class="token punctuation">.</span>warning<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;Function [ request_sync   ] running time: </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">int</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> start<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string"> seconds | </span><span class="token interpolation"><span class="token punctuation">{</span>Counter<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">request_async</span><span class="token punctuation">(</span>url<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">,</span> number<span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    start <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment"># 统计HTTP请求状态码结果</span></span>
<span class="line">    Counter <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token string">&quot;Success&quot;</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token string">&quot;Failed&quot;</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">wrapper</span><span class="token punctuation">(</span>session<span class="token punctuation">:</span> aiohttp<span class="token punctuation">.</span>ClientSession<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token keyword">async</span> <span class="token keyword">with</span> session<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">)</span> <span class="token keyword">as</span> r<span class="token punctuation">:</span></span>
<span class="line">            <span class="token keyword">if</span> r<span class="token punctuation">.</span>status <span class="token operator">==</span> <span class="token number">200</span><span class="token punctuation">:</span></span>
<span class="line">                Counter<span class="token punctuation">[</span><span class="token string">&quot;Success&quot;</span><span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token number">1</span></span>
<span class="line">            <span class="token keyword">else</span><span class="token punctuation">:</span></span>
<span class="line">                Counter<span class="token punctuation">[</span><span class="token string">&quot;Failed&quot;</span><span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token number">1</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment"># 发送网络请求</span></span>
<span class="line">    <span class="token keyword">async</span> <span class="token keyword">with</span> aiohttp<span class="token punctuation">.</span>ClientSession<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> session<span class="token punctuation">:</span></span>
<span class="line">        tasks <span class="token operator">=</span> <span class="token punctuation">[</span>wrapper<span class="token punctuation">(</span>session<span class="token punctuation">)</span> <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>number<span class="token punctuation">)</span><span class="token punctuation">]</span></span>
<span class="line">        <span class="token keyword">await</span> asyncio<span class="token punctuation">.</span>gather<span class="token punctuation">(</span><span class="token operator">*</span>tasks<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">    logging<span class="token punctuation">.</span>warning<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;Function [ request_async  ] running time: </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">int</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> start<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string"> seconds | </span><span class="token interpolation"><span class="token punctuation">{</span>Counter<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line">asyncio<span class="token punctuation">.</span>run<span class="token punctuation">(</span>request_sync<span class="token punctuation">(</span><span class="token string">&quot;https://www.qq.com&quot;</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">asyncio<span class="token punctuation">.</span>run<span class="token punctuation">(</span>request_async<span class="token punctuation">(</span><span class="token string">&quot;https://www.qq.com&quot;</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre></div></details><p>输出结果</p><div class="language-bash" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token number">2022</span>-04-04 <span class="token number">11</span>:28:37,125	 <span class="token punctuation">[</span>MainThread, <span class="token number">247048</span><span class="token punctuation">]</span> Function <span class="token punctuation">[</span> request_sync   <span class="token punctuation">]</span> running time: <span class="token number">53</span> seconds <span class="token operator">|</span> <span class="token punctuation">{</span><span class="token string">&#39;Success&#39;</span><span class="token builtin class-name">:</span> <span class="token number">1000</span>, <span class="token string">&#39;Failed&#39;</span><span class="token builtin class-name">:</span> <span class="token number">0</span><span class="token punctuation">}</span></span>
<span class="line"><span class="token number">2022</span>-04-04 <span class="token number">11</span>:29:01,859	 <span class="token punctuation">[</span>MainThread, <span class="token number">247048</span><span class="token punctuation">]</span> Function <span class="token punctuation">[</span> request_async  <span class="token punctuation">]</span> running time: <span class="token number">24</span> seconds <span class="token operator">|</span> <span class="token punctuation">{</span><span class="token string">&#39;Success&#39;</span><span class="token builtin class-name">:</span> <span class="token number">1000</span>, <span class="token string">&#39;Failed&#39;</span><span class="token builtin class-name">:</span> <span class="token number">0</span><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre></div><h4 id="协程函数并不是万能的-测试磁盘io" tabindex="-1"><a class="header-anchor" href="#协程函数并不是万能的-测试磁盘io"><span>协程函数并不是万能的 - 测试磁盘IO</span></a></h4><p>这次我们来读写文件测试，使用非阻塞函数<code>aiofiles</code>来代替<code>open</code></p><p>安装aiofiles</p><div class="language-bash" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line">pip <span class="token function">install</span> aiofiles</span>
<span class="line"></span></code></pre></div><p>代码演示</p><details class="hint-container details"><summary>点击查看完整代码</summary><div class="language-python" data-highlighter="prismjs" data-ext="py"><pre><code class="language-python"><span class="line"><span class="token comment">#!/usr/bin/env python</span></span>
<span class="line"><span class="token comment"># -*-coding:utf-8-*-</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> logging</span>
<span class="line"><span class="token keyword">import</span> random</span>
<span class="line"><span class="token keyword">import</span> asyncio</span>
<span class="line"><span class="token keyword">import</span> time</span>
<span class="line"><span class="token keyword">import</span> aiofiles</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 初始化日志</span></span>
<span class="line">FORMAT <span class="token operator">=</span> <span class="token string">&#39;%(asctime)-15s\t [%(threadName)s, %(thread)d] %(message)s&#39;</span></span>
<span class="line">logging<span class="token punctuation">.</span>basicConfig<span class="token punctuation">(</span><span class="token builtin">format</span><span class="token operator">=</span>FORMAT<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">write_sync</span><span class="token punctuation">(</span>file_prefix<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">,</span> number<span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">,</span> lines<span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token triple-quoted-string string">&#39;&#39;&#39;</span>
<span class="line">    :param file_prefix: 文件名前缀</span>
<span class="line">    :param number: 文件个数</span>
<span class="line">    :param lines: 每个文件行数</span>
<span class="line">    :return: None</span>
<span class="line">    &#39;&#39;&#39;</span></span>
<span class="line"></span>
<span class="line">    start <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment"># 定义文件列表</span></span>
<span class="line">    file_names <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string-interpolation"><span class="token string">f&quot;</span><span class="token interpolation"><span class="token punctuation">{</span>file_prefix<span class="token punctuation">}</span></span><span class="token string">-</span><span class="token interpolation"><span class="token punctuation">{</span>i<span class="token punctuation">}</span></span><span class="token string">.txt&quot;</span></span> <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>number<span class="token punctuation">)</span><span class="token punctuation">]</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment"># 定义文件内容</span></span>
<span class="line">    content <span class="token operator">=</span> <span class="token string">&quot;&quot;</span></span>
<span class="line">    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>lines<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        line <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>random<span class="token punctuation">.</span>sample<span class="token punctuation">(</span><span class="token string">&#39;zyxwvutsrqponmlkjihgfedcba&#39;</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;\n&quot;</span></span>
<span class="line">        content <span class="token operator">+=</span> line</span>
<span class="line"></span>
<span class="line">    <span class="token comment"># 生成文件-阻塞</span></span>
<span class="line">    <span class="token keyword">for</span> <span class="token builtin">file</span> <span class="token keyword">in</span> file_names<span class="token punctuation">:</span></span>
<span class="line">        <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">,</span> <span class="token string">&quot;w+&quot;</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span></span>
<span class="line">            f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>content<span class="token punctuation">)</span></span>
<span class="line">    logging<span class="token punctuation">.</span>warning<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;Function [ write_sync  ] running time: </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">int</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> start<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string"> seconds&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">write_async</span><span class="token punctuation">(</span>file_prefix<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">,</span> number<span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">,</span> lines<span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token triple-quoted-string string">&#39;&#39;&#39;</span>
<span class="line">    :param file_prefix: 文件名前缀</span>
<span class="line">    :param number: 文件个数</span>
<span class="line">    :param lines: 每个文件行数</span>
<span class="line">    :return: None</span>
<span class="line">    &#39;&#39;&#39;</span></span>
<span class="line"></span>
<span class="line">    start <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment"># 定义文件列表</span></span>
<span class="line">    file_names <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string-interpolation"><span class="token string">f&quot;</span><span class="token interpolation"><span class="token punctuation">{</span>file_prefix<span class="token punctuation">}</span></span><span class="token string">-</span><span class="token interpolation"><span class="token punctuation">{</span>i<span class="token punctuation">}</span></span><span class="token string">.txt&quot;</span></span> <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>number<span class="token punctuation">)</span><span class="token punctuation">]</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment"># 定义文件内容</span></span>
<span class="line">    content <span class="token operator">=</span> <span class="token string">&quot;&quot;</span></span>
<span class="line">    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>lines<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        line <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>random<span class="token punctuation">.</span>sample<span class="token punctuation">(</span><span class="token string">&#39;zyxwvutsrqponmlkjihgfedcba&#39;</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;\n&quot;</span></span>
<span class="line">        content <span class="token operator">+=</span> line</span>
<span class="line"></span>
<span class="line">    <span class="token comment"># 生成文件函数-非阻塞</span></span>
<span class="line">    <span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">wrapper</span><span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token keyword">async</span> <span class="token keyword">with</span> aiofiles<span class="token punctuation">.</span><span class="token builtin">open</span><span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">,</span> mode<span class="token operator">=</span><span class="token string">&#39;w+&#39;</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span></span>
<span class="line">            <span class="token keyword">await</span> f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>content<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment"># 生成文件-非阻塞</span></span>
<span class="line">    tasks <span class="token operator">=</span> <span class="token punctuation">[</span>wrapper<span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">)</span> <span class="token keyword">for</span> <span class="token builtin">file</span> <span class="token keyword">in</span> file_names<span class="token punctuation">]</span></span>
<span class="line">    <span class="token keyword">await</span> asyncio<span class="token punctuation">.</span>gather<span class="token punctuation">(</span><span class="token operator">*</span>tasks<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">    logging<span class="token punctuation">.</span>warning<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;Function [ write_async ] running time: </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">int</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> start<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string"> seconds&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 生成30个文件，每个文件包含800万行</span></span>
<span class="line">asyncio<span class="token punctuation">.</span>run<span class="token punctuation">(</span>write_sync<span class="token punctuation">(</span><span class="token string">&quot;sync&quot;</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">8000000</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">asyncio<span class="token punctuation">.</span>run<span class="token punctuation">(</span>write_async<span class="token punctuation">(</span><span class="token string">&quot;async&quot;</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">8000000</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre></div></details><p>输出结果</p><div class="language-bash" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token number">2022</span>-04-04 <span class="token number">11</span>:30:32,599	 <span class="token punctuation">[</span>MainThread, <span class="token number">241668</span><span class="token punctuation">]</span> Function <span class="token punctuation">[</span> write_sync  <span class="token punctuation">]</span> running time: <span class="token number">312</span> seconds</span>
<span class="line"><span class="token number">2022</span>-04-04 <span class="token number">11</span>:35:17,728	 <span class="token punctuation">[</span>MainThread, <span class="token number">241668</span><span class="token punctuation">]</span> Function <span class="token punctuation">[</span> write_async <span class="token punctuation">]</span> running time: <span class="token number">285</span> seconds</span>
<span class="line"></span></code></pre></div><p>可以看到确实有效果，但是提速并不明显</p><p>尤其是当我们减少文件数量、减少文件内容的时候，两种方式运行效果几乎一致，甚至有可能出现协程会更慢的情况</p><p>这是为什么呢？可能是因为网络IO和磁盘IO的不同导致的。</p><h4 id="协程与同步阻塞混合编程" tabindex="-1"><a class="header-anchor" href="#协程与同步阻塞混合编程"><span>协程与同步阻塞混合编程</span></a></h4><p>注入事件循环中的执行器（默认为线程池），后面去讲到</p><p>代码演示</p><details class="hint-container details"><summary>点击查看完整代码</summary><div class="language-python" data-highlighter="prismjs" data-ext="py"><pre><code class="language-python"><span class="line"><span class="token comment">#!/usr/bin/env python</span></span>
<span class="line"><span class="token comment"># -*- coding:utf-8 -*-</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> asyncio</span>
<span class="line"><span class="token keyword">import</span> logging</span>
<span class="line"><span class="token keyword">import</span> time</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> requests</span>
<span class="line"><span class="token keyword">import</span> urllib3</span>
<span class="line"><span class="token keyword">from</span> functools <span class="token keyword">import</span> partial</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 不验证HTTPS证书后会弹出警告，此代码用于关闭警告</span></span>
<span class="line">urllib3<span class="token punctuation">.</span>disable_warnings<span class="token punctuation">(</span>urllib3<span class="token punctuation">.</span>exceptions<span class="token punctuation">.</span>InsecureRequestWarning<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 初始化日志</span></span>
<span class="line">FORMAT <span class="token operator">=</span> <span class="token string">&#39;%(asctime)-15s\t [%(threadName)s, %(thread)d] %(message)s&#39;</span></span>
<span class="line">logging<span class="token punctuation">.</span>basicConfig<span class="token punctuation">(</span><span class="token builtin">format</span><span class="token operator">=</span>FORMAT<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">download_sync</span><span class="token punctuation">(</span>urls<span class="token punctuation">:</span> <span class="token builtin">list</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    name <span class="token operator">=</span> <span class="token string">&quot;download_sync&quot;</span></span>
<span class="line"></span>
<span class="line">    start <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">for</span> url <span class="token keyword">in</span> urls<span class="token punctuation">:</span></span>
<span class="line">        <span class="token comment"># 发送HTTP请求</span></span>
<span class="line">        response <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">,</span> verify<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">        <span class="token comment"># 写入磁盘</span></span>
<span class="line">        file_name <span class="token operator">=</span> url<span class="token punctuation">.</span>rsplit<span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span></span>
<span class="line">        <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>file_name<span class="token punctuation">,</span> mode<span class="token operator">=</span><span class="token string">&quot;wb&quot;</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span></span>
<span class="line">            f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>response<span class="token punctuation">.</span>content<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">    logging<span class="token punctuation">.</span>warning<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;</span><span class="token interpolation"><span class="token punctuation">{</span>name<span class="token punctuation">:</span><span class="token format-spec">14</span><span class="token punctuation">}</span></span><span class="token string"> 下载完成 | 用时: </span><span class="token interpolation"><span class="token punctuation">{</span>time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> start<span class="token punctuation">}</span></span><span class="token string">秒&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 协程和requests库混合编程</span></span>
<span class="line"><span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">download_async</span><span class="token punctuation">(</span>urls<span class="token punctuation">:</span> <span class="token builtin">list</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    name <span class="token operator">=</span> <span class="token string">&quot;download_async&quot;</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">wrapper</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token comment"># 获取事件循环</span></span>
<span class="line">        loop <span class="token operator">=</span> asyncio<span class="token punctuation">.</span>get_event_loop<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">        </span>
<span class="line">        <span class="token comment"># run_in_executor中并不能给执行的函数传递字典参数，所以这里用get2来代替requests.get</span></span>
<span class="line">        get2 <span class="token operator">=</span> partial<span class="token punctuation">(</span>requests<span class="token punctuation">.</span>get<span class="token punctuation">,</span> verify<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span></span>
<span class="line">        </span>
<span class="line">        <span class="token comment"># 执行器执行同步阻塞函数</span></span>
<span class="line">        future <span class="token operator">=</span> loop<span class="token punctuation">.</span>run_in_executor<span class="token punctuation">(</span><span class="token boolean">None</span><span class="token punctuation">,</span> get2<span class="token punctuation">,</span> url<span class="token punctuation">)</span></span>
<span class="line">        response <span class="token operator">=</span> <span class="token keyword">await</span> future</span>
<span class="line"></span>
<span class="line">        <span class="token comment"># 写入磁盘</span></span>
<span class="line">        file_name <span class="token operator">=</span> url<span class="token punctuation">.</span>rsplit<span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span></span>
<span class="line">        <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>file_name<span class="token punctuation">,</span> mode<span class="token operator">=</span><span class="token string">&quot;wb&quot;</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span></span>
<span class="line">            f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>response<span class="token punctuation">.</span>content<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">    start <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    tasks <span class="token operator">=</span> <span class="token punctuation">[</span>wrapper<span class="token punctuation">(</span>url<span class="token punctuation">)</span> <span class="token keyword">for</span> url <span class="token keyword">in</span> urls<span class="token punctuation">]</span></span>
<span class="line">    <span class="token keyword">await</span> asyncio<span class="token punctuation">.</span>wait<span class="token punctuation">(</span>tasks<span class="token punctuation">)</span></span>
<span class="line">    logging<span class="token punctuation">.</span>warning<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;</span><span class="token interpolation"><span class="token punctuation">{</span>name<span class="token punctuation">:</span><span class="token format-spec">14</span><span class="token punctuation">}</span></span><span class="token string"> 下载完成 | 用时: </span><span class="token interpolation"><span class="token punctuation">{</span>time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> start<span class="token punctuation">}</span></span><span class="token string">秒&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">&quot;__main__&quot;</span><span class="token punctuation">:</span></span>
<span class="line">    urls <span class="token operator">=</span> <span class="token punctuation">[</span></span>
<span class="line">        <span class="token string">&quot;https://img-pre.ivsky.com/img/tupian/pre/202108/09/fengniao.jpg&quot;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token string">&quot;https://img-pre.ivsky.com/img/tupian/pre/202108/09/fengniao-003.jpg&quot;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token string">&quot;https://img-pre.ivsky.com/img/tupian/pre/202108/09/fengniao-004.jpg&quot;</span></span>
<span class="line">    <span class="token punctuation">]</span></span>
<span class="line"></span>
<span class="line">    asyncio<span class="token punctuation">.</span>run<span class="token punctuation">(</span>download_sync<span class="token punctuation">(</span>urls<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">    asyncio<span class="token punctuation">.</span>run<span class="token punctuation">(</span>download_async<span class="token punctuation">(</span>urls<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre></div></details><p>输出结果</p><div class="language-bash" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token number">2022</span>-04-04 <span class="token number">12</span>:23:50,691	 <span class="token punctuation">[</span>MainThread, <span class="token number">252956</span><span class="token punctuation">]</span> download_sync  下载完成 <span class="token operator">|</span> 用时: <span class="token number">0.9531307220458984</span>秒</span>
<span class="line"><span class="token number">2022</span>-04-04 <span class="token number">12</span>:23:51,035	 <span class="token punctuation">[</span>MainThread, <span class="token number">252956</span><span class="token punctuation">]</span> download_async 下载完成 <span class="token operator">|</span> 用时: <span class="token number">0.3437678813934326</span>秒</span>
<span class="line"></span></code></pre></div><p>可以看到效果提升还是比较明显</p><h3 id="协程深入理解" tabindex="-1"><a class="header-anchor" href="#协程深入理解"><span>协程深入理解</span></a></h3><h4 id="早期的协程执行最高入口" tabindex="-1"><a class="header-anchor" href="#早期的协程执行最高入口"><span>早期的协程执行最高入口</span></a></h4><div class="language-python" data-highlighter="prismjs" data-ext="py"><pre><code class="language-python"><span class="line"><span class="token comment">#!/usr/bin/env python</span></span>
<span class="line"><span class="token comment"># -*- coding:utf-8 -*-</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> asyncio</span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;hello world&quot;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 运行协程函数</span></span>
<span class="line"><span class="token comment"># asyncio.run(main())</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 也可以使用低级API来运行协程函数</span></span>
<span class="line">loop <span class="token operator">=</span> asyncio<span class="token punctuation">.</span>get_event_loop<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 获取事件循环对象</span></span>
<span class="line">loop<span class="token punctuation">.</span>run_until_complete<span class="token punctuation">(</span>main<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 将协程对象放入事件循环</span></span>
<span class="line"></span></code></pre></div><h4 id="事件循环" tabindex="-1"><a class="header-anchor" href="#事件循环"><span>事件循环</span></a></h4><p>官方文档：<a href="https://docs.python.org/zh-cn/3.9/library/asyncio-eventloop.html" target="_blank" rel="noopener noreferrer">https://docs.python.org/zh-cn/3.9/library/asyncio-eventloop.html</a></p><p>看一下官网的描述：</p><blockquote><p>事件循环是每个 asyncio 应用的核心。 事件循环会运行异步任务和回调，执行网络 IO 操作，以及运行子进程。</p></blockquote><p>简单来说，事件循环就是一个大循环，用来调度协程对象，可以让我们更精细的控制协程调度</p><p><strong>创建和运行</strong></p><p>事件循环相关方法</p><table><thead><tr><th>方法</th><th>说明</th></tr></thead><tbody><tr><td>asyncio.new_event_loop()</td><td>创建一个事件循环</td></tr><tr><td>asyncio.set_event_loop(loop)</td><td>将loop设置为当前OS线程的当前事件循环</td></tr><tr><td><strong>asyncio.get_event_loop()</strong></td><td>获取当前事件循环，如果当前没有运行则创建一个新的事件循环</td></tr><tr><td><strong>asyncio.get_running_loop()</strong></td><td>返回当前OS线程中正在运行的事件循环，如果没有运行则引发RuntimeError<br>（1）此函数只能由协程或回调来调用。<br>（2）官方更推荐使用这个而不是<code>get_event_loop</code></td></tr><tr><td>asyncio.get_event_loop_policy()</td><td>获取当前事件循环策略</td></tr><tr><td><strong>asyncio.set_event_loop_policy(policy)</strong></td><td>设置当前事件循环策略，比如使用<code>uvloop</code>提供的事件循环策略来加快协程执行速度</td></tr></tbody></table><p>事件循环代码演示</p><details class="hint-container details"><summary>点击查看完整代码</summary><div class="language-python" data-highlighter="prismjs" data-ext="py"><pre><code class="language-python"><span class="line"><span class="token comment">#!/usr/bin/env python</span></span>
<span class="line"><span class="token comment"># -*- coding:utf-8 -*-</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> asyncio</span>
<span class="line"><span class="token keyword">import</span> logging</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 初始化日志</span></span>
<span class="line">FORMAT <span class="token operator">=</span> <span class="token string">&#39;%(asctime)-15s\t [%(threadName)s, %(thread)d] %(message)s&#39;</span></span>
<span class="line">logging<span class="token punctuation">.</span>basicConfig<span class="token punctuation">(</span><span class="token builtin">format</span><span class="token operator">=</span>FORMAT<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 因为事件循环尚未运行，所以这里会报错 RuntimeError: no running event loop</span></span>
<span class="line"><span class="token comment"># loop = asyncio.get_running_loop()</span></span>
<span class="line"><span class="token comment"># print(loop)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 看看事件循环到底是个啥?</span></span>
<span class="line">loop1 <span class="token operator">=</span> asyncio<span class="token punctuation">.</span>get_event_loop<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">logging<span class="token punctuation">.</span>warning<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;事件循环1: </span><span class="token interpolation"><span class="token punctuation">{</span>loop1<span class="token punctuation">}</span></span><span class="token string"> | 内存地址: </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">id</span><span class="token punctuation">(</span>loop1<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 创建一个新的事件循环对象，并设置为当前事件循环</span></span>
<span class="line">loop2 <span class="token operator">=</span> asyncio<span class="token punctuation">.</span>new_event_loop<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">asyncio<span class="token punctuation">.</span>set_event_loop<span class="token punctuation">(</span>loop2<span class="token punctuation">)</span></span>
<span class="line">logging<span class="token punctuation">.</span>warning<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;事件循环2: </span><span class="token interpolation"><span class="token punctuation">{</span>asyncio<span class="token punctuation">.</span>get_event_loop<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string"> | 内存地址: </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">id</span><span class="token punctuation">(</span>asyncio<span class="token punctuation">.</span>get_event_loop<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">show_current_loop</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    current_loop <span class="token operator">=</span> asyncio<span class="token punctuation">.</span>get_running_loop<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    logging<span class="token punctuation">.</span>warning<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;</span><span class="token interpolation"><span class="token punctuation">{</span>message<span class="token punctuation">}</span></span><span class="token string">: </span><span class="token interpolation"><span class="token punctuation">{</span>current_loop<span class="token punctuation">}</span></span><span class="token string"> | 内存地址：</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">id</span><span class="token punctuation">(</span>current_loop<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 运行事件循环</span></span>
<span class="line">loop1<span class="token punctuation">.</span>run_until_complete<span class="token punctuation">(</span>show_current_loop<span class="token punctuation">(</span><span class="token string">&quot;在事件循环1中运行&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">loop2<span class="token punctuation">.</span>run_until_complete<span class="token punctuation">(</span>show_current_loop<span class="token punctuation">(</span><span class="token string">&quot;在事件循环1中运行&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre></div></details><p>输出结果</p><div class="language-bash" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token number">2022</span>-04-04 <span class="token number">16</span>:09:19,252	 <span class="token punctuation">[</span>MainThread, <span class="token number">261928</span><span class="token punctuation">]</span> 事件循环1: <span class="token operator">&lt;</span>_WindowsSelectorEventLoop <span class="token assign-left variable">running</span><span class="token operator">=</span>False <span class="token assign-left variable">closed</span><span class="token operator">=</span>False <span class="token assign-left variable">debug</span><span class="token operator">=</span>False<span class="token operator">&gt;</span> <span class="token operator">|</span> 内存地址: <span class="token number">1926186899208</span></span>
<span class="line"><span class="token number">2022</span>-04-04 <span class="token number">16</span>:09:19,252	 <span class="token punctuation">[</span>MainThread, <span class="token number">261928</span><span class="token punctuation">]</span> 事件循环2: <span class="token operator">&lt;</span>_WindowsSelectorEventLoop <span class="token assign-left variable">running</span><span class="token operator">=</span>False <span class="token assign-left variable">closed</span><span class="token operator">=</span>False <span class="token assign-left variable">debug</span><span class="token operator">=</span>False<span class="token operator">&gt;</span> <span class="token operator">|</span> 内存地址: <span class="token number">1926189799880</span></span>
<span class="line"><span class="token number">2022</span>-04-04 <span class="token number">16</span>:09:19,252	 <span class="token punctuation">[</span>MainThread, <span class="token number">261928</span><span class="token punctuation">]</span> 在事件循环1中运行: <span class="token operator">&lt;</span>_WindowsSelectorEventLoop <span class="token assign-left variable">running</span><span class="token operator">=</span>True <span class="token assign-left variable">closed</span><span class="token operator">=</span>False <span class="token assign-left variable">debug</span><span class="token operator">=</span>False<span class="token operator">&gt;</span> <span class="token operator">|</span> 内存地址：1926186899208</span>
<span class="line"><span class="token number">2022</span>-04-04 <span class="token number">16</span>:09:19,252	 <span class="token punctuation">[</span>MainThread, <span class="token number">261928</span><span class="token punctuation">]</span> 在事件循环1中运行: <span class="token operator">&lt;</span>_WindowsSelectorEventLoop <span class="token assign-left variable">running</span><span class="token operator">=</span>True <span class="token assign-left variable">closed</span><span class="token operator">=</span>False <span class="token assign-left variable">debug</span><span class="token operator">=</span>False<span class="token operator">&gt;</span> <span class="token operator">|</span> 内存地址：1926189799880</span>
<span class="line"></span></code></pre></div><blockquote><p>（1）第一行输出：running=False 说明虽然创建了事件循环，但并未运行</p><p>（2）第二行输出：我们又创建了一个事件循环，两个对比一下，发现内存地址并不相同</p><p>（3）第三行输出：我们编写的异步代码在第1个事件循环中运行：</p><p>​ ① running已变成了True，说明事件循环运行起来了</p><p>​ ② 内存地址与事件循环1相同</p><p>（4）第四行输出：我们编写的异步代码在第2个事件循环中运行</p></blockquote><p><span style="color:red;font-weight:bold;">总结：可以有多个事件循环；协程函数需要在一个具体的事件循环中执行</span></p><br><p><strong>事件循环实例方法</strong></p><table><thead><tr><th>方法</th><th>说明</th></tr></thead><tbody><tr><td>loop.run_until_complete(future)</td><td>运行直到 future ( Future 的实例 )被完成；也可以传入协程对象，会自动处理<br>（1）如果当前事件循环loop处于停止状态(stop)，会自动启动<br>（2）如果当前事件循环loop处于关闭状态(close)，则会抛出异常<code>RuntimeError: Event loop is closed</code></td></tr><tr><td>loop.run_forever()</td><td>运行事件循环直到 stop() 被调用</td></tr><tr><td>loop.stop()</td><td>停止事件循环</td></tr><tr><td>loop.is_running()</td><td>事件循环是否正在运行</td></tr><tr><td>loop.close()</td><td>关闭事件循环，当这个函数被调用的时候，循环必须处于非运行状态</td></tr><tr><td>loop.is_closed()</td><td>事件循环是否已经被关闭</td></tr><tr><td>loop.run_in_executor(executor, func, *args)</td><td>在指定的执行器中调用func,返回Future对象；执行器可以为：<br>（1）None,使用默认执行器，线程池<br>（2）concurrent.futures.ThreadPoolExecutor()对象，线程池<br>（3）concurrent.futures.ProcessPoolExecutor()对象，进程池<br>如果要给函数func传递字典参数，则可以使用标准库<code>functools.partial</code>来对函数进行一层包装</td></tr></tbody></table><h4 id="可等待对象" tabindex="-1"><a class="header-anchor" href="#可等待对象"><span>可等待对象</span></a></h4><p>文档：<a href="https://docs.python.org/zh-cn/3.9/library/asyncio-task.html#awaitables" target="_blank" rel="noopener noreferrer">https://docs.python.org/zh-cn/3.9/library/asyncio-task.html#awaitables</a></p><p>如果一个对象可以在 <a href="https://docs.python.org/zh-cn/3.9/reference/expressions.html#await" target="_blank" rel="noopener noreferrer"><code>await</code></a> 语句中使用，那么它就是 <strong>可等待</strong> 对象。许多 asyncio API 都被设计为接受可等待对象。</p><p>可等待对象有几下几种类型:</p><ul><li>协程</li><li>Task</li><li>Future</li><li>拥有<code>__await__</code>方法的对象</li></ul><h4 id="task对象" tabindex="-1"><a class="header-anchor" href="#task对象"><span>Task对象</span></a></h4><p>文档：<a href="https://docs.python.org/zh-cn/3.9/library/asyncio-task.html#task-object" target="_blank" rel="noopener noreferrer">https://docs.python.org/zh-cn/3.9/library/asyncio-task.html#task-object</a></p><p>Task说明</p><ul><li><p>Task对象是对协程对象的一层包装，该协程会被<strong>自动调度执行</strong></p><p>Task创建完后会被<strong>自动调度执行</strong>，所以如果在事件循环运行之前创建Task，会报错<code>RuntimeError: no running event loop</code></p></li><li><p>Task对象是线程不安全的</p></li><li><p>Task是Future的子类</p></li></ul><p>创建Task实例的方法</p><ul><li>高级API ：<code>asyncio.create_task(协程对象, *, name=None)</code>（推荐使用）</li><li>低级API ：<code>loop.create_task(协程对象, *, name=None)</code></li><li>低级API：<code>asyncio.ensure_future(obj, *, loop=None)</code></li></ul><h4 id="future对象" tabindex="-1"><a class="header-anchor" href="#future对象"><span>Future对象</span></a></h4><p>文档：<a href="https://docs.python.org/zh-cn/3.9/library/asyncio-future.html#asyncio.Future" target="_blank" rel="noopener noreferrer">https://docs.python.org/zh-cn/3.9/library/asyncio-future.html#asyncio.Future</a></p><p>Future说明</p><ul><li>Future表示异步操作的 <strong>最终结果</strong>，是一种特殊的<strong>低层级</strong> 可等待对象，通常情况下<strong>没有必要</strong>在应用层级的代码中创建 Future 对象</li><li>Future对象是线程不安全的</li></ul><p>Future简单示例</p><div class="language-python" data-highlighter="prismjs" data-ext="py"><pre><code class="language-python"><span class="line"><span class="token comment">#!/usr/bin/env python</span></span>
<span class="line"><span class="token comment"># -*- coding:utf-8 -*-</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> asyncio</span>
<span class="line"><span class="token keyword">import</span> logging</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 初始化日志</span></span>
<span class="line">FORMAT <span class="token operator">=</span> <span class="token string">&#39;%(asctime)-15s\t [%(threadName)s, %(thread)d] %(message)s&#39;</span></span>
<span class="line">logging<span class="token punctuation">.</span>basicConfig<span class="token punctuation">(</span><span class="token builtin">format</span><span class="token operator">=</span>FORMAT<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">display</span><span class="token punctuation">(</span>future<span class="token punctuation">:</span> asyncio<span class="token punctuation">.</span>Future<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    future<span class="token punctuation">.</span>set_result<span class="token punctuation">(</span><span class="token string">&quot;Hello World&quot;</span><span class="token punctuation">)</span>  <span class="token comment"># 设置future返回值</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    loop <span class="token operator">=</span> asyncio<span class="token punctuation">.</span>get_running_loop<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 得到当前事件循环</span></span>
<span class="line">    future <span class="token operator">=</span> loop<span class="token punctuation">.</span>create_future<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 在当前事件循环中创建一个Future对象</span></span>
<span class="line">    <span class="token keyword">await</span> loop<span class="token punctuation">.</span>create_task<span class="token punctuation">(</span>display<span class="token punctuation">(</span>future<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 创建一个Task对象放入事件循环，绑定display函数，display函数内手动给future赋值</span></span>
<span class="line">    data <span class="token operator">=</span> <span class="token keyword">await</span> future  <span class="token comment"># 等待Future获取结果</span></span>
<span class="line">    logging<span class="token punctuation">.</span>warning<span class="token punctuation">(</span>data<span class="token punctuation">)</span>  <span class="token comment"># 输出结果 Hello World</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line">asyncio<span class="token punctuation">.</span>run<span class="token punctuation">(</span>main<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre></div><h4 id="对象检测" tabindex="-1"><a class="header-anchor" href="#对象检测"><span>对象检测</span></a></h4><table><thead><tr><th>检测方法</th><th>说明</th></tr></thead><tbody><tr><td>asyncio.iscoroutinefunction(协程函数)</td><td>返回是否是协程函数</td></tr><tr><td>asyncio.iscoroutine(协程对象)</td><td>返回是否是协程对象</td></tr><tr><td>asyncio.isfuture(future)</td><td>返回是否是Future对象</td></tr><tr><td>inspect.isawaitable(对象)</td><td>返回是否是可等待对象</td></tr></tbody></table><blockquote><p>协程函数、协程对象也可以使用<code>inspect.iscoroutinefunction(协程函数)</code>和<code>inspect.iscoroutine(协程对象)</code>来检测，</p><p>但是<code>inspect</code>只能检测使用<code>async def</code>定义的协程，对于使用基于生成器的协程，则无法检测</p></blockquote><h4 id="异步迭代器" tabindex="-1"><a class="header-anchor" href="#异步迭代器"><span>异步迭代器</span></a></h4><p>文档：<a href="https://docs.python.org/zh-cn/3.9/reference/datamodel.html#asynchronous-iterators" target="_blank" rel="noopener noreferrer">https://docs.python.org/zh-cn/3.9/reference/datamodel.html#asynchronous-iterators</a></p><p>异步迭代器可以在其 <code>__anext__</code> 方法中调用异步代码</p><p>异步迭代器可在 <a href="https://docs.python.org/zh-cn/3.9/reference/compound_stmts.html#async-for" target="_blank" rel="noopener noreferrer"><code>async for</code></a> 语句中使用</p><p>异步迭代器需要定义如下方法</p><p>（1）<code>def __aiter__(self)</code></p><p>必须返回一个可等待对象，一般返回自己</p><p>（2）<code>async def __anext__(self)</code></p><p>必须返回一个下一次迭代的结果值。 当迭代结束时应该引发 <a href="https://docs.python.org/zh-cn/3.9/library/exceptions.html#StopAsyncIteration" target="_blank" rel="noopener noreferrer"><code>StopAsyncIteration</code></a> 错误</p><p>代码示例</p><div class="language-python" data-highlighter="prismjs" data-ext="py"><pre><code class="language-python"><span class="line"><span class="token comment">#!/usr/bin/env python</span></span>
<span class="line"><span class="token comment"># -*- coding:utf-8 -*-</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> asyncio</span>
<span class="line"><span class="token keyword">import</span> random</span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">Random</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> n<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        self<span class="token punctuation">.</span>n <span class="token operator">=</span> n</span>
<span class="line">        self<span class="token punctuation">.</span>_count <span class="token operator">=</span> <span class="token number">0</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">__aiter__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token keyword">return</span> self</span>
<span class="line"></span>
<span class="line">    <span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">__anext__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token keyword">if</span> self<span class="token punctuation">.</span>n <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token keyword">if</span> self<span class="token punctuation">.</span>_count <span class="token operator">&gt;=</span> self<span class="token punctuation">.</span>n<span class="token punctuation">:</span></span>
<span class="line">                <span class="token keyword">raise</span> StopAsyncIteration</span>
<span class="line">            self<span class="token punctuation">.</span>_count <span class="token operator">+=</span> <span class="token number">1</span></span>
<span class="line">        <span class="token keyword">return</span> random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">async</span> <span class="token keyword">for</span> x <span class="token keyword">in</span> Random<span class="token punctuation">(</span>n<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment"># 异步迭代</span></span>
<span class="line">        <span class="token keyword">print</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line">asyncio<span class="token punctuation">.</span>run<span class="token punctuation">(</span>main<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre></div><h4 id="异步上下文管理器" tabindex="-1"><a class="header-anchor" href="#异步上下文管理器"><span>异步上下文管理器</span></a></h4><p>文档：<a href="https://docs.python.org/zh-cn/3.9/reference/datamodel.html#asynchronous-context-managers" target="_blank" rel="noopener noreferrer">https://docs.python.org/zh-cn/3.9/reference/datamodel.html#asynchronous-context-managers</a></p><p>异步上下文管理器 是上下文管理器的一种，它能够在其 <code>__aenter__</code> 和 <code>__aexit__</code> 方法中暂停执行。</p><p>异步上下文管理器可在 <a href="https://docs.python.org/zh-cn/3.9/reference/compound_stmts.html#async-with" target="_blank" rel="noopener noreferrer"><code>async with</code></a> 语句中使用</p><p>异步上下文管理器需要实现如下方法</p><p>（1）<code>async def __aenter__(self)</code></p><p>返回值是<code>async with xx as xx</code>语句中as后面的对象，必须返回一个可等待对象</p><p>（2）<code>async def __aexit__(self, exc_type, exc_val, exc_tb)</code></p><p>当<code>with</code>语句执行结束时调用此函数，用于执行一些资源清理的操作</p><p>代码示例</p><div class="language-python" data-highlighter="prismjs" data-ext="py"><pre><code class="language-python"><span class="line"><span class="token comment">#!/usr/bin/env python</span></span>
<span class="line"><span class="token comment"># -*- coding:utf-8 -*-</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> asyncio</span>
<span class="line"><span class="token keyword">import</span> logging</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 初始化日志</span></span>
<span class="line">FORMAT <span class="token operator">=</span> <span class="token string">&#39;%(asctime)-15s\t [%(threadName)s, %(thread)d] %(message)s&#39;</span></span>
<span class="line">logging<span class="token punctuation">.</span>basicConfig<span class="token punctuation">(</span><span class="token builtin">format</span><span class="token operator">=</span>FORMAT<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">ClientSession</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">__aenter__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token triple-quoted-string string">&#39;&#39;&#39;</span>
<span class="line">        async with xxx as xx</span>
<span class="line">        as后面的对象，就是本函数的返回值</span>
<span class="line">        &#39;&#39;&#39;</span></span>
<span class="line">        <span class="token keyword">return</span> self</span>
<span class="line"></span>
<span class="line">    <span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">__aexit__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> exc_type<span class="token punctuation">,</span> exc_val<span class="token punctuation">,</span> exc_tb<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token triple-quoted-string string">&#39;&#39;&#39;with语法运行结束后执行的清理操作&#39;&#39;&#39;</span></span>
<span class="line">        self<span class="token punctuation">.</span>_close<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">get</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        logging<span class="token punctuation">.</span>warning<span class="token punctuation">(</span><span class="token string">&quot;执行Get方法&quot;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">_close</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        logging<span class="token punctuation">.</span>warning<span class="token punctuation">(</span><span class="token string">&quot;关闭Session&quot;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">async</span> <span class="token keyword">with</span> ClientSession<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> session<span class="token punctuation">:</span></span>
<span class="line">        session<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">asyncio<span class="token punctuation">.</span>run<span class="token punctuation">(</span>main<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre></div><h4 id="控制协程并发数量" tabindex="-1"><a class="header-anchor" href="#控制协程并发数量"><span>控制协程并发数量</span></a></h4><p>可以自己手动控制也可以使用<code>asyncio.Semaphore(并发)</code>，两个代码都不难，但以下两种代码还是有些区别的，假设总请求数为10，并发为2，那么：</p><ul><li><p>手动控制的是等2个请求完全完成后再去请求后2个，<code>Semaphore</code>是2个请求中任意一个完成就会再启动一个新请求，</p><p><code>Semaphore</code>效率更高，手动控的制控制台信息更直观</p></li><li><p><code>Semaphore</code>代码量更小</p></li></ul><p>自己手动控制并发演示</p><details class="hint-container details"><summary>点击查看完整代码</summary><div class="language-python" data-highlighter="prismjs" data-ext="py"><pre><code class="language-python"><span class="line"><span class="token comment">#!/usr/bin/env python</span></span>
<span class="line"><span class="token comment"># -*- coding:utf-8 -*-</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> asyncio</span>
<span class="line"><span class="token keyword">import</span> logging</span>
<span class="line"><span class="token keyword">import</span> time</span>
<span class="line"><span class="token keyword">import</span> aiohttp</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 初始化日志</span></span>
<span class="line">FORMAT <span class="token operator">=</span> <span class="token string">&#39;%(asctime)-15s\t [%(threadName)s, %(thread)d] %(message)s&#39;</span></span>
<span class="line">logging<span class="token punctuation">.</span>basicConfig<span class="token punctuation">(</span><span class="token builtin">format</span><span class="token operator">=</span>FORMAT<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">request_async</span><span class="token punctuation">(</span>url<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">,</span> request_total<span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">,</span> concurrent<span class="token punctuation">:</span> <span class="token builtin">int</span> <span class="token operator">=</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token triple-quoted-string string">&#39;&#39;&#39;</span>
<span class="line">    :param url: URL</span>
<span class="line">    :param request_total: 总共发送多少次请求</span>
<span class="line">    :param concurrent: 并发数量，需要 &gt; 0</span>
<span class="line">    :return: None</span>
<span class="line">    &#39;&#39;&#39;</span></span>
<span class="line">    start <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment"># 统计HTTP请求状态码结果</span></span>
<span class="line">    Counter <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token string">&quot;Success&quot;</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token string">&quot;Failed&quot;</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">wrapper</span><span class="token punctuation">(</span>session<span class="token punctuation">:</span> aiohttp<span class="token punctuation">.</span>ClientSession<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        logging<span class="token punctuation">.</span>warning<span class="token punctuation">(</span><span class="token string">&quot;Started a request&quot;</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">async</span> <span class="token keyword">with</span> session<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">)</span> <span class="token keyword">as</span> r<span class="token punctuation">:</span></span>
<span class="line">            <span class="token keyword">if</span> r<span class="token punctuation">.</span>status <span class="token operator">==</span> <span class="token number">200</span><span class="token punctuation">:</span></span>
<span class="line">                Counter<span class="token punctuation">[</span><span class="token string">&quot;Success&quot;</span><span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token number">1</span></span>
<span class="line">            <span class="token keyword">else</span><span class="token punctuation">:</span></span>
<span class="line">                Counter<span class="token punctuation">[</span><span class="token string">&quot;Failed&quot;</span><span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token number">1</span></span>
<span class="line">        logging<span class="token punctuation">.</span>warning<span class="token punctuation">(</span><span class="token string">&quot;Completed a request&quot;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment"># 发送网络请求</span></span>
<span class="line">    <span class="token keyword">async</span> <span class="token keyword">with</span> aiohttp<span class="token punctuation">.</span>ClientSession<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> session<span class="token punctuation">:</span></span>
<span class="line">        <span class="token keyword">while</span> request_total <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token comment"># --------------------------- 并发控制 --------------------------------</span></span>
<span class="line">            <span class="token comment"># 剩余请求小于并发数，直接请求即可</span></span>
<span class="line">            <span class="token keyword">if</span> request_total <span class="token operator">&lt;=</span> concurrent<span class="token punctuation">:</span></span>
<span class="line">                tasks <span class="token operator">=</span> <span class="token punctuation">[</span>wrapper<span class="token punctuation">(</span>session<span class="token punctuation">)</span> <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>request_total<span class="token punctuation">)</span><span class="token punctuation">]</span></span>
<span class="line">                request_total <span class="token operator">=</span> <span class="token number">0</span></span>
<span class="line">            <span class="token comment"># 按照一定数量并发执行</span></span>
<span class="line">            <span class="token keyword">else</span><span class="token punctuation">:</span></span>
<span class="line">                tasks <span class="token operator">=</span> <span class="token punctuation">[</span>wrapper<span class="token punctuation">(</span>session<span class="token punctuation">)</span> <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>concurrent<span class="token punctuation">)</span><span class="token punctuation">]</span></span>
<span class="line">                request_total <span class="token operator">-=</span> concurrent</span>
<span class="line">            <span class="token comment"># --------------------------- 并发控制 --------------------------------</span></span>
<span class="line">            <span class="token keyword">await</span> asyncio<span class="token punctuation">.</span>gather<span class="token punctuation">(</span><span class="token operator">*</span>tasks<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">    logging<span class="token punctuation">.</span>warning<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;Function [ request_async  ] running time: </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">int</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> start<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string"> seconds | </span><span class="token interpolation"><span class="token punctuation">{</span>Counter<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line">asyncio<span class="token punctuation">.</span>run<span class="token punctuation">(</span>request_async<span class="token punctuation">(</span><span class="token string">&quot;https://www.qq.com&quot;</span><span class="token punctuation">,</span> request_total<span class="token operator">=</span><span class="token number">10</span> concurrent<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre></div></details><p>使用<code>asyncio.Semaphore</code>控制并发</p><details class="hint-container details"><summary>点击查看完整代码</summary><div class="language-python" data-highlighter="prismjs" data-ext="py"><pre><code class="language-python"><span class="line"><span class="token comment">#!/usr/bin/env python</span></span>
<span class="line"><span class="token comment"># -*- coding:utf-8 -*-</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> asyncio</span>
<span class="line"><span class="token keyword">import</span> logging</span>
<span class="line"><span class="token keyword">import</span> time</span>
<span class="line"><span class="token keyword">import</span> aiohttp</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 初始化日志</span></span>
<span class="line">FORMAT <span class="token operator">=</span> <span class="token string">&#39;%(asctime)-15s\t [%(threadName)s, %(thread)d] %(message)s&#39;</span></span>
<span class="line">logging<span class="token punctuation">.</span>basicConfig<span class="token punctuation">(</span><span class="token builtin">format</span><span class="token operator">=</span>FORMAT<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">request_async</span><span class="token punctuation">(</span>url<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">,</span> request_total<span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">,</span> concurrent<span class="token punctuation">:</span> <span class="token builtin">int</span> <span class="token operator">=</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token triple-quoted-string string">&#39;&#39;&#39;</span>
<span class="line">    :param url: URL</span>
<span class="line">    :param request_total: 总共发送多少次请求</span>
<span class="line">    :param concurrent: 并发数量，需要 &gt; 0</span>
<span class="line">    :return: None</span>
<span class="line">    &#39;&#39;&#39;</span></span>
<span class="line">    start <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment"># (1)并发控制, 不能设置为0，否则会发生死锁</span></span>
<span class="line">    semphore <span class="token operator">=</span> asyncio<span class="token punctuation">.</span>Semaphore<span class="token punctuation">(</span>concurrent<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment"># 统计HTTP请求状态码结果</span></span>
<span class="line">    Counter <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token string">&quot;Success&quot;</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token string">&quot;Failed&quot;</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">wrapper</span><span class="token punctuation">(</span>session<span class="token punctuation">:</span> aiohttp<span class="token punctuation">.</span>ClientSession<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token keyword">async</span> <span class="token keyword">with</span> semphore<span class="token punctuation">:</span>  <span class="token comment"># (2)并发控制</span></span>
<span class="line">            logging<span class="token punctuation">.</span>warning<span class="token punctuation">(</span><span class="token string">&quot;Started a request&quot;</span><span class="token punctuation">)</span></span>
<span class="line">            <span class="token keyword">async</span> <span class="token keyword">with</span> session<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">)</span> <span class="token keyword">as</span> r<span class="token punctuation">:</span></span>
<span class="line">                <span class="token keyword">if</span> r<span class="token punctuation">.</span>status <span class="token operator">==</span> <span class="token number">200</span><span class="token punctuation">:</span></span>
<span class="line">                    Counter<span class="token punctuation">[</span><span class="token string">&quot;Success&quot;</span><span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token number">1</span></span>
<span class="line">                <span class="token keyword">else</span><span class="token punctuation">:</span></span>
<span class="line">                    Counter<span class="token punctuation">[</span><span class="token string">&quot;Failed&quot;</span><span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token number">1</span></span>
<span class="line">            logging<span class="token punctuation">.</span>warning<span class="token punctuation">(</span><span class="token string">&quot;Completed a request&quot;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment"># 发送网络请求</span></span>
<span class="line">    <span class="token keyword">async</span> <span class="token keyword">with</span> aiohttp<span class="token punctuation">.</span>ClientSession<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> session<span class="token punctuation">:</span></span>
<span class="line">        tasks <span class="token operator">=</span> <span class="token punctuation">[</span>wrapper<span class="token punctuation">(</span>session<span class="token punctuation">)</span> <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>request_total<span class="token punctuation">)</span><span class="token punctuation">]</span></span>
<span class="line">        <span class="token keyword">await</span> asyncio<span class="token punctuation">.</span>gather<span class="token punctuation">(</span><span class="token operator">*</span>tasks<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">    logging<span class="token punctuation">.</span>warning<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;Function [ request_async  ] running time: </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">int</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> start<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string"> seconds | </span><span class="token interpolation"><span class="token punctuation">{</span>Counter<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line">asyncio<span class="token punctuation">.</span>run<span class="token punctuation">(</span>request_async<span class="token punctuation">(</span><span class="token string">&quot;https://www.qq.com&quot;</span><span class="token punctuation">,</span> request_total<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">,</span> concurrent<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre></div></details><h4 id="协程局部变量" tabindex="-1"><a class="header-anchor" href="#协程局部变量"><span>协程局部变量</span></a></h4><p>文档：<a href="https://docs.python.org/zh-cn/3.10/library/contextvars.html" target="_blank" rel="noopener noreferrer">https://docs.python.org/zh-cn/3.10/library/contextvars.html</a></p><p><code>contextvars</code>与<code>threading.local</code>类似，用于异步中管理上下文</p><p>💡 提醒： <code>asyncio</code>并没有提供<code>local</code>类</p><details class="hint-container details"><summary>点击查看完整代码</summary><div class="language-python" data-highlighter="prismjs" data-ext="py"><pre><code class="language-python"><span class="line"><span class="token comment">#!/usr/bin/env python</span></span>
<span class="line"><span class="token comment"># -*- coding:utf-8-*-</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> asyncio</span>
<span class="line"><span class="token keyword">import</span> logging</span>
<span class="line"><span class="token keyword">import</span> contextvars</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 初始化日志</span></span>
<span class="line">FORMAT <span class="token operator">=</span> <span class="token string">&#39;%(asctime)-15s\t [%(threadName)s, %(thread)d] %(message)s&#39;</span></span>
<span class="line">logging<span class="token punctuation">.</span>basicConfig<span class="token punctuation">(</span><span class="token builtin">format</span><span class="token operator">=</span>FORMAT<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">MyClass</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> value<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        self<span class="token punctuation">.</span>value <span class="token operator">=</span> value</span>
<span class="line"></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">set</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        self<span class="token punctuation">.</span>value <span class="token operator">=</span> value</span>
<span class="line"></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">get</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token keyword">return</span> self<span class="token punctuation">.</span>value</span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 全局变量</span></span>
<span class="line">data1 <span class="token operator">=</span> MyClass<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 全局变量(协程局部变量)</span></span>
<span class="line">data2 <span class="token operator">=</span> contextvars<span class="token punctuation">.</span>ContextVar<span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">task1</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    data1<span class="token punctuation">.</span><span class="token builtin">set</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">await</span> asyncio<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">0.1</span><span class="token punctuation">)</span></span>
<span class="line">    logging<span class="token punctuation">.</span>warning<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;Task1-</span><span class="token interpolation"><span class="token punctuation">{</span>n<span class="token punctuation">}</span></span><span class="token string">: </span><span class="token interpolation"><span class="token punctuation">{</span>data1<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token comment"># assert n == data.get()</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">task2</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    data2<span class="token punctuation">.</span><span class="token builtin">set</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">await</span> asyncio<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">0.1</span><span class="token punctuation">)</span></span>
<span class="line">    logging<span class="token punctuation">.</span>warning<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;Task2-</span><span class="token interpolation"><span class="token punctuation">{</span>n<span class="token punctuation">}</span></span><span class="token string">: </span><span class="token interpolation"><span class="token punctuation">{</span>data2<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token comment"># assert n == data.get()</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token comment"># 测试1</span></span>
<span class="line">    logging<span class="token punctuation">.</span>warning<span class="token punctuation">(</span><span class="token string">&quot;测试1：协程并发修改全局变量&quot;</span><span class="token punctuation">)</span></span>
<span class="line">    tasks1 <span class="token operator">=</span> <span class="token punctuation">[</span>task1<span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">]</span></span>
<span class="line">    <span class="token keyword">await</span> asyncio<span class="token punctuation">.</span>gather<span class="token punctuation">(</span><span class="token operator">*</span>tasks1<span class="token punctuation">)</span></span>
<span class="line">    logging<span class="token punctuation">.</span>warning<span class="token punctuation">(</span><span class="token string">&quot;-&quot;</span> <span class="token operator">*</span> <span class="token number">50</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment"># 测试2</span></span>
<span class="line">    logging<span class="token punctuation">.</span>warning<span class="token punctuation">(</span><span class="token string">&quot;测试2：协程局部变量&quot;</span><span class="token punctuation">)</span></span>
<span class="line">    tasks2 <span class="token operator">=</span> <span class="token punctuation">[</span>task2<span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">]</span></span>
<span class="line">    <span class="token keyword">await</span> asyncio<span class="token punctuation">.</span>gather<span class="token punctuation">(</span><span class="token operator">*</span>tasks2<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">&#39;__main__&#39;</span><span class="token punctuation">:</span></span>
<span class="line">    asyncio<span class="token punctuation">.</span>run<span class="token punctuation">(</span>main<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre></div></details><p>输出结果</p><div class="language-bash" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token number">2022</span>-04-07 <span class="token number">11</span>:45:22,185	 <span class="token punctuation">[</span>MainThread, <span class="token number">360196</span><span class="token punctuation">]</span> 测试1：协程并发修改全局变量</span>
<span class="line"><span class="token number">2022</span>-04-07 <span class="token number">11</span>:45:22,294	 <span class="token punctuation">[</span>MainThread, <span class="token number">360196</span><span class="token punctuation">]</span> Task1-0: <span class="token number">9</span></span>
<span class="line"><span class="token number">2022</span>-04-07 <span class="token number">11</span>:45:22,294	 <span class="token punctuation">[</span>MainThread, <span class="token number">360196</span><span class="token punctuation">]</span> Task1-2: <span class="token number">9</span></span>
<span class="line"><span class="token number">2022</span>-04-07 <span class="token number">11</span>:45:22,294	 <span class="token punctuation">[</span>MainThread, <span class="token number">360196</span><span class="token punctuation">]</span> Task1-6: <span class="token number">9</span></span>
<span class="line"><span class="token number">2022</span>-04-07 <span class="token number">11</span>:45:22,294	 <span class="token punctuation">[</span>MainThread, <span class="token number">360196</span><span class="token punctuation">]</span> Task1-9: <span class="token number">9</span></span>
<span class="line"><span class="token number">2022</span>-04-07 <span class="token number">11</span>:45:22,294	 <span class="token punctuation">[</span>MainThread, <span class="token number">360196</span><span class="token punctuation">]</span> Task1-8: <span class="token number">9</span></span>
<span class="line"><span class="token number">2022</span>-04-07 <span class="token number">11</span>:45:22,294	 <span class="token punctuation">[</span>MainThread, <span class="token number">360196</span><span class="token punctuation">]</span> Task1-5: <span class="token number">9</span></span>
<span class="line"><span class="token number">2022</span>-04-07 <span class="token number">11</span>:45:22,294	 <span class="token punctuation">[</span>MainThread, <span class="token number">360196</span><span class="token punctuation">]</span> Task1-7: <span class="token number">9</span></span>
<span class="line"><span class="token number">2022</span>-04-07 <span class="token number">11</span>:45:22,294	 <span class="token punctuation">[</span>MainThread, <span class="token number">360196</span><span class="token punctuation">]</span> Task1-4: <span class="token number">9</span></span>
<span class="line"><span class="token number">2022</span>-04-07 <span class="token number">11</span>:45:22,294	 <span class="token punctuation">[</span>MainThread, <span class="token number">360196</span><span class="token punctuation">]</span> Task1-1: <span class="token number">9</span></span>
<span class="line"><span class="token number">2022</span>-04-07 <span class="token number">11</span>:45:22,294	 <span class="token punctuation">[</span>MainThread, <span class="token number">360196</span><span class="token punctuation">]</span> Task1-3: <span class="token number">9</span></span>
<span class="line"><span class="token number">2022</span>-04-07 <span class="token number">11</span>:45:22,294	 <span class="token punctuation">[</span>MainThread, <span class="token number">360196</span><span class="token punctuation">]</span> --------------------------------------------------</span>
<span class="line"><span class="token number">2022</span>-04-07 <span class="token number">11</span>:45:22,294	 <span class="token punctuation">[</span>MainThread, <span class="token number">360196</span><span class="token punctuation">]</span> 测试2：协程局部变量</span>
<span class="line"><span class="token number">2022</span>-04-07 <span class="token number">11</span>:45:22,403	 <span class="token punctuation">[</span>MainThread, <span class="token number">360196</span><span class="token punctuation">]</span> Task2-0: <span class="token number">0</span></span>
<span class="line"><span class="token number">2022</span>-04-07 <span class="token number">11</span>:45:22,403	 <span class="token punctuation">[</span>MainThread, <span class="token number">360196</span><span class="token punctuation">]</span> Task2-2: <span class="token number">2</span></span>
<span class="line"><span class="token number">2022</span>-04-07 <span class="token number">11</span>:45:22,403	 <span class="token punctuation">[</span>MainThread, <span class="token number">360196</span><span class="token punctuation">]</span> Task2-6: <span class="token number">6</span></span>
<span class="line"><span class="token number">2022</span>-04-07 <span class="token number">11</span>:45:22,403	 <span class="token punctuation">[</span>MainThread, <span class="token number">360196</span><span class="token punctuation">]</span> Task2-9: <span class="token number">9</span></span>
<span class="line"><span class="token number">2022</span>-04-07 <span class="token number">11</span>:45:22,403	 <span class="token punctuation">[</span>MainThread, <span class="token number">360196</span><span class="token punctuation">]</span> Task2-8: <span class="token number">8</span></span>
<span class="line"><span class="token number">2022</span>-04-07 <span class="token number">11</span>:45:22,403	 <span class="token punctuation">[</span>MainThread, <span class="token number">360196</span><span class="token punctuation">]</span> Task2-5: <span class="token number">5</span></span>
<span class="line"><span class="token number">2022</span>-04-07 <span class="token number">11</span>:45:22,403	 <span class="token punctuation">[</span>MainThread, <span class="token number">360196</span><span class="token punctuation">]</span> Task2-7: <span class="token number">7</span></span>
<span class="line"><span class="token number">2022</span>-04-07 <span class="token number">11</span>:45:22,403	 <span class="token punctuation">[</span>MainThread, <span class="token number">360196</span><span class="token punctuation">]</span> Task2-4: <span class="token number">4</span></span>
<span class="line"><span class="token number">2022</span>-04-07 <span class="token number">11</span>:45:22,403	 <span class="token punctuation">[</span>MainThread, <span class="token number">360196</span><span class="token punctuation">]</span> Task2-1: <span class="token number">1</span></span>
<span class="line"><span class="token number">2022</span>-04-07 <span class="token number">11</span>:45:22,403	 <span class="token punctuation">[</span>MainThread, <span class="token number">360196</span><span class="token punctuation">]</span> Task2-3: <span class="token number">3</span></span>
<span class="line"></span></code></pre></div><h2 id="" tabindex="-1"><a class="header-anchor" href="#"><span></span></a></h2><h2 id="六、面向对象" tabindex="-1"><a class="header-anchor" href="#六、面向对象"><span>六、面向对象</span></a></h2><h3 id="魔法方法概览" tabindex="-1"><a class="header-anchor" href="#魔法方法概览"><span>魔法方法概览</span></a></h3><table><thead><tr><th>分类</th><th>魔法方法</th><th>说明</th></tr></thead><tbody><tr><td>实例创建和销毁</td><td><code>__new__</code></td><td>创建类实例对象并返回</td></tr><tr><td></td><td><code>__del__</code></td><td>在实例将被销毁时调用</td></tr><tr><td>属性字典</td><td><code>__dict__</code></td><td>对象所有属性组成的字典</td></tr><tr><td>self[key]</td><td><code>__getitem__</code>、<code>__setitem__</code>、<code>__delitem__</code></td><td>通过<code>self[key]</code>访问时调用</td></tr><tr><td>可视化</td><td><code>__repr__</code>、<code>__str__</code>、<code>__format__</code></td><td>可视化</td></tr><tr><td>可迭代对象和迭代器</td><td><code>__iter__</code>、<code>__next__</code></td><td>可迭代对象和迭代器</td></tr><tr><td>with上下文管理</td><td><code>__enter__</code>、<code>__exit__</code></td><td></td></tr><tr><td>实例属性查找</td><td><code>__getattribute__</code></td><td></td></tr><tr><td>描述器</td><td><code>__get__</code>、<code>__set__</code>、<code>__delete__</code></td><td></td></tr><tr><td>运算符重载</td><td><code>__lt__</code></td><td>小于，&lt;</td></tr><tr><td></td><td><code>__le__</code></td><td>小于等于，&lt;=</td></tr><tr><td></td><td><code>__eq__</code></td><td>等于，==</td></tr><tr><td></td><td><code>__gt__</code></td><td>大于，&gt;</td></tr><tr><td></td><td><code>__ge__</code></td><td>大于等于，&gt;=</td></tr><tr><td></td><td><code>__ne__</code></td><td>不等于，!=</td></tr><tr><td></td><td><code>__add__</code></td><td>加，+</td></tr><tr><td></td><td><code>__sub__</code></td><td>减，-</td></tr><tr><td></td><td>__<code>mul__</code></td><td>乘，*</td></tr><tr><td></td><td>__<code>truediv__</code></td><td>除，5 / 3 = 1.6666666666666667</td></tr><tr><td></td><td><code>__floordiv__</code></td><td>地板除，5 // 3 = 1</td></tr><tr><td></td><td><code>__mod__</code></td><td>取余，%</td></tr><tr><td></td><td><code>__pow__</code></td><td>计算次方， 2 ** 3 = 2 * 2 * 2 = 8</td></tr><tr><td></td><td><code>__divmod__</code></td><td>等同于 <code>(x//y, x%y)</code></td></tr><tr><td></td><td></td><td></td></tr><tr><td></td><td><code>__iadd__</code></td><td>+=</td></tr><tr><td></td><td><code>__isub__</code></td><td>-=</td></tr><tr><td></td><td><code>__imul__</code></td><td>*=</td></tr><tr><td></td><td><code>__itruediv__</code></td><td>/=</td></tr><tr><td></td><td><code>__imod__</code></td><td>%=</td></tr><tr><td></td><td><code>__ifloordiv__</code></td><td>//=</td></tr><tr><td></td><td><code>__ipow__</code></td><td>**=</td></tr></tbody></table><h3 id="实例创建和销毁" tabindex="-1"><a class="header-anchor" href="#实例创建和销毁"><span>实例创建和销毁</span></a></h3><h4 id="创建实例-new" tabindex="-1"><a class="header-anchor" href="#创建实例-new"><span>创建实例：<code>__new__</code></span></a></h4><p>文档：<a href="https://docs.python.org/zh-cn/3.10/reference/datamodel.html#object.__new__" target="_blank" rel="noopener noreferrer">https://docs.python.org/zh-cn/3.10/reference/datamodel.html#object.<strong>new</strong></a></p><p>创建类实例对象并返回，它可以让我们定制实例创建过程，比如实现<strong>单例模式</strong></p><p>默认的<code>__new__</code>行为</p><div class="language-python" data-highlighter="prismjs" data-ext="py"><pre><code class="language-python"><span class="line"><span class="token comment">#!/usr/bin/env python</span></span>
<span class="line"><span class="token comment"># -*- coding:utf-8-*-</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># class Demo:</span></span>
<span class="line"><span class="token comment">#    pass</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 将以上代码展开的话，就等同于如下代码</span></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">Demo</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">__new__</span><span class="token punctuation">(</span>cls<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token comment"># return object.__new__(cls) # 写法1</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__new__<span class="token punctuation">(</span>cls<span class="token punctuation">)</span>  <span class="token comment"># 写法2</span></span>
<span class="line"></span></code></pre></div><p>使用<code>__new__</code>实现线程安全的单例类</p><details class="hint-container details"><summary>点击查看完整代码</summary><div class="language-python" data-highlighter="prismjs" data-ext="py"><pre><code class="language-python"><span class="line"><span class="token comment">#!/usr/bin/env python</span></span>
<span class="line"><span class="token comment"># -*- coding:utf-8-*-</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> time</span>
<span class="line"><span class="token keyword">import</span> threading</span>
<span class="line"></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">Single</span><span class="token punctuation">:</span></span>
<span class="line">    _instance_lock <span class="token operator">=</span> threading<span class="token punctuation">.</span>Lock<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">__new__</span><span class="token punctuation">(</span>cls<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token keyword">not</span> <span class="token builtin">hasattr</span><span class="token punctuation">(</span>cls<span class="token punctuation">,</span> <span class="token string">&quot;_instance&quot;</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token keyword">with</span> cls<span class="token punctuation">.</span>_instance_lock<span class="token punctuation">:</span></span>
<span class="line">                <span class="token comment"># time.sleep(1)</span></span>
<span class="line">                <span class="token keyword">if</span> <span class="token keyword">not</span> <span class="token builtin">hasattr</span><span class="token punctuation">(</span>cls<span class="token punctuation">,</span> <span class="token string">&quot;_instance&quot;</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">                    cls<span class="token punctuation">.</span>_instance <span class="token operator">=</span> <span class="token builtin">object</span><span class="token punctuation">.</span>__new__<span class="token punctuation">(</span>cls<span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token builtin">getattr</span><span class="token punctuation">(</span>cls<span class="token punctuation">,</span> <span class="token string">&quot;_instance&quot;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 原理说明</span></span>
<span class="line"><span class="token comment">#   每次创建【类实例对象】时先检查【类对象】上是否有_instance属性，</span></span>
<span class="line"><span class="token comment">#       如果有，说明已经实例化过了，直接返回类实例化对象</span></span>
<span class="line"><span class="token comment">#       如果没有，那么才开始创建实例对象</span></span>
<span class="line"><span class="token comment">#           获取锁</span></span>
<span class="line"><span class="token comment">#               类属性_instance = 类实例化对象</span></span>
<span class="line"><span class="token comment">#           返回类属性_instance</span></span>
<span class="line"><span class="token comment">#</span></span>
<span class="line"><span class="token comment"># 问: 加锁之后为什么还要判断有没有_instance属性?</span></span>
<span class="line"><span class="token comment"># 答: (1) 如果不判断，那么线程1获取锁后，还没执行完，这时候线程2已经在尝试获取锁了，等线程1执行完，实际上已经是单例了，</span></span>
<span class="line"><span class="token comment">#         线程2又获取了一遍锁，又生成一个新对象，实际就并不是线程安全了。这与线程安全章节的queue陷阱类似。可以取消注释# time.sleep(1)来验证</span></span>
<span class="line"><span class="token comment">#     (2) 如果不容易理解，可以从另一方面来考虑</span></span>
<span class="line"><span class="token comment">#         其实第一个if判断可以去掉，程序逻辑就变为：先加锁，若没有_instance属性就创建要给实例加上去</span></span>
<span class="line"><span class="token comment">#         第一个if可以用来先判断一次，可以避免多次创建实例都会加锁判断，提高程序运行效率</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token comment"># 这里print的函数的骚操作主要是： 将默认线程不安全的print函数改写为线程安全</span></span>
<span class="line">    threading<span class="token punctuation">.</span>Thread<span class="token punctuation">(</span>target<span class="token operator">=</span><span class="token keyword">lambda</span><span class="token punctuation">:</span> <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>Single<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;\n&quot;</span><span class="token punctuation">,</span> end<span class="token operator">=</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre></div><p>输出结果</p><div class="language-bash" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token operator">&lt;</span>__main__.Single object at 0x000002620E53957<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span></span>
<span class="line"><span class="token operator">&lt;</span>__main__.Single object at 0x000002620E53957<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span></span>
<span class="line"><span class="token operator">&lt;</span>__main__.Single object at 0x000002620E53957<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span></span>
<span class="line"><span class="token operator">&lt;</span>__main__.Single object at 0x000002620E53957<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span></span>
<span class="line"><span class="token operator">&lt;</span>__main__.Single object at 0x000002620E53957<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span></span>
<span class="line"><span class="token operator">&lt;</span>__main__.Single object at 0x000002620E53957<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span></span>
<span class="line"><span class="token operator">&lt;</span>__main__.Single object at 0x000002620E53957<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span></span>
<span class="line"><span class="token operator">&lt;</span>__main__.Single object at 0x000002620E53957<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span></span>
<span class="line"><span class="token operator">&lt;</span>__main__.Single object at 0x000002620E53957<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span></span>
<span class="line"><span class="token operator">&lt;</span>__main__.Single object at 0x000002620E53957<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span></span>
<span class="line"></span></code></pre></div><p>验证第一个if判断是否需要，主要验证运行效率</p><div class="language-python" data-highlighter="prismjs" data-ext="py"><pre><code class="language-python"><span class="line"><span class="token comment">#!/usr/bin/env python</span></span>
<span class="line"><span class="token comment"># -*- coding:utf-8-*-</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> threading</span>
<span class="line"><span class="token keyword">import</span> timeit</span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">Single1</span><span class="token punctuation">:</span></span>
<span class="line">    _instance_lock <span class="token operator">=</span> threading<span class="token punctuation">.</span>Lock<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">__new__</span><span class="token punctuation">(</span>cls<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token keyword">not</span> <span class="token builtin">hasattr</span><span class="token punctuation">(</span>cls<span class="token punctuation">,</span> <span class="token string">&quot;_instance&quot;</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token keyword">with</span> cls<span class="token punctuation">.</span>_instance_lock<span class="token punctuation">:</span></span>
<span class="line">                <span class="token keyword">if</span> <span class="token keyword">not</span> <span class="token builtin">hasattr</span><span class="token punctuation">(</span>cls<span class="token punctuation">,</span> <span class="token string">&quot;_instance&quot;</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">                    cls<span class="token punctuation">.</span>_instance <span class="token operator">=</span> <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__new__<span class="token punctuation">(</span>cls<span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token builtin">getattr</span><span class="token punctuation">(</span>cls<span class="token punctuation">,</span> <span class="token string">&quot;_instance&quot;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">Single2</span><span class="token punctuation">:</span></span>
<span class="line">    _instance_lock <span class="token operator">=</span> threading<span class="token punctuation">.</span>Lock<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">__new__</span><span class="token punctuation">(</span>cls<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token keyword">with</span> cls<span class="token punctuation">.</span>_instance_lock<span class="token punctuation">:</span></span>
<span class="line">            <span class="token keyword">if</span> <span class="token keyword">not</span> <span class="token builtin">hasattr</span><span class="token punctuation">(</span>cls<span class="token punctuation">,</span> <span class="token string">&quot;_instance&quot;</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">                cls<span class="token punctuation">.</span>_instance <span class="token operator">=</span> <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__new__<span class="token punctuation">(</span>cls<span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token builtin">getattr</span><span class="token punctuation">(</span>cls<span class="token punctuation">,</span> <span class="token string">&quot;_instance&quot;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line">number <span class="token operator">=</span> <span class="token number">1000000</span>  <span class="token comment"># 运行一百万次，这也是默认值</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span>timeit<span class="token punctuation">.</span>timeit<span class="token punctuation">(</span>stmt<span class="token operator">=</span>Single1<span class="token punctuation">,</span> number<span class="token operator">=</span>number<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span>timeit<span class="token punctuation">.</span>timeit<span class="token punctuation">(</span>stmt<span class="token operator">=</span>Single2<span class="token punctuation">,</span> number<span class="token operator">=</span>number<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre></div><p>输出结果，执行100万次，效率相差0.2秒</p><div class="language-bash" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token number">0.17731970000022557</span></span>
<span class="line"><span class="token number">0.3915019999985816</span></span>
<span class="line"></span></code></pre></div></details><h4 id="销毁实例-del" tabindex="-1"><a class="header-anchor" href="#销毁实例-del"><span>销毁实例：<code>__del__</code></span></a></h4><p>文档：<a href="https://docs.python.org/zh-cn/3.10/reference/datamodel.html#object.__del__" target="_blank" rel="noopener noreferrer">https://docs.python.org/zh-cn/3.10/reference/datamodel.html#object.<strong>del</strong></a></p><p>在实例将被销毁时调用，注意：<code>del x</code> 并不直接调用 <code>x.__del__()</code> --- 前者会将 <code>x</code> 的引用计数减一，而后者仅会在 <code>x</code> 的引用计数变为零时被调用。</p><p>代码示例</p><details class="hint-container details"><summary>点击查看完整代码</summary><div class="language-python" data-highlighter="prismjs" data-ext="py"><pre><code class="language-python"><span class="line"><span class="token comment">#!/usr/bin/env python</span></span>
<span class="line"><span class="token comment"># -*- coding:utf-8-*-</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> sys</span>
<span class="line"><span class="token keyword">import</span> time</span>
<span class="line"></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">Demo</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">__del__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;__del__ called&quot;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line">a <span class="token operator">=</span> Demo<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">b <span class="token operator">=</span> a</span>
<span class="line">c <span class="token operator">=</span> a</span>
<span class="line"></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span>a <span class="token keyword">is</span> b <span class="token keyword">is</span> c<span class="token punctuation">)</span>  <span class="token comment"># True</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span>sys<span class="token punctuation">.</span>getrefcount<span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>  <span class="token comment"># 引用计数为3， a，b,c</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">del</span> a  <span class="token comment"># del会将对象的引用计数-1，只有当对象的引用计数为0时，才会调用__del__，所以这里并不会有任何输出</span></span>
<span class="line"></span>
<span class="line">time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 程序在结束时，会将引用计数置为0，并调用一次__del__</span></span>
<span class="line"><span class="token comment"># __del__ called</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 输出结果</span></span>
<span class="line"><span class="token comment"># True</span></span>
<span class="line"><span class="token comment"># 3</span></span>
<span class="line"><span class="token comment"># __del__ called</span></span>
<span class="line"></span></code></pre></div></details><h3 id="实例-key" tabindex="-1"><a class="header-anchor" href="#实例-key"><span><code>实例[key]</code></span></a></h3><p><a href="https://docs.python.org/zh-cn/3.10/reference/datamodel.html#object.__getitem__" target="_blank" rel="noopener noreferrer">文档：https://docs.python.org/zh-cn/3.10/reference/datamodel.html#object.<strong>getitem</strong></a></p><p>代码示例</p><details class="hint-container details"><summary>点击查看完整代码</summary><div class="language-python" data-highlighter="prismjs" data-ext="py"><pre><code class="language-python"><span class="line"><span class="token comment">#!/usr/bin/env python</span></span>
<span class="line"><span class="token comment"># -*- coding:utf-8-*-</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 测试1：准备几种不同的数据结构</span></span>
<span class="line">l <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">,</span> <span class="token number">300</span><span class="token punctuation">]</span></span>
<span class="line">d <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;bob&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;age&quot;</span><span class="token punctuation">:</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">:</span> <span class="token number">20</span><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span>l<span class="token punctuation">.</span>__getitem__<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>       <span class="token comment"># 等同于 l[0], 列表没有key，只有索引，所以0代表的是索引</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span>d<span class="token punctuation">.</span>__getitem__<span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 等同于d[&quot;name&quot;]</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span>d<span class="token punctuation">.</span>__getitem__<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span>      <span class="token comment"># 等同于d[10]，这里虽然是数字，看起来像是通过索引来访问（其实不是），本质上还是通过key</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 测试2：</span></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">Demo</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        self<span class="token punctuation">.</span>data <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token string">&quot;name&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;Demo&quot;</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token string">&quot;version&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;v1&quot;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">__getitem__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> item<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;Called: __getitem__(</span><span class="token interpolation"><span class="token punctuation">{</span>item<span class="token punctuation">}</span></span><span class="token string">)&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">return</span> self<span class="token punctuation">.</span>data<span class="token punctuation">[</span>item<span class="token punctuation">]</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">__setitem__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;Called: __setitem__(</span><span class="token interpolation"><span class="token punctuation">{</span>key<span class="token punctuation">}</span></span><span class="token string">, </span><span class="token interpolation"><span class="token punctuation">{</span>value<span class="token punctuation">}</span></span><span class="token string">)&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line">        self<span class="token punctuation">.</span>data<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> value</span>
<span class="line"></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">__delitem__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;Called: __delitem__(</span><span class="token interpolation"><span class="token punctuation">{</span>key<span class="token punctuation">}</span></span><span class="token string">)&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">del</span> self<span class="token punctuation">.</span>data<span class="token punctuation">[</span>key<span class="token punctuation">]</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;-&quot;</span> <span class="token operator">*</span> <span class="token number">50</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token comment"># (1)</span></span>
<span class="line">d <span class="token operator">=</span> Demo<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span>d<span class="token punctuation">[</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># (2)</span></span>
<span class="line">d<span class="token punctuation">[</span><span class="token string">&quot;color&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;red&quot;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># (3)</span></span>
<span class="line"><span class="token keyword">del</span> d<span class="token punctuation">[</span><span class="token string">&quot;version&quot;</span><span class="token punctuation">]</span></span>
<span class="line"></span></code></pre></div><p>输出结果</p><div class="language-bash" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token number">100</span></span>
<span class="line">bob</span>
<span class="line"><span class="token number">20</span></span>
<span class="line">--------------------------------------------------</span>
<span class="line">Called: __getitem__<span class="token punctuation">(</span>name<span class="token punctuation">)</span></span>
<span class="line">Demo</span>
<span class="line">Called: __setitem__<span class="token punctuation">(</span>color, red<span class="token punctuation">)</span></span>
<span class="line">Called: __delitem__<span class="token punctuation">(</span>version<span class="token punctuation">)</span></span>
<span class="line"></span></code></pre></div></details><h3 id="实例可视化" tabindex="-1"><a class="header-anchor" href="#实例可视化"><span>实例可视化</span></a></h3><p>文档：<a href="https://docs.python.org/zh-cn/3.10/reference/datamodel.html#object.__repr__" target="_blank" rel="noopener noreferrer">https://docs.python.org/zh-cn/3.10/reference/datamodel.html#object.<strong>repr</strong></a></p><ul><li><p><code>__str__</code>和<code>__repr__</code>作用类似，推荐两个定义成一样的，并且优先定义<code>__repr__</code>（<code>__str__</code>也可以不定义会自动调用<code>__repr__</code>）</p></li><li><p><code>__str__</code>和<code>__repr__</code>不同的例子可以参考<code>datetime</code>模块实现</p><div class="language-python" data-highlighter="prismjs" data-ext="py"><pre><code class="language-python"><span class="line"><span class="token keyword">from</span> datetime <span class="token keyword">import</span> date</span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>date<span class="token punctuation">.</span>today<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>   <span class="token comment"># 2022-04-08</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">repr</span><span class="token punctuation">(</span>date<span class="token punctuation">.</span>today<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># datetime.date(2022, 4, 8)</span></span>
<span class="line"></span></code></pre></div></li><li><p><code>__format__</code>用的并不多，当需要一个对象可以展示多种样式时可以定义这个方法</p></li></ul><p>示例代码</p><details class="hint-container details"><summary>点击查看完整代码</summary><div class="language-python" data-highlighter="prismjs" data-ext="py"><pre><code class="language-python"><span class="line"><span class="token comment">#!/usr/bin/env python</span></span>
<span class="line"><span class="token comment"># -*- coding:utf-8-*-</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">Person</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        self<span class="token punctuation">.</span>name <span class="token operator">=</span> name</span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">Person2</span><span class="token punctuation">(</span>Person<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">__repr__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token string-interpolation"><span class="token string">f&#39;&lt;Person2 </span><span class="token interpolation"><span class="token punctuation">{</span>self<span class="token punctuation">.</span>name<span class="token punctuation">}</span></span><span class="token string">&gt;&#39;</span></span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 默认情况下的输出</span></span>
<span class="line">bob <span class="token operator">=</span> Person<span class="token punctuation">(</span><span class="token string">&quot;Bob&quot;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span>bob<span class="token punctuation">)</span>  <span class="token comment"># &lt;__main__.Person object at 0x0000017AE21FD548&gt;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 优化默认输出</span></span>
<span class="line">jack <span class="token operator">=</span> Person2<span class="token punctuation">(</span><span class="token string">&quot;Jack&quot;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span>jack<span class="token punctuation">)</span>  <span class="token comment"># &lt;Person2 Jack&gt;</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;-&quot;</span> <span class="token operator">*</span> <span class="token number">50</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token comment"># __format__可以定制多种输出格式</span></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">Point</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> x<span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        self<span class="token punctuation">.</span>x <span class="token operator">=</span> x</span>
<span class="line">        self<span class="token punctuation">.</span>y <span class="token operator">=</span> y</span>
<span class="line"></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">__repr__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token string-interpolation"><span class="token string">f&quot;&lt;Point (</span><span class="token interpolation"><span class="token punctuation">{</span>self<span class="token punctuation">.</span>x<span class="token punctuation">}</span></span><span class="token string">, </span><span class="token interpolation"><span class="token punctuation">{</span>self<span class="token punctuation">.</span>y<span class="token punctuation">}</span></span><span class="token string">)&gt;&quot;</span></span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">__format__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> format_spec<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token comment"># 显示格式，也可以放到类外边去定义</span></span>
<span class="line">        FORMAT <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token string">&quot;default&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;&lt;Point ({}, {})&gt;&quot;</span><span class="token punctuation">,</span>  <span class="token comment"># 默认显示格式</span></span>
<span class="line">            <span class="token string">&quot;parentheses&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;({}, {})&quot;</span><span class="token punctuation">,</span>  <span class="token comment"># 小括号显示格式</span></span>
<span class="line">            <span class="token string">&quot;dictionary&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;{{&#39;x&#39;:{}, &#39;y&#39;:{} }}&quot;</span><span class="token punctuation">,</span>  <span class="token comment"># 字典显示格式</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">        <span class="token comment"># 不指定则使用默认显示形式</span></span>
<span class="line">        <span class="token keyword">if</span> format_spec <span class="token operator">==</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token keyword">return</span> self<span class="token punctuation">.</span>__repr__<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">        <span class="token keyword">return</span> FORMAT<span class="token punctuation">[</span>format_spec<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>x<span class="token punctuation">,</span> self<span class="token punctuation">.</span>y<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line">point <span class="token operator">=</span> Point<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;</span><span class="token interpolation"><span class="token punctuation">{</span>point<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>  <span class="token comment"># 默认显示格式， &lt;Point (100, 200)&gt;</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;</span><span class="token interpolation"><span class="token punctuation">{</span>point<span class="token punctuation">:</span><span class="token format-spec">parentheses</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>  <span class="token comment"># 小括号显示格式， (100, 200)</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;</span><span class="token interpolation"><span class="token punctuation">{</span>point<span class="token punctuation">:</span><span class="token format-spec">dictionary</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>  <span class="token comment"># 字典显示格式， {&#39;x&#39;:100, &#39;y&#39;:200 }</span></span>
<span class="line"></span></code></pre></div><p>输出结果</p><div class="language-bash" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token operator">&lt;</span>__main__.Person object at 0x00000210C796590<span class="token operator"><span class="token file-descriptor important">8</span>&gt;</span></span>
<span class="line"><span class="token operator">&lt;</span>Person2 Jack<span class="token operator">&gt;</span></span>
<span class="line">--------------------------------------------------</span>
<span class="line"><span class="token operator">&lt;</span>Point <span class="token punctuation">(</span><span class="token number">100</span>, <span class="token number">200</span><span class="token punctuation">)</span><span class="token operator">&gt;</span></span>
<span class="line"><span class="token punctuation">(</span><span class="token number">100</span>, <span class="token number">200</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">{</span><span class="token string">&#39;x&#39;</span>:100, <span class="token string">&#39;y&#39;</span>:200 <span class="token punctuation">}</span></span>
<span class="line"></span></code></pre></div></details><h3 id="常用装饰器" tabindex="-1"><a class="header-anchor" href="#常用装饰器"><span>常用装饰器</span></a></h3><p>（1）属性装饰器 <code>@property</code></p><ul><li>可以将一个方法可以当做属性来访问，访问时不需要加()</li><li>同时该属性不允许直接修改，如果需要修改和删除功能，需要编写<code>@函数名.setter</code>和<code>@函数名.deleter</code>装饰的同名函数</li><li>通过黑魔法【._类名__属性名】可以修改属性值，但是强烈不建议使用这种方法</li></ul><p>（2）类方法装饰器 <code>@classmethod</code></p><p>被修饰的函数第一个参数不再是实例对象而是 类对象</p><p>（3）静态方法装饰器 <code>@staticmethod</code></p><p>修饰的函数第一个参数可以不用传，装饰器会自动给我们传进去</p><p>代码示例</p><details class="hint-container details"><summary>点击查看完整代码</summary><div class="language-python" data-highlighter="prismjs" data-ext="py"><pre><code class="language-python"><span class="line"><span class="token comment">#!/usr/bin/env python</span></span>
<span class="line"><span class="token comment"># -*- coding:utf-8-*-</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> logging</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 初始化日志</span></span>
<span class="line">FORMAT <span class="token operator">=</span> <span class="token string">&#39;%(asctime)-15s\t [%(threadName)s, %(thread)d] %(message)s&#39;</span></span>
<span class="line">logging<span class="token punctuation">.</span>basicConfig<span class="token punctuation">(</span><span class="token builtin">format</span><span class="token operator">=</span>FORMAT<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">Person</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        self<span class="token punctuation">.</span>__name <span class="token operator">=</span> name</span>
<span class="line"></span>
<span class="line">    <span class="token decorator annotation punctuation">@property</span></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">name</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        logging<span class="token punctuation">.</span>warning<span class="token punctuation">(</span><span class="token string">&quot;@property&quot;</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">return</span> self<span class="token punctuation">.</span>__name</span>
<span class="line"></span>
<span class="line">    <span class="token decorator annotation punctuation">@name<span class="token punctuation">.</span>setter</span></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">name</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        logging<span class="token punctuation">.</span>warning<span class="token punctuation">(</span><span class="token string">&quot;@name.setter&quot;</span><span class="token punctuation">)</span></span>
<span class="line">        self<span class="token punctuation">.</span>__name <span class="token operator">=</span> name</span>
<span class="line"></span>
<span class="line">    <span class="token decorator annotation punctuation">@name<span class="token punctuation">.</span>deleter</span></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">name</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        logging<span class="token punctuation">.</span>warning<span class="token punctuation">(</span><span class="token string">&quot;@name.deleter&quot;</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">del</span> self<span class="token punctuation">.</span>__name</span>
<span class="line"></span>
<span class="line"></span>
<span class="line">logging<span class="token punctuation">.</span>warning<span class="token punctuation">(</span><span class="token string">&quot;属性访问&quot;</span><span class="token punctuation">)</span></span>
<span class="line">bob <span class="token operator">=</span> Person<span class="token punctuation">(</span><span class="token string">&quot;bob&quot;</span><span class="token punctuation">)</span></span>
<span class="line">logging<span class="token punctuation">.</span>warning<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;</span><span class="token interpolation"><span class="token punctuation">{</span>bob<span class="token punctuation">.</span>name<span class="token punctuation">}</span></span><span class="token string">\n&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">logging<span class="token punctuation">.</span>warning<span class="token punctuation">(</span><span class="token string">&quot;属性设置&quot;</span><span class="token punctuation">)</span></span>
<span class="line">bob<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">&quot;Bob&quot;</span></span>
<span class="line">logging<span class="token punctuation">.</span>warning<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;</span><span class="token interpolation"><span class="token punctuation">{</span>bob<span class="token punctuation">.</span>name<span class="token punctuation">}</span></span><span class="token string">\n&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">logging<span class="token punctuation">.</span>warning<span class="token punctuation">(</span><span class="token string">&quot;黑魔法设置属性&quot;</span><span class="token punctuation">)</span></span>
<span class="line">bob<span class="token punctuation">.</span>_Person__name <span class="token operator">=</span> <span class="token string">&quot;abc&quot;</span></span>
<span class="line">logging<span class="token punctuation">.</span>warning<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;</span><span class="token interpolation"><span class="token punctuation">{</span>bob<span class="token punctuation">.</span>name<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre></div></details><h3 id="常用反射函数" tabindex="-1"><a class="header-anchor" href="#常用反射函数"><span>常用反射函数</span></a></h3><p>反射就是通过<strong>字符串</strong>映射出对象的方法</p><p>具有反射能力的函数包括<code>type()</code>、<code>isinstance()</code>、<code>callable()</code>、<code>dir</code>、<code>getattr()</code>等</p><p>这里主要说一下<code>getattr</code>系列的几个函数</p><table><thead><tr><th>函数</th><th>说明</th></tr></thead><tbody><tr><td>getattr(object, name, [default])</td><td>获取object.name属性值，如果属性不存在且未设置<code>default</code>，则抛出<code>AttributeError</code>，name必须为字符串</td></tr><tr><td>setattr(object, name, value)</td><td>设置object.name属性值，如果存在则覆盖否则新增，name必须为字符串</td></tr><tr><td>hasattr(object, name)</td><td>判断是否有object.name属性，name必须为字符串</td></tr><tr><td>delattr(object, name)</td><td>删除object.name属性，如果属性不存在抛出<code>AttributeError</code>，name必须为字符串</td></tr></tbody></table><p>代码示例</p><details class="hint-container details"><summary>点击查看完整代码</summary><div class="language-python" data-highlighter="prismjs" data-ext="py"><pre><code class="language-python"><span class="line"><span class="token comment">#!/usr/bin/env python</span></span>
<span class="line"><span class="token comment"># -*- coding:utf-8-*-</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">Point</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        self<span class="token punctuation">.</span>x <span class="token operator">=</span> x</span>
<span class="line">        self<span class="token punctuation">.</span>y <span class="token operator">=</span> y</span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token keyword">def</span> <span class="token function">show</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token punctuation">(</span>self<span class="token punctuation">.</span>x<span class="token punctuation">,</span> self<span class="token punctuation">.</span>y<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token comment"># (1) 直接给类增加方法，可以正常调用该方法</span></span>
<span class="line">Point<span class="token punctuation">.</span>show <span class="token operator">=</span> show</span>
<span class="line">p <span class="token operator">=</span> Point<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># (1, 2)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># (2) 使用setattr给类增加方法，，可以正常调用该方法</span></span>
<span class="line"><span class="token builtin">setattr</span><span class="token punctuation">(</span>Point<span class="token punctuation">,</span> <span class="token string">&quot;show&quot;</span><span class="token punctuation">,</span> show<span class="token punctuation">)</span></span>
<span class="line">p <span class="token operator">=</span> Point<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>     <span class="token comment"># (3, 4)</span></span>
<span class="line"><span class="token comment">#</span></span>
<span class="line"><span class="token comment"># # (3) 给实例增加方法，需要将实例传入到show方法中</span></span>
<span class="line">p <span class="token operator">=</span> Point<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token builtin">setattr</span><span class="token punctuation">(</span>p<span class="token punctuation">,</span> <span class="token string">&quot;show&quot;</span><span class="token punctuation">,</span> show<span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span>show<span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token comment"># 这里需要将实例传入到show方法中</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># (4) 给实例增加方法，需要将实例传入到show方法中</span></span>
<span class="line">p <span class="token operator">=</span> Point<span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span></span>
<span class="line">p<span class="token punctuation">.</span>show <span class="token operator">=</span> show</span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span>show<span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 这里需要将实例传入到show方法中</span></span>
<span class="line"></span></code></pre></div><p>输出结果</p><div class="language-bash" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token punctuation">(</span><span class="token number">1</span>, <span class="token number">2</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">(</span><span class="token number">3</span>, <span class="token number">4</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">(</span><span class="token number">5</span>, <span class="token number">6</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">(</span><span class="token number">7</span>, <span class="token number">8</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre></div></details><h3 id="运算符重载及应用" tabindex="-1"><a class="header-anchor" href="#运算符重载及应用"><span>运算符重载及应用</span></a></h3><p>文档：<a href="https://docs.python.org/zh-cn/3.10/reference/datamodel.html#emulating-numeric-types" target="_blank" rel="noopener noreferrer">https://docs.python.org/zh-cn/3.10/reference/datamodel.html#emulating-numeric-types</a></p><p>示例</p><details class="hint-container details"><summary>点击查看完整代码</summary><div class="language-python" data-highlighter="prismjs" data-ext="py"><pre><code class="language-python"><span class="line"><span class="token comment">#!/usr/bin/env python</span></span>
<span class="line"><span class="token comment"># -*- coding:utf-8-*-</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">from</span> functools <span class="token keyword">import</span> total_ordering</span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token comment"># __lt__、__le__、__gt__、__ge__全部写完的话太麻烦，使用total_ordering装饰器后，只需要实现其中一种即可；</span></span>
<span class="line"><span class="token comment"># 但是如需不需要最好不要加这个装饰器，因为可能带来性能问题</span></span>
<span class="line"></span>
<span class="line"><span class="token decorator annotation punctuation">@total_ordering</span></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">Point</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        self<span class="token punctuation">.</span>x <span class="token operator">=</span> x</span>
<span class="line">        self<span class="token punctuation">.</span>y <span class="token operator">=</span> y</span>
<span class="line"></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">__hash__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token builtin">hash</span><span class="token punctuation">(</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>x<span class="token punctuation">,</span> self<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">__eq__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> other<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token keyword">return</span> self<span class="token punctuation">.</span>x <span class="token operator">==</span> other<span class="token punctuation">.</span>x <span class="token keyword">and</span> self<span class="token punctuation">.</span>y <span class="token operator">==</span> other<span class="token punctuation">.</span>y</span>
<span class="line"></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">__repr__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token string-interpolation"><span class="token string">f&quot;&lt;Point (</span><span class="token interpolation"><span class="token punctuation">{</span>self<span class="token punctuation">.</span>x<span class="token punctuation">}</span></span><span class="token string">, </span><span class="token interpolation"><span class="token punctuation">{</span>self<span class="token punctuation">.</span>y<span class="token punctuation">}</span></span><span class="token string">)&gt;&quot;</span></span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">__add__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> other<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token keyword">return</span> Point<span class="token punctuation">(</span>self<span class="token punctuation">.</span>x <span class="token operator">+</span> other<span class="token punctuation">.</span>x<span class="token punctuation">,</span> self<span class="token punctuation">.</span>y <span class="token operator">+</span> other<span class="token punctuation">.</span>y<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">__iadd__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> other<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token keyword">return</span> Point<span class="token punctuation">(</span>self<span class="token punctuation">.</span>x <span class="token operator">+</span> other<span class="token punctuation">.</span>x<span class="token punctuation">,</span> self<span class="token punctuation">.</span>y <span class="token operator">+</span> other<span class="token punctuation">.</span>y<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">__gt__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> other<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token keyword">return</span> self<span class="token punctuation">.</span>x <span class="token operator">&gt;</span> other<span class="token punctuation">.</span>x</span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 实例化</span></span>
<span class="line">p1 <span class="token operator">=</span> Point<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span></span>
<span class="line">p2 <span class="token operator">=</span> Point<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 支持+ +=等运算符</span></span>
<span class="line">p3 <span class="token operator">=</span> p1 <span class="token operator">+</span> p2</span>
<span class="line">p1 <span class="token operator">+=</span> p2</span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span>p1 <span class="token operator">==</span> p3<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 可哈希,可作为dict/set等的key</span></span>
<span class="line">d <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span>
<span class="line">d<span class="token punctuation">[</span>p3<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;p3&quot;</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span></span>
<span class="line"></span></code></pre></div><p>输出结果</p><div class="language-bash" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line">True</span>
<span class="line"><span class="token punctuation">{</span><span class="token operator">&lt;</span>Point <span class="token punctuation">(</span><span class="token number">2</span>, <span class="token number">5</span><span class="token punctuation">)</span><span class="token operator">&gt;</span>: <span class="token string">&#39;p3&#39;</span><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre></div></details><p><strong>pathlib中的运算符重载</strong></p><div class="language-python" data-highlighter="prismjs" data-ext="py"><pre><code class="language-python"><span class="line"><span class="token comment">#!/usr/bin/env python</span></span>
<span class="line"><span class="token comment"># -*- coding:utf-8-*-</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">from</span> pathlib <span class="token keyword">import</span> Path</span>
<span class="line"></span>
<span class="line">host1 <span class="token operator">=</span> Path<span class="token punctuation">(</span><span class="token string">&quot;C:\Windows\System32\drivers\etc&quot;</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token string">&quot;hosts&quot;</span></span>
<span class="line">host2 <span class="token operator">=</span> Path<span class="token punctuation">(</span><span class="token string">&quot;C:\Windows\System32\drivers\etc&quot;</span><span class="token punctuation">)</span> <span class="token operator">/</span> Path<span class="token punctuation">(</span><span class="token string">&quot;hosts&quot;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span>host1<span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span>host1<span class="token punctuation">.</span>exists<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span>host2<span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span>host2<span class="token punctuation">.</span>exists<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># C:\Windows\System32\drivers\etc\hosts</span></span>
<span class="line"><span class="token comment"># True</span></span>
<span class="line"><span class="token comment"># C:\Windows\System32\drivers\etc\hosts</span></span>
<span class="line"><span class="token comment"># True</span></span>
<span class="line"></span></code></pre></div><h3 id="上下文管理-with" tabindex="-1"><a class="header-anchor" href="#上下文管理-with"><span>上下文管理：with</span></a></h3><p><strong>文档</strong></p><ul><li><p><a href="https://docs.python.org/zh-cn/3.10/reference/compound_stmts.html#the-with-statement" target="_blank" rel="noopener noreferrer">https://docs.python.org/zh-cn/3.10/reference/compound_stmts.html#the-with-statement</a></p></li><li><p><a href="https://docs.python.org/zh-cn/3.10/reference/datamodel.html#object.__enter__" target="_blank" rel="noopener noreferrer">https://docs.python.org/zh-cn/3.10/reference/datamodel.html#object.<strong>enter</strong></a></p></li></ul><p><strong>说明</strong></p><p><code>__enter__</code>：</p><ul><li><strong>使用<code>with..as</code>语句时，<code>__enter__</code>的返回值就等于<code>as</code>后面跟的变量</strong></li><li>如果<code>__enter__</code>方法发生错误，那么意味着<code>with</code>语句尚未开始执行，<code>__exit__</code>自然也不会执行</li><li>如果<code>__enter__</code>方法未发生错误，那么<code>__exit__()</code> 将总是被调用</li></ul><p><code>__exit__</code>:</p><ul><li><code>with</code>语句执行完成后，会自动执行<code>__exit__</code>方法，即使在with上下文中遇到异常，<code>__exit__</code>也会被执行</li><li><strong><code>__exit__</code>的返回值决定<code>with</code>语句中的异常是否向外抛出（等效于<code>False</code>为抛出异常，等效于<code>True</code>为压制异常）</strong></li></ul><p><strong>两种调用方法</strong></p><details class="hint-container details"><summary>点击查看完整代码</summary><div class="language-python" data-highlighter="prismjs" data-ext="py"><pre><code class="language-python"><span class="line"><span class="token comment">#!/usr/bin/env python</span></span>
<span class="line"><span class="token comment"># -*- coding:utf-8-*-</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">Demo</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">__enter__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&#39;__enter__ called&#39;</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">return</span> self</span>
<span class="line"></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">__exit__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> exc_type<span class="token punctuation">,</span> exc_val<span class="token punctuation">,</span> exc_tb<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&#39;__exit__ called&#39;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">demo</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token keyword">return</span> self</span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 使用实例的方式调用</span></span>
<span class="line"><span class="token keyword">with</span> Demo<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;Class test&quot;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&#39;-&#39;</span> <span class="token operator">*</span> <span class="token number">50</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 使用实例方法调用</span></span>
<span class="line"><span class="token keyword">with</span> Demo<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>demo<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> c<span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;Func test&quot;</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre></div><p>输出结果</p><div class="language-bash" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line">__enter__ called</span>
<span class="line">Class <span class="token builtin class-name">test</span></span>
<span class="line">__exit__ called</span>
<span class="line">--------------------------------------------------</span>
<span class="line">__enter__ called</span>
<span class="line">Func <span class="token builtin class-name">test</span></span>
<span class="line">__exit__ called</span>
<span class="line"></span></code></pre></div></details><p><strong>异常抛出与压制</strong></p><details class="hint-container details"><summary>点击查看完整代码</summary><div class="language-python" data-highlighter="prismjs" data-ext="py"><pre><code class="language-python"><span class="line"><span class="token comment">#!/usr/bin/env python</span></span>
<span class="line"><span class="token comment"># -*- coding:utf-8-*-</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">Demo</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">__enter__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&#39;__enter__ called&#39;</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">return</span> self</span>
<span class="line"></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">__exit__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> exc_type<span class="token punctuation">,</span> exc_val<span class="token punctuation">,</span> exc_tb<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&#39;__exit__ called&#39;</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token boolean">True</span>  <span class="token comment"># 压制异常(如果有)</span></span>
<span class="line">        <span class="token comment"># return False  # 抛出异常(如果有), 这句也可以不写，默认return None就等效于False</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 使用实例的方式调用</span></span>
<span class="line"><span class="token keyword">with</span> Demo<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> a<span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">raise</span> Exception<span class="token punctuation">(</span><span class="token string">&quot;error&quot;</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre></div></details><h3 id="实例属性查找顺序" tabindex="-1"><a class="header-anchor" href="#实例属性查找顺序"><span>实例属性查找顺序</span></a></h3><p>文档：<a href="https://docs.python.org/zh-cn/3.10/reference/datamodel.html#object.__getattribute__" target="_blank" rel="noopener noreferrer">https://docs.python.org/zh-cn/3.10/reference/datamodel.html#object.<strong>getattribute</strong></a></p><p><strong>实例属性查找顺序如下</strong></p><p>（1）主要顺序</p><p>① 调用<code>__getattribute__(item)</code> --&gt; 返回（计算后的）正常值</p><p>② 调用<code>__getattribute__(item)</code> --&gt; 返回（计算后的）异常值<code>AttributeError</code> --&gt; 如果定义了<code>__getattr__</code>则调用，否则继续抛出原来的<code>AttributeError</code></p><blockquote><p>我们可以称<code>__getattribute__</code>为属性拦截器</p></blockquote><br><p>（2）计算后的值如何获得？ 实例字典 --&gt; 类字典 --&gt; ... --&gt; 直到<code>object</code>类字典 --&gt; <code>object</code>抛出<code>AttributeError</code></p><br><p>（3）注意事项</p><p>① <code>__getattribute__(item)</code>方法中不能再使用<code>self.x</code>、<code>self.__dict__</code>等属性，因为这会造成无限递归</p><p>② <code>__getattr__</code>中不能再使用<code>self.不存在的属性</code>，因为这同样会造成无限递归</p><p>③ <code>object</code>对象没有<code>__getattr__</code>方法，所以我们不能调用父类或object的<code>__getattr__</code>方法</p><br><p><strong>实例属性查找-正常值示例</strong></p><details class="hint-container details"><summary>点击查看完整代码</summary><div class="language-python" data-highlighter="prismjs" data-ext="py"><pre><code class="language-python"><span class="line"><span class="token comment">#!/usr/bin/env python</span></span>
<span class="line"><span class="token comment"># -*- coding:utf-8-*-</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">Person</span><span class="token punctuation">:</span></span>
<span class="line">    </span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        self<span class="token punctuation">.</span>name <span class="token operator">=</span> name</span>
<span class="line"></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">getName</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token keyword">return</span> self<span class="token punctuation">.</span>name</span>
<span class="line"></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">__getattribute__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> item<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;Called __getattribute__(</span><span class="token interpolation"><span class="token punctuation">{</span>item<span class="token punctuation">}</span></span><span class="token string">)&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__getattribute__<span class="token punctuation">(</span>item<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 实例化对象</span></span>
<span class="line">person <span class="token operator">=</span> Person<span class="token punctuation">(</span><span class="token string">&quot;bob&quot;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 实例属性查找-1</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span>person<span class="token punctuation">.</span>name<span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;-&quot;</span> <span class="token operator">*</span> <span class="token number">30</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token comment"># Called __getattribute__(name)</span></span>
<span class="line"><span class="token comment"># bob</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 实例属性查找-2</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span>person<span class="token punctuation">.</span>getName<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token comment"># Called __getattribute__(getName)</span></span>
<span class="line"><span class="token comment"># Called __getattribute__(name)</span></span>
<span class="line"><span class="token comment"># bob</span></span>
<span class="line"></span></code></pre></div></details><p><strong>实例属性查找-AttributeError示例</strong></p><details class="hint-container details"><summary>点击查看完整代码</summary><div class="language-python" data-highlighter="prismjs" data-ext="py"><pre><code class="language-python"><span class="line"><span class="token comment">#!/usr/bin/env python</span></span>
<span class="line"><span class="token comment"># -*- coding:utf-8-*-</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">Person</span><span class="token punctuation">:</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        self<span class="token punctuation">.</span>name <span class="token operator">=</span> name</span>
<span class="line"></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">getName</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token keyword">return</span> self<span class="token punctuation">.</span>name</span>
<span class="line"></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">__getattribute__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> item<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;Called __getattribute__(</span><span class="token interpolation"><span class="token punctuation">{</span>item<span class="token punctuation">}</span></span><span class="token string">)&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__getattribute__<span class="token punctuation">(</span>item<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">__getattr__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> item<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token comment"># object对象没有__getattr__方法, 不能使用super</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token string-interpolation"><span class="token string">f&quot;实例对象</span><span class="token interpolation"><span class="token punctuation">{</span>self<span class="token punctuation">.</span>__class__<span class="token punctuation">.</span>__name__<span class="token punctuation">}</span></span><span class="token string">不存在</span><span class="token interpolation"><span class="token punctuation">{</span>item<span class="token punctuation">}</span></span><span class="token string">属性&quot;</span></span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 实例化对象</span></span>
<span class="line">person <span class="token operator">=</span> Person<span class="token punctuation">(</span><span class="token string">&quot;bob&quot;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 实例属性查找</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span>person<span class="token punctuation">.</span>abc<span class="token punctuation">)</span></span>
<span class="line"></span></code></pre></div></details><p>输出结果</p><div class="language-bash" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line">Called __getattribute__<span class="token punctuation">(</span>abc<span class="token punctuation">)</span></span>
<span class="line">Called __getattribute__<span class="token punctuation">(</span>__class__<span class="token punctuation">)</span></span>
<span class="line">实例对象Person不存在abc属性</span>
<span class="line"></span></code></pre></div><h3 id="迭代" tabindex="-1"><a class="header-anchor" href="#迭代"><span>迭代</span></a></h3><p>文档：<a href="https://docs.python.org/zh-cn/3.10/library/stdtypes.html#container.__iter__" target="_blank" rel="noopener noreferrer">https://docs.python.org/zh-cn/3.10/library/stdtypes.html#container.<strong>iter</strong></a></p><hr><h4 id="_1-可迭代对象和迭代器" tabindex="-1"><a class="header-anchor" href="#_1-可迭代对象和迭代器"><span><strong>（1）可迭代对象和迭代器</strong></span></a></h4><p><strong>定义</strong></p><p>语法定义：实现了<code>__iter__</code>方法的对象称为可迭代对象，实现了<code>__iter__</code>方法和<code>__next__</code>的对象称为迭代器</p><p>包含关系：迭代器是可迭代对象，但是可迭代对象不一定是迭代器</p><br><p><strong>相同点和不同点</strong></p><p>相同点</p><ul><li>都可以使用<code>for xx in xx</code>语句</li></ul><p>不同点：</p><ul><li><p><strong>同一个迭代器对象</strong>只能使用<strong>一次</strong>for语句迭代</p></li><li><p><strong>同一个可迭代对象</strong>可以<strong>多次</strong>使用for语句迭代，原因在于每次迭代<code>__iter__</code>必须要返回一个新的迭代器对象</p></li></ul><br><p><strong>相关内建函数</strong></p><ul><li><code>iter(可迭代对象)</code> 将可迭代对象转为一个新的迭代器返回，等同于调用<code>可迭代对象.__iter__()</code></li><li><code>next(迭代器)</code> 获取下一次迭代的值，迭代完成后会抛出<code>StopIteration</code>异常，for语句会自动帮我们捕获，然后退出循环</li></ul><br><p><strong>数据类型举例</strong></p><ul><li>可迭代对象：<code>str</code>、<code>list</code>、<code>tuple</code>、<code>dict</code>等</li><li>迭代器：生成器</li></ul><br><h4 id="_2-迭代次数不同示例" tabindex="-1"><a class="header-anchor" href="#_2-迭代次数不同示例"><span><strong>（2）迭代次数不同示例</strong></span></a></h4><details class="hint-container details"><summary>点击查看完整代码</summary><div class="language-python" data-highlighter="prismjs" data-ext="py"><pre><code class="language-python"><span class="line"><span class="token comment"># !/usr/bin/env python</span></span>
<span class="line"><span class="token comment"># -*- coding:utf-8-*-</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">from</span> collections<span class="token punctuation">.</span>abc <span class="token keyword">import</span> Iterable<span class="token punctuation">,</span> Iterator</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 定义数据</span></span>
<span class="line">l1 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">]</span>  <span class="token comment"># 列表是可迭代对象，但不是迭代器</span></span>
<span class="line">l2 <span class="token operator">=</span> <span class="token builtin">iter</span><span class="token punctuation">(</span>l1<span class="token punctuation">)</span>  <span class="token comment"># 使用iter(可迭代对象)可以将 可迭代对象转为迭代器</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;-&quot;</span> <span class="token operator">*</span> <span class="token number">25</span> <span class="token operator">+</span> <span class="token string">&quot; 一个可迭代对象和一个迭代器 &quot;</span> <span class="token operator">+</span> <span class="token string">&quot;-&quot;</span> <span class="token operator">*</span> <span class="token number">25</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;l1是可迭代对象: </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">isinstance</span><span class="token punctuation">(</span>l1<span class="token punctuation">,</span> Iterable<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">, 是迭代器: </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">isinstance</span><span class="token punctuation">(</span>l1<span class="token punctuation">,</span> Iterator<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;l2是可迭代对象: </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">isinstance</span><span class="token punctuation">(</span>l2<span class="token punctuation">,</span> Iterable<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">, 是迭代器: </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">isinstance</span><span class="token punctuation">(</span>l2<span class="token punctuation">,</span> Iterator<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;-&quot;</span> <span class="token operator">*</span> <span class="token number">25</span> <span class="token operator">+</span> <span class="token string">&quot;多次迭代l1&quot;</span> <span class="token operator">+</span> <span class="token string">&quot;-&quot;</span> <span class="token operator">*</span> <span class="token number">25</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">for</span> i <span class="token keyword">in</span> l1<span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">print</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">for</span> i <span class="token keyword">in</span> l1<span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">print</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;-&quot;</span> <span class="token operator">*</span> <span class="token number">25</span> <span class="token operator">+</span> <span class="token string">&quot;多次迭代l2&quot;</span> <span class="token operator">+</span> <span class="token string">&quot;-&quot;</span> <span class="token operator">*</span> <span class="token number">25</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">for</span> i <span class="token keyword">in</span> l2<span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">print</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">for</span> i <span class="token keyword">in</span> l2<span class="token punctuation">:</span>  <span class="token comment"># 这里再迭代，已经没有数据了</span></span>
<span class="line">    <span class="token keyword">print</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 需要注意的是：上面我们都是在迭代同一对象，如果是不同对象，不管是迭代器还是可迭代对象，都可以无限使用for语句，比如</span></span>
<span class="line"><span class="token comment"># for i in iter([1, 2, 3]):</span></span>
<span class="line"><span class="token comment">#     print(i)</span></span>
<span class="line"><span class="token comment"># for i in iter([1, 2, 3]):  # 注意这里又是另外一个迭代器对象了，跟上面的不一样，所以可以继续迭代</span></span>
<span class="line"><span class="token comment">#     print(i)</span></span>
<span class="line"></span></code></pre></div><p>输出结果</p><div class="language-bash" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line">------------------------- 一个可迭代对象和一个迭代器 -------------------------</span>
<span class="line">l1是可迭代对象: True, 是迭代器: False</span>
<span class="line">l2是可迭代对象: True, 是迭代器: True</span>
<span class="line">-------------------------多次迭代l1-------------------------</span>
<span class="line"><span class="token number">100</span></span>
<span class="line"><span class="token number">200</span></span>
<span class="line"></span>
<span class="line"><span class="token number">100</span></span>
<span class="line"><span class="token number">200</span></span>
<span class="line">-------------------------多次迭代l2-------------------------</span>
<span class="line"><span class="token number">100</span></span>
<span class="line"><span class="token number">200</span></span>
<span class="line"></span></code></pre></div></details><br><h4 id="_3-iter-和-next-方法" tabindex="-1"><a class="header-anchor" href="#_3-iter-和-next-方法"><span><strong>（3）<code>__iter__</code>和<code>__next__</code>方法</strong></span></a></h4><p><code>__iter__</code>必须返回一个迭代器，此时可以有以下几种返回值：</p><ul><li>返回实例本身(<code>self</code>)，意味着实例本身就是迭代器，所以也需要实现<code>__next__</code>方法</li><li>将可迭代对象转为迭代器并返回，<code>return iter(可迭代对象)</code></li><li>返回生成器（生成器是迭代器的一种）</li></ul><p><code>__next__</code>方法返回下一个值，如果值已经取完，抛出<code>StopIteration</code>，<code>for</code>语句会自动捕捉这个异常，然后退出循环</p><details class="hint-container details"><summary>自定义迭代器对象Range（仿<code>range</code>对象）</summary><div class="language-python" data-highlighter="prismjs" data-ext="py"><pre><code class="language-python"><span class="line"><span class="token comment">#!/usr/bin/env python</span></span>
<span class="line"><span class="token comment"># -*- coding:utf-8-*-</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">Range</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> start<span class="token punctuation">,</span> stop<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> step<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        self<span class="token punctuation">.</span>step <span class="token operator">=</span> step</span>
<span class="line">        <span class="token comment"># 一个参数, start = stop</span></span>
<span class="line">        <span class="token keyword">if</span> stop <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span></span>
<span class="line">            self<span class="token punctuation">.</span>start <span class="token operator">=</span> <span class="token operator">-</span> self<span class="token punctuation">.</span>step</span>
<span class="line">            self<span class="token punctuation">.</span>stop <span class="token operator">=</span> start</span>
<span class="line">        <span class="token keyword">else</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token comment"># 两个参数</span></span>
<span class="line">            self<span class="token punctuation">.</span>start <span class="token operator">=</span> start <span class="token operator">-</span> self<span class="token punctuation">.</span>step</span>
<span class="line">            self<span class="token punctuation">.</span>stop <span class="token operator">=</span> stop</span>
<span class="line"></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">__iter__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token keyword">return</span> self</span>
<span class="line"></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">__next__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        self<span class="token punctuation">.</span>start <span class="token operator">+=</span> self<span class="token punctuation">.</span>step</span>
<span class="line">        <span class="token keyword">if</span> self<span class="token punctuation">.</span>start <span class="token operator">&gt;=</span> self<span class="token punctuation">.</span>stop<span class="token punctuation">:</span></span>
<span class="line">            <span class="token keyword">raise</span> StopIteration</span>
<span class="line">        <span class="token keyword">return</span> self<span class="token punctuation">.</span>start</span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token keyword">for</span> i <span class="token keyword">in</span> Range<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">print</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">list</span><span class="token punctuation">(</span><span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token builtin">list</span><span class="token punctuation">(</span>Range<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># True</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">list</span><span class="token punctuation">(</span><span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token builtin">list</span><span class="token punctuation">(</span>Range<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># True</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">list</span><span class="token punctuation">(</span><span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token builtin">list</span><span class="token punctuation">(</span>Range<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># True</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">list</span><span class="token punctuation">(</span><span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token builtin">list</span><span class="token punctuation">(</span>Range<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># True</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">list</span><span class="token punctuation">(</span><span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token builtin">list</span><span class="token punctuation">(</span>Range<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># True</span></span>
<span class="line"></span></code></pre></div><p>输出结果</p><div class="language-bash" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token number">10</span></span>
<span class="line"><span class="token number">13</span></span>
<span class="line"><span class="token number">16</span></span>
<span class="line"><span class="token number">19</span></span>
<span class="line">True</span>
<span class="line">True</span>
<span class="line">True</span>
<span class="line">True</span>
<span class="line">True</span>
<span class="line"></span></code></pre></div></details><h4 id="_4-for循环流程" tabindex="-1"><a class="header-anchor" href="#_4-for循环流程"><span><strong>（4）<code>for</code>循环流程</strong></span></a></h4><p>① 检查对象是否实现了<code>__iter__</code>方法，如果实现了就调用它，获取一个新的迭代器</p><p>​ 调用<code>迭代器.__next__</code>方法获取下一个值，直到抛出<code>StopIteration</code>异常，for语句会自动帮我们捕获，然后退出循环</p><p>② 如果没有实现<code>__iter__</code>方法，但是实现了<code> __getitem__</code> 方法，Python会创建一个迭代器，尝试按顺序（从索引 0 开始）获取元素，</p><p>​ 直到抛出<code>IndexError</code>异常，for语句会自动帮我们捕获，然后退出循环</p><p><span style="color:red;font-weight:bold;">总结：for循环支持【迭代协议】和【使用索引】来获取值，并自动为我们处理循环完成后的异常</span></p><details class="hint-container details"><summary>不实现<code>__iter__</code>但是实现<code>__getitem__</code>示例</summary><div class="language-python" data-highlighter="prismjs" data-ext="py"><pre><code class="language-python"><span class="line"><span class="token comment">#!/usr/bin/env python</span></span>
<span class="line"><span class="token comment"># -*- coding:utf-8-*-</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token keyword">from</span> collections<span class="token punctuation">.</span>abc <span class="token keyword">import</span> Iterable<span class="token punctuation">,</span> Iterator</span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">Range</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> start<span class="token punctuation">,</span> stop<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> step<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        self<span class="token punctuation">.</span>step <span class="token operator">=</span> step</span>
<span class="line">        <span class="token comment"># 1个参数</span></span>
<span class="line">        <span class="token keyword">if</span> stop <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span></span>
<span class="line">            self<span class="token punctuation">.</span>start <span class="token operator">=</span> <span class="token operator">-</span>step</span>
<span class="line">            self<span class="token punctuation">.</span>stop <span class="token operator">=</span> start</span>
<span class="line">        <span class="token comment"># 2个参数</span></span>
<span class="line">        <span class="token keyword">else</span><span class="token punctuation">:</span></span>
<span class="line">            self<span class="token punctuation">.</span>start <span class="token operator">=</span> start <span class="token operator">-</span> step</span>
<span class="line">            self<span class="token punctuation">.</span>stop <span class="token operator">=</span> stop</span>
<span class="line"></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">__getitem__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> item<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        value <span class="token operator">=</span> self<span class="token punctuation">.</span>start <span class="token operator">+</span> self<span class="token punctuation">.</span>step <span class="token operator">*</span> <span class="token punctuation">(</span>item <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">if</span> value <span class="token operator">&gt;=</span> self<span class="token punctuation">.</span>stop<span class="token punctuation">:</span></span>
<span class="line">            <span class="token keyword">raise</span> IndexError</span>
<span class="line">        <span class="token keyword">return</span> value</span>
<span class="line"></span>
<span class="line"></span>
<span class="line">data <span class="token operator">=</span> Range<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">for</span> i <span class="token keyword">in</span> data<span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">print</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">for</span> i <span class="token keyword">in</span> data<span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">print</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">isinstance</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> Iterable<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">isinstance</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> Iterator<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 总结：</span></span>
<span class="line"><span class="token comment"># 仅利用__getitem__就可以实现for语句迭代，但是它并不是可迭代对象，更不是迭代器</span></span>
<span class="line"></span></code></pre></div><p>输出结果</p><div class="language-bash" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token number">5</span></span>
<span class="line"><span class="token number">6</span></span>
<span class="line"><span class="token number">7</span></span>
<span class="line"></span>
<span class="line"><span class="token number">5</span></span>
<span class="line"><span class="token number">6</span></span>
<span class="line"><span class="token number">7</span></span>
<span class="line"></span>
<span class="line"><span class="token number">5</span></span>
<span class="line"><span class="token number">6</span></span>
<span class="line"><span class="token number">7</span></span>
<span class="line"></span>
<span class="line">False</span>
<span class="line">False</span>
<span class="line"></span></code></pre></div></details><h3 id="继承" tabindex="-1"><a class="header-anchor" href="#继承"><span>继承</span></a></h3><p>Python支持单继承和多继承</p><h4 id="_1-哪些属性不会继承" tabindex="-1"><a class="header-anchor" href="#_1-哪些属性不会继承"><span>（1）哪些属性不会继承</span></a></h4><p>父类中的<strong>私有属性</strong>在子类中不能直接访问，但可以通过**._父类__属性**来访问</p><details class="hint-container details"><summary>点击查看完整代码</summary><div class="language-python" data-highlighter="prismjs" data-ext="py"><pre><code class="language-python"><span class="line"><span class="token comment">#!/usr/bin/env python</span></span>
<span class="line"><span class="token comment"># -*- coding:utf-8-*-</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">A</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        self<span class="token punctuation">.</span>__money <span class="token operator">=</span> <span class="token number">1000</span></span>
<span class="line">        self<span class="token punctuation">.</span>_name <span class="token operator">=</span> <span class="token string">&quot;我叫大A&quot;</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">B</span><span class="token punctuation">(</span>A<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">getMoney</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token comment"># 直接访问是访问不到的，会报错，也就是没有继承下来</span></span>
<span class="line">        <span class="token keyword">return</span> self<span class="token punctuation">.</span>__money</span>
<span class="line"></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">getMoney2</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token keyword">print</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>__dict__<span class="token punctuation">)</span>  <span class="token comment"># {&#39;_A__money&#39;: 1000, &#39;_name&#39;: &#39;我叫大A&#39;}</span></span>
<span class="line"></span>
<span class="line">        <span class="token comment"># return self._A__money  # 写法1, Pycharm会有黄色警告</span></span>
<span class="line">        <span class="token keyword">return</span> self<span class="token punctuation">.</span>__dict__<span class="token punctuation">[</span><span class="token string">&quot;_A__money&quot;</span><span class="token punctuation">]</span>  <span class="token comment"># 写法2</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span>B<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>getMoney2<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre></div></details><p>输出结果</p><div class="language-bash" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token punctuation">{</span><span class="token string">&#39;_A__money&#39;</span><span class="token builtin class-name">:</span> <span class="token number">1000</span>, <span class="token string">&#39;_name&#39;</span><span class="token builtin class-name">:</span> <span class="token string">&#39;我叫大A&#39;</span><span class="token punctuation">}</span></span>
<span class="line"><span class="token number">1000</span></span>
<span class="line"></span></code></pre></div><h4 id="_2-类与类之间的属性查找顺序" tabindex="-1"><a class="header-anchor" href="#_2-类与类之间的属性查找顺序"><span>（2）类与类之间的属性查找顺序</span></a></h4><p>按照【深度优先】的搜索顺序，使用的是C3算法</p><p>使用<code>类对象.__mro__</code> 或 <code>类对象.mro()方法</code> 可以显示查找顺序</p><details class="hint-container details"><summary>点击查看完整代码</summary><div class="language-python" data-highlighter="prismjs" data-ext="py"><pre><code class="language-python"><span class="line"><span class="token comment">#!/usr/bin/env python</span></span>
<span class="line"><span class="token comment"># -*- coding:utf-8-*-</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">A</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;Class A.__init__ called&quot;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">B</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;Class B.__init__ called&quot;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">C</span><span class="token punctuation">(</span>A<span class="token punctuation">,</span> B<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;Class C.__init__ called&quot;</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line">c <span class="token operator">=</span> C<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span>C<span class="token punctuation">.</span>mro<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 返回列表</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span>C<span class="token punctuation">.</span>__mro__<span class="token punctuation">)</span>  <span class="token comment"># 返回元组</span></span>
<span class="line"></span></code></pre></div></details><p>输出结果</p><div class="language-bash" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line">Class C.__init__ called</span>
<span class="line">Class A.__init__ called</span>
<span class="line"><span class="token punctuation">[</span><span class="token operator">&lt;</span>class <span class="token string">&#39;__main__.C&#39;</span><span class="token operator">&gt;</span>, <span class="token operator">&lt;</span>class <span class="token string">&#39;__main__.A&#39;</span><span class="token operator">&gt;</span>, <span class="token operator">&lt;</span>class <span class="token string">&#39;__main__.B&#39;</span><span class="token operator">&gt;</span>, <span class="token operator">&lt;</span>class <span class="token string">&#39;object&#39;</span><span class="token operator">&gt;</span><span class="token punctuation">]</span></span>
<span class="line"><span class="token punctuation">(</span><span class="token operator">&lt;</span>class <span class="token string">&#39;__main__.C&#39;</span><span class="token operator">&gt;</span>, <span class="token operator">&lt;</span>class <span class="token string">&#39;__main__.A&#39;</span><span class="token operator">&gt;</span>, <span class="token operator">&lt;</span>class <span class="token string">&#39;__main__.B&#39;</span><span class="token operator">&gt;</span>, <span class="token operator">&lt;</span>class <span class="token string">&#39;object&#39;</span><span class="token operator">&gt;</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre></div><h4 id="_3-super解决多继承下的问题" tabindex="-1"><a class="header-anchor" href="#_3-super解决多继承下的问题"><span>（3）super解决多继承下的问题</span></a></h4><p>若要调用父类方法，强烈建议使用<code>super()</code>而不是直接写父类名，因为在多继承中这会有问题</p><p>错误代码示例</p><details class="hint-container details"><summary>点击查看完整代码</summary><div class="language-python" data-highlighter="prismjs" data-ext="py"><pre><code class="language-python"><span class="line"><span class="token comment">#!/usr/bin/env python</span></span>
<span class="line"><span class="token comment"># -*- coding:utf-8-*-</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">Base</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;Class Base.__init__ called&quot;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">A</span><span class="token punctuation">(</span>Base<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        Base<span class="token punctuation">.</span>__init__<span class="token punctuation">(</span>self<span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;Class A.__init__ called&quot;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">B</span><span class="token punctuation">(</span>Base<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        Base<span class="token punctuation">.</span>__init__<span class="token punctuation">(</span>self<span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;Class B.__init__ called&quot;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">C</span><span class="token punctuation">(</span>A<span class="token punctuation">,</span> B<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        A<span class="token punctuation">.</span>__init__<span class="token punctuation">(</span>self<span class="token punctuation">)</span></span>
<span class="line">        B<span class="token punctuation">.</span>__init__<span class="token punctuation">(</span>self<span class="token punctuation">)</span>	<span class="token comment"># 并且，A和B的调用顺序也没有遵循MRO顺序，不够规范</span></span>
<span class="line">        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;Class C.__init__ called&quot;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line">c <span class="token operator">=</span> C<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 输出结果</span></span>
<span class="line"><span class="token comment"># Class Base.__init__ called</span></span>
<span class="line"><span class="token comment"># Class A.__init__ called</span></span>
<span class="line"><span class="token comment"># Class Base.__init__ called</span></span>
<span class="line"><span class="token comment"># Class B.__init__ called</span></span>
<span class="line"><span class="token comment"># Class C.__init__ called</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 可以看到Base.__init__调用了2次！</span></span>
<span class="line"></span></code></pre></div></details><p>正确代码示例</p><details class="hint-container details"><summary>点击查看完整代码</summary><div class="language-python" data-highlighter="prismjs" data-ext="py"><pre><code class="language-python"><span class="line"><span class="token comment">#!/usr/bin/env python</span></span>
<span class="line"><span class="token comment"># -*- coding:utf-8-*-</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">Base</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;Class Base.__init__ called&quot;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">A</span><span class="token punctuation">(</span>Base<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;Class A.__init__ called&quot;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">B</span><span class="token punctuation">(</span>Base<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;Class B.__init__ called&quot;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">C</span><span class="token punctuation">(</span>A<span class="token punctuation">,</span> B<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;Class C.__init__ called&quot;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line">c <span class="token operator">=</span> C<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 输出结果</span></span>
<span class="line"><span class="token comment"># Class Base.__init__ called</span></span>
<span class="line"><span class="token comment"># Class B.__init__ called</span></span>
<span class="line"><span class="token comment"># Class A.__init__ called</span></span>
<span class="line"><span class="token comment"># Class C.__init__ called</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 可以看到Base.__init__调用了1次</span></span>
<span class="line"></span></code></pre></div></details><h4 id="_4-继承相关魔法方法" tabindex="-1"><a class="header-anchor" href="#_4-继承相关魔法方法"><span>（4）继承相关魔法方法</span></a></h4><table><thead><tr><th>方法</th><th>说明</th></tr></thead><tbody><tr><td><code>类对象.__base__</code></td><td>类对象的父类对象，多继承情况下也只显示一个（注意：实例对象没有这个属性）</td></tr><tr><td><code>类对象.__bases__</code></td><td>类对象的父类对象元祖，多继承情况下显示所有父类（注意：实例对象没有这个属性）</td></tr><tr><td><code>类对象.__subclasses__</code></td><td>类对象的子类对象列表，与<code>__bases__</code>相对应（注意：实例对象没有这个属性）</td></tr><tr><td><code>类对象.__mro__</code> 或 <code>类对象.mro()</code></td><td>类与类之间的属性查找顺序（前面已经讲过）（注意：实例对象没有这个属性）</td></tr><tr><td><code>实例对象.__class</code>__</td><td>实例所属的类对象（本章扩展内容，与继承没有关系，单纯是记录一下）</td></tr></tbody></table><h3 id="描述器" tabindex="-1"><a class="header-anchor" href="#描述器"><span>描述器</span></a></h3><h4 id="_1-描述器定义" tabindex="-1"><a class="header-anchor" href="#_1-描述器定义"><span>（1）描述器定义</span></a></h4><p>如果实现了<code>__get__</code>、<code>__set__</code> 、<code>__delete__</code>中的任何一个，就实现了描述器定义</p><p>如果只实现了<code>__get__</code>，那么就是非数据描述器；</p><p>如果实现了<code>__get__</code>和<code>__set__</code> 或 <code>__get__</code>和<code>__delete__</code> ，那么就是数据描述器</p><h4 id="_2-非数据描述器示例" tabindex="-1"><a class="header-anchor" href="#_2-非数据描述器示例"><span>（2）非数据描述器示例</span></a></h4><details class="hint-container details"><summary>点击查看完整代码</summary><div class="language-python" data-highlighter="prismjs" data-ext="py"><pre><code class="language-python"><span class="line"><span class="token comment">#!/usr/bin/env python</span></span>
<span class="line"><span class="token comment"># -*- coding:utf-8-*-</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">A</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token triple-quoted-string string">&#39;&#39;&#39;描述器定义&#39;&#39;&#39;</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;Class A().__init__ called&quot;</span><span class="token punctuation">)</span></span>
<span class="line">        self<span class="token punctuation">.</span>x <span class="token operator">=</span> x</span>
<span class="line"></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">__get__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> instance<span class="token punctuation">,</span> owner<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token triple-quoted-string string">&quot;&quot;&quot;</span>
<span class="line">        self: A的实例对象</span>
<span class="line">        instance: B的实例对象</span>
<span class="line">        owner: B类对象</span>
<span class="line">        &quot;&quot;&quot;</span></span>
<span class="line">        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;Class A().__get__ called&quot;</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">print</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> instance<span class="token punctuation">,</span> owner<span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">return</span> self</span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">B</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token triple-quoted-string string">&quot;&quot;&quot;</span>
<span class="line">    描述器使用</span>
<span class="line">        类属性为 另一个类的实例，且另一个类定义了描述器</span>
<span class="line">        下面的 x 就是一个描述器</span>
<span class="line">    &quot;&quot;&quot;</span></span>
<span class="line">    x <span class="token operator">=</span> A<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;Class B().__init__ called&quot;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&#39;--&gt; 1&#39;</span><span class="token punctuation">)</span></span>
<span class="line">b <span class="token operator">=</span> B<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&#39;--&gt; 2&#39;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span>b<span class="token punctuation">.</span>x<span class="token punctuation">)</span></span>
<span class="line"></span></code></pre></div></details><p>输出结果</p><div class="language-bash" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line">Class A<span class="token punctuation">(</span><span class="token punctuation">)</span>.__init__ called</span>
<span class="line">--<span class="token operator">&gt;</span> <span class="token number">1</span></span>
<span class="line">Class B<span class="token punctuation">(</span><span class="token punctuation">)</span>.__init__ called</span>
<span class="line">--<span class="token operator">&gt;</span> <span class="token number">2</span></span>
<span class="line">Class A<span class="token punctuation">(</span><span class="token punctuation">)</span>.__get__ called</span>
<span class="line"><span class="token operator">&lt;</span>__main__.A object at 0x000002AD2912EB4<span class="token operator"><span class="token file-descriptor important">8</span>&gt;</span> <span class="token operator">&lt;</span>__main__.B object at 0x000002AD2912EB8<span class="token operator"><span class="token file-descriptor important">8</span>&gt;</span> <span class="token operator">&lt;</span>class <span class="token string">&#39;__main__.B&#39;</span><span class="token operator">&gt;</span></span>
<span class="line"><span class="token operator">&lt;</span>__main__.A object at 0x000002AD2912EB4<span class="token operator"><span class="token file-descriptor important">8</span>&gt;</span></span>
<span class="line"></span></code></pre></div><h4 id="_3-非数据描述器应用" tabindex="-1"><a class="header-anchor" href="#_3-非数据描述器应用"><span>（3）非数据描述器应用</span></a></h4><p>实现<code>@classmethod</code>、<code>@staticmethod</code>、<code>@property</code>装饰器</p><details class="hint-container details"><summary>点击查看完整代码</summary><div class="language-python" data-highlighter="prismjs" data-ext="py"><pre><code class="language-python"><span class="line"><span class="token comment">#!/usr/bin/env python</span></span>
<span class="line"><span class="token comment"># -*- coding:utf-8-*-</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">from</span> functools <span class="token keyword">import</span> partial</span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">StaticMethod</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> fn<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        self<span class="token punctuation">.</span>fn <span class="token operator">=</span> fn</span>
<span class="line"></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">__get__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> instance<span class="token punctuation">,</span> owner<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token keyword">return</span> self<span class="token punctuation">.</span>fn</span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">ClassMethod</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> fn<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        self<span class="token punctuation">.</span>fn <span class="token operator">=</span> fn</span>
<span class="line"></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">__get__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> instance<span class="token punctuation">,</span> owner<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token keyword">return</span> partial<span class="token punctuation">(</span>self<span class="token punctuation">.</span>fn<span class="token punctuation">,</span> owner<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">Property</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> fn<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        self<span class="token punctuation">.</span>fn <span class="token operator">=</span> fn</span>
<span class="line"></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">__get__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> instance<span class="token punctuation">,</span> owner<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token keyword">return</span> self<span class="token punctuation">.</span>fn<span class="token punctuation">(</span>instance<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">A</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token decorator annotation punctuation">@classmethod</span></span>
<span class="line">    <span class="token comment"># @ClassMethod  # c_method = ClassMethod(c_method)</span></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">class_methd</span><span class="token punctuation">(</span>cls<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;class method&quot;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment"># @staticmethod</span></span>
<span class="line">    <span class="token decorator annotation punctuation">@StaticMethod</span>  <span class="token comment"># s_method = StaticMethod(s_method)</span></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">static_method</span><span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;static method&quot;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment"># @property</span></span>
<span class="line">    <span class="token decorator annotation punctuation">@Property</span></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">ping</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token string">&quot;pong&quot;</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line">A<span class="token punctuation">.</span>class_methd<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">A<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>static_method<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span>A<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>ping<span class="token punctuation">)</span></span>
<span class="line"></span></code></pre></div></details><p>输出结果</p><div class="language-bash" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line">class method</span>
<span class="line">static method</span>
<span class="line">pongclass method</span>
<span class="line">static method</span>
<span class="line"></span></code></pre></div><h3 id="元类" tabindex="-1"><a class="header-anchor" href="#元类"><span>元类</span></a></h3><p><strong>文档</strong></p><p>（1）<a href="https://docs.python.org/zh-cn/3.10/library/functions.html#type" target="_blank" rel="noopener noreferrer">https://docs.python.org/zh-cn/3.10/library/functions.html#type</a></p><p>（2）<a href="https://docs.python.org/zh-cn/3.10/reference/datamodel.html#metaclasses" target="_blank" rel="noopener noreferrer">https://docs.python.org/zh-cn/3.10/reference/datamodel.html#metaclasses</a></p><p>元类就是创建类的类，type除了可以查看对象类型，还是内置的元类</p><h4 id="_1-使用内置元类type创建类" tabindex="-1"><a class="header-anchor" href="#_1-使用内置元类type创建类"><span>（1）使用内置元类type创建类</span></a></h4><p>示例代码</p><details class="hint-container details"><summary>点击查看完整代码</summary><div class="language-python" data-highlighter="prismjs" data-ext="py"><pre><code class="language-python"><span class="line"><span class="token comment">#!/usr/bin/env python</span></span>
<span class="line"><span class="token comment"># -*- coding:utf-8-*-</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 方式一：使用class定义类</span></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">A</span><span class="token punctuation">:</span></span>
<span class="line">    x <span class="token operator">=</span> <span class="token number">800</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 方式二：使用type类创建类</span></span>
<span class="line"><span class="token comment"># 语法：type(类名，继续的父类元组(可以为空)， 属性字典)</span></span>
<span class="line">B <span class="token operator">=</span> <span class="token builtin">type</span><span class="token punctuation">(</span><span class="token string">&quot;B&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">&quot;x&quot;</span><span class="token punctuation">:</span> <span class="token number">800</span><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span>A<span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span>B<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token punctuation">(</span>A<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token punctuation">(</span>B<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span>A<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>x<span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span>B<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>x<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span>A<span class="token punctuation">.</span>mro<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span>B<span class="token punctuation">.</span>mro<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre></div></details><p>输出结果</p><div class="language-bash" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token operator">&lt;</span>class <span class="token string">&#39;__main__.A&#39;</span><span class="token operator">&gt;</span></span>
<span class="line"><span class="token operator">&lt;</span>class <span class="token string">&#39;__main__.B&#39;</span><span class="token operator">&gt;</span></span>
<span class="line"><span class="token operator">&lt;</span>class <span class="token string">&#39;type&#39;</span><span class="token operator">&gt;</span></span>
<span class="line"><span class="token operator">&lt;</span>class <span class="token string">&#39;type&#39;</span><span class="token operator">&gt;</span></span>
<span class="line"><span class="token number">800</span></span>
<span class="line"><span class="token number">800</span></span>
<span class="line"><span class="token punctuation">[</span><span class="token operator">&lt;</span>class <span class="token string">&#39;__main__.A&#39;</span><span class="token operator">&gt;</span>, <span class="token operator">&lt;</span>class <span class="token string">&#39;object&#39;</span><span class="token operator">&gt;</span><span class="token punctuation">]</span></span>
<span class="line"><span class="token punctuation">[</span><span class="token operator">&lt;</span>class <span class="token string">&#39;__main__.B&#39;</span><span class="token operator">&gt;</span>, <span class="token operator">&lt;</span>class <span class="token string">&#39;object&#39;</span><span class="token operator">&gt;</span><span class="token punctuation">]</span></span>
<span class="line"></span></code></pre></div><h4 id="_2-自定义元类对象来创建类" tabindex="-1"><a class="header-anchor" href="#_2-自定义元类对象来创建类"><span>（2）自定义元类对象来创建类</span></a></h4><details class="hint-container details"><summary>点击查看完整代码</summary><div class="language-python" data-highlighter="prismjs" data-ext="py"><pre><code class="language-python"><span class="line"><span class="token comment">#!/usr/bin/env python</span></span>
<span class="line"><span class="token comment"># -*- coding:utf-8-*-</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 下面两段代码其实是一样的（除了类名不一样），metaclass指定了元类是谁</span></span>
<span class="line"><span class="token comment"># class A:</span></span>
<span class="line"><span class="token comment">#     x = 800</span></span>
<span class="line"><span class="token comment">#</span></span>
<span class="line"><span class="token comment">#</span></span>
<span class="line"><span class="token comment"># class B(metaclass=type):</span></span>
<span class="line"><span class="token comment">#     x = 800</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 定义自己的元类</span></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">MetaClass</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment"># 自定义元类必须要继承type</span></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">__new__</span><span class="token punctuation">(</span>cls<span class="token punctuation">,</span> name<span class="token punctuation">,</span> bases<span class="token punctuation">,</span> attrs<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;Metaclass.__new__ called&quot;</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__new__<span class="token punctuation">(</span>cls<span class="token punctuation">,</span> name<span class="token punctuation">,</span> bases<span class="token punctuation">,</span> attrs<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">,</span> bases<span class="token punctuation">,</span> attrs<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;Metaclass.__init__ called&quot;</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span>name<span class="token punctuation">,</span> bases<span class="token punctuation">,</span> attrs<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">__call__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;Metaclass.__call__ called&quot;</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__call__<span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">B</span><span class="token punctuation">(</span>metaclass<span class="token operator">=</span>MetaClass<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    f <span class="token operator">=</span> <span class="token string">&quot;2&quot;</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;B.__init__ called&quot;</span><span class="token punctuation">)</span></span>
<span class="line">        self<span class="token punctuation">.</span>name <span class="token operator">=</span> name</span>
<span class="line"></span>
<span class="line"></span>
<span class="line">b <span class="token operator">=</span> B<span class="token punctuation">(</span><span class="token string">&quot;小B&quot;</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre></div></details><p>输出结果</p><div class="language-python" data-highlighter="prismjs" data-ext="py"><pre><code class="language-python"><span class="line">Metaclass<span class="token punctuation">.</span>__new__ called</span>
<span class="line">Metaclass<span class="token punctuation">.</span>__init__ called</span>
<span class="line">Metaclass<span class="token punctuation">.</span>__call__ called</span>
<span class="line">B<span class="token punctuation">.</span>__init__ called</span>
<span class="line"></span></code></pre></div><h4 id="_3-使用元类对象创建单例类" tabindex="-1"><a class="header-anchor" href="#_3-使用元类对象创建单例类"><span>（3）使用元类对象创建单例类</span></a></h4><details class="hint-container details"><summary>点击查看完整代码</summary><div class="language-python" data-highlighter="prismjs" data-ext="py"><pre><code class="language-python"><span class="line"><span class="token comment">#!/usr/bin/env python</span></span>
<span class="line"><span class="token comment"># -*- coding:utf-8-*-</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> threading</span>
<span class="line"><span class="token keyword">import</span> time</span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">MetaSingle</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    _instance_lock <span class="token operator">=</span> threading<span class="token punctuation">.</span>Lock<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">__call__</span><span class="token punctuation">(</span>cls<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token triple-quoted-string string">&#39;&#39;&#39;</span>
<span class="line">        下面Single类实例化过程其实就等于元类的__call__调用过程，原理如下：</span>
<span class="line"></span>
<span class="line">            （1）Single   = MetaSingle(&quot;Single&quot;, (), {})</span>
<span class="line">            （2）Single() = MetaSingle(&quot;Single&quot;, (), {})()</span>
<span class="line">        &#39;&#39;&#39;</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token keyword">not</span> <span class="token builtin">hasattr</span><span class="token punctuation">(</span>cls<span class="token punctuation">,</span> <span class="token string">&quot;_instance&quot;</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token keyword">with</span> cls<span class="token punctuation">.</span>_instance_lock<span class="token punctuation">:</span></span>
<span class="line">                time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">0.1</span><span class="token punctuation">)</span>  <span class="token comment"># 这里是为了测试使用</span></span>
<span class="line">                <span class="token keyword">if</span> <span class="token keyword">not</span> <span class="token builtin">hasattr</span><span class="token punctuation">(</span>cls<span class="token punctuation">,</span> <span class="token string">&quot;_instance&quot;</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">                    cls<span class="token punctuation">.</span>_instance <span class="token operator">=</span> <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__call__<span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">return</span> cls<span class="token punctuation">.</span>_instance</span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">Single</span><span class="token punctuation">(</span>metaclass<span class="token operator">=</span>MetaSingle<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        self<span class="token punctuation">.</span>name <span class="token operator">=</span> name</span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    threading<span class="token punctuation">.</span>Thread<span class="token punctuation">(</span>target<span class="token operator">=</span><span class="token keyword">lambda</span><span class="token punctuation">:</span> <span class="token keyword">print</span><span class="token punctuation">(</span>Single<span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre></div></details><p>输出结果</p><div class="language-bash" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token operator">&lt;</span>__main__.Single object at 0x000001D92436EE4<span class="token operator"><span class="token file-descriptor important">8</span>&gt;</span></span>
<span class="line"><span class="token operator">&lt;</span>__main__.Single object at 0x000001D92436EE4<span class="token operator"><span class="token file-descriptor important">8</span>&gt;</span></span>
<span class="line"><span class="token operator">&lt;</span>__main__.Single object at 0x000001D92436EE4<span class="token operator"><span class="token file-descriptor important">8</span>&gt;</span></span>
<span class="line"><span class="token operator">&lt;</span>__main__.Single object at 0x000001D92436EE4<span class="token operator"><span class="token file-descriptor important">8</span>&gt;</span></span>
<span class="line"><span class="token operator">&lt;</span>__main__.Single object at 0x000001D92436EE4<span class="token operator"><span class="token file-descriptor important">8</span>&gt;</span></span>
<span class="line"><span class="token operator">&lt;</span>__main__.Single object at 0x000001D92436EE4<span class="token operator"><span class="token file-descriptor important">8</span>&gt;</span></span>
<span class="line"><span class="token operator">&lt;</span>__main__.Single object at 0x000001D92436EE4<span class="token operator"><span class="token file-descriptor important">8</span>&gt;</span></span>
<span class="line"><span class="token operator">&lt;</span>__main__.Single object at 0x000001D92436EE4<span class="token operator"><span class="token file-descriptor important">8</span>&gt;</span></span>
<span class="line"><span class="token operator">&lt;</span>__main__.Single object at 0x000001D92436EE4<span class="token operator"><span class="token file-descriptor important">8</span>&gt;</span></span>
<span class="line"><span class="token operator">&lt;</span>__main__.Single object at 0x000001D92436EE4<span class="token operator"><span class="token file-descriptor important">8</span>&gt;</span></span>
<span class="line"></span></code></pre></div><h4 id="_4-元类应用之抽象类" tabindex="-1"><a class="header-anchor" href="#_4-元类应用之抽象类"><span>（4）元类应用之抽象类</span></a></h4><p>抽象类就是提取一对类的共同特征，抽象称一个类</p><p>抽象类不能单独实例化、执行，必须由其他类继承</p><p>所有类都要继承自抽象类，抽象类提供的方法必须实现，否则会报错</p><p>示例代码</p><div class="language-python" data-highlighter="prismjs" data-ext="py"><pre><code class="language-python"><span class="line"><span class="token comment">#!/usr/bin/env python</span></span>
<span class="line"><span class="token comment"># -*- coding:utf-8-*-</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">from</span> abc <span class="token keyword">import</span> ABCMeta<span class="token punctuation">,</span> abstractmethod</span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">A</span><span class="token punctuation">(</span>metaclass<span class="token operator">=</span>ABCMeta<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token decorator annotation punctuation">@abstractmethod</span></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">read</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token keyword">pass</span></span>
<span class="line"></span>
<span class="line">    <span class="token decorator annotation punctuation">@abstractmethod</span></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">write</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token keyword">pass</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">B</span><span class="token punctuation">(</span>A<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token triple-quoted-string string">&#39;&#39;&#39;必须实现read和write方法，否则会报错, 比如： TypeError: Can&#39;t instantiate abstract class B with abstract methods write&#39;&#39;&#39;</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">read</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token keyword">pass</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">write</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token keyword">pass</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line">b <span class="token operator">=</span> B<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre></div><h2 id="-1" tabindex="-1"><a class="header-anchor" href="#-1"><span></span></a></h2><h2 id="七、类型注解" tabindex="-1"><a class="header-anchor" href="#七、类型注解"><span>七、类型注解</span></a></h2><p>文档：<a href="https://docs.python.org/zh-cn/3/library/typing.html" target="_blank" rel="noopener noreferrer">https://docs.python.org/zh-cn/3/library/typing.html</a></p><h3 id="泛型类型" tabindex="-1"><a class="header-anchor" href="#泛型类型"><span>泛型类型</span></a></h3><p>文档：<a href="https://docs.python.org/zh-cn/3/library/typing.html#corresponding-to-built-in-types" target="_blank" rel="noopener noreferrer">https://docs.python.org/zh-cn/3/library/typing.html#corresponding-to-built-in-types</a></p><table><thead><tr><th>泛型版本</th><th>内置类型</th><th>说明</th></tr></thead><tbody><tr><td><code>typing.Dict</code></td><td>dict</td><td></td></tr><tr><td><code>typing.List</code></td><td>list</td><td></td></tr><tr><td><code>typing.Set</code></td><td>set</td><td></td></tr><tr><td><code>typing.FrozenSet</code></td><td>frozenset</td><td></td></tr><tr><td><code>typing.Sequence</code></td><td><code>collections.abc.Sequence</code></td><td>序列类型，像list,tuple等都可以</td></tr><tr><td><code>typing.Coroutine</code></td><td><code>collections.abc.Coroutine</code></td><td>协程</td></tr></tbody></table><details class="hint-container details"><summary>typing.Sequence示例</summary><div class="language-python" data-highlighter="prismjs" data-ext="py"><pre><code class="language-python"><span class="line"><span class="token comment">#!/usr/bin/env python</span></span>
<span class="line"><span class="token comment"># -*-coding:utf-8 -*-</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">from</span> typing <span class="token keyword">import</span> Sequence</span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token keyword">def</span> <span class="token function">demo</span><span class="token punctuation">(</span>arg<span class="token punctuation">:</span> Sequence<span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token boolean">None</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 正确示例</span></span>
<span class="line">demo<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">demo<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">&quot;a&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span></span>
<span class="line">demo<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">demo<span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 错误示例</span></span>
<span class="line">demo<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre></div></details><h3 id="特殊类型" tabindex="-1"><a class="header-anchor" href="#特殊类型"><span>特殊类型</span></a></h3><p>文档：<a href="https://docs.python.org/zh-cn/3/library/typing.html#special-typing-primitives" target="_blank" rel="noopener noreferrer">https://docs.python.org/zh-cn/3/library/typing.html#special-typing-primitives</a></p><h4 id="typing-any" tabindex="-1"><a class="header-anchor" href="#typing-any"><span><code>typing.Any</code></span></a></h4><p>不受限的特殊类型，不支持 <code>[]</code></p><h4 id="typing-noreturn" tabindex="-1"><a class="header-anchor" href="#typing-noreturn"><span><code>typing.NoReturn</code></span></a></h4><p>标记没有返回值的函数的特殊类型</p><h4 id="typing-tuple" tabindex="-1"><a class="header-anchor" href="#typing-tuple"><span><code>typing.Tuple</code></span></a></h4><p>元组类型</p><details class="hint-container details"><summary>点击查看完整代码</summary><div class="language-python" data-highlighter="prismjs" data-ext="py"><pre><code class="language-python"><span class="line"><span class="token comment">#!/usr/bin/env python</span></span>
<span class="line"><span class="token comment"># -*-coding:utf-8 -*-</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">from</span> typing <span class="token keyword">import</span> Tuple</span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token keyword">def</span> <span class="token function">demo1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token comment"># 二项元组</span></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">test</span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> Tuple<span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token keyword">print</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment"># 正确示例</span></span>
<span class="line">    test<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&quot;2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment"># 错误示例</span></span>
<span class="line">    test<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">    test<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token keyword">def</span> <span class="token function">demo2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token comment"># 空元组</span></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">test</span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> Tuple<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token keyword">print</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">    test<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 正确示例</span></span>
<span class="line">    test<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 错误示例</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token keyword">def</span> <span class="token function">demo3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">test</span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> Tuple<span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token keyword">print</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">    test<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 正确示例</span></span>
<span class="line">    test<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">&quot;3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 错误示例</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line">demo1<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">demo2<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">demo3<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre></div></details><h4 id="typing-union" tabindex="-1"><a class="header-anchor" href="#typing-union"><span><code>typing.Union</code></span></a></h4><p>联合类型</p><details class="hint-container details"><summary>点击查看完整代码</summary><div class="language-python" data-highlighter="prismjs" data-ext="py"><pre><code class="language-python"><span class="line"><span class="token comment">#!/usr/bin/env python</span></span>
<span class="line"><span class="token comment"># -*-coding:utf-8 -*-</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">from</span> typing <span class="token keyword">import</span> Union</span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token keyword">def</span> <span class="token function">demo1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">test</span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> Union<span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">,</span> <span class="token builtin">float</span><span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment"># 可以简写成 x: int | float | str,推荐这种简写形式</span></span>
<span class="line">        <span class="token keyword">print</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment"># 正确示例</span></span>
<span class="line">    test<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span></span>
<span class="line">    test<span class="token punctuation">(</span><span class="token string">&quot;2&quot;</span><span class="token punctuation">)</span></span>
<span class="line">    test<span class="token punctuation">(</span><span class="token number">1.1</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment"># 错误示例</span></span>
<span class="line">    test<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span></span>
<span class="line">    test<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line">demo1<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre></div></details><h4 id="typing-optional" tabindex="-1"><a class="header-anchor" href="#typing-optional"><span><code>typing.Optional</code></span></a></h4><p>可选类型。注意，可选类型与含默认值的可选参数不同。含默认值的可选参数不需要在类型注解上添加 <code>Optional</code> 限定符，因为它仅是可选的</p><details class="hint-container details"><summary>点击查看完整代码</summary><div class="language-python" data-highlighter="prismjs" data-ext="py"><pre><code class="language-python"><span class="line"><span class="token comment">#!/usr/bin/env python</span></span>
<span class="line"><span class="token comment"># -*-coding:utf-8 -*-</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">from</span> typing <span class="token keyword">import</span> Optional</span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token keyword">def</span> <span class="token function">foo</span><span class="token punctuation">(</span>arg<span class="token punctuation">:</span> <span class="token builtin">int</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token boolean">None</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span></span>
<span class="line">    </span>
<span class="line"><span class="token keyword">def</span> <span class="token function">foo1</span><span class="token punctuation">(</span>arg<span class="token punctuation">:</span> Optional<span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">None</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token boolean">None</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 也可以改成下面这种形式，并且推荐这种形式</span></span>
<span class="line"><span class="token keyword">def</span> <span class="token function">foo2</span><span class="token punctuation">(</span>arg<span class="token punctuation">:</span> <span class="token builtin">int</span> <span class="token operator">|</span> <span class="token boolean">None</span> <span class="token operator">=</span> <span class="token boolean">None</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token boolean">None</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line">foo1<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">foo1<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span></span>
<span class="line">foo1<span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">foo2<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">foo2<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span></span>
<span class="line">foo2<span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre></div></details><h4 id="typing-callable" tabindex="-1"><a class="header-anchor" href="#typing-callable"><span><code>typing.Callable</code></span></a></h4><p>可调用类型，<code>Callable[[int], str]</code> 是把（int）转为 str 的函数</p></div><!--[--><!--]--></div><footer class="vp-page-meta"><!----><div class="vp-meta-item git-info"><div class="vp-meta-item last-updated"><span class="meta-item-label">最近更新: </span><time class="meta-item-info" datetime="2026-01-18T23:38:34.000Z" data-allow-mismatch>2026/1/18 23:38</time></div><div class="vp-meta-item contributors"><span class="meta-item-label">作者: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: vvfock3r@gmail.com">VVFock3r</span><!----><!--]--><!--]--></span></div></div></footer><!----><!--[--><!--]--></main><!--]--></div><!--[--><!----><!--]--><!--]--></div>
    <script type="module" src="/assets/app-D4_ZvgBW.js" defer></script>
  </body>
</html>
